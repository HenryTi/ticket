{"version":3,"sources":["tonwa-core/web/caller.ts","tonwa-core/web/httpChannel.ts","tonwa-core/web/httpChannelUI.ts","tonwa-core/web/apiBase.ts","tonwa-core/web/wsChannel.ts","tonwa-core/web/uqApi.ts","tonwa-core/web/appBridge.ts","tonwa-core/web/centerApi.ts","tonwa-core/web/guestApi.ts","tonwa-core/web/messageHub.ts","tonwa-core/web/host.ts","tonwa-core/web/Web.ts","tonwa-core/uqBuild/TsTemplate.ts","tonwa-core/uqCore/uqMan.ts","tonwa-core/uqBuild/UqBuildContext.ts","tonwa-core/uqCore/entity.ts","tonwa-core/uqCore/caller.ts","tonwa-core/uqCore/tuid/idCache.ts","tonwa-core/uqCore/tuid/tuid.tsx","tonwa-core/uqCore/tuid/tuidsCache.ts","tonwa-core/uqCore/action.ts","tonwa-core/uqCore/sheet.ts","tonwa-core/uqCore/query.ts","tonwa-core/uqCore/book.ts","tonwa-core/uqCore/history.ts","tonwa-core/uqCore/map.ts","tonwa-core/uqCore/pending.ts","tonwa-core/uqCore/enum.ts","tonwa-core/uqCore/ID.ts","tonwa-core/uqCore/IDCache/IDCache.ts","tonwa-core/uqCore/uqsMan.ts","tonwa-core/uqCore/uqsLoader.ts","tonwa-core/uqCore/uqStringify.ts","tonwa-core/res/res.ts","tonwa-core/res/inputRes.ts","tonwa-core/core/Tonwa.ts","tonwa-core/res/listRes.ts","tonwa-core/core/Navigo.ts","tonwa-core/tool/user.ts","tonwa-core/tool/uid.ts","tonwa-core/tool/local.ts","tonwa-core/tool/getObjPropIgnoreCase.ts","tonwa-core/tool/caseString.ts","tonwa-core/tool/rules.ts","tonwa-react/components/inputRules.ts","tonwa-react/components/form/widgets/widget.tsx","tonwa-react/components/form/widgets/textWidget.tsx","tonwa-react/components/form/widgets/textareaWidget.tsx","tonwa-react/components/form/widgets/passwordWidget.tsx","tonwa-react/components/form/widgets/numberWidget.tsx","tonwa-react/components/form/widgets/updownWidget.tsx","tonwa-react/components/form/widgets/dateWidget.tsx","tonwa-react/components/form/widgets/checkBoxWidget.tsx","tonwa-react/components/form/widgets/selectWidget.tsx","tonwa-react/components/form/widgets/radioWidget.tsx","tonwa-react/components/form/widgets/rangeWidget.tsx","tonwa-react/components/form/widgets/idWidget.tsx","tonwa-react/components/form/widgets/unknown.tsx","tonwa-react/components/form/widgets/buttonWidget.tsx","tonwa-react/components/form/context.tsx","tonwa-react/components/form/widgets/arrComponent.tsx","tonwa-react/components/image.tsx","tonwa-react/components/loading.tsx","tonwa-react/components/simple/Badge.tsx","tonwa-react/components/simple/LMR.tsx","tonwa-react/components/simple/FA.tsx","tonwa-react/components/simple/IconText.tsx","tonwa-react/components/resUploader.tsx","tonwa-react/components/edit/itemEdit.tsx","tonwa-react/components/edit/imageItemEdit.tsx","tonwa-react/components/form/widgets/imageWidget.tsx","tonwa-react/components/form/widgets/tagWidget.tsx","tonwa-react/components/form/widgets/factory.tsx","tonwa-react/components/form/form.tsx","tonwa-react/components/form/field.tsx","tonwa-react/components/edit/stringItemEdit.tsx","tonwa-react/components/edit/radioItemEdit.tsx","tonwa-react/components/edit/selectItemEdit.tsx","tonwa-react/components/edit/idItemEdit.tsx","tonwa-react/components/edit/tagItemEdit.tsx","tonwa-react/components/edit/textAreaItemEdit.tsx","tonwa-react/components/edit/checkBoxItemEdit.tsx","tonwa-react/components/edit/rangeItemEdit.tsx","tonwa-react/components/edit/numberItemEdit.tsx","tonwa-react/components/edit/edit.tsx","tonwa-react/components/list/base.tsx","tonwa-react/components/list/clickable.tsx","tonwa-react/components/list/static.tsx","tonwa-react/components/list/selectable.tsx","tonwa-react/components/list/index.tsx","tonwa-react/components/easyDate/index.tsx","tonwa-react/components/dropDownActions/index.tsx","tonwa-react/components/propGrid/row.tsx","tonwa-react/components/propGrid/propView.tsx","tonwa-react/components/propGrid/PropGrid.tsx","tonwa-react/components/media.tsx","tonwa-react/components/searchBox.tsx","tonwa-react/components/ax/index.tsx","tonwa-react/components/input/input.tsx","tonwa-react/components/input/inputs/inputNumber.tsx","tonwa-react/components/input/inputs/checkBox.tsx","tonwa-core/uqBuild/tools.ts","tonwa-react/vm/ControllerWithWeb.ts","tonwa-react/vm/View.tsx","tonwa-react/vm/VPage.tsx","tonwa-react/vm/components/CStringEdit.tsx","tonwa-react/components/page/page.tsx","tonwa-core/tool/env.ts","tonwa-react/vm/Controller.tsx","tonwa-react/components/page/scrollView.tsx","tonwa-core/tool/localDb.ts","tonwa-react/nav/NavView.tsx","tonwa-react/ui/res.ts","tonwa-react/components/login.tsx","tonwa-core/tool/62.ts","tonwa-react/components/page/pageHeader.tsx","tonwa-react/components/page/tabs.tsx","tonwa-react/nav/FetchErrorView.tsx","tonwa-core/uqBuild/buildFieldItem.ts","tonwa-react/auth/VLogout.tsx","tonwa-react/auth/VLogin.tsx","tonwa-react/auth/VChangePassword.tsx","tonwa-react/auth/VUserQuit.tsx","tonwa-react/auth/CLogin.tsx","tonwa-react/img/logo.svg","tonwa-react/auth/tools.tsx","tonwa-core/uqBuild/TsUqFolder.ts","tonwa-core/uqBuild/TsUQ.ts","tonwa-react/auth/meInfo.tsx","tonwa-react/app/vMain.tsx","tonwa-react/uq/Uq.ts","tonwa-react/uq/createUQsProxy.tsx","tonwa-react/app/CAppBase.ts","tonwa-react/app/start.ts","tonwa-react/app/CBase.ts","tonwa-react/app/WebReact.ts","tonwa-react/views/userIcon.tsx","tonwa-react/app/UqBuildContext.ts","tonwa-react/CStringEdit.tsx","tonwa-react/tool/cacheIds.ts","tonwa-react/components/reloadPage.tsx","tonwa-react/TonwaReact.tsx","uq-app/CBase.ts","uqTest/VCustomerEdit.tsx","uqTest/VUqTest.tsx","uqTest/CUqTest.ts","ids/customer/VCustomer.tsx","ids/customer/VCustomerList.tsx","ids/tool/createFormSchema.ts","ids/customer/VCustomerNew.tsx","ids/customer/VCustomerView.tsx","ids/customer/CCustomer.ts","ids/product/CProduct.ts","ids/staff/VStaff.tsx","ids/staff/VStaffList.tsx","ids/staff/VStaffNew.tsx","ids/staff/VStaffSelect.tsx","ids/staff/VStaffView.tsx","ids/staff/CStaff.ts","ids/ticket-type/VTicketTypeList.tsx","ids/ticket-type/CTicketType.ts","home/VHome.tsx","home/VTestPage1.tsx","home/VTestPage2.tsx","home/VTestPage3.tsx","home/CHome.ts","uq-app/appConfig.ts","me/VAbout.tsx","me/VMe.tsx","me/VEditMe.tsx","me/CMe.ts","uq-app/res/index.ts","uq-app/res/zh.ts","uq-app/res/en.ts","uq-app/VMain.tsx","uq-app/uqs/JsTicket/JsTicket.ts","uq-app/uqs/JsTicket/Customer.ui.tsx","uq-app/uqs/JsTicket/ProductPackage.ui.tsx","uq-app/uqs/JsTicket/Market.ui.tsx","uq-app/uqs/JsTicket/PackageVersion.ui.tsx","uq-app/uqs/JsTicket/Project.ui.tsx","uq-app/uqs/JsTicket/Ticket.ui.tsx","uq-app/uqs/JsTicket/TicketType.ui.tsx","uq-app/uqs/JsTicket/Source.ui.tsx","uq-app/uqs/JsTicket/PackageCustomer.ui.tsx","uq-app/uqs/JsTicket/TicketSheet.ui.tsx","uq-app/uqs/JsTicket/SourceCustomer.ui.tsx","uq-app/uqs/JsTicket/TicketNode.ui.tsx","uq-app/uqs/JsTicket/Staff.ui.tsx","uq-app/uqs/JsTicket/SourceCustomerSheet.ui.tsx","uq-app/uqs/JsTicket/TicketState.ui.tsx","uq-app/uqs/JsTicket/TicketAssess.ui.tsx","uq-app/uqs/index.ts","uq-app/uqs/JsTicket/index.ts","ids/ticket/VMyTickets.tsx","ids/ticket/VTicketNew.tsx","ids/ticket/CTicket.ts","uq-app/CApp.ts","uq-app/startApp.tsx","index.tsx"],"names":["Caller","params","$$user","undefined","waiting","_params","method","this","methodsWithBody","HttpChannel","web","hostUrl","apiToken","ui","timeout","startWait","endWait","url","reject","showError","error","a","env","isDevelopment","post","urlPrefix","caller","options","buildOptions","headers","path","i","h","encodeURI","p","buildParams","indexOf","body","JSON","stringify","innerFetch","ret","res","keys","Object","length","c","k","innerFetchResult","resolve","buildError","err","ex","retErr","key","channel","that","console","log","now","Date","timeOutHandler","setTimeout","fetch","ok","clearTimeout","statusText","ct","get","json","then","retJson","Array","isArray","retError","catch","text","toLowerCase","startsWith","logout","Promise","buildHeaders","language","culture","lang","CenterHttpChannel","u","appBridge","isBridged","bridgeCenterApi","UqHttpChannel","HttpChannelNavUI","onError","refetchApi","subAppWindow","ApiBase","showWaiting","token","getHttpChannel","xcall","callFetch","put","delete","UqApi","basePath","uqOwner","uqName","uq","buildAppUq","channels","channelUIs","channelUI","channelNoUIs","arr","push","uqToken","getUqToken","init","parts","split","s","trim","theUser","roles","name","start","page","entities","UnitxApi","unitId","buildChannel","centerAppApi","CenterAppApi","unitxUq","db","urlTest","realUrl","host","getUrlOrTest","CenterApiBase","getCenterChannelUI","getCenterChannel","uqTokensName","UqTokenApi","localMap","localDb","map","un","localCache","child","unit","user","loginedUserId","remove","nowTick","Math","floor","tick","value","assign","uqParams","testing","set","removeItem","CallCenterApi","call","appOwner","appName","uqs","param","UserApi","decodeUserToken","nick","icon","account","type","oem","verify","password","prop","id","postWsToSubApp","msg","postMessage","WsBase","messageHub","dispatch","wsBaseSeed","WsBridge","wsBaseId","WSChannel","wsHost","ws","WebSocket","centerToken","onopen","ev","onerror","onmessage","wsMessage","onclose","close","event","data","parse","receive","netThis","connect","send","AppBridge","uqTokens","uqTokenActions","brideCenterApis","window","addEventListener","evt","message","subFrameStarted","onWsReceive","initSubWin","navBack","callCenterApiFromMessage","source","bridgeCenterApiReturn","onReceiveAppApiMessage","hash","apiName","onAppApiReturn","clearLocal","self","parent","subWin","hideFrameBack","el","document","getElementById","hidden","setCenterToken","showAppView","uqTokenApi","action","Error","at","opener","callId","uid","from","callCenterapi","directCall","result","bca","CenterApi","app","userId","userName","GuestApi","decodeGuestToken","guest","unitName","MessageHub","handlerSeed","anyHandlers","msgHandlers","handler","seed","args0","handlerId","$type","centerHost","uqDebugHost","hosts","centerhost","local","reshost","uqhost","unitxhost","httpArr","urlFromHost","str","isAbsoluteUrl","endsWith","centerUrlFromHost","centerWsFromHost","https","substr","fetchOptions","mode","Host","resHost","tryLocal","getCenterHost","getResHost","promises","hostArr","findIndex","v","fetchUrl","debugHostUrl","localCheck","all","results","len","j","hostValue","location","includes","debugHost","testProd","getUrlOrDebug","urlDebug","fetchLocalCheck","e","Web","centerChannelUI","centerChannel","centerApi","userApi","unitxApi","guestApi","wsBridge","isBuildingUQ","_uqs","logoutUqTokens","t","resUrlFromHost","EnumResultType","TsTemplate","buildContext","tsHeader","uiPlatform","UqBuildContext","uqsLoader","uqTsSrcPath","tsTemplate","ln","chars","codeBackSlash","charCodeAt","codeN","codeT","codeB","codeF","codeV","codeR","codes","codeBN","codeBT","codeBB","codeBF","codeBV","codeBR","Entity","typeId","jName","schema","ver","sys","schemaLocal","uqApi","fields","arrFields","returns","face","fieldMaps","item","find","f","loadEntitySchema","buildSchema","loadValues","setSchema","buildFieldsTuid","version","setJName","arrs","buildFieldTuid","buildArrFieldsTuid","fieldName","arrName","fn","getTuid","an","fieldArr","tuid","buildFieldsParams","arrResult","pa","rowResult","field","d","val","buildDateTimeParam","getFullYear","getMonth","getDate","_tuid","getIdFromObj","dt","getTime","toISOString","packRow","arrData","getObjPropIgnoreCase","packArr","join","row","r","ch","substring","escape","values","boxId","unpackRow","unpackArr","ch0","fLen","to","reverseNT","n","Number","isNaN","p0","vals","EntityCaller","entity","tries","_entity","loadSchema","innerRequest","innerCall","jsonResult","$uq","$modify","pullModify","xresult","retry","uqVersion","en","rebuildSchema","buildEntities","ActionCaller","QueryQueryCaller","unpackReturns","QueryPageCaller","pageStart","pageSize","IdCache","tuidLocal","queue","cache","localArr","waitingIds","tuidInner","tonwa","createObservableMap","initLocalArr","defer","has","cacheTuids","moveToHead","shift","index","splice","_id","getValue","useId","cacheSet","loadIds","tuidValues","cacheIdValues","tuids","unpackTuidIds","tuidValue","cacheValue","cacheTuidFieldValues","ids","loadTuidIdsOrLocal","localedValues","filter","getItem","loadingIds","netIds","loadValuesFromIds","netRet","pos","setItem","IdDivCache","div","divName","UqTuid","noCache","typeName","idName","unique","isImport","TuidBox","obj","id1","ix","Tuid","idValue","TuidInner","divs","cacheFields","idCache","newVersion","removeAll","tuidDiv","TuidDiv","valueFromId","resetCache","assureObj","cacheIds","modifyIds","IdsCaller","request","GetCaller","cacheFieldsInValue","arrValues","mainFields","$create","$update","stampOnMain","unpackTuidIdsOfFields","props","SaveCaller","SavePropCaller","AllCaller","searchArr","owner","SearchCaller","LoadArrCaller","SaveArrCaller","order","ArrPosCaller","TuidNoCaller","TuidCaller","$id","transParams","arrParams","arrValue","buildDateParam","bid","$order","year","month","date","TuidImport","getObj","assureBox","hasDiv","loadMain","load","save","saveProp","search","loadArr","saveArr","posArr","no","ownerField","alert","TuidBoxDiv","TuidsCache","modifyMax","cacheTimer","clearCacheTimer","localModifyMax","max","seconds","tuidCached","innerPullModify","tuidLists","queueModify","group","modify","UqAction","ActionSubmitCaller","SubmitReturnsCaller","SubmitConvertCaller","Action","pack","UqSheet","states","ops","op","actions","discription","SaveDirectCaller","flow","state","ActionDirectCaller","brief","unpackSheet","flows","GetSheetCaller","getArchive","unpack","SheetArchiveCaller","SheetArchivesCaller","StateSheetsCaller","StateSheetCountCaller","UserSheetsCaller","MySheetsCaller","Sheet","SheetCaller","suffix","resVerify","count","UqQuery","isPaged","pageCaller","queryCaller","query","table","Query","UqBook","queryApiName","BookQueryCaller","Book","UqHistory","History","UqMap","queries","schemaFrom","actionSchema","newAction","querySchema","newQuery","AddCaller","DelCaller","PageCaller","qc","QueryCaller","Map","MapCaller","getCaller","MapAddCaller","add","MapDelCaller","MapAllCaller","MapPageCaller","MapQueryCaller","UqPending","Pending","UqEnum","UqID","create","update","ID","QueryID","IDX","UqIDX","UqIX","IX","IDCache","uqMan","timeoutHandler","timeOut","TvIdValues","IDTv","UqMan","uqData","enums","idxs","ixs","sheets","books","maps","histories","pendings","tuidsCache","localEntities","proxy","config","allRoles","tuidArr","actionArr","queryArr","idArr","idxArr","ixArr","enumArr","sheetArr","bookArr","mapArr","historyArr","pendingArr","Acts","apiActs","retArr","retActs","getAdmins","$Acts","sql","ActIX","apiActIX","$ActIX","ActIXSort","apiActIxSort","$ActIXSort","ActDetail","apiActDetail","items","main","detail","detail2","detail3","$ActDetail","apiQueryID","$QueryID","apiIDTv","retValues","$tv","nameNoVice","$IDTv","IDNO","apiIDNO","$IDNO","IDDetailGet","apiIDDetailGet","$IDDetailGet","apiID","$ID","KeyID","apiKeyID","$KeyID","apiIX","$IX","IXr","apiIXr","$IXr","KeyIX","apiKeyIX","$KeyIX","IDLog","apiIDLog","$IDLog","IDSum","apiIDSum","$IDSum","IDinIX","apiIDinIX","$IDinIX","IDxID","apiIDxID","$IDxID","IDTree","apiIDTree","$IDTree","getRoles","sheet","loadEntities","access","role","names","buildTuids","buildAccess","newTuid","entityName","allSchemas","forEach","fromType","fromObj","enm","setEntity","book","history","pending","lName","idEntity","idx","newID","newIDX","newIX","newBook","newMap","newHistory","newSheet","newPending","newEnum","buildSheet","build","buildTuidBox","buildTuidDivBox","uqKey","dev","alias","capitalCase","Proxy","target","receiver","lk","func","String","showReload","reloadTick","showReloadPage","reload","api","resultType","apiParam","nv","tv","prototype","toString","apiPost","IXs","after","postParam","toScalars","IDXToString","stamp","IX1","ID2","UQsMan","collection","uqMans","uqDataArr","uqConfigs","localCacheVersion","cacheVersion","retErrors","setTuidImportsLocal","uqConfig","ownerAlias","uqLower","buildUQs","uqsData","promiseInits","uqAlias","uqFullName","uqFull","lower","setUq","createProxy","getUqKey","getUqKeyWithConfig","setInner","tuidImport","fromName","iName","setFrom","buildingUq","UQsLoader","appConfig","uqsMan","loadApp","loadUqs","uqsManApp","UQsManApp","localData","uqAppData","loadUqAppData","loadUqData","buildUqs","appUqs","tonwaAppName","uqStringify","resOptions","$lang","district","$district","resLang","_","l","navigator","languages","toUpperCase","setResOptions","resGlobal","setRes","setGlobalRes","logMark","inputRes","required","number","integer","min","zh","listRes","none","Navigo","useHash","root","_routes","_useHash","_hash","_paused","_destroyed","_lastRouteResolved","_notFoundHandler","_defaultHandler","_usePushState","_genericHooks","_historyUpdateMethod","timout","_onLocationChange","isPushStateAvailable","replace","_cLoc","_listen","updatePageLinks","absolute","_getRoot","_historyUpdate","RegExp","href","arg0","arg1","hooks","orderedRoutes","sort","compareUrlDepth","route","on","uses","_add","reduce","current","GETParameters","extractGETParameters","onlyURL","getOnlyURL","already","matched","match","manageHooks","_callLeave","isHashedRoot","m","slice","removeEventListener","_findLinks","link","hasListenerAttached","ctrlKey","metaKey","currentTarget","tagName","getLinkPath","preventDefault","navigate","status","pause","destroy","getAttribute","as","title","pushState","replaceState","cLocRoot","isHashChangeAPIAvailable","cached","check","cleanUrl","querySelectorAll","lastRouteResolved","leave","decodeURIComponent","paramNames","regexp","PARAMETER_REGEXP","full","dots","REPLACE_VARIABLE_REGEXP","WILDCARD_REGEXP","REPLACE_WILDCARD","FOLLOWED_BY_SLASH_REGEXP","MATCH_REGEXP_FLAGS","urlA","urlB","getUrlDepth","routes","replaceDynamicURLParts","clean","regExpResultToParams","findMatchedRoutes","colonExp","routeExp","fallbackURL","matched0","cleanGETParam","exHooks","before","shouldRoute","logs","Tonwa","LocalData","navigo","navSettings","resUrl","resetAll","hashParam","windowOnError","lineno","colno","windowOnUnhandledRejection","reason","windowOnClick","windowOnMouseMove","userAgent","x","y","windowOnScroll","forceDevelopment","reloadUser","curUser","logined","notLogined","userPassword","onChangeLogin","race","serviceWorker","ready","registration","unregister","plus","webview","webView","navLogin","showLogin","back","navLogout","showLogout","navRegister","showRegister","navForget","showForget","navPageRoutes","doneSysRoutes","sysRoutes","createLogin","login","createWeb","g","unitJsonPath","unitRes","innerText","loadUnitJson","innerHTML","process","getPredefinedUnitName","unitFromName","settings","htmlTitle","html0","getElementsByTagName","origin","pathname","setCenterUrl","setGuest","onunhandledrejection","onfocus","isMobile","onselectstart","oncontextmenu","nav","clear","pwd","logindUser","isWebNav","historyAPIUpdateMethod","showPage","setNetToken","me","callback","isUserLogin","logoutApis","saveLocalUser","internalLogined","defaultTop","loginTop","logoutClear","toTimeString","step","navPage","queryStr","routeFromNavPage","internalOnNavRoutes","navOns","parser","DOMParser","htmlDoc","parseFromString","elHtml","getLogin","showChangePassword","showUserQuit","withBack","jwtDecode","ALPHABET","rtn","charAt","random","_user","_guest","_unit","firstCharUppercase","camelCase","ACode","ZCode","fromCharCode","firstCharLowercase","aCode","zCode","mobileRegex","emailRegex","Rule","defaultInputRes","RuleCustom","defy","RulePredefined","RuleRequired","RuleNum","minMsg","maxMsg","template","checkMore","RuleInt","isInteger","Widget","context","itemSchema","fieldProps","children","_itemSchema","_ui","defaultValue","rules","readOnly","disabled","errors","contextErrors","visible","isChanging","onInputChange","changeValue","container","observer","form","inNode","render","label","requiredFlag","className","FieldContainer","renderBody","makeObservable","observable","hasError","computed","isOk","getUiItem","buildRules","rule","removeErrorWidget","addErrorWidget","initData","newValue","fromElement","onChanging","onChanged","prev","allowChange","setDataValue","setElementValue","fieldClass","classNames","FieldClass","elDiscription","discriptionClassName","uiLabel","Templet","errorList","tag","React","TextWidget","inputType","input","hasFocus","onKeyDown","internalOnKeyDown","keyCode","onEnter","blur","setError","onBlur","runInAction","checkRules","checkContextRules","onFocus","clearError","clearErrors","focus","select","placeholder","renderTemplet","cn","ref","onChange","maxLength","renderErrors","TextAreaWidget","setValue","rows","PasswordWidget","UrlWidget","EmailWidget","NumberWidget","UpdownWidget","returnValue","isValidKey","DateWidget","DateTimeWidget","TimeWidget","MonthWidget","CheckBoxWidget","trueValue","falseValue","checked","onClick","defaultChecked","SelectWidget","option","list","radioStyle","height","RadioWidget","inputs","rowKey","isRow","style","RangeWidget","IdWidget","pickId","clearContextError","content","Unknown","dataType","uiType","dataTypes","ButtonWidget","submit","onButtonClick","observerRender","caption","widgetType","widget","button","ButtonClass","Context","uiSchema","subContexts","widgets","errorWidgets","arrRowContexts","itemName","getDisabled","setDisabled","getReadOnly","setReadOnly","getVisible","setVisible","buttonName","ew","checkFieldRules","rowContext","setContextError","clearWidgetsErrors","checkHasError","clearContextErrors","rowKeySeed","RowContext","parentContext","arrSchema","uiArr","itemSchemas","FormContext","ContextContainer","ArrComponent","selectable","deletable","restorable","getArrRowContexts","onDeleted","onRestored","arrLabel","ArrContainer","RowContainer","RowSeperator","formSelectable","formDeletable","formRestorable","arrSelectable","arrDeletable","arrRestorable","ac","rc","rs","first","rowContent","sep","typeofTemplet","factory","selectCheck","deleteIcon","$isSelected","$source","isDeleted","$isDeleted","editContainer","Provider","Image","src","altImage","alt","Loading","b","badge","size","color","badgeAlign","badgeVertical","LMR","cursor","left","right","FA","spin","fixWidth","border","pull","pulse","rotate","flip","inverse","IconText","iconClass","textClass","ResUploader","fileInput","fileName","upload","formData","buildFormData","Headers","append","onFilesChange","files","maxSize","FormData","file","multiple","display","formatSize","pointLength","units","toFixed","xlargeSize","mediumSize","ImageUploader","imgBaseSize","imageTypes","resUploader","desImgWidth","desImgHeight","desImgSize","srcImgWidth","srcImgHeight","isChanged","resId","enableUploadButton","srcImage","desImage","fileError","uploaded","onFileChange","lastIndexOf","reader","FileReader","readAsDataURL","onload","setSize","compress","img","width","w","scale","round","canvas","createElement","ctx","getContext","anw","createAttribute","nodeValue","anh","setAttributeNode","drawImage","base64","toDataURL","blob","convertBase64UrlToBlob","onSaved","showOrgImage","header","maxWidth","urlData","mime","bstr","atob","u8arr","Uint8Array","Blob","levelDiv","padding","ItemEdit","fileSize","uploading","AudioUploader","audioTypes","edit","uiItem","_uiItem","internalStart","internalEnd","divValue","labelHide","templet","pop","verifyRule","ImageItemEdit","ImageWidget","imageSrc","end","TagWidget","TagSingleWidget","valuesView","wrapClassName","inputName","renderRadios","TagMultiWidget","defaultArr","def","renderChecks","stringWidget","widgetFactories","string","textarea","datetime","time","email","updown","checkbox","image","checkboxes","radio","tagSingle","tagMulti","range","typeWidget","getItemSchema","getTypeWidget","hiden","widgetFactory","WidgetClass","Form","formContext","disposer","Container","watch","calcSelectOrDelete","DefaultContainer","onSubmit","DefaultFieldContainer","fieldLabelSize","fieldLabelAlign","labelView","cnAlign","fieldCol","DefaultFieldClass","DefaultButtonClass","DefaultRes","autorun","dv","initDataItem","arrItem","arrItems","arrDict","arrItemOperated","formArrVal","beforeShow","renderContent","FormField","contextType","StringItemEdit","preValue","verifyValue","onSave","inputOptions","element","RadioItemEdit","SelectItemEdit","IdItemEdit","TagItemEdit","renderInputs","TagSingleItemEdit","TagMultiItemEdit","TextAreaItemEdit","CheckBoxItemEdit","onItemChanged","RangeItemEdit","NumberItemEdit","Edit","defaultSepClassName","defaultRowContainerClassName","topBorder","bottomBorder","rowContainerClassName","rowClick","itemEdit","editInRow","onItemClick","stopEdit","topBorderClassName","bottomBorderClassName","sepClassName","ie","createItemEdit","divLabel","requireFlag","ListBase","loading","pageItems","Clickable","Static","Selectable","_items","inputItems","buildItems","itemsArray","isItemSelected","selectedItems","compare","retItems","selected","labelId","comp","selectItem","si","obItem","onSelect","flex","marginBottom","htmlFor","listenArraySplice","isObservableArray","observe","change","removedCount","added","_added","checkAll","anySelected","some","List","listBase","_$scroll","direct","buildBase","prevProps","prevState","isEqual","forceUpdate","dispose","selectAll","unselectAll","footer","waitingMore","tabIndex","isLoading","staticRow","timeRes","md","ymd","yesterday","today","tomorrow","$zh","$en","tt","renderDate","vDate","withTime","always","nDate","_date","nowYear","hour","getHours","minute","getMinutes","appendTime","dPart","hm","PropRow","PropBorder","borderTop","PropGap","valueAlignStart","valueAlignCenter","valueAlignEnd","LabeledPropRow","gridProps","_prop","col","labelFixLeft","bk","renderLabel","renderProp","align","vAlign","alignValue","renderPropBody","renderPropContent","StringPropRow","NumberPropRow","ListPropRow","borderBottom","ComponentPropRow","component","PropView","buildRows","isGap","setValues","PropGrid","propView","Ax","axProps","aClassName","naClassName","openSysPage","Input","requiredFlagElement","ruleMessage","defaultRequiredFlagElement","onValueChange","inp","containerClassName","ruleClassName","defaultRuleClassName","valueFromInput","Component","InputNumber","defaultClassName","parseFloat","parseValue","InputCheckBox","red","lastBuildTime","saveSrcTsFileIfNotExists","saveTsFileIfNotExists","saveTsFile","srcFile","tsFile","fs","existsSync","renameSync","writeFileSync","overrideTsFile","tsFilePath","getNameFromUq","devPart","uqPart","devName","ControllerWithWeb","receiveHandlerId","unregisterReceiveHandler","onDispose","onMessageReceive","onMessage","_resolve_$","webNav","registerReceiveHandler","beforeStart","afterStart","vp","open","Controller","View","controller","getTonwa","shallow","deep","V","bind","vm","afterBack","go","view","onClosePage","openPage","replacePage","backPage","level","closePage","ceasePage","removeCeased","confirmClose","regConfirmClose","popToTopPage","VPage","retOnClosePage","_onClosePage","openPageElement","renderPage","replacePageElement","onScroll","onPageScroll","onScrollTop","scroller","onPageScrollTop","onScrollBottom","onPageScrollBottom","headerClassName","tabsProps","pageWebNav","Page","tabsView","TabsView","inWebNav","pageHeaderProps","center","rph","renderPageHeader","elFooter","errorInfo","renderHeader","renderFooter","pl","decode","exec","sUnit","tc","from62","test","parseInt","timeZone","getTimezoneOffset","initEnv","browser","detectBrowser","LocalMap","ms","args","global","handle","setInterval","clearInterval","documentMode","internalT","isDev","topPageKey","buildReactiveProps","ob","beforeInit","getPageWebNav","afterInit","replaceOpen","onEvent","ceaseTop","topKey","popTo","yes","buttons","Scroller","scrollTo","scrollTop","offsetHeight","scrollTimeGap","ScrollViewBase","bottomTime","topTime","refDiv","onResize","sh","scrollHeight","top","Children","eachChild","ScrollView","WebNavScrollView","vHeader","vFooter","navHeader","navRawHeader","navFooter","navRawFooter","__ls","localStorage","LocalCache","removeLocal","Local","caches","locals","keyForGet","keyForSet","sk","LocalArr","keyForRemove","ks","unshift","saveIndex","ls","stackKey","notSupportedBrowsers","NavView","stack","waitCount","waitTimeHandler","isHistoryBack","confirm","setState","fetchError","backIcon","closeIcon","notSupportedBrowser","wait","ceased","refresh","backLevel","popAndDispose","elWait","elError","FetchErrorView","zIndex","visibility","position","onLogined","onNotLogined","importCLogin","CLogin","importCRegister","CRegister","CForget","digits","c0","c9","A","Z","z","NaN","onBack","vBack","debugLogout","rightView","Tab","loaded","contentBuilder","notify","onShown","_content","TabCaptionComponent","tabBg","selectedTab","tabArr","tabClick","tab","shown","tabs","bsCur","bsTab","tabPosition","borderColor","borderStyle","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","notifyCircle","num","displayNone","pageHeader","pageFooter","tabBack","isSelected","reApi","errContent","wordWrap","SystemNotifyPage","buildFieldItem","isKey","$FieldItemType","fieldItemType","VLogout","onLogout","VLogin","onLogin","username","sender","getSender","defaultLoginTop","privacyEntry","VChangePassword","orgPassword","newPassword","newPassword1","waitingTime","VUserQuitBase","button1Caption","onClickButton1","button2Caption","onClickButton2","note","renderButton1","renderButton2","VUserQuit","openVPage","VQuitConfirm","userQuit","VQuitDone","userLogined","vPage","getVChangePassword","changePassword","logo","senders","regex","fieldItemReplaceProps","TsUqFolder","uqsFolder","uqFolder","mkdirSync","tsUq","TsUQ","saveTuidAndIDTsIndexAndRender","imports","sets","coll","sName","cName","tsUI","toLocaleLowerCase","buildFields","tsFieldArr","buildFieldArr","replaceTsFileFields","tsImportFieldItemsBegin","tsImportFieldItemsEnd","replaceTsFileString","begin","tsIndex","readdirSync","fileEntityName","unFile","unlinkSync","buildIDFields","buildIDXFields","buildIXFields","ts","buildIDFieldArr","buildIDXFieldArr","buildIXFieldArr","readFileSync","startStr","lBrace","rBrace","oldText","fieldsText","buildFieldsFromOldText","setFieldOldProp","buildFieldText","fieldStart","fieldText","eval","sec","fieldTypeMap","sysFields","buildTuid","buildTuidInterface","buildAction","buildActionInterface","buildArrs","buildReturns","buildEnumInterface","buildQuery","buildQueryInterface","buildSheetInterface","buildBook","buildBookInterface","buildMap","buildMapInterface","buildHistory","buildHistoryInterface","buildPending","buildPendingInterface","buildID","buildIDX","buildIX","buildIDInterface","schemaKeys","others","buildIDXInterface","exFields","repeat","hasTrack","hasMemo","exField","track","memo","buildIDXActParamInterface","buildIXInterface","tsImport","appendArr","tsBuild","tsLen","uqEntityInterface","buildActsInterface","uqBlock","buildInterface","entityCode","isInID","indent","buildField","q","af","retName","VErrorsPage","VStartError","Uq","$_uqMan","$_uqSql","IDRender","renderIDUnknownType","IDType","IDV","IDLocalV","IDLocalRender","$_createUqSqlProxy","createUQsProxy","TuidView","uqReacts","$_createProxy","onUqProxyError","CAppBase","timezone","unitTimezone","uqsUser","afterBuiltUQs","onNavRoutes","initUQs","resolveRoute","userFromId","userRoles","getUqUserRoles","setUqRoles","isRole","CApp","html","cApp","CBase","getUqRoles","internalInit","wn","getWebNav","staticUserCache","WebReact","tonwaReact","setFetchError","UserCache","loader","onLoaded","getUserCache","noneImage","idProp","userCache","useUser","use","ReloadPage","timerHandler","ConfirmReloadPage","TonwaReact","navView","showPrivacyPage","privacy","getPrivacyContent","privacyPage","htmlString","__html","dangerouslySetInnerHTML","upgradeUq","setCreateLogin","unauthorized","show","CUqBase","CUqApp","VCustomerEdit","VUqTest","customer","vice","newCustomer","listCustomer","loadTvCustomer","changeCustomer","CUqTest","JsTicket","editCustomer","Customer","ChangeVice","VCustomer","VCustomerList","renderItem","customerList","showCustomer","createFormSchema","uiItems","VCustomerNew","newNo","onNewSubmit","VCustomerView","CCustomer","CProduct","VStaff","newStaff","VStaffList","staffList","showStaff","VStaffNew","Staff","VStaffSelect","staff","returnCall","renderStaff","VStaffView","CStaff","loadList","vCall","VTicketTypeList","saveTicketTypes","CTicketType","ticketTypes","retIds","SaveTicketType","submitReturns","typeVice","stateName","stateVice","TicketType","VHome","startController","cTicket","newTicket","renderMyTickets","VTestPage1","VTestPage2","inc","dec","react","showTestPage3","VTestPage3","CHome","renderView","loadMyTicket","newC","showUqTest","cUqTest","showTestPage1","showTestPage2","noUnit","VAbout","VMe","meInfo","showEditMe","userSpan","about","aboutRows","VEditMe","userSetProp","onExit","gridRows","CMe","unitOwner","rootUnits","backend","myRolesChanged","home","relation","discover","supervise","debug","aboutTheApp","pleaseLogin","SourceType","TicketBox","VMain","cHome","cMe","hasEntity","package","creator","firstState","packageVersion","ticket","operator","setUI","ProductPackage","Market","PackageVersion","Project","Ticket","Source","PackageCustomer","TicketSheet","SourceCustomer","TicketNode","SourceCustomerSheet","TicketState","TicketAssess","VMyTickets","renderMyTicket","node","onMyTicket","myTickets","VTicketNew","saveTicket","buttonDisabled","onSelectStaff","cStaff","selectStaff","setStaff","selectedStaff","CTicket","SaveTicket","MyTickets","gaps","timer","refreshTime","gapIndex","callTick","$poked","poke","loadBaseData","appStart","loginedOnly","renderNavView","setSettings","ReactDOM","StrictMode","startApp"],"mappings":"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","file":"static/js/main.98b9f9bf.chunk.js","sourcesContent":["export abstract class Caller<T> {\r\n    protected readonly _params: T;\r\n    constructor(params: T, $$user:number = undefined, waiting: boolean) {\r\n        this._params = params;\r\n        this.$$user = $$user;\r\n        this.waiting = waiting;\r\n    }\r\n    readonly $$user: number;\r\n    protected get params():any {return this._params;}\r\n    buildParams():any {return this.params;}\r\n    method: string  = 'POST';\r\n    abstract get path(): string;\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    waiting: boolean;\r\n}\r\n","//import {bridgeCenterApi, isBridged} from './appBridge';\r\nimport { FetchError } from './fetchError';\r\nimport { HttpChannelUI } from './httpChannelUI';\r\nimport { Caller } from './caller';\r\nimport { env } from '../tool';\r\nimport { Web } from './Web';\r\n\r\n/*\r\nexport async function httpGet(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.get('', params);\r\n    return ret;\r\n}\r\n\r\nexport async function httpPost(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.post('', params);\r\n    return ret;\r\n}\r\n*/\r\n\r\nconst methodsWithBody = ['POST', 'PUT'];\r\n\r\nexport abstract class HttpChannel {\r\n    private timeout: number;\r\n    protected web: Web;\r\n    protected ui?: HttpChannelUI;\r\n    protected hostUrl: string;\r\n    protected apiToken: string;\r\n\r\n    constructor(web: Web, hostUrl: string, apiToken: string, ui?: HttpChannelUI) {\r\n        this.web = web;\r\n        this.hostUrl = hostUrl;\r\n        this.apiToken = apiToken;\r\n        this.ui = ui;\r\n        this.timeout = env.isDevelopment === true ? 30000 : 50000;\r\n    }\r\n\r\n    private startWait = (waiting: boolean) => {\r\n        if (waiting === true) {\r\n            if (this.ui !== undefined) this.ui.startWait();\r\n        }\r\n    }\r\n\r\n    private endWait = (url?: string, reject?: (reason?: any) => void) => {\r\n        if (this.ui !== undefined) this.ui.endWait();\r\n        if (reject !== undefined) reject(url);\r\n    }\r\n\r\n    private showError = async (error: FetchError) => {\r\n        if (this.ui !== undefined) await this.ui.showError(error);\r\n    }\r\n\r\n    used() {\r\n        this.post('', {});\r\n    }\r\n\r\n    async xcall(urlPrefix: string, caller: Caller<any>): Promise<void> {\r\n        let options = this.buildOptions();\r\n        let { headers, path, method } = caller;\r\n        if (headers !== undefined) {\r\n            let h = options.headers;\r\n            for (let i in headers) {\r\n                //h.append(i, encodeURI(headers[i]));\r\n                h[i] = encodeURI(headers[i]);\r\n            }\r\n        }\r\n        options.method = method;\r\n        let p = caller.buildParams();\r\n        if (methodsWithBody.indexOf(method) >= 0 && p !== undefined) {\r\n            options.body = JSON.stringify(p)\r\n        }\r\n        return await this.innerFetch(urlPrefix + path, options, caller.waiting);\r\n    }\r\n\r\n    private async innerFetchResult(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let ret = await this.innerFetch(url, options, waiting);\r\n        return ret.res;\r\n    }\r\n\r\n    async get(url: string, params: any = undefined, waiting?: boolean): Promise<any> {\r\n        if (params) {\r\n            let keys = Object.keys(params);\r\n            if (keys.length > 0) {\r\n                let c = '?';\r\n                for (let k of keys) {\r\n                    let v = params[k];\r\n                    if (v === undefined) continue;\r\n                    url += c + k + '=' + params[k];\r\n                    c = '&';\r\n                }\r\n            }\r\n        }\r\n        let options = this.buildOptions();\r\n        options.method = 'GET';\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async post(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'POST';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async put(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'PUT';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async delete(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'DELETE';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n    async fetch(url: string, options: any, waiting: boolean, resolve: (value?: any) => any, reject: (reason?: any) => void): Promise<void> {\r\n        let that = this;\r\n        this.startWait(waiting);\r\n        let path = url;\r\n        function buildError(err: any, ex?: string) {\r\n            switch (typeof err) {\r\n                case 'string':\r\n                    if (ex !== undefined) err += ' ' + ex;\r\n                    break;\r\n                case 'object':\r\n                    let keys = Object.keys(err);\r\n                    let retErr: any = {\r\n                        ex: ex,\r\n                    };\r\n                    for (let key of keys) {\r\n                        retErr[key] = err[key];\r\n                    }\r\n                    err = retErr;\r\n                    break;\r\n            }\r\n            return {\r\n                channel: that,\r\n                url: path,\r\n                options: options,\r\n                resolve: resolve,\r\n                reject: reject,\r\n                error: err,\r\n            }\r\n        }\r\n        try {\r\n            console.log('%s-%s %s', options.method, path, options.body || '');\r\n            let now = Date.now();\r\n            let timeOutHandler = env.setTimeout(\r\n                undefined, //'httpChannel.fetch',\r\n                () => {\r\n                    that.endWait(`webapi timeout: ${(Date.now() - now)}ms ${url}`, reject);\r\n                },\r\n                this.timeout);\r\n            let res = await fetch(encodeURI(path), options);\r\n            if (res.ok === false) {\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('ok false endWait');\r\n                that.endWait();\r\n                console.log('call error %s', res.statusText);\r\n                throw res.statusText;\r\n            }\r\n            let ct = res.headers.get('content-type');\r\n            if (ct && ct.indexOf('json') >= 0) {\r\n                return res.json().then(async retJson => {\r\n                    env.clearTimeout(timeOutHandler);\r\n                    that.endWait();\r\n                    if (retJson.ok === true) {\r\n                        if (typeof retJson !== 'object') {\r\n                            debugger;\r\n                        }\r\n                        else if (Array.isArray(retJson) === true) {\r\n                            debugger;\r\n                        }\r\n                        return resolve(retJson);\r\n                    }\r\n                    let retError = retJson.error;\r\n                    if (retError === undefined) {\r\n                        await that.showError(buildError('not valid tonwa json'));\r\n                    }\r\n                    else {\r\n                        await that.showError(buildError(retError, 'retJson.error'));\r\n                        reject(retError);\r\n                    }\r\n                }).catch(async error => {\r\n                    await that.showError(buildError(error, 'catch res.json()'));\r\n                });\r\n            }\r\n            else {\r\n                let text = await res.text();\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('text endWait');\r\n                that.endWait();\r\n                resolve(text);\r\n            }\r\n        }\r\n        catch (error) {\r\n            this.endWait(url, reject);\r\n            if (typeof error === 'string') {\r\n                let err = error.toLowerCase();\r\n                if (err.startsWith('unauthorized') === true || err.startsWith('$roles') === true) {\r\n                    this.web.logout();\r\n                    return;\r\n                }\r\n            }\r\n            console.error('fecth error (no nav.showError): ' + url);\r\n        };\r\n    }\r\n\r\n    protected abstract innerFetch(url: string, options: any, waiting: boolean): Promise<any>;\r\n\r\n    async callFetch(url: string, method: string, body: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = method;\r\n        options.body = body;\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(url, options, true, resolve, reject);\r\n        });\r\n    }\r\n\r\n    //private buildOptions(): {method:string; headers:Headers; body:any} {\r\n    private buildOptions(): { method: string; headers: { [name: string]: string }; body: any } {\r\n        let headers = this.buildHeaders();\r\n        let options = {\r\n            headers: headers,\r\n            method: undefined as any,\r\n            body: undefined as any,\r\n            // cache: 'no-cache',\r\n        };\r\n        return options;\r\n    }\r\n\r\n    /*\r\n    protected buildHeaders():Headers {\r\n        let {language, culture} = nav;\r\n        let headers = new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        headers.append('Accept-Language', lang);\r\n        if (this.apiToken) { \r\n            headers.append('Authorization', this.apiToken); \r\n        }\r\n        return headers;\r\n    }\r\n    */\r\n    protected buildHeaders(): { [name: string]: string } {\r\n        let { language, culture } = this.web;\r\n        let headers: { [name: string]: string } = {}; //new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        //headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        headers['Content-Type'] = 'application/json;charset=UTF-8';\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        //headers.append('Accept-Language', lang);\r\n        headers['Accept-Language'] = lang;\r\n        if (this.apiToken) {\r\n            //headers.append('Authorization', this.apiToken); \r\n            headers['Authorization'] = this.apiToken;\r\n        }\r\n        return headers;\r\n    }\r\n}\r\n\r\nexport class CenterHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        let { appBridge } = this.web;\r\n        if (this.apiToken === undefined && appBridge.isBridged())\r\n            return await appBridge.bridgeCenterApi(u, options.method, options.body);\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n\r\nexport class UqHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n","import { Web } from './Web';\r\nimport { FetchError } from './fetchError';\r\n\r\nexport interface HttpChannelUI {\r\n    startWait(): void;\r\n    endWait(): void;\r\n    showError(error: FetchError): Promise<void>;\r\n    // showUpgradeUq(uq:string, version:number):Promise<void>;\r\n}\r\n\r\nexport class HttpChannelNavUI implements HttpChannelUI {\r\n    protected readonly web: Web;\r\n\r\n    constructor(web: Web) {\r\n        this.web = web;\r\n    }\r\n\r\n    startWait() {\r\n        this.web.startWait();\r\n    }\r\n    endWait() {\r\n        this.web.endWait();\r\n    }\r\n    async showError(error: FetchError): Promise<void> {\r\n        this.web.endWait();\r\n        /*\r\n        if (error.name === 'SyntaxError') {\r\n            error = {\r\n                name: error.name,\r\n                message: error.message,\r\n            }\r\n        }*/\r\n        await this.web.onError(error);\r\n    }\r\n    /*\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await this.web.tonwa.nav.showUpgradeUq(uq, version);\r\n    }\r\n    */\r\n}\r\n","import {HttpChannel} from './httpChannel';\r\nimport { Caller } from './caller';\r\nimport { Web } from './Web';\r\n\r\nexport async function refetchApi(channel:HttpChannel, url:string, options:any, \r\n    resolve:(values:any)=>any, reject:(reason:any)=>void)\r\n{\r\n    await channel.fetch(url, options, false, resolve, reject);\r\n}\r\n\r\nexport abstract class ApiBase {\r\n    protected readonly web: Web;\r\n    protected token: string;\r\n    protected path: string;\r\n    protected showWaiting: boolean;\r\n\r\n    constructor(web: Web, path: string, showWaiting: boolean) {\r\n        this.web = web;\r\n        this.path = path || '';\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    protected abstract getHttpChannel(): Promise<HttpChannel>;\r\n\r\n    async xcall(caller:Caller<any>):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.xcall(this.path, caller);\r\n    }\r\n\r\n    public async call(url:string, method:string, body:any):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.callFetch(url, method, body);\r\n    }\r\n\r\n    public async get(path:string, params:any=undefined): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.get(this.path + path, params);\r\n    }\r\n\r\n    public async post(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.post(this.path + path, params);\r\n    }\r\n\r\n    public async put(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.put(this.path + path, params);\r\n    }\r\n\r\n    public async delete(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.delete(this.path + path, params);\r\n    }\r\n}\r\n","import { Web } from \"./Web\";\r\n\r\nlet subAppWindow:Window;\r\nfunction postWsToSubApp(msg:any) {\r\n    if (subAppWindow === undefined) return;\r\n    subAppWindow.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport function setSubAppWindow(win:Window) {\r\n    subAppWindow = win;\r\n}\r\n\r\nexport function postWsToTop(msg:any) {\r\n    window.top.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport abstract class WsBase {\r\n    protected web: Web;\r\n\t//private messageHub = messageHub;\r\n    constructor(web: Web) {\r\n        this.web = web;\r\n    }\r\n\r\n\t/*\r\n    wsBaseId:string;\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n\tprivate msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\t*/\r\n\t/*\r\n    onWsReceiveAny(handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.anyHandlers[seed] = handler;\r\n        return seed;\r\n    }\r\n    onWsReceive(type:string, handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.msgHandlers[seed] = {type:type, handler: handler};\r\n        return seed;\r\n    }\r\n    endWsReceive(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n\t}\r\n\t*/\r\n    async receive(msg:any) {\r\n\t\tthis.web.messageHub.dispatch(msg);\r\n\t\t/*\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n}\r\n\r\nlet wsBaseSeed = 1;\r\nexport class WsBridge extends WsBase {\r\n    wsBaseId:string = 'WsBridge seed ' + wsBaseSeed++;\r\n}\r\n\r\nexport class WSChannel extends WsBase {\r\n    wsBaseId:string = 'WSChannel seed ' + wsBaseSeed++;\r\n    static centerToken:string;\r\n    private wsHost: string;\r\n    private token: string;\r\n    private ws: WebSocket;\r\n\r\n    constructor(web: Web, wsHost: string, token: string) {\r\n        super(web);\r\n        this.wsHost = wsHost;\r\n        this.token = token;\r\n    }\r\n\r\n    static setCenterToken(token?: string) {\r\n        WSChannel.centerToken = token;\r\n    }\r\n    \r\n    connect():Promise<void> {\r\n        //this.wsHost = wsHost;\r\n        //this.token = token || WSChannel.centerToken;\r\n        if (this.ws !== undefined) return;\r\n        let that = this;\r\n        return new Promise((resolve, reject) => {\r\n            let ws = new WebSocket(this.wsHost, this.token || WSChannel.centerToken);\r\n            console.log('connect webSocket %s', this.wsHost);\r\n            ws.onopen = (ev) => {\r\n                console.log('webSocket connected %s', this.wsHost);\r\n                that.ws = ws;\r\n                resolve();\r\n            };\r\n            ws.onerror = (ev) => {\r\n                reject('webSocket can\\'t open!');\r\n            };\r\n            ws.onmessage = async (msg) => await that.wsMessage(msg);\r\n            ws.onclose = (ev) => {\r\n                that.ws = undefined;\r\n                console.log('webSocket closed!');\r\n            }\r\n        });\r\n    }\r\n    close() {\r\n        if (this.ws !== undefined) {\r\n            this.ws.close();\r\n            this.ws = undefined;\r\n        }\r\n    }\r\n    private async wsMessage(event:any):Promise<void> {\r\n        try {\r\n            console.log('websocket message: %s', event.data);\r\n            let msg = JSON.parse(event.data);\r\n            postWsToSubApp(msg);\r\n            await this.receive(msg);\r\n        }\r\n        catch (err) {\r\n            console.log('ws msg error: ', err);\r\n        }\r\n    }\r\n    sendWs(msg:any) {\r\n        let netThis = this;\r\n        this.connect().then(() => {\r\n            netThis.ws.send(msg);\r\n        });\r\n    }\r\n}\r\n","import {HttpChannel, UqHttpChannel} from './httpChannel';\r\nimport {HttpChannelNavUI} from './httpChannelUI';\r\n//import {getUqToken, logoutUqTokens, buildAppUq} from './appBridge';\r\nimport {ApiBase} from './apiBase';\r\n//import { host } from './host';\r\nimport { LocalMap, env, decodeUserToken } from '../tool';\r\nimport { Web, PromiseValue } from './Web';\r\n\r\ninterface UqLocal {\r\n    user: number;\r\n    unit: number;\r\n    value: any;\r\n    tick?: number;\r\n    isNet?: boolean;\r\n}\r\n\r\nexport class UqApi extends ApiBase {\r\n    uqOwner: string;\r\n    uqName: string;\r\n    uq: string;\r\n\r\n    constructor(web:Web, basePath:string, uqOwner:string, uqName:string, showWaiting?: boolean) {\r\n        super(web, basePath, showWaiting);\r\n        if (uqName) {\r\n            this.uqOwner = uqOwner;\r\n            this.uqName = uqName;\r\n            this.uq = uqOwner + '/' + uqName;\r\n        }\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    async init() {\r\n        await this.web.appBridge.buildAppUq(this.uq, this.uqOwner, this.uqName);\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channels: {[name:string]: HttpChannel|(PromiseValue<any>[])};\r\n        let channelUI: HttpChannelNavUI;\r\n        if (this.showWaiting === true || this.showWaiting === undefined) {\r\n            channels = this.web.channelUIs;\r\n            channelUI = new HttpChannelNavUI(this.web);\r\n        }\r\n        else {\r\n            channels = this.web.channelNoUIs;\r\n        }\r\n        let channel = channels[this.uq];\r\n\t\tif (channel !== undefined) {\r\n\t\t\tif (Array.isArray(channel) === false) return channel as HttpChannel;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tchannel = channels[this.uq] = [];\r\n\t\t}\r\n\t\tlet arr = channel as PromiseValue<any>[];\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\tarr.push({resolve, reject});\r\n\t\t\tif (arr.length !== 1) return;\r\n\t\t\tlet uqToken = this.web.appBridge.getUqToken(this.uq); //, this.uqOwner, this.uqName);\r\n\t\t\tif (!uqToken) {\r\n\t\t\t\t//debugger;\r\n\t\t\t\tawait this.init();\r\n\t\t\t\tuqToken = this.web.appBridge.getUqToken(this.uq);\r\n\t\t\t}\r\n\t\t\tlet {url, token} = uqToken;\r\n\t\t\tthis.token = token;\r\n\t\t\tchannel = new UqHttpChannel(this.web, url, token, channelUI);\r\n\t\t\tchannels[this.uq] = channel;\r\n\t\t\tfor (let pv of arr) {\r\n\t\t\t\tpv.resolve(channel);\r\n\t\t\t}\r\n\r\n\t\t});\r\n    }\r\n\r\n    /*async update():Promise<string> {\r\n        return await this.get('update');\r\n    }*/\r\n\r\n    /*\r\n    async __loadAccess():Promise<any> {\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        let ret = await this.get('access', {acc:acc});\r\n        return ret;\r\n    }\r\n    */\r\n    async loadEntities():Promise<any> {\r\n        //return await localUqs.loadAccess(this);\r\n        //let acc = this.access === undefined?\r\n        //    '' :\r\n        //    this.access.join('|');\r\n\t\t//let ret = await this.get('access', {acc:acc});\r\n\t\tlet ret = await this.get('entities');\r\n        return ret;\r\n\t}\r\n    async getAdmins():Promise<{id:number;role:number}[]> {\r\n\t\tlet ret = await this.get('get-admins',);\r\n\t\treturn ret;\r\n    }\r\n \tasync getRoles():Promise<string[]> {\r\n\t\tlet ret = await this.get('get-roles',);\r\n\t\tif (!ret) return null;\r\n\t\tlet parts:string[] = (ret as string).split('|');\r\n\t\tlet s:string[] = [];\r\n\t\tfor (let p of parts) {\r\n\t\t\tp = p.trim();\r\n\t\t\tif (!p) continue;\r\n\t\t\ts.push(p);\r\n\t\t}\r\n\t\tif (s.length === 0) return null;\r\n\t\treturn s;\r\n\t}\r\n\tasync getAllRoleUsers():Promise<{user:number, admin:number, roles:string}[]> {\r\n\t\tlet ret = await this.get('get-all-role-users');\r\n\t\treturn ret;\r\n\t}\r\n\tasync setUserRoles(theUser:number, roles:string):Promise<void> {\r\n\t\tawait this.post('set-user-roles', {theUser, roles});\r\n\t}\r\n\tasync deleteUserRoles(theUser:number):Promise<void> {\r\n\t\tawait this.get('delete-user-roles', {theUser});\r\n\t}\r\n\r\n\tasync allSchemas(): Promise<any> {\r\n\t\treturn await this.get('all-schemas');\r\n\t}\r\n\r\n    async schema(name:string):Promise<any> {\r\n        return await this.get('schema/' + name);\r\n    }\r\n\r\n    async queueModify(start:number, page:number, entities:string) {\r\n        return await this.post('queue-modify', {start:start, page:page, entities:entities});\r\n    }\r\n}\r\n\r\n/*\r\nlet channels:{[unitId:number]: HttpChannel} = {};\r\n\r\nexport function logoutUnitxApis() {\r\n    channels = {};\r\n}\r\n*/\r\n\r\nexport class UnitxApi extends UqApi {\r\n    private unitId:number;\r\n    constructor(web:Web, unitId:number) {\r\n        super(web, 'tv/', undefined, undefined, true);\r\n        this.unitId = unitId;\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channel = this.web.channels[this.unitId];\r\n        if (channel !== undefined) return channel;\r\n        return this.web.channels[this.unitId] = await this.buildChannel();\r\n    }\r\n\r\n    private async buildChannel():Promise<HttpChannel> {        \r\n        let channelUI = new HttpChannelNavUI(this.web);\r\n        let centerAppApi = new CenterAppApi(this.web, 'tv/', undefined);\r\n        let ret = await centerAppApi.unitxUq(this.unitId);\r\n        let {token, db, url, urlTest} = ret;\r\n        let realUrl = this.web.host.getUrlOrTest(db, url, urlTest);\r\n        this.token = token;\r\n        return new UqHttpChannel(this.web, realUrl, token, channelUI);\r\n    }\r\n}\r\nexport abstract class CenterApiBase extends ApiBase {\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let ret: HttpChannel;\r\n        if (this.showWaiting === true || this.showWaiting === undefined) {\r\n            ret = this.web.getCenterChannelUI();\r\n        }\r\n        else {\r\n            ret = this.web.getCenterChannel();\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nconst uqTokensName = 'uqTokens';\r\nexport class UqTokenApi extends CenterApiBase {\r\n\tstatic clearLocal() {\r\n\t\tenv.localDb.removeItem(uqTokensName);\r\n\t}\r\n    private localMap: LocalMap = env.localDb.map(uqTokensName);\r\n\r\n    async uq(params: {unit:number, uqOwner:string, uqName:string}):Promise<any> {\r\n        let {uqOwner, uqName} = params;\r\n        let un = uqOwner+'/'+uqName;\r\n        let localCache = this.localMap.child(un);\r\n        try {\r\n            let uqToken:UqLocal = localCache.get();\r\n            if (uqToken !== undefined) {\r\n                let {unit, user} = uqToken;\r\n                if (unit !== params.unit || user !== this.web.loginedUserId) {\r\n                    localCache.remove();\r\n                    uqToken = undefined;\r\n                }\r\n            }\r\n            let nowTick = Math.floor(Date.now() / 1000);\r\n            if (uqToken !== undefined) {\r\n                let {tick, value} = uqToken;\r\n                if (value !== undefined && (nowTick - tick) < 24*3600) {\r\n                    return Object.assign({}, value);\r\n                }\r\n            }\r\n            let uqParams:any = Object.assign({}, params);\r\n            uqParams.testing = this.web.host.testing;\r\n            let ret = await this.get('uq-token', uqParams);\r\n            if (ret === undefined) {\r\n                let {unit, uqOwner, uqName} = params;\r\n                let err = `center get app-uq(unit=${unit}, '${uqOwner}/${uqName}') - not exists or no unit-service`;\r\n                throw err;\r\n            }\r\n\r\n            uqToken = {\r\n                unit: params.unit,\r\n                user: this.web.loginedUserId,\r\n                tick: nowTick,\r\n                value: ret,\r\n            }\r\n            localCache.set(uqToken);\r\n            return Object.assign({}, ret);\r\n        }\r\n        catch (err) {\r\n            localCache.remove();\r\n            throw err;\r\n        }\r\n    }\r\n}\r\n\r\nexport class CallCenterApi extends CenterApiBase {\r\n    directCall(url:string, method:string, body:any):Promise<any> {\r\n        return this.call(url, method, body);\r\n    }\r\n}\r\n\r\nexport interface UqAppData {\r\n    appName: string;\r\n    appOwner: string;\r\n    id: number;\r\n    version: string;        // AppUI version\r\n    uqs: UqData[];\r\n}\r\n\r\nexport interface UqData {\r\n    id: number;\r\n    uqOwner: string;\r\n\townerAlias: string;\r\n    uqName: string;\r\n\tuqAlias: string;\r\n    access: string;\r\n    newVersion: boolean;\r\n}\r\n\r\nexport interface UqServiceData {\r\n    id: number;\r\n    db: string;\r\n    url: string;\r\n    urlTest: string;\r\n    token: string;\r\n}\r\n\r\n//const appUqsName = 'appUqs';\r\n\r\nexport class CenterAppApi extends CenterApiBase {\r\n    async appUqs(appOwner:string, appName:string):Promise<UqAppData> {\r\n        let ret:UqAppData = await this.get('tie/app-uqs', {appOwner, appName});\r\n        return ret;\r\n    }\r\n    async uqs(uqs: {owner:string; name:string; version:string}[]):Promise<UqData[]> {\r\n        return await this.post('tie/pure-uqs', uqs);\r\n    }\r\n    async unitxUq(unit:number):Promise<UqServiceData> {\r\n        return await this.get('tie/unitx-uq', {unit:unit});\r\n    }\r\n    async changePassword(param: {orgPassword:string, newPassword:string}) {\r\n        return await this.post('tie/change-password', param);\r\n    }\r\n\r\n    async userQuit(): Promise<void> {\r\n        await this.get('tie/user-ask-quit', {});\r\n    }\r\n}\r\n\r\nexport interface RegisterParameter {\r\n    nick:string, \r\n    user:string, \r\n    pwd:string,\r\n    country:number, \r\n    mobile:number, \r\n    mobileCountry:number,\r\n    email:string,\r\n    verify:string,\r\n};\r\n\r\nexport class UserApi extends CenterApiBase {\r\n    async login(params: {user: string, pwd: string, guest: number}): Promise<any> {\r\n        //(params as any).device = nav.local.device.get();\r\n        let ret = await this.post('user/login', params);\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeUserToken(ret);\r\n            case 'object':\r\n                let token = ret.token;\r\n                let user = decodeUserToken(token);\r\n                let {nick, icon} = ret;\r\n                if (nick) user.nick = nick;\r\n                if (icon) user.icon = icon;\r\n                return user;\r\n        }\r\n        // !== undefined) return decodeToken(token);\r\n    }\r\n    async register(params: RegisterParameter): Promise<any>\r\n    {\r\n        return await this.post('user/register', params);\r\n    }\r\n\r\n    async sendVerify(account:string, type:'mobile'|'email', oem:string) {\r\n        return await this.post('user/set-verify', {account:account, type:type, oem:oem});\r\n    }\r\n\r\n    async checkVerify(account:string, verify:string) {\r\n        return await this.post('user/check-verify', {account:account, verify:verify});\r\n    }\r\n\r\n    async isExists(account:string) {\r\n        return await this.get('user/is-exists', {account:account});\r\n    }\r\n\r\n    async resetPassword(account:string, password:string, verify:string, type:'mobile'|'email'):Promise<any[]> {\r\n        return await this.post('user/reset-password', {account:account, password, verify, type});\r\n    }\r\n    \r\n    async userSetProp(prop:string, value:any) {\r\n        await this.post('tie/user-set-prop', {prop:prop, value:value});\r\n    }\r\n\r\n    async me():Promise<any> {\r\n        return await this.get('tie/me');\r\n    }\r\n\r\n    async user(id:number): Promise<any> {\r\n        return await this.get('tie/user', {id:id});\r\n\t}\r\n\t\r\n\tasync fromKey(key:string): Promise<{id:number, name:string, nick:string, icon:string}> {\r\n\t\treturn await this.get('tie/user-from-key', {key});\r\n\t}\r\n}\r\n","//import {nav} from '../components';\r\nimport { UqTokenApi } from './uqApi';\r\nimport { setSubAppWindow } from './wsChannel';\r\n//import { host } from './host';\r\nimport { env, uid } from '../tool';\r\nimport { Web } from './Web';\r\n\r\nexport interface UqToken {\r\n    name: string;\r\n    db: string;\r\n    url: string;\r\n    token: string;\r\n}\r\n\r\ninterface UqTokenAction {\r\n    resolve: (value?: UqToken | PromiseLike<UqToken>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\n\r\ninterface BridgeCenterApi {\r\n    id: string;\r\n    resolve: (value?: any) => any;\r\n    reject: (reason?: any) => void;\r\n}\r\n\r\nexport class AppBridge {\r\n    private readonly web: Web;\r\n    private readonly uqTokens: { [uqName: string]: UqToken } = {};\r\n\r\n    constructor(web: Web) {\r\n        this.web = web;\r\n    }\r\n\r\n    addMessageListener() {\r\n        window.addEventListener('message', async (evt) => {\r\n            var message = evt.data;\r\n            if (!message) return;\r\n            //let {nav} = this.web.tonwa;\r\n            switch (message.type) {\r\n                case 'sub-frame-started':\r\n                    this.subFrameStarted(evt);\r\n                    break;\r\n                case 'ws':\r\n                    //wsBridge.receive(message.msg);\r\n                    await this.web.onWsReceive(message.msg);\r\n                    break;\r\n                case 'init-sub-win':\r\n                    await this.initSubWin(message);\r\n                    break;\r\n                case 'pop-app':\r\n                    window.console.log('///\\\\\\\\\\\\ pop-app');\r\n                    this.web.navBack();\r\n                    break;\r\n                case 'center-api':\r\n                    await this.callCenterApiFromMessage(evt.source as Window, message);\r\n                    break;\r\n                case 'center-api-return':\r\n                    this.bridgeCenterApiReturn(message);\r\n                    break;\r\n                case 'app-api':\r\n                    let ret = await this.onReceiveAppApiMessage(message.hash, message.apiName);\r\n                    (evt.source as Window).postMessage({\r\n                        type: 'app-api-return',\r\n                        apiName: message.apiName,\r\n                        db: ret.db,\r\n                        url: ret.url,\r\n                        token: ret.token\r\n                    } as any, \"*\");\r\n                    break;\r\n                case 'app-api-return':\r\n                    console.log(\"app-api-return: %s\", JSON.stringify(message));\r\n                    console.log('await onAppApiReturn(message);');\r\n                    await this.onAppApiReturn(message);\r\n                    break;\r\n                default:\r\n                    if ((message.source as string)?.startsWith('react-devtools') === true) break;\r\n                    window.console.log('message: %s', JSON.stringify(message));\r\n                    break;\r\n            }\r\n        });\r\n    }\r\n\r\n    logoutUqTokens() {\r\n        for (let i in this.uqTokens) {\r\n            this.uqTokens[i] = undefined;\r\n        }\r\n        UqTokenApi.clearLocal();\r\n    }\r\n\r\n    isBridged(): boolean {\r\n        return window.self !== window.parent;\r\n    }\r\n\r\n    private subFrameStarted(evt: any) {\r\n        var message = evt.data;\r\n        let subWin = evt.source as Window;\r\n        setSubAppWindow(subWin);\r\n        this.hideFrameBack(message.hash);\r\n        let msg: any = Object.assign({}, this.web.user);\r\n        msg.type = 'init-sub-win';\r\n        subWin.postMessage(msg, '*');\r\n    }\r\n\r\n    hideFrameBack(hash: string) {\r\n        let el = document.getElementById(hash);\r\n        if (el !== undefined) el.hidden = true;\r\n    }\r\n\r\n    async initSubWin(message: any) {\r\n        console.log('initSubWin: set nav.user', message);\r\n        let user = this.web.user = message; // message.user;\r\n        this.web.setCenterToken(user.id, user.token);\r\n        await this.web.showAppView();\r\n    }\r\n\r\n    private async onReceiveAppApiMessage(hash: string, apiName: string): Promise<UqToken> {\r\n        let { unit } = env;\r\n        if (!unit) {\r\n            console.error('no unit defined in unit.json or in index.html, or not logined in', unit);\r\n        }\r\n        let parts = apiName.split('/');\r\n        let param = { unit: unit, uqOwner: parts[0], uqName: parts[1], appOwner: parts[2], appName: parts[3] };\r\n        console.log('uqTokenApi.uq onReceiveAppApiMessage', param);\r\n        let ret = await this.web.uqTokenApi.uq(param);\r\n        let { db, url, token } = ret;\r\n        return { name: apiName, db: db, url: url, token: token };\r\n    }\r\n\r\n    private async onAppApiReturn(message: any) {\r\n        let { apiName, db, url, urlTest, token } = message;\r\n        let action = this.uqTokenActions[apiName];\r\n        if (action === undefined) {\r\n            throw new Error('error app api return');\r\n            //return;\r\n        }\r\n        let realUrl = this.web.host.getUrlOrTest(db, url, urlTest);\r\n        console.log('onAppApiReturn(message:any): url=' + url + ', real=' + realUrl);\r\n        //action.url = realUrl;\r\n        //action.token = token;\r\n        action.resolve({\r\n            name: apiName,\r\n            db: db,\r\n            url: realUrl,\r\n            token: token,\r\n        } as UqToken);\r\n    }\r\n\r\n    private readonly uqTokenActions: { [uq: string]: UqTokenAction } = {};\r\n\r\n    async buildAppUq(uq: string, uqOwner: string, uqName: string): Promise<void> {\r\n        if (!this.isBridged()) {\r\n            //let unit = getUnit();\r\n            let { unit } = env;\r\n            let uqToken = await this.web.uqTokenApi.uq({ unit, uqOwner, uqName });\r\n            if (uqToken.token === undefined) uqToken.token = this.web.centerToken;\r\n            let { db, url, urlTest } = uqToken;\r\n            let realUrl = this.web.host.getUrlOrTest(db, url, urlTest);\r\n            console.log('realUrl: %s', realUrl);\r\n            uqToken.url = realUrl;\r\n            this.uqTokens[uq] = uqToken;\r\n            return uqToken;\r\n        }\r\n        //console.log(\"**** before buildAppUq ****\", appInFrame);\r\n        let bp = this.uqTokenActions[uq];\r\n        if (bp !== undefined) return;\r\n        return new Promise<void>((resolve, reject) => {\r\n            this.uqTokenActions[uq] = {\r\n                resolve: async (at: any) => {\r\n                    let { db, url, token } = await at;\r\n                    this.uqTokens[uq] = {\r\n                        name: uq,\r\n                        db: db,\r\n                        url: url,\r\n                        token: token,\r\n                    };\r\n                    this.uqTokenActions[uq] = undefined;\r\n                    //console.log(\"**** after buildAppUq ****\", appInFrame);\r\n                    resolve();\r\n                },\r\n                reject: reject,\r\n            };\r\n            (window.opener || window.parent).postMessage({\r\n                type: 'app-api',\r\n                apiName: uq,\r\n                //hash: appInFrame.hash,\r\n            }, \"*\");\r\n        });\r\n    }\r\n\r\n    getUqToken(uq: string): UqToken {\r\n        let uts = this.uqTokens;\r\n        return uts[uq];\r\n    }\r\n\r\n    private readonly brideCenterApis: { [id: string]: BridgeCenterApi } = {};\r\n    async bridgeCenterApi(url: string, method: string, body: any): Promise<any> {\r\n        console.log('bridgeCenterApi: url=%s, method=%s', url, method);\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            let callId: string;\r\n            for (; ;) {\r\n                callId = uid();\r\n                let bca = this.brideCenterApis[callId];\r\n                if (bca === undefined) {\r\n                    this.brideCenterApis[callId] = {\r\n                        id: callId,\r\n                        resolve: resolve,\r\n                        reject: reject,\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n            (window.opener || window.parent).postMessage({\r\n                type: 'center-api',\r\n                callId: callId,\r\n                url: url,\r\n                method: method,\r\n                body: body\r\n            }, '*');\r\n        });\r\n    }\r\n\r\n    async callCenterApiFromMessage(from: Window, message: any): Promise<void> {\r\n        let { callId, url, method, body } = message;\r\n        let result = await this.web.callCenterapi.directCall(url, method, body);\r\n        from.postMessage({\r\n            type: 'center-api-return',\r\n            callId: callId,\r\n            result: result,\r\n        }, '*');\r\n    }\r\n\r\n    bridgeCenterApiReturn(message: any) {\r\n        let { callId, result } = message;\r\n        let bca = this.brideCenterApis[callId];\r\n        if (bca === undefined) return;\r\n        this.brideCenterApis[callId] = undefined;\r\n        bca.resolve(result);\r\n    }\r\n}\r\n","import {CenterApiBase} from './uqApi';\r\n\r\nexport class CenterApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    }\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await this.get('user/user-name-nick-icon-from-id', {userId:userId});\r\n\t}\r\n\tasync userFromKey(userName:string):Promise<any> {\r\n\t\treturn await this.get('tie/user-from-key', {key:userName});\r\n\t}\r\n}\r\n","import { decodeGuestToken } from '../tool';\r\nimport { CenterApiBase } from './uqApi';\r\n\r\nexport class GuestApi extends CenterApiBase {\r\n    async guest(): Promise<any> {\r\n        //let guest = nav.local.guest.get();\r\n        let ret = await this.get('', {});\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeGuestToken(ret);\r\n            case 'object':\r\n                let guest = decodeGuestToken(ret.token);\r\n                return guest;\r\n        }\r\n    }\r\n\r\n    async unitFromName(unitName:string): Promise<number> {\r\n        let ret = await this.get(unitName);\r\n        return ret && ret.unit;\r\n    }\r\n}\r\n","import { Web } from \"./Web\";\r\n\r\nexport class MessageHub {\r\n    web: Web;\r\n    constructor(web: Web) {\r\n        this.web = web;\r\n    }\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n    private msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\tregisterReceiveHandler(handler:(msg:any)=>Promise<void>):number;\r\n\tregisterReceiveHandler(type:string, handler:(msg:any)=>Promise<void>):number;\t\r\n    registerReceiveHandler(...args:any[]):number {\r\n\t\tlet seed = this.handlerSeed++;\r\n\t\tlet args0 = args[0];\r\n\t\tlet handler:(msg:any)=>Promise<void>;\r\n\t\tswitch (typeof args0) {\r\n\t\t\tcase 'string':\r\n\t\t\t\thandler = args[1];\r\n\t\t\t\tthis.msgHandlers[seed] = {type:args0, handler};\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis.anyHandlers[seed] = args0;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn seed;\r\n    }\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n    }\r\n    async dispatch(msg:any) {\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n        }\r\n    }\r\n}\r\n","import { env } from '../tool';\r\n\r\nconst centerHost = 'https://tv.jkchemical.com'; // process.env['REACT_APP_CENTER_HOST'];\r\nconst centerDebugHost = 'localhost:3000'; //'192.168.86.64';\r\nconst resHost = 'https://tv.jkchemical.com' || centerHost;\r\nconst resDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugBuilderHost = 'localhost:3009';\r\ninterface HostValue {\r\n    value: string;\r\n    local: boolean;\r\n}\r\nconst hosts: { [name: string]: HostValue } = {\r\n    centerhost: {\r\n        value: /*process.env['REACT_APP_CENTER_DEBUG_HOST']*/ undefined || centerDebugHost,\r\n        local: false,\r\n    },\r\n    reshost: {\r\n        value: /*process.env['REACT_APP_RES_DEBUG_HOST']*/ undefined || resDebugHost,\r\n        local: false,\r\n    },\r\n    uqhost: {\r\n        value: /*process.env['REACT_APP_UQ_DEBUG_HOST']*/ undefined || uqDebugHost,\r\n        local: false,\r\n    },\r\n    unitxhost: {\r\n        value: /*process.env['REACT_APP_UQ_DEBUG_HOST']*/ undefined || uqDebugHost,\r\n        local: false,\r\n    },\r\n    \"uq-build\": {\r\n        value: /*process.env['REACT_APP_UQ_DEBUG_BUILDER_HOST']*/ undefined || uqDebugBuilderHost,\r\n        local: false,\r\n    }\r\n}\r\n\r\nconst httpArr = ['https://', 'http://'];\r\nfunction isAbsoluteUrl(url: string): boolean {\r\n    for (let str of httpArr) {\r\n        if (url.startsWith(str) === true) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction urlFromHost(host: string): string {\r\n    if (isAbsoluteUrl(host) === true) {\r\n        if (host.endsWith('/')) return host;\r\n        return host + '/';\r\n    }\r\n    return `http://${host}/`;\r\n}\r\n\r\nfunction centerUrlFromHost(host: string): string {\r\n    return urlFromHost(host);\r\n}\r\nfunction centerWsFromHost(host: string) {\r\n    let https = 'https://';\r\n    if (host.startsWith(https) === true) {\r\n        host = host.substr(https.length);\r\n        if (host.endsWith('/') === true) host = host.substr(0, host.length - 1);\r\n        return 'wss://' + host + '/tv/';\r\n    }\r\n    return `ws://${host}/tv/`\r\n}\r\nexport function resUrlFromHost(host: string) {\r\n    if (!host) return;\r\n    let url = urlFromHost(host);\r\n    return url + 'res/';\r\n}\r\n\r\nconst fetchOptions = {\r\n    method: \"GET\",\r\n    mode: \"no-cors\", // no-cors, cors, *same-origin\r\n    headers: {\r\n        \"Content-Type\": \"text/plain\"\r\n    },\r\n};\r\n\r\nexport class Host {\r\n    testing: boolean;\r\n    url: string;\r\n    ws: string;\r\n    resHost: string;\r\n\r\n    async start(testing: boolean) {\r\n        if (!centerHost) debugger;\r\n        this.testing = testing;\r\n        if (env.isDevelopment === true) {\r\n            await this.tryLocal();\r\n        }\r\n        let host = this.getCenterHost();\r\n        this.url = centerUrlFromHost(host);\r\n        this.ws = centerWsFromHost(host);\r\n        this.resHost = this.getResHost();\r\n    }\r\n\r\n    private debugHostUrl(host: string) { return `http://${host}/hello` }\r\n    private async tryLocal() {\r\n        let promises: PromiseLike<any>[] = [];\r\n        let hostArr: string[] = [];\r\n        for (let i in hosts) {\r\n            let hostValue = hosts[i];\r\n            let { value } = hostValue;\r\n            if (hostArr.findIndex(v => v === value) < 0) hostArr.push(value);\r\n        }\r\n\r\n        for (let host of hostArr) {\r\n            let fetchUrl = this.debugHostUrl(host);\r\n            promises.push(localCheck(fetchUrl));\r\n        }\r\n        let results = await Promise.all(promises);\r\n        let len = hostArr.length;\r\n        for (let i = 0; i < len; i++) {\r\n            let local = results[i];\r\n            let host = hostArr[i];\r\n            for (let j in hosts) {\r\n                let hostValue = hosts[j];\r\n                if (hostValue.value === host) {\r\n                    hostValue.local = local;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private getCenterHost(): string {\r\n        let { value, local } = hosts.centerhost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return centerHost;\r\n    }\r\n\r\n    private getResHost(): string {\r\n        let { value, local } = hosts.reshost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return resHost;\r\n    }\r\n\r\n    getUrlOrDebug(url: string, debugHost: string = 'uqhost'): string {\r\n        if (env.isDevelopment === false) return url;\r\n        let host = hosts[debugHost];\r\n        if (host === undefined) return url;\r\n        let { value, local } = host;\r\n        if (local === false) return url;\r\n        return `http://${value}/`;\r\n    }\r\n    getUrlOrTest(db: string, url: string, urlTest: string): string {\r\n        if (!urlTest) {\r\n            urlTest = url;\r\n            if (!urlTest) {\r\n                console.error('no server set for ' + db);\r\n                debugger;\r\n            }\r\n        }\r\n        else if (!url) {\r\n            url = urlTest;\r\n        }\r\n        let testProd: string;\r\n        if (this.testing === true) {\r\n            if (urlTest !== '-') url = urlTest;\r\n            testProd = 'test';\r\n        }\r\n        else {\r\n            testProd = 'prod';\r\n        }\r\n        url = this.getUrlOrDebug(url);\r\n        if (url.endsWith('/') === false) {\r\n            url += '/';\r\n        }\r\n        return `${url}uq/${testProd}/${db}/`;\r\n    }\r\n\r\n    async localCheck(urlDebug: string): Promise<boolean> {\r\n        return await localCheck(urlDebug);\r\n    }\r\n}\r\n\r\n//export const host:Host = new Host();\r\n\r\n// 因为测试的都是局域网服务器，甚至本机服务器，所以一秒足够了\r\n// 网上找了上面的fetch timeout代码。\r\n// 尽管timeout了，fetch仍然继续，没有cancel\r\n\r\n// 实际上，一秒钟不够。web服务器会自动停。重启的时候，可能会比较长时间。也许两秒甚至更多。\r\n//const timeout = 2000;\r\nconst timeout = 2000;\r\n\r\nfunction fetchLocalCheck(url: string): Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n        fetch(url, fetchOptions as any)\r\n            .then(v => {\r\n                v.text().then(resolve).catch(reject);\r\n            })\r\n            .catch(reject);\r\n        const e = new Error(\"Connection timed out\");\r\n        env.setTimeout('fetchLocalCheck', reject, timeout, e);\r\n    });\r\n}\r\n\r\nasync function localCheck(url: string): Promise<boolean> {\r\n    try {\r\n        await fetchLocalCheck(url);\r\n        return true;\r\n    }\r\n    catch (err) {\r\n        return false;\r\n    }\r\n}\r\n\r\n/*\r\nexport interface IUqForChannel {\r\n    uq: string;\r\n    uqVersion: number;\r\n}\r\n*/","/* eslint-disable */\r\n//import { Tonwa } from \"../Tonwa\";\r\nimport { AppBridge } from \"./appBridge\";\r\nimport { CenterApi } from \"./centerApi\";\r\nimport { UqData, CallCenterApi, CenterAppApi, UnitxApi, UqAppData, UqTokenApi, UserApi } from \"./uqApi\";\r\nimport { HttpChannel, CenterHttpChannel, UqHttpChannel } from './httpChannel';\r\nimport { GuestApi } from \"./guestApi\";\r\nimport { MessageHub } from \"./messageHub\";\r\nimport { HttpChannelNavUI } from \"./httpChannelUI\";\r\nimport { WsBridge, WSChannel } from \"./wsChannel\";\r\nimport { FetchError } from \"./fetchError\";\r\nimport { Host, resUrlFromHost } from './host';\r\n//import { UQsMan, UQsManApp, TVs } from \"../uq\";\r\n//import { AppConfig, UqConfig } from \"../app\";\r\n\r\nexport interface PromiseValue<T> {\r\n    resolve: (value?: T | PromiseLike<T>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\n\r\nexport abstract class Web {\r\n    // ----- 从nav搬移过来的内容\r\n\r\n\r\n\r\n    // ===== nav搬移内容结束\r\n\r\n    // abstract navInit(): Promise<void>\r\n\r\n    reload() {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    showReloadPage(msg: string) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    // 这个应该会去掉\r\n    navBack() {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    // 这个是收到websocket消息的处理\r\n    async onWsReceive(msg: any) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    async showAppView() {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    logout() {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    async onError(error: FetchError) {\r\n        throw error;\r\n    }\r\n    endWait() {\r\n        //throw new Error('Method not implemented.');\r\n    }\r\n    startWait() {\r\n        //throw new Error('Method not implemented.');\r\n    }\r\n    centerHost: string;\r\n    centerToken: string | undefined = undefined;\r\n    loginedUserId: number = 0;\r\n    centerChannelUI: HttpChannel;\r\n    centerChannel: HttpChannel;\r\n\r\n    channelUIs: { [name: string]: HttpChannel | (PromiseValue<any>[]) } = {};\r\n    channelNoUIs: { [name: string]: HttpChannel | (PromiseValue<any>[]) } = {};\r\n    channels: { [unitId: number]: HttpChannel } = {};\r\n\r\n    //    readonly tonwa: Tonwa;\r\n    readonly centerApi: CenterApi;\r\n    readonly appBridge: AppBridge;\r\n    readonly userApi: UserApi;\r\n    readonly uqTokenApi: UqTokenApi;\r\n    readonly callCenterapi: CallCenterApi;\r\n    readonly unitxApi: UnitxApi;\r\n    readonly guestApi: GuestApi;\r\n    readonly messageHub: MessageHub;\r\n    readonly wsBridge: WsBridge;\r\n    readonly host: Host;\r\n\r\n    language: string;\r\n    culture: string;\r\n\r\n    // 下面的变量应该以后会去掉\r\n    isBuildingUQ: boolean;\r\n    _uqs: any;\r\n    user: any;\r\n    // -- end -------------------\r\n\r\n\r\n    constructor() {\r\n        this.centerApi = new CenterApi(this, '/tv', undefined);\r\n        this.appBridge = new AppBridge(this);\r\n        this.userApi = new UserApi(this, 'tv/', undefined);\r\n        this.uqTokenApi = new UqTokenApi(this, 'tv/tie/', undefined);\r\n        this.callCenterapi = new CallCenterApi(this, '', undefined);\r\n        let unitId: number = 0;\r\n        this.unitxApi = new UnitxApi(this, unitId);\r\n        this.guestApi = new GuestApi(this, 'tv/guest/', undefined);\r\n        this.messageHub = new MessageHub(this);\r\n        this.wsBridge = new WsBridge(this);\r\n        this.host = new Host();\r\n    }\r\n\r\n    logoutApis() {\r\n        this.channelUIs = {};\r\n        this.channelNoUIs = {};\r\n        this.channels = {};\r\n        this.appBridge.logoutUqTokens();\r\n    }\r\n\r\n    setCenterUrl(url: string) {\r\n        console.log('setCenterUrl %s', url);\r\n        this.centerHost = url;\r\n        this.centerChannel = undefined;\r\n        this.centerChannelUI = undefined;\r\n    }\r\n\r\n    setCenterToken(userId: number, t?: string) {\r\n        this.loginedUserId = userId;\r\n        this.centerToken = t;\r\n        this.centerChannel = undefined;\r\n        this.centerChannelUI = undefined;\r\n    }\r\n\r\n    getCenterChannelUI(): HttpChannel {\r\n        if (this.centerChannelUI !== undefined) return this.centerChannelUI;\r\n        return this.centerChannelUI = new CenterHttpChannel(this, this.centerHost, this.centerToken, new HttpChannelNavUI(this));\r\n    }\r\n\r\n    getCenterChannel(): HttpChannel {\r\n        if (this.centerChannel !== undefined) return this.centerChannel;\r\n        return this.centerChannel = new CenterHttpChannel(this, this.centerHost, this.centerToken);\r\n    }\r\n\r\n    setNetToken(userId: number, token: string) {\r\n        this.setCenterToken(userId, token);\r\n        WSChannel.setCenterToken(token);\r\n    }\r\n\r\n    clearNetToken() {\r\n        this.setCenterToken(0, undefined);\r\n        WSChannel.setCenterToken(undefined);\r\n    }\r\n\r\n    resUrlFromHost(host: string): string {\r\n        return resUrlFromHost(host);\r\n    }\r\n}\r\n","import { UqBuildContext } from \"./UqBuildContext\";\r\n\r\nexport class TsTemplate {\r\n    private readonly buildContext: UqBuildContext;\r\n\r\n    constructor(buildContext: UqBuildContext) {\r\n        this.buildContext = buildContext;\r\n        this.tsHeader = `//=== UqApp builder created on ${new Date()} ===//`;\r\n    }\r\n\r\n    readonly tsHeader: string;\r\n\r\n    get tsApp(): string {\r\n        return `${this.tsHeader}\r\nimport { NavView, start, nav } from 'tonwa-${this.buildContext.uiPlatform}';\r\nimport { CApp } from './CApp';\r\nimport { appConfig } from './appConfig';\r\n\r\nexport const App: React.FC = () => {\r\n    nav.setSettings(appConfig);\r\n    const onLogined = async (isUserLogin?:boolean) => {\r\n        await start(CApp, appConfig, isUserLogin);\r\n    }\r\n    return <NavView onLogined={onLogined} />;\r\n}\r\n\r\n`;\r\n    }\r\n\r\n    get tsCApp(): string {\r\n        return `${this.tsHeader}\r\nimport { CUqApp } from \"./CBase\";\r\nimport { res } from \"./res\";\r\nimport { VMain } from \"./VMain\";\r\nimport { setUI } from \"./uqs\";\r\n\r\nconst gaps = [10, 3,3,3,3,3,5,5,5,5,5,5,5,5,10,10,10,10,15,15,15,30,30,60];\r\n\r\nexport class CApp extends CUqApp {\r\n    protected async internalStart(isUserLogin: boolean) {\r\n        this.setRes(res);\r\n        setUI(this.uqs);\r\n        \r\n        this.openVPage(VMain, undefined, this.dispose);\r\n    }\r\n\r\n    private timer:any;\r\n    protected onDispose() {\r\n        clearInterval(this.timer);\r\n        this.timer = undefined;\r\n    }\r\n\r\n    private tick = 0;\r\n    private gapIndex = 0;\r\n    private callTick = async () => {\r\n        try {\r\n            if (!this.user) return;\r\n            ++this.tick;\r\n            if (this.tick<gaps[this.gapIndex]) return;\r\n            this.tick = 0;\r\n            if (this.gapIndex < gaps.length - 1) ++this.gapIndex;\r\n            let ret = await this.uqs.BzHelloTonwa.$poked.query(undefined, false);\r\n            let v = ret.ret[0];\r\n            if (v === undefined) return;\r\n            if (!v.poke) return;\r\n            this.gapIndex = 1;\r\n\r\n            // 数据服务器提醒客户端刷新，下面代码重新调入的数据\r\n            //this.cHome.refresh();\r\n        }\r\n        catch {\r\n        }\r\n    }\r\n}\r\n`;\r\n    }\r\n\r\n    get tsCBase(): string {\r\n        return `${this.tsHeader}\r\nimport { CSub, CBase, CAppBase, IConstructor } from 'tonwa-${this.buildContext.uiPlatform}';\r\nimport { UQs } from './uqs';\r\nimport { CApp } from './CApp';\r\n\r\nexport abstract class CUqBase extends CBase<CApp, UQs> {\r\n    protected async internalStart(param?:any, ...params:any[]):Promise<void> {}\r\n}\r\n\r\nexport abstract class CUqSub<A extends CAppBase<U>, U, T extends CBase<A,U>> extends CSub<A, U, T> {\r\n}\r\n\r\nexport abstract class CUqApp extends CAppBase<UQs> {\r\n    newC<T extends CUqBase>(type: IConstructor<T>, ...param:any[]): T {\r\n        let c = new type(this);\r\n        c.internalInit(...param);\r\n        return c;\r\n    }\r\n}\r\n`;\r\n    }\r\n\r\n    get tsIndex(): string {\r\n        return `${this.tsHeader}\r\nexport { CUqApp, CUqBase, CUqSub } from './CBase';\r\nexport { CApp } from './CApp';\r\nexport * from './uqs';\r\nexport * from './App';\r\nexport * from './startApp';\r\n`;\r\n    }\r\n\r\n    get tsVMain(): string {\r\n        return `${this.tsHeader}\r\nimport { VPage, Page } from 'tonwa-${this.buildContext.uiPlatform}';\r\nimport { CApp } from './CApp';\r\n\r\nexport class VMain extends VPage<CApp> {\r\n    header() { return 'TEST'; }\r\n    content() {\r\n        return <div className=\"m-3\">\r\n            <div>{this.renderMe()}</div>\r\n            <div className=\"mb-5\">同花样例主页面</div>\r\n        </div>;\r\n    }\r\n}\r\n`;\r\n    }\r\n}\r\n","/* eslint-disable */\r\n//import { UqApi, UqData, UnitxApi } from '../net';\r\nimport { UqApi, UqData, UnitxApi } from '../web';\r\nimport { Tonwa, UqConfig } from '../core';\r\nimport { Tuid, TuidDiv, TuidImport, TuidInner, TuidBox, TuidsCache } from './tuid';\r\nimport { Action } from './action';\r\nimport { Sheet } from './sheet';\r\nimport { Query } from './query';\r\nimport { Book } from './book';\r\nimport { History } from './history';\r\nimport { Map } from './map';\r\nimport { Pending } from './pending';\r\n//import { CreateBoxId, BoxId } from './tuid';\r\nimport { LocalMap, LocalCache, env, capitalCase } from '../tool';\r\n//import { ReactBoxId } from './tuid/reactBoxId';\r\nimport { UqEnum } from './enum';\r\nimport { Entity } from './entity';\r\nimport { ID, IX, IDX } from './ID';\r\nimport { IDCache } from './IDCache';\r\nimport { Web } from '../web';\r\n\r\nexport type FieldType = 'id' | 'tinyint' | 'smallint' | 'int' | 'bigint' | 'dec' | 'float' | 'double' | 'char' | 'text'\r\n\t| 'datetime' | 'date' | 'time' | 'timestamp' | 'enum';\r\n\r\nexport function fieldDefaultValue(type: FieldType) {\r\n\tswitch (type) {\r\n\t\tcase 'tinyint':\r\n\t\tcase 'smallint':\r\n\t\tcase 'int':\r\n\t\tcase 'bigint':\r\n\t\tcase 'dec':\r\n\t\tcase 'float':\r\n\t\tcase 'double':\r\n\t\tcase 'enum':\r\n\t\t\treturn 0;\r\n\t\tcase 'char':\r\n\t\tcase 'text':\r\n\t\t\treturn '';\r\n\t\tcase 'datetime':\r\n\t\tcase 'date':\r\n\t\t\treturn '2000-1-1';\r\n\t\tcase 'time':\r\n\t\t\treturn '0:00';\r\n\t}\r\n}\r\n\r\nexport interface Field {\r\n\tname: string;\r\n\ttype: FieldType;\r\n\ttuid?: string;\r\n\tarr?: string;\r\n\tnull?: boolean;\r\n\tsize?: number;\r\n\towner?: string;\r\n\t_tuid?: TuidBox;\r\n}\r\nexport interface ArrFields {\r\n\tname: string;\r\n\tfields: Field[];\r\n\tid?: string;\r\n\torder?: string;\r\n}\r\nexport interface FieldMap {\r\n\t[name: string]: Field;\r\n}\r\nexport interface SchemaFrom {\r\n\towner: string;\r\n\tuq: string;\r\n}\r\nexport interface TuidModify {\r\n\tmax: number;\r\n\tseconds: number;\r\n}\r\n\r\ninterface ParamPage {\r\n\tstart: number;\r\n\tend?: number;\r\n\tsize: number;\r\n}\r\n\r\nexport interface ParamActIX<T> {\r\n\tIX: IX;\r\n\tID?: ID;\r\n\tIXs?: { IX: IX, ix: number }[];\t\t\t\t// 一次写入多个IX\r\n\tvalues: { ix: number, xi: number | T }[];\r\n}\r\n\r\nexport interface ParamActIXSort {\r\n\tIX: IX;\r\n\tix: number;\r\n\tid: number;\t\t\t\t\t// id to be moved\r\n\tafter: number;\t\t\t\t// insert after id. if before first, then 0\r\n}\r\n\r\nexport interface ParamActDetail<M, D> {\r\n\tmain: {\r\n\t\tID: ID;\r\n\t\tvalue: M;\r\n\t};\r\n\tdetail: {\r\n\t\tID: ID;\r\n\t\tvalues: D[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail {\r\n\tmain: number;\r\n\tdetail: number[];\r\n}\r\n\r\nexport interface ParamActDetail2<M, D, D2> extends ParamActDetail<M, D> {\r\n\tdetail2: {\r\n\t\tID: ID;\r\n\t\tvalues: D2[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail2 extends RetActDetail {\r\n\tdetail2: number[];\r\n}\r\n\r\nexport interface ParamActDetail3<M, D, D2, D3> extends ParamActDetail2<M, D, D2> {\r\n\tdetail3: {\r\n\t\tID: ID;\r\n\t\tvalues: D3[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail3 extends RetActDetail2 {\r\n\tdetail3: number[];\r\n}\r\n\r\nexport interface ParamQueryID {\r\n\tID?: ID;\r\n\tIX?: (IX | string)[];\r\n\tIDX?: (ID | IDX)[];\r\n\tid?: number | number[];\r\n\tkey?: { [key: string]: string | number };\r\n\tix?: number;\r\n\tidx?: number | number[];\r\n\tkeyx?: { [key: string]: string | number };\r\n\tpage?: ParamPage;\r\n\torder?: 'desc' | 'asc';\r\n}\r\n\r\nexport interface ParamIDNO {\r\n\tID: ID;\r\n\tstamp?: undefined,\r\n}\r\n\r\nexport interface ParamIDDetailGet {\r\n\tid: number;\r\n\tmain: ID;\r\n\tdetail: ID;\r\n\tdetail2?: ID;\r\n\tdetail3?: ID;\r\n}\r\n\r\nexport interface ParamID {\r\n\tIDX: (ID | IDX) | (ID | IDX)[];\r\n\tid: number | number[];\r\n\torder?: 'asc' | 'desc',\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamKeyID {\r\n\tID: ID;\r\n\tIDX?: (ID | IDX)[];\r\n\tIX?: IX[];\r\n\tkey: { [key: string]: string | number };\r\n\tix?: number;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIX {\r\n\tIX: IX;\r\n\tIX1?: IX;\r\n\tix: number | number[];\r\n\tIDX?: (ID | IDX)[];\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamKeyIX {\r\n\tID: ID;\r\n\tkey: { [key: string]: string | number };\r\n\tIX: IX;\r\n\tIDX?: (ID | IDX)[];\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIDLog {\r\n\tIDX: (ID | IDX);\r\n\tfield: string;\r\n\tid: number;\r\n\tlog: 'each' | 'day' | 'week' | 'month' | 'year';\r\n\ttimeZone?: number;\r\n\tfar?: number;\r\n\tnear?: number;\r\n\tpage: ParamPage;\r\n}\r\n\r\nexport interface ParamIDSum {\r\n\tIDX: IDX;\r\n\tfield: string[];\r\n\tid: number | number[];\r\n\tfar?: number;\t\t\t\t// 以前\r\n\tnear?: number;\t\t\t\t// 最近\r\n}\r\n\r\nexport interface ParamIDxID {\r\n\tID: ID;\r\n\tIX: IX;\r\n\tID2: ID;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface IDXValue {\r\n\tvalue: number;\r\n\ttime?: number | Date;\r\n\tsetAdd: '=' | '+';\r\n}\r\n\r\nexport interface ParamIDinIX {\r\n\tID: ID;\r\n\tid: number;\r\n\tIX: IX;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIDTree {\r\n\tID: ID;\r\n\tparent: number;\r\n\tkey: string | number;\r\n\tlevel?: number;\t\t\t\t// 无值，默认1一级\r\n\tpage?: ParamPage;\r\n}\r\n\r\nfunction IDPath(path: string): string { return path; }\r\nenum EnumResultType { data, sql };\r\n\r\nexport interface Uq {\r\n\tgetAdmins(): Promise<{ id: number; role: number }[]>;\r\n\t$: UqMan;\r\n\tActs(param: any): Promise<any>;\r\n\tActIX<T>(param: ParamActIX<T>): Promise<number[]>;\r\n\tActIXSort(param: ParamActIXSort): Promise<void>;\r\n\tActDetail<M, D>(param: ParamActDetail<M, D>): Promise<RetActDetail>;\r\n\tActDetail<M, D, D2>(param: ParamActDetail2<M, D, D2>): Promise<RetActDetail2>;\r\n\tActDetail<M, D, D2, D3>(param: ParamActDetail3<M, D, D2, D3>): Promise<RetActDetail3>;\r\n\tQueryID<T>(param: ParamQueryID): Promise<T[]>;\r\n\tIDNO(param: ParamIDNO): Promise<string>;\r\n\tIDDetailGet<M, D>(param: ParamIDDetailGet): Promise<[M[], D[]]>;\r\n\tIDDetailGet<M, D, D2>(param: ParamIDDetailGet): Promise<[M[], D[], D2[]]>;\r\n\tIDDetailGet<M, D, D2, D3>(param: ParamIDDetailGet): Promise<[M[], D[], D2[], D3[]]>;\r\n\tID<T>(param: ParamID): Promise<T[]>;\r\n\tIXr<T>(param: ParamIX): Promise<T[]>; // IX id 反查IX list\r\n\tKeyID<T>(param: ParamKeyID): Promise<T[]>;\r\n\tIX<T>(param: ParamIX): Promise<T[]>;\r\n\tKeyIX<T>(param: ParamKeyIX): Promise<T[]>;\r\n\tIDLog<T>(param: ParamIDLog): Promise<T[]>;\r\n\tIDSum<T>(param: ParamIDSum): Promise<T[]>;\r\n\tIDxID<T, T2>(param: ParamIDxID): Promise<[T[], T2[]]>; // ID list with IX 对应的子集\r\n\tIDinIX<T>(param: ParamIDinIX): Promise<T & { $in: boolean }[]>;\r\n\tIDTree<T>(param: ParamIDTree): Promise<T[]>;\r\n\r\n\tIDTv(ids: number[]): Promise<any[]>;\r\n}\r\n\r\nexport class UqMan {\r\n\treadonly entities: { [name: string]: Entity } = {};\r\n\tprivate readonly enums: { [name: string]: UqEnum } = {};\r\n\tprivate readonly actions: { [name: string]: Action } = {};\r\n\tprivate readonly queries: { [name: string]: Query } = {};\r\n\treadonly ids: { [name: string]: ID } = {};\r\n\tprivate readonly idxs: { [name: string]: IDX } = {};\r\n\tprivate readonly ixs: { [name: string]: IX } = {};\r\n\r\n\tprivate readonly sheets: { [name: string]: Sheet } = {};\r\n\tprivate readonly books: { [name: string]: Book } = {};\r\n\tprivate readonly maps: { [name: string]: Map } = {};\r\n\tprivate readonly histories: { [name: string]: History } = {};\r\n\tprivate readonly pendings: { [name: string]: Pending } = {};\r\n\tprivate readonly tuidsCache: TuidsCache;\r\n\tprivate readonly localEntities: LocalCache;\r\n\t//private readonly tvs:{[entity:string]:(values:any)=>JSX.Element};\r\n\tidCache: IDCache;\r\n\tproxy: any;\r\n\treadonly localMap: LocalMap;\r\n\treadonly localModifyMax: LocalCache;\r\n\treadonly tuids: { [name: string]: Tuid } = {};\r\n\t//readonly createBoxId: CreateBoxId;\r\n\treadonly newVersion: boolean;\r\n\treadonly uqOwner: string;\r\n\treadonly uqName: string;\r\n\treadonly name: string;\r\n\treadonly uqApi: UqApi;\r\n\treadonly id: number;\r\n\treadonly tonwa: Tonwa;\r\n\treadonly web: Web;\r\n\r\n\tuqVersion: number;\r\n\tconfig: UqConfig;\r\n\r\n\tconstructor(tonwa: Tonwa, uqData: UqData/*, createBoxId:CreateBoxId, tvs:{[entity:string]:(values:any)=>JSX.Element}*/) {\r\n\t\tthis.tonwa = tonwa;\r\n\t\tthis.web = tonwa.web;\r\n\t\t//this.createBoxId = createBoxId;\r\n\t\t/*\r\n\t\tif (createBoxId === undefined) {\r\n\t\t\tthis.createBoxId = this.createBoxIdFromTVs;\r\n\t\t\tthis.tvs = tvs || {};\r\n\t\t}\r\n\t\t*/\r\n\t\tlet { id, uqOwner, uqName, /*access, */newVersion } = uqData;\r\n\t\tthis.newVersion = newVersion;\r\n\t\tthis.uqOwner = uqOwner;\r\n\t\tthis.uqName = uqName;\r\n\t\tthis.id = id;\r\n\t\tthis.name = uqOwner + '/' + uqName;\r\n\t\tthis.uqVersion = 0;\r\n\t\tthis.localMap = env.localDb.map(this.name);\r\n\t\tthis.localModifyMax = this.localMap.child('$modifyMax');\r\n\t\tthis.localEntities = this.localMap.child('$access');\r\n\t\tlet baseUrl = 'tv/';\r\n\r\n\t\tif (this.name === '$$$/$unitx') {\r\n\t\t\t// 这里假定，点击home link之后，已经设置unit了\r\n\t\t\t// 调用 UnitxApi会自动搜索绑定 unitx service\r\n\t\t\tthis.uqApi = new UnitxApi(this.web, env.unit);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.uqApi = new UqApi(this.web, baseUrl, uqOwner, uqName, true);\r\n\t\t}\r\n\t\tthis.tuidsCache = new TuidsCache(this);\r\n\t}\r\n\r\n\tgetID(name: string): ID { return this.ids[name.toLowerCase()]; };\r\n\tgetIDX(name: string): IDX { return this.idxs[name.toLowerCase()]; };\r\n\tgetIX(name: string): IX { return this.ixs[name.toLowerCase()]; };\r\n\r\n\t/*\r\n\tprivate createBoxIdFromTVs:CreateBoxId = (tuid:Tuid, id:number):BoxId =>{\r\n\t\tlet {name} = tuid;\r\n\t\treturn new ReactBoxId(id, tuid, this.tvs[name]);\r\n\t}\r\n\t*/\r\n\r\n\tprivate roles: string[];\r\n\tasync getRoles(): Promise<string[]> {\r\n\t\tif (this.roles !== undefined) return this.roles;\r\n\t\tthis.roles = await this.uqApi.getRoles();\r\n\t\treturn this.roles;\r\n\t}\r\n\r\n\ttuid(name: string): Tuid { return this.tuids[name.toLowerCase()] }\r\n\ttuidDiv(name: string, div: string): TuidDiv {\r\n\t\tlet tuid = this.tuids[name.toLowerCase()]\r\n\t\treturn tuid && tuid.div(div.toLowerCase());\r\n\t}\r\n\taction(name: string): Action { return this.actions[name.toLowerCase()] }\r\n\tsheet(name: string): Sheet { return this.sheets[name.toLowerCase()] }\r\n\tquery(name: string): Query { return this.queries[name.toLowerCase()] }\r\n\tbook(name: string): Book { return this.books[name.toLowerCase()] }\r\n\tmap(name: string): Map { return this.maps[name.toLowerCase()] }\r\n\thistory(name: string): History { return this.histories[name.toLowerCase()] }\r\n\tpending(name: string): Pending { return this.pendings[name.toLowerCase()] }\r\n\r\n\tsheetFromTypeId(typeId: number): Sheet {\r\n\t\tfor (let i in this.sheets) {\r\n\t\t\tlet sheet = this.sheets[i];\r\n\t\t\tif (sheet.typeId === typeId) return sheet;\r\n\t\t}\r\n\t}\r\n\r\n\tallRoles: string[];\r\n\treadonly tuidArr: Tuid[] = [];\r\n\treadonly actionArr: Action[] = [];\r\n\treadonly queryArr: Query[] = [];\r\n\treadonly idArr: ID[] = [];\r\n\treadonly idxArr: IDX[] = [];\r\n\treadonly ixArr: IX[] = [];\r\n\treadonly enumArr: UqEnum[] = [];\r\n\treadonly sheetArr: Sheet[] = [];\r\n\treadonly bookArr: Book[] = [];\r\n\treadonly mapArr: Map[] = [];\r\n\treadonly historyArr: History[] = [];\r\n\treadonly pendingArr: Pending[] = [];\r\n\r\n\tasync init() {\r\n\t\tawait this.uqApi.init();\r\n\t}\r\n\r\n\tasync loadEntities(): Promise<string> {\r\n\t\ttry {\r\n\t\t\tlet entities = this.localEntities.get();\r\n\t\t\tif (!entities) {\r\n\t\t\t\tentities = await this.uqApi.loadEntities();\r\n\t\t\t}\r\n\t\t\tif (!entities) return;\r\n\t\t\tthis.buildEntities(entities);\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\treturn err as any;\r\n\t\t}\r\n\t}\r\n\r\n\tbuildEntities(entities: any) {\r\n\t\tif (entities === undefined) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\tthis.localEntities.set(entities);\r\n\t\tlet { access, tuids, role, version } = entities;\r\n\t\tthis.uqVersion = version;\r\n\t\tthis.allRoles = role?.names;\r\n\t\tthis.buildTuids(tuids);\r\n\t\tthis.buildAccess(access);\r\n\t}\r\n\r\n\tprivate buildTuids(tuids: any) {\r\n\t\tfor (let i in tuids) {\r\n\t\t\tlet schema = tuids[i];\r\n\t\t\tlet { typeId, from } = schema;\r\n\t\t\tlet tuid = this.newTuid(i, typeId, from);\r\n\t\t\ttuid.sys = true;\r\n\t\t}\r\n\t\tfor (let i in tuids) {\r\n\t\t\tlet schema = tuids[i];\r\n\t\t\tlet tuid = this.getTuid(i);\r\n\t\t\ttuid.setSchema(schema);\r\n\t\t}\r\n\t\tfor (let i in this.tuids) {\r\n\t\t\tlet tuid = this.tuids[i];\r\n\t\t\ttuid.buildFieldsTuid();\r\n\t\t}\r\n\t}\r\n\r\n\tasync loadEntitySchema(entityName: string): Promise<any> {\r\n\t\treturn await this.uqApi.schema(entityName);\r\n\t}\r\n\r\n\tasync loadAllSchemas(): Promise<void> {\r\n\t\tlet ret = await this.uqApi.allSchemas();\r\n\t\tlet entities: Entity[][] = [\r\n\t\t\tthis.actionArr,\r\n\t\t\tthis.enumArr,\r\n\t\t\tthis.sheetArr,\r\n\t\t\tthis.queryArr,\r\n\t\t\tthis.bookArr,\r\n\t\t\tthis.mapArr,\r\n\t\t\tthis.historyArr,\r\n\t\t\tthis.pendingArr,\r\n\t\t\tthis.idArr,\r\n\t\t\tthis.idxArr,\r\n\t\t\tthis.ixArr,\r\n\t\t];\r\n\t\tentities.forEach(arr => {\r\n\t\t\tarr.forEach(v => {\r\n\t\t\t\tlet entity = ret[v.name.toLowerCase()];\r\n\t\t\t\tif (!entity) return;\r\n\t\t\t\tlet schema = entity.call;\r\n\t\t\t\tif (!schema) return;\r\n\t\t\t\tv.buildSchema(schema);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tgetTuid(name: string): Tuid {\r\n\t\treturn this.tuids[name];\r\n\t}\r\n\r\n\tprivate buildAccess(access: any) {\r\n\t\tfor (let a in access) {\r\n\t\t\tlet v = access[a];\r\n\t\t\tswitch (typeof v) {\r\n\t\t\t\tcase 'string': this.fromType(a, v); break;\r\n\t\t\t\tcase 'object': this.fromObj(a, v); break;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcacheTuids(defer: number) {\r\n\t\tthis.tuidsCache.cacheTuids(defer);\r\n\t}\r\n\r\n\tprivate setEntity(name: string, entity: Entity) {\r\n\t\tthis.entities[name] = entity;\r\n\t\tthis.entities[name.toLowerCase()] = entity;\r\n\t}\r\n\r\n\tnewEnum(name: string, id: number): UqEnum {\r\n\t\tlet enm = this.enums[name];\r\n\t\tif (enm !== undefined) return enm;\r\n\t\tenm = this.enums[name] = new UqEnum(this, name, id);\r\n\t\tthis.setEntity(name, enm);\r\n\t\tthis.enumArr.push(enm);\r\n\t\treturn enm;\r\n\t}\r\n\tnewAction(name: string, id: number): Action {\r\n\t\tlet action = this.actions[name];\r\n\t\tif (action !== undefined) return action;\r\n\t\taction = this.actions[name] = new Action(this, name, id);\r\n\t\tthis.setEntity(name, action);\r\n\t\tthis.actionArr.push(action);\r\n\t\treturn action;\r\n\t}\r\n\tprivate newTuid(name: string, id: number, from: SchemaFrom): Tuid {\r\n\t\tlet tuid = this.tuids[name];\r\n\t\tif (tuid !== undefined) return tuid;\r\n\t\tif (from !== undefined)\r\n\t\t\ttuid = new TuidImport(this, name, id, from);\r\n\t\telse\r\n\t\t\ttuid = new TuidInner(this, name, id);\r\n\t\tthis.tuids[name] = tuid;\r\n\t\tthis.setEntity(name, tuid);\r\n\t\tthis.tuidArr.push(tuid);\r\n\t\treturn tuid;\r\n\t}\r\n\tnewQuery(name: string, id: number): Query {\r\n\t\tlet query = this.queries[name];\r\n\t\tif (query !== undefined) return query;\r\n\t\tquery = this.queries[name] = new Query(this, name, id)\r\n\t\tthis.setEntity(name, query);\r\n\t\tthis.queryArr.push(query);\r\n\t\treturn query;\r\n\t}\r\n\tprivate newBook(name: string, id: number): Book {\r\n\t\tlet book = this.books[name];\r\n\t\tif (book !== undefined) return book;\r\n\t\tbook = this.books[name] = new Book(this, name, id);\r\n\t\tthis.setEntity(name, book);\r\n\t\tthis.bookArr.push(book);\r\n\t\treturn book;\r\n\t}\r\n\tprivate newMap(name: string, id: number): Map {\r\n\t\tlet map = this.maps[name];\r\n\t\tif (map !== undefined) return map;\r\n\t\tmap = this.maps[name] = new Map(this, name, id)\r\n\t\tthis.setEntity(name, map);\r\n\t\tthis.mapArr.push(map);\r\n\t\treturn map;\r\n\t}\r\n\tprivate newHistory(name: string, id: number): History {\r\n\t\tlet history = this.histories[name];\r\n\t\tif (history !== undefined) return;\r\n\t\thistory = this.histories[name] = new History(this, name, id)\r\n\t\tthis.setEntity(name, history);\r\n\t\tthis.historyArr.push(history);\r\n\t\treturn history;\r\n\t}\r\n\tprivate newPending(name: string, id: number): Pending {\r\n\t\tlet pending = this.pendings[name];\r\n\t\tif (pending !== undefined) return;\r\n\t\tpending = this.pendings[name] = new Pending(this, name, id)\r\n\t\tthis.setEntity(name, pending);\r\n\t\tthis.pendingArr.push(pending);\r\n\t\treturn pending;\r\n\t}\r\n\tprivate newSheet(name: string, id: number): Sheet {\r\n\t\tlet sheet = this.sheets[name];\r\n\t\tif (sheet !== undefined) return sheet;\r\n\t\tsheet = this.sheets[name] = new Sheet(this, name, id);\r\n\t\tthis.setEntity(name, sheet);\r\n\t\tthis.sheetArr.push(sheet);\r\n\t\treturn sheet;\r\n\t}\r\n\tprivate newID(name: string, id: number): ID {\r\n\t\tlet lName = name.toLowerCase();\r\n\t\tlet idEntity = this.ids[lName];\r\n\t\tif (idEntity !== undefined) return idEntity;\r\n\t\tidEntity = this.ids[lName] = new ID(this, name, id);\r\n\t\tthis.setEntity(name, idEntity);\r\n\t\tthis.idArr.push(idEntity);\r\n\t\treturn idEntity;\r\n\t}\r\n\tprivate newIDX(name: string, id: number): IDX {\r\n\t\tlet lName = name.toLowerCase();\r\n\t\tlet idx = this.idxs[lName];\r\n\t\tif (idx !== undefined) return idx;\r\n\t\tidx = this.idxs[lName] = new IDX(this, name, id);\r\n\t\tthis.setEntity(name, idx);\r\n\t\tthis.idxArr.push(idx);\r\n\t\treturn idx;\r\n\t}\r\n\tprivate newIX(name: string, id: number): IX {\r\n\t\tlet lName = name.toLowerCase();\r\n\t\tlet ix = this.ixs[lName];\r\n\t\tif (ix !== undefined) return ix;\r\n\t\tix = this.ixs[lName] = new IX(this, name, id);\r\n\t\tthis.setEntity(name, ix);\r\n\t\tthis.ixArr.push(ix);\r\n\t\treturn ix;\r\n\t}\r\n\tprivate fromType(name: string, type: string) {\r\n\t\tlet parts = type.split('|');\r\n\t\ttype = parts[0];\r\n\t\tlet id = Number(parts[1]);\r\n\t\tswitch (type) {\r\n\t\t\t//case 'uq': this.id = id; break;\r\n\t\t\tcase 'tuid':\r\n\t\t\t\t// Tuid should not be created here!;\r\n\t\t\t\t//let tuid = this.newTuid(name, id);\r\n\t\t\t\t//tuid.sys = false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'id': this.newID(name, id); break;\r\n\t\t\tcase 'idx': this.newIDX(name, id); break;\r\n\t\t\tcase 'ix': this.newIX(name, id); break;\r\n\t\t\tcase 'action': this.newAction(name, id); break;\r\n\t\t\tcase 'query': this.newQuery(name, id); break;\r\n\t\t\tcase 'book': this.newBook(name, id); break;\r\n\t\t\tcase 'map': this.newMap(name, id); break;\r\n\t\t\tcase 'history': this.newHistory(name, id); break;\r\n\t\t\tcase 'sheet': this.newSheet(name, id); break;\r\n\t\t\tcase 'pending': this.newPending(name, id); break;\r\n\t\t\tcase 'enum': this.newEnum(name, id); break;\r\n\t\t}\r\n\t}\r\n\tprivate fromObj(name: string, obj: any) {\r\n\t\tswitch (obj['$']) {\r\n\t\t\tcase 'sheet': this.buildSheet(name, obj); break;\r\n\t\t}\r\n\t}\r\n\tprivate buildSheet(name: string, obj: any) {\r\n\t\tlet sheet = this.sheets[name];\r\n\t\tif (sheet === undefined) sheet = this.newSheet(name, obj.id);\r\n\t\tsheet.build(obj);\r\n\t}\r\n\tbuildFieldTuid(fields: Field[], mainFields?: Field[]) {\r\n\t\tif (fields === undefined) return;\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { tuid } = f;\r\n\t\t\tif (tuid === undefined) continue;\r\n\t\t\tlet t = this.getTuid(tuid);\r\n\t\t\tif (t === undefined) continue;\r\n\t\t\tf._tuid = t.buildTuidBox();\r\n\t\t}\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { owner } = f;\r\n\t\t\tif (owner === undefined) continue;\r\n\t\t\tlet ownerField = fields.find(v => v.name === owner);\r\n\t\t\tif (ownerField === undefined) {\r\n\t\t\t\tif (mainFields !== undefined) {\r\n\t\t\t\t\townerField = mainFields.find(v => v.name === owner);\r\n\t\t\t\t}\r\n\t\t\t\tif (ownerField === undefined) {\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\tthrow new Error(`owner field ${owner} is undefined`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet { arr, tuid } = f;\r\n\t\t\tlet t = this.getTuid(ownerField._tuid.tuid.name);\r\n\t\t\tif (t === undefined) continue;\r\n\t\t\tlet div = t.div(arr || tuid);\r\n\t\t\tf._tuid = div && div.buildTuidDivBox(ownerField);\r\n\t\t\t/*\r\n\t\t\tif (f._tuid === undefined) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\tthrow new Error(`owner field ${owner} is not tuid`);\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t}\r\n\t}\r\n\tbuildArrFieldsTuid(arrFields: ArrFields[], mainFields: Field[]) {\r\n\t\tif (arrFields === undefined) return;\r\n\t\tfor (let af of arrFields) {\r\n\t\t\tlet { fields } = af;\r\n\t\t\tif (fields === undefined) continue;\r\n\t\t\tthis.buildFieldTuid(fields, mainFields);\r\n\t\t}\r\n\t}\r\n\r\n\tpullModify(modifyMax: number) {\r\n\t\tthis.tuidsCache.pullModify(modifyMax);\r\n\t}\r\n\r\n\tgetUqKey() {\r\n\t\tlet uqKey: string = this.uqName.split(/[-._]/).join('').toLowerCase();\r\n\t\treturn uqKey;\r\n\t}\r\n\r\n\tgetUqKeyWithConfig() {\r\n\t\tif (!this.config) return;\r\n\t\tlet uqKey: string = this.uqName.split(/[-._]/).join('').toLowerCase();\r\n\t\tlet { dev, alias } = this.config;\r\n\t\tuqKey = capitalCase(dev.alias || dev.name) + capitalCase(alias ?? uqKey);\r\n\t\treturn uqKey;\r\n\t}\r\n\r\n\thasEntity(name: string): boolean {\r\n\t\treturn this.entities[name] !== undefined\r\n\t\t\t|| this.entities[name.toLowerCase()] !== undefined;\r\n\t}\r\n\r\n\tcreateProxy(): any {\r\n\t\tlet ret = new Proxy(this.entities, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tlet lk = (key as string).toLowerCase();\r\n\t\t\t\tif (lk === '$') {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = target[lk];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tlet func = (this as any)[key];\r\n\t\t\t\tif (func !== undefined) return func;\r\n\t\t\t\tlet err = `entity ${this.name}.${String(key)} not defined`;\r\n\t\t\t\tconsole.error('UQ错误：' + err);\r\n\t\t\t\tthis.showReload('服务器正在更新');\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.proxy = ret;\r\n\t\tthis.idCache = new IDCache(this);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tshowReload(msg: string) {\r\n\t\tlet cache = this.localMap.child('$reload-tick');\r\n\t\tlet reloadTick = cache.get();\r\n\t\tif (!reloadTick) reloadTick = 0;\r\n\t\tconsole.error(msg);\r\n\t\tthis.localMap.removeAll();\r\n\t\tlet tick = Date.now();\r\n\t\tcache.set(tick);\r\n\t\tif (tick - reloadTick < 10 * 1000) {\r\n\t\t\tthis.web.showReloadPage(msg);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.web.reload();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async apiPost(api: string, resultType: EnumResultType, apiParam: any): Promise<any> {\r\n\t\tif (resultType === EnumResultType.sql) api = 'sql-' + api;\r\n\t\tlet ret = await this.uqApi.post(IDPath(api), apiParam);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate async apiActs(param: any, resultType: EnumResultType): Promise<any> {\r\n\t\t// 这边的obj属性序列，也许会不一样\r\n\t\tlet arr: string[] = [];\r\n\t\tlet apiParam: any = {};\r\n\t\tfor (let i in param) {\r\n\t\t\tarr.push(i);\r\n\t\t\tapiParam[i] = (param[i] as any[]).map(v => {\r\n\t\t\t\tlet obj: any = {};\r\n\t\t\t\tfor (let j in v) {\r\n\t\t\t\t\tlet val = v[j];\r\n\t\t\t\t\tif (typeof val === 'object') {\r\n\t\t\t\t\t\tlet nv: any = {};\r\n\t\t\t\t\t\tfor (let n in val) {\r\n\t\t\t\t\t\t\tlet tv = val[n];\r\n\t\t\t\t\t\t\tif (tv && typeof tv === 'object') {\r\n\t\t\t\t\t\t\t\tif (n === 'time') {\r\n\t\t\t\t\t\t\t\t\tif (Object.prototype.toString.call(tv) === '[object Date]') {\r\n\t\t\t\t\t\t\t\t\t\ttv = (tv as Date).getTime();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tlet id = tv['id'];\r\n\t\t\t\t\t\t\t\t\ttv = id;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tnv[n] = tv;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tobj[j] = nv;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tobj[j] = val;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn obj;\r\n\t\t\t});\r\n\t\t}\r\n\t\tapiParam['$'] = arr;\r\n\t\tlet ret = await this.apiPost('acts', resultType, apiParam);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected Acts = async (param: any): Promise<any> => {\r\n\t\t//let apiParam = this.ActsApiParam(param);\r\n\t\tlet ret = await this.apiActs(param, EnumResultType.data); // await this.apiPost('acts', apiParam);\r\n\t\tlet retArr = (ret[0].ret as string).split('\\n');\r\n\t\tlet arr: string[] = [];\r\n\t\tfor (let i in param) arr.push(i);\r\n\t\tlet retActs: { [key: string]: number[] } = {};\r\n\t\tfor (let i = 0; i < arr.length; i++) {\r\n\t\t\tretActs[arr[i]] = ids(retArr[i].split('\\t'));\r\n\t\t}\r\n\t\treturn retActs;\r\n\t}\r\n\r\n\tprotected getAdmins = async (): Promise<{ id: number; role: number }[]> => {\r\n\t\treturn await this.uqApi.getAdmins();\r\n\t}\r\n\r\n\tprotected $Acts = async (param: any): Promise<any> => {\r\n\t\treturn await this.apiActs(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiActIX(param: any, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IX, ID, values, IXs } = param;\r\n\t\tlet apiParam: any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIXs: IXs?.map((v: any) => ({ IX: entityName(v.IX), ix: v.ix })),\r\n\t\t\tvalues,\r\n\t\t};\r\n\t\tlet ret = await this.apiPost('act-ix', resultType, apiParam);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected ActIX = async (param: ParamActIX<any>): Promise<number[]> => {\r\n\t\t/*\r\n\t\tlet {IX, ID, values, IXs} = param;\r\n\t\tlet apiParam:any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIXs: IXs?.map(v => ({IX:entityName(v.IX), ix:v.ix})),\r\n\t\t\tvalues,\r\n\t\t};\r\n\t\tlet ret = await this.apiPost('act-ix'), apiParam);\r\n\t\t*/\r\n\t\tlet ret = await this.apiActIX(param, EnumResultType.data);\r\n\t\treturn (ret[0].ret as string).split('\\t').map(v => Number(v));\r\n\t}\r\n\r\n\tprotected $ActIX = async (param: ParamActIX<any>): Promise<string> => {\r\n\t\tlet ret = await this.apiActIX(param, EnumResultType.sql);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate async apiActIxSort(param: ParamActIXSort, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IX, ix, id, after } = param;\r\n\t\tlet apiParam: any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tix,\r\n\t\t\tid,\r\n\t\t\tafter,\r\n\t\t};\r\n\t\treturn await this.apiPost('act-ix-sort', resultType, apiParam);\r\n\t}\r\n\r\n\tprotected ActIXSort = async (param: ParamActIXSort): Promise<void> => {\r\n\t\t/*\r\n\t\tlet {IX, ix, id, after} = param;\r\n\t\tlet apiParam:any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tix,\r\n\t\t\tid,\r\n\t\t\tafter,\r\n\t\t};\r\n\t\tawait this.apiPost('act-ix-sort'), apiParam);\r\n\t\t*/\r\n\t\treturn await this.apiActIxSort(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprotected $ActIXSort = async (param: ParamActIXSort): Promise<string> => {\r\n\t\treturn await this.apiActIxSort(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiActDetail(param: ParamActDetail<any, any>, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { main, detail, detail2, detail3 } = param as unknown as ParamActDetail3<any, any, any, any>;\r\n\t\tlet postParam: any = {\r\n\t\t\tmain: {\r\n\t\t\t\tname: entityName(main.ID),\r\n\t\t\t\tvalue: toScalars(main.value),\r\n\t\t\t},\r\n\t\t\tdetail: {\r\n\t\t\t\tname: entityName(detail.ID),\r\n\t\t\t\tvalues: detail.values?.map(v => toScalars(v)),\r\n\t\t\t},\r\n\t\t}\r\n\t\tif (detail2) {\r\n\t\t\tpostParam.detail2 = {\r\n\t\t\t\tname: entityName(detail2.ID),\r\n\t\t\t\tvalues: detail2.values?.map(v => toScalars(v)),\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (detail3) {\r\n\t\t\tpostParam.detail3 = {\r\n\t\t\t\tname: entityName(detail3.ID),\r\n\t\t\t\tvalues: detail3.values?.map(v => toScalars(v)),\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet ret = await this.apiPost('act-detail', resultType, postParam);\r\n\t}\r\n\r\n\tprotected ActDetail = async (param: ParamActDetail<any, any>) => {\r\n\t\tlet ret = await this.apiActDetail(param, EnumResultType.data);\r\n\t\tlet val: string = ret[0].ret;\r\n\t\tlet parts = val.split('\\n');\r\n\t\tlet items = parts.map(v => v.split('\\t'));\r\n\t\tret = {\r\n\t\t\tmain: ids(items[0])[0],\r\n\t\t\tdetail: ids(items[1]),\r\n\t\t\tdetail2: ids(items[2]),\r\n\t\t\tdetail3: ids(items[3]),\r\n\t\t};\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected $ActDetail = async (param: ParamActDetail<any, any>) => {\r\n\t\treturn await this.apiActDetail(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiQueryID(param: ParamQueryID, resultType: EnumResultType): Promise<any[]> {\r\n\t\tlet { ID, IX, IDX } = param;\r\n\t\tif (!IDX) {\r\n\t\t\tIDX = [ID];\r\n\t\t}\r\n\t\tlet ret = await this.apiPost('query-id', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: IX?.map(v => entityName(v)),\r\n\t\t\tIDX: this.IDXToString(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected QueryID = async (param: ParamQueryID) => {\r\n\t\treturn await this.apiQueryID(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprotected $QueryID = async (param: ParamQueryID) => {\r\n\t\treturn await this.apiQueryID(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDTv(ids: number[], resultType: EnumResultType): Promise<any[]> {\r\n\t\tlet ret = await this.apiPost('id-tv', resultType, ids);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tIDTv = async (ids: number[]): Promise<any[]> => {\r\n\t\tlet ret = await this.apiIDTv(ids, EnumResultType.data);\r\n\t\tlet retValues: any[] = [];\r\n\t\tfor (let row of ret) {\r\n\t\t\tlet { $type, $tv } = row;\r\n\t\t\tif (!$tv) continue;\r\n\t\t\tlet ID = this.ids[$type];\r\n\t\t\tif (!ID) continue;\r\n\t\t\tlet { schema } = ID;\r\n\t\t\tif (!schema) {\r\n\t\t\t\tawait ID.loadSchema();\r\n\t\t\t\tschema = ID.schema;\r\n\t\t\t}\r\n\t\t\tlet { nameNoVice } = schema;\r\n\t\t\tif (!nameNoVice) continue;\r\n\t\t\tlet values = ($tv as string).split('\\n');\r\n\t\t\tlet len = nameNoVice.length;\r\n\t\t\tfor (let i = 0; i < len; i++) {\r\n\t\t\t\tlet p = nameNoVice[i];\r\n\t\t\t\trow[p] = values[i];\r\n\t\t\t}\r\n\t\t\tdelete row.$tv;\r\n\t\t\tretValues.push(row);\r\n\t\t}\r\n\t\treturn retValues;\r\n\t}\r\n\r\n\tprotected $IDTv = async (ids: number[]): Promise<any> => {\r\n\t\treturn await this.apiIDTv(ids, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDNO(param: ParamIDNO, resultType: EnumResultType): Promise<string> {\r\n\t\tlet { ID, stamp } = param;\r\n\t\tlet ret = await this.apiPost('id-no', resultType, { ID: entityName(ID), stamp });\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected IDNO = async (param: ParamIDNO): Promise<string> => {\r\n\t\treturn await this.apiIDNO(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprotected $IDNO = async (param: ParamIDNO): Promise<string> => {\r\n\t\treturn await this.apiIDNO(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDDetailGet(param: ParamIDDetailGet, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { id, main, detail, detail2, detail3 } = param;\r\n\t\tlet ret = await this.apiPost('id-detail-get', resultType, {\r\n\t\t\tid,\r\n\t\t\tmain: entityName(main),\r\n\t\t\tdetail: entityName(detail),\r\n\t\t\tdetail2: entityName(detail2),\r\n\t\t\tdetail3: entityName(detail3),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tIDDetailGet = async (param: ParamIDDetailGet): Promise<any> => {\r\n\t\treturn await this.apiIDDetailGet(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprotected $IDDetailGet = async (param: ParamIDDetailGet): Promise<any> => {\r\n\t\treturn await this.apiIDDetailGet(param, EnumResultType.sql);\r\n\t}\r\n\r\n\t//private checkParam(ID:ID, IDX:(ID|IDX)|(ID|IDX)[], IX:IX, id:number|number[], key:{[key:string]:string|number}, page: ParamPage) {\r\n\t//}\r\n\tprivate IDXToString(p: ID | IDX | ((ID | IDX)[])): string | string[] {\r\n\t\tif (Array.isArray(p) === true) return (p as (ID | IDX)[]).map(v => entityName(v));\r\n\t\treturn entityName(p as ID | IDX);\r\n\t}\r\n\tprivate async apiID(param: ParamID, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IDX } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIDX: this.IDXToString(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected ID = async (param: ParamID): Promise<any[]> => {\r\n\t\treturn await this.apiID(param, EnumResultType.data);\r\n\t}\r\n\tprotected $ID = async (param: ParamID): Promise<string> => {\r\n\t\treturn await this.apiID(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiKeyID(param: ParamKeyID, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { ID, IDX } = param;\r\n\t\t//this.checkParam(null, IDX, null, null, key, page);\r\n\t\tlet ret = await this.apiPost('key-id', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected KeyID = async (param: ParamKeyID): Promise<any[]> => {\r\n\t\treturn await this.apiKeyID(param, EnumResultType.data);\r\n\t}\r\n\tprotected $KeyID = async (param: ParamKeyID): Promise<string> => {\r\n\t\treturn await this.apiKeyID(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIX(param: ParamIX, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IX, IX1, IDX } = param;\r\n\t\t//this.checkParam(null, IDX, IX, id, null, page);\r\n\t\tlet ret = await this.apiPost('ix', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIX1: entityName(IX1),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IX = async (param: ParamIX): Promise<any[]> => {\r\n\t\treturn await this.apiIX(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IX = async (param: ParamIX): Promise<string> => {\r\n\t\treturn await this.apiIX(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIXr(param: ParamIX, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IX, IX1, IDX } = param;\r\n\t\t//this.checkParam(null, IDX, IX, id, null, page);\r\n\t\tlet ret = await this.apiPost('ixr', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIX1: entityName(IX1),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IXr = async (param: ParamIX): Promise<any[]> => {\r\n\t\treturn await this.apiIXr(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IXr = async (param: ParamIX): Promise<any[]> => {\r\n\t\treturn await this.apiIXr(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiKeyIX(param: ParamKeyIX, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { ID, IX, IDX } = param;\r\n\t\t//this.checkParam(ID, IDX, IX, null, key, page);\r\n\t\tlet ret = await this.apiPost('key-ix', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected KeyIX = async (param: ParamKeyIX): Promise<any[]> => {\r\n\t\treturn await this.apiKeyIX(param, EnumResultType.data);\r\n\t}\r\n\tprotected $KeyIX = async (param: ParamKeyIX): Promise<any[]> => {\r\n\t\treturn await this.apiKeyIX(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDLog(param: ParamIDLog, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IDX } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id-log', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIDX: entityName(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDLog = async (param: ParamIDLog): Promise<any[]> => {\r\n\t\treturn await this.apiIDLog(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDLog = async (param: ParamIDLog): Promise<string> => {\r\n\t\treturn await this.apiIDLog(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDSum(param: ParamIDSum, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IDX } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id-sum', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIDX: entityName(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDSum = async (param: ParamIDSum): Promise<any[]> => {\r\n\t\treturn await this.apiIDSum(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDSum = async (param: ParamIDSum): Promise<string> => {\r\n\t\treturn await this.apiIDSum(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDinIX(param: ParamIDinIX, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { ID, IX } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id-in-ix', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDinIX = async (param: ParamIDinIX): Promise<any | { $in: boolean }[]> => {\r\n\t\treturn await this.apiIDinIX(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDinIX = async (param: ParamIDinIX): Promise<string> => {\r\n\t\treturn await this.apiIDinIX(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDxID(param: ParamIDxID, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { ID, IX, ID2 } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id-x-id', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tID2: entityName(ID2),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDxID = async (param: ParamIDxID): Promise<any[]> => {\r\n\t\treturn await this.apiIDxID(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDxID = async (param: ParamIDxID): Promise<string> => {\r\n\t\treturn await this.apiIDxID(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDTree(param: ParamIDTree, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { ID } = param;\r\n\t\tlet ret = await this.apiPost('id-tree', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDTree = async (param: ParamIDTree): Promise<any[]> => {\r\n\t\treturn await this.apiIDTree(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDTree = async (param: ParamIDTree): Promise<string> => {\r\n\t\treturn await this.apiIDTree(param, EnumResultType.sql);\r\n\t}\r\n}\r\n\r\nfunction ids(item: string[]): number[] {\r\n\tif (!item) return;\r\n\tlet len = item.length;\r\n\tif (len <= 1) return;\r\n\tlet ret: number[] = [];\r\n\tfor (let i = 0; i < len - 1; i++) ret.push(Number(item[i]));\r\n\treturn ret;\r\n}\r\n\r\nfunction entityName(entity: Entity | string): string {\r\n\tif (!entity) return;\r\n\tif (typeof entity === 'string') return entity;\r\n\treturn entity.name;\r\n}\r\n\r\nfunction toScalars(value: any): any {\r\n\tif (!value) return value;\r\n\tlet ret: any = {};\r\n\tfor (let i in value) {\r\n\t\tlet v = value[i];\r\n\t\tif (typeof v === 'object') v = v['id'];\r\n\t\tret[i] = v;\r\n\t}\r\n\treturn ret;\r\n}\r\n","import { UQsBuildingLoader } from \"../uqCore\";\r\nimport { TsTemplate } from \"./TsTemplate\";\r\n\r\nexport abstract class UqBuildContext {\r\n\treadonly uqsLoader: UQsBuildingLoader;\r\n\treadonly uqTsSrcPath: string;\r\n\treadonly tsTemplate: TsTemplate;\r\n\r\n\tconstructor(uqsLoader: UQsBuildingLoader, uqTsSrcPath: string) {\r\n\t\tthis.uqsLoader = uqsLoader;\r\n\t\tthis.uqTsSrcPath = uqTsSrcPath;\r\n\t\tthis.tsTemplate = new TsTemplate(this);\r\n\t}\r\n\r\n\tabstract get uiPlatform():string;\r\n\tabstract get uiPlatformUpper():string;\r\n\tabstract get uiPlatformCamel():string;\r\n\tabstract get element(): string;\r\n}\r\n","import { UqApi } from '../web';\r\nimport { LocalCache, getObjPropIgnoreCase } from '../tool';\r\nimport { UqMan, Field, ArrFields, FieldMap } from './uqMan';\r\nimport { Tuid } from './tuid';\r\n\r\nconst tab = '\\t';\r\nconst ln = '\\n';\r\nconst chars = '\\\\ntbfvr';\r\nconst codeBackSlash = chars.charCodeAt(0);\r\nconst codeN = chars.charCodeAt(1);\r\nconst codeT = chars.charCodeAt(2);\r\nconst codeB = chars.charCodeAt(3);\r\nconst codeF = chars.charCodeAt(4);\r\nconst codeV = chars.charCodeAt(5);\r\nconst codeR = chars.charCodeAt(6);\r\n\r\nconst codes = '\\n\\t\\b\\f\\v\\r';\r\nconst codeBN = codes.charCodeAt(0);\r\nconst codeBT = codes.charCodeAt(1);\r\nconst codeBB = codes.charCodeAt(2);\r\nconst codeBF = codes.charCodeAt(3);\r\nconst codeBV = codes.charCodeAt(4);\r\nconst codeBR = codes.charCodeAt(5);\r\n\r\nexport abstract class Entity {\r\n    private jName: string;\r\n    schema: any;\r\n    ver: number = 0;\r\n    sys?: boolean;\r\n    readonly uq: UqMan;\r\n    readonly name: string;\r\n    readonly typeId: number;\r\n    readonly schemaLocal: LocalCache;\r\n    readonly uqApi: UqApi;\r\n    abstract get typeName(): string;\r\n    get sName():string {return this.jName || this.name}\r\n\tfields: Field[];\r\n    arrFields: ArrFields[];\r\n    returns: ArrFields[];\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        this.uq = uq;\r\n        this.name = name;\r\n        this.typeId = typeId;\r\n        this.sys = this.name.indexOf('$') >= 0;\r\n        this.schemaLocal = this.uq.localMap.item(this.name); // new EntityCache(this);\r\n        this.uqApi = this.uq.uqApi;\r\n    }\r\n\r\n    public face: any;           // 对应字段的label, placeHolder等等的中文，或者语言的翻译\r\n\r\n    //getApiFrom() {return this.entities.uqApi;}\r\n\r\n    private fieldMaps: {[arr:string]: FieldMap} = {};\r\n    fieldMap(arr?:string): FieldMap {\r\n        if (arr === undefined) arr = '$';\r\n        let ret = this.fieldMaps[arr];\r\n        if (ret === undefined) {\r\n            let fields:Field[];\r\n            if (arr === '$') fields = this.fields;\r\n            else if (this.arrFields !== undefined) {\r\n                let arrFields = this.arrFields.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            else if (this.returns !== undefined) {\r\n                let arrFields = this.returns.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            if (fields === undefined) return {};\r\n            ret = {};\r\n            for (let f of fields) ret[f.name] = f;\r\n            this.fieldMaps[arr] = ret;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public async loadSchema():Promise<void> {\r\n        if (this.schema !== undefined) return;\r\n        let schema = this.schemaLocal.get();\r\n        if (!schema) {\r\n            schema = await this.uq.loadEntitySchema(this.name);\r\n        }\r\n        //this.setSchema(schema);\r\n\t\t//this.buildFieldsTuid();\r\n\t\tthis.buildSchema(schema);\r\n\t\tawait this.loadValues();\r\n\t}\r\n\r\n\tbuildSchema(schema: any) {\r\n        this.setSchema(schema);\r\n\t\tthis.buildFieldsTuid();\r\n\t\t//await this.loadValues();\r\n\t}\r\n\t\r\n\tprotected async loadValues():Promise<any> {}\r\n\r\n    // 如果要在setSchema里面保存cache，必须先调用clearSchema\r\n    public clearSchema() {\r\n        this.schema = undefined;\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        if (schema === undefined) return;\r\n        let {name, version} = schema;\r\n        this.ver = version || 0;\t\t\r\n\t\tthis.setJName(name);\r\n        this.schemaLocal.set(schema);\r\n\t\tthis.schema = schema;\r\n\t\tthis.buildFieldsTuid();\r\n\t}\r\n\t\r\n\tprotected setJName(name:string) {\r\n        if (name !== this.name) this.jName = name;\r\n\t}\r\n\r\n    public buildFieldsTuid() {\r\n        let {fields, arrs, returns} = this.schema;\r\n\t\tthis.fields = fields;\r\n        this.uq.buildFieldTuid(fields);\r\n\t\tthis.arrFields = arrs;\r\n        this.uq.buildArrFieldsTuid(arrs, fields);\r\n\t\tthis.returns = returns;\r\n        this.uq.buildArrFieldsTuid(returns, fields);\r\n    }\r\n\r\n    schemaStringify():string {\r\n        return JSON.stringify(this.schema, (key:string, value:any) => {\r\n            if (key === '_tuid') return undefined;\r\n            return value;\r\n        }, 4);\r\n    }\r\n\r\n    tuidFromName(fieldName:string, arrName?:string):Tuid {\r\n        if (this.schema === undefined) return;\r\n        let {fields, arrs} = this.schema;\r\n        let entities = this.uq;\r\n        function getTuid(fn:string, fieldArr:Field[]) {\r\n            if (fieldArr === undefined) return;\r\n            let f = fieldArr.find(v => v.name === fn);\r\n            if (f === undefined) return;\r\n            return entities.getTuid(f.tuid);\r\n        }\r\n        let fn = fieldName.toLowerCase();\r\n        if (arrName === undefined) return getTuid(fn, fields);\r\n        if (arrs === undefined) return;\r\n        let an = arrName.toLowerCase();\r\n        let arr = (arrs as ArrFields[]).find(v => v.name === an);\r\n        if (arr === undefined) return;\r\n        return getTuid(fn, arr.fields);\r\n    }\r\n\r\n    buildParams(params:any):any {\r\n        let result:any = {};\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.buildFieldsParams(result, fields, params);\r\n        let arrs = this.arrFields;\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let {name, fields} = arr;\r\n                let paramsArr:any[] = params[name];\r\n                if (paramsArr === undefined) continue;\r\n                let arrResult:any[] = [];\r\n                result[name] = arrResult;\r\n                for (let pa of params) {\r\n                    let rowResult = {};\r\n                    this.buildFieldsParams(rowResult, fields, pa);\r\n                    arrResult.push(rowResult);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private buildFieldsParams(result:any, fields:Field[], params:any) {\r\n        for (let field of fields) {\r\n            let {name, type} = field;            \r\n            let d = params[name];\r\n            let val:any;\r\n            switch (type) {\r\n\t\t\t\tcase 'datetime':\r\n                \tval = this.buildDateTimeParam(d);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'date':\r\n\t\t\t\t\tif (d instanceof Date) {\r\n\t\t\t\t\t\tval = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tval = d;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tswitch (typeof d) {\r\n\t\t\t\t\t\tdefault: val = d; break;\r\n\t\t\t\t\t\tcase 'object':\r\n\t\t\t\t\t\t\tif (d instanceof Date) {\r\n\t\t\t\t\t\t\t\tval = d;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlet tuid = field._tuid;\r\n\t\t\t\t\t\t\tif (tuid === undefined) val = d.id;\r\n\t\t\t\t\t\t\telse val = tuid.getIdFromObj(d);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n            }\r\n            result[name] = val;\r\n        }\r\n    }\r\n\r\n    buildDateTimeParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return undefined;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'string':\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        return Math.floor(dt.getTime()/1000);\r\n    }\r\n\r\n    buildDateParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return '';\r\n            case 'string': return val;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        let ret = dt.toISOString();\r\n        let p = ret.indexOf('T');\r\n        return p>0? ret.substr(0, p) : ret;\r\n    }\r\n\r\n    pack(data:any):string {\r\n        let ret:string[] = [];\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.packRow(ret, fields, data);\r\n        let arrs = this.arrFields; \r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n\t\t\t\tlet {name, fields} = arr;\r\n\t\t\t\tlet arrData = getObjPropIgnoreCase(data, name);\r\n\t\t\t\t//if (!arrData) arrData = data[name.toLowerCase()];\r\n                this.packArr(ret, fields, arrData);\r\n            }\r\n        }\r\n        return ret.join('');\r\n    }\r\n\r\n    private escape(row:any, field:Field):any {\r\n        let d = row[field.name];\r\n        if (d === null) return '';\r\n        switch (field.type) {\r\n            case 'datetime':\r\n                return this.buildDateTimeParam(d);\r\n            default:\r\n                switch (typeof d) {\r\n                    default: return d;\r\n                    case 'object':\r\n                        let tuid = field._tuid;\r\n                        if (tuid === undefined) return d.id;\r\n                        return tuid.getIdFromObj(d);\r\n                    case 'string':\r\n                        let len = d.length;\r\n                        let r = '', p = 0;\r\n                        for (let i=0;i<len;i++) {\r\n                            let c:number = d.charCodeAt(i), ch:string;\r\n                            switch(c) {\r\n\t\t\t\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\t\t\t\tcase codeBackSlash: ch = '\\\\\\\\'; break;\r\n                                case codeBT: ch = '\\\\t'; break;\r\n\t\t\t\t\t\t\t\tcase codeBN: ch = '\\\\n'; break;\r\n\t\t\t\t\t\t\t\tcase codeBF: ch = '\\\\f'; break;\r\n\t\t\t\t\t\t\t\tcase codeBV: ch = '\\\\v'; break;\r\n\t\t\t\t\t\t\t\tcase codeBB: ch = '\\\\b'; break;\r\n\t\t\t\t\t\t\t\tcase codeBR: ch = '\\\\r'; break;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tr += d.substring(p, i) + ch;\r\n\t\t\t\t\t\t\tp = i+1;\r\n                        }\r\n                        return r + d.substring(p);\r\n                    case 'undefined': return '';\r\n                }\r\n        }\r\n    }\r\n\r\n    private packRow(result:string[], fields:Field[], data:any) {\r\n        let len = fields.length;\r\n        if (len === 0) {\r\n            result.push(ln);\r\n            return;\r\n        }\r\n        let ret = '';\r\n        ret += this.escape(data, fields[0]);\r\n        for (let i=1;i<len;i++) {\r\n            let f = fields[i];\r\n            ret += tab + this.escape(data, f);\r\n        }\r\n        result.push(ret + ln);\r\n    }\r\n\r\n    private packArr(result:string[], fields:Field[], data:any[]) {\r\n        if (data !== undefined) {\r\n\t\t\tif (data.length === 0) {\r\n\t\t\t\tresult.push(ln);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (let row of data) {\r\n\t\t\t\t\tthis.packRow(result, fields, row);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tresult.push(ln);\r\n\t\t}\r\n        result.push(ln);\r\n    }\r\n    protected cacheFieldsInValue(values:any, fields:Field[]) {\r\n        for (let f of fields as Field[]) {\r\n            let {name, _tuid} = f;\r\n            if (_tuid === undefined) continue;\r\n            let id = values[name];\r\n            //_tuid.useId(id);\r\n            values[name] = _tuid.boxId(id);\r\n        }\r\n    }\r\n\r\n    protected unpackTuidIdsOfFields(values:string[], fields: Field[]):any[] {\r\n        if (fields === undefined) {\r\n            return values as any[];\r\n        }\r\n        let ret:any[] = []\r\n        for (let ln of values) {\r\n            if (!ln) continue;\r\n            let len = ln.length;\r\n            let p = 0;\r\n            while (p<len) {\r\n                let ch = ln.charCodeAt(p);\r\n                if (ch === 10) {\r\n                    ++p;\r\n                    break;\r\n                }\r\n                let row = {};\r\n                p = this.unpackRow(row, fields, ln, p);\r\n                ret.push(row);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    unpackSheet(data:string):any {\r\n        let ret = {} as any; //new this.newMain();\r\n        //if (schema === undefined || data === undefined) return;\r\n        let fields = this.fields;\r\n        let p = 0;\r\n        if (fields !== undefined) p = this.unpackRow(ret, fields, data, p);\r\n        let arrs = this.arrFields; //schema['arrs'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n\tunpackReturns(data:string, returns?:ArrFields[]):{[name:string]:any[]} {\r\n\t\tif (data === undefined) debugger;\r\n\t\tlet ret = {} as any;\r\n\t\tlet p = 0;\r\n\t\tlet arrs = returns || this.returns;\r\n\t\tif (arrs !== undefined) {\r\n\t\t\tfor (let arr of arrs) {\r\n\t\t\t\tp = this.unpackArr(ret, arr, data, p);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n    protected unpackRow(ret:any, fields:Field[], data:string, p:number):number {\r\n        let ch0 = 0, ch = 0, c = p, i = 0, len = data.length, fLen = fields.length;\r\n        for (;p<len;p++) {\r\n            ch0 = ch;\r\n            ch = data.charCodeAt(p);\r\n            if (ch === 9) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                c = p+1;\r\n                ++i;\r\n                if (i>=fLen) {\r\n                    p = data.indexOf('\\n', c);\r\n                    if (p >= 0) ++p;\r\n                    else p = len;\r\n                    return p;\r\n                }\r\n            }\r\n            else if (ch === 10) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                ++p;\r\n                ++i;\r\n                return p;\r\n            }\r\n        }\r\n        let f = fields[i];\r\n        let {name} = f;\r\n        if (ch0 !== 8) {\r\n            let v = data.substring(c);\r\n            ret[name] = this.to(ret, v, f);\r\n        }\r\n        return len;\r\n    }\r\n\r\n    private to(ret:any, v:string, f:Field):any {\r\n        switch (f.type) {\r\n\t\t\tdefault: return v;\r\n\t\t\tcase 'text':\r\n\t\t\tcase 'char':\r\n\t\t\t\treturn this.reverseNT(v);\r\n            case 'datetime':\r\n            case 'time':\r\n\t\t\tcase 'timestamp':\r\n                let n = Number(v);\r\n                let date = isNaN(n) === true? new Date(v) : new Date(n*1000);\r\n                return date;\r\n            case 'date':\r\n                let parts = v.split('-');\r\n                return new Date(Number(parts[0]), Number(parts[1])-1, Number(parts[2]));\r\n            case 'enum':\r\n            case 'tinyint':\r\n            case 'smallint':\r\n            case 'int':\r\n            case 'bigint':\r\n            case 'dec':\r\n\t\t\tcase 'float':\r\n\t\t\tcase 'double':\r\n                return Number(v);\r\n            case 'id':\r\n                let id = Number(v);\r\n                let {_tuid} = f;\r\n                if (_tuid === undefined) return id;\r\n                return _tuid.boxId(id);\r\n        }\r\n\t}\r\n\t\r\n\tprivate reverseNT(text:string):string {\r\n\t\tif (text === undefined) return;\r\n\t\tif (text === null) return;\r\n\t\tlet len = text.length;\r\n\t\tlet r = '';\r\n\t\tlet p = 0;\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet c = text.charCodeAt(i);\r\n\t\t\tif (c === codeBackSlash) {\r\n\t\t\t\tif (i===len-1) break;\r\n\t\t\t\tlet c1 = text.charCodeAt(i+1);\r\n\t\t\t\tlet ch:string;\r\n\t\t\t\tswitch (c1) {\r\n\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\tcase codeBackSlash: ch = '\\\\'; break;\r\n\t\t\t\t\tcase codeN: ch = '\\n'; break;\r\n\t\t\t\t\tcase codeT: ch = '\\t'; break;\r\n\t\t\t\t\tcase codeB: ch = '\\b'; break;\r\n\t\t\t\t\tcase codeF: ch = '\\f'; break;\r\n\t\t\t\t\tcase codeV: ch = '\\v'; break;\r\n\t\t\t\t\tcase codeR: ch = '\\r'; break;\r\n\t\t\t\t}\r\n\t\t\t\tr += text.substring(p, i) + ch;\r\n\t\t\t\tp = i+2;\r\n\t\t\t\t++i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tr += text.substring(p, len);\r\n\t\treturn r;\r\n\t}\r\n\r\n    private unpackArr(ret:any, arr:ArrFields, data:string, p:number):number {\r\n\t\tlet p0 = p;\r\n        let vals:any[] = [], len = data.length;\r\n        let {name, fields} = arr;\r\n        while (p<len) {\r\n            let ch = data.charCodeAt(p);\r\n            if (ch === 10) {\r\n\t\t\t\tif (p === p0) {\r\n\t\t\t\t\tch = data.charCodeAt(p);\r\n\t\t\t\t\tif (ch !== 10) {\r\n\t\t\t\t\t\tthrow new Error('upackArr: arr第一个字符是10，则必须紧跟一个10，表示整个arr的结束')\r\n\t\t\t\t\t}\r\n\t\t\t\t\t++p;\r\n\t\t\t\t}\r\n                ++p;\r\n                break;\r\n            }\r\n            let val = {} as any; //new creater();\r\n            vals.push(val);\r\n            p = this.unpackRow(val, fields, data, p);\r\n        }\r\n        ret[name] = vals;\r\n        return p;\r\n    }\r\n}\r\n","import { Caller } from '../web';\r\nimport { Entity } from './entity';\r\nimport { Action } from './action';\r\nimport { Query } from './query';\r\n\r\ninterface UqResponseSchema {\r\n    uq: any;\r\n    entity: any;\r\n}\r\n\r\nexport abstract class EntityCaller<T> extends Caller<T> {\r\n    private tries: number;\r\n    protected _entity: Entity;\r\n\r\n    constructor(entity: Entity, params:T, $$user:number = undefined, waiting: boolean = true) {\r\n        super(params, $$user, waiting);\r\n        this.tries = 0;\r\n        this._entity = entity;\r\n    }\r\n\r\n    protected get entity(): Entity {return this._entity;}\r\n\r\n    //大多的entityCaller都不需要这个\r\n    //buildParams() {return this.entity.buildParams(this.params);}\r\n    \r\n    async request(): Promise<any> {\r\n        await this.entity.loadSchema();\r\n        let ret = await this.innerRequest();\r\n        return ret;\r\n    }\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        return await this.entity.uqApi.xcall(this);\r\n    }\r\n\r\n    async innerRequest(): Promise<any> {\r\n        let jsonResult = await this.innerCall();\r\n        let {$uq, $modify, res} = jsonResult;\r\n        this.entity.uq.pullModify($modify);\r\n        if ($uq === undefined) {\r\n            let ret = this.xresult(res);\r\n            return ret;\r\n        }\r\n        return await this.retry($uq);\r\n    }\r\n\r\n    xresult(res:any):any {return res}\r\n\r\n    get headers(): {[header:string]: string} {\r\n        let {ver, uq} = this.entity;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }\r\n\r\n    private async retry(schema: UqResponseSchema) {\r\n        ++this.tries;\r\n        if (this.tries > 5) throw new Error(`${schema.entity.name} can not get right uq response schema, 5 tries`);\r\n        this.rebuildSchema(schema);\r\n        return await this.innerRequest();\r\n    }\r\n\r\n    private rebuildSchema(schema: UqResponseSchema) {\r\n        let {uq, entity} = schema;\r\n        if (uq !== undefined) {\r\n\t\t\tthis.entity.uq.buildEntities(uq);\r\n\t\t}\r\n        if (entity !== undefined) {\r\n\t\t\tthis.entity.setSchema(entity);\r\n\t\t}\r\n    }\r\n}\r\n\r\nexport abstract class ActionCaller extends EntityCaller<any> {\r\n    protected get entity(): Action {return this._entity as Action;}\r\n}\r\n\r\nexport class QueryQueryCaller extends EntityCaller<any> {\r\n    protected get entity(): Query {return this._entity as Query};\r\n    get path():string {return `query/${this.entity.name}`;}\r\n    xresult(res:any) {\r\n        let data = this.entity.unpackReturns(res);\r\n        return data;\r\n    }\r\n    buildParams() {return this.entity.buildParams(this.params);}\r\n}\r\n\r\nexport class QueryPageCaller extends EntityCaller<any> {\r\n    protected get params(): {pageStart:any; pageSize:number, params:any} {return this._params};\r\n\tprotected get entity(): Query {return this._entity as Query};\r\n\t//results: {[name:string]:any[]};\r\n\tget path():string {return `query-page/${this.entity.name}`;}\t\r\n    buildParams() {\r\n        let {pageStart, pageSize, params} = this.params;\r\n        let p:any;\r\n        if (params === undefined) {\r\n            p = {key: ''};\r\n        }\r\n        else {\r\n            p = this.entity.buildParams(params);\r\n        }\r\n        /*\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        */\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return p;\r\n    };\r\n    xresult(res:any): {[name:string]:any[]} {\r\n        let ret = this.entity.unpackReturns(res);\r\n\t\t//return this.results.$page;// as any[];\r\n\t\treturn ret;\r\n    }\r\n}\r\n","import { LocalArr } from '../../tool';\r\nimport { BoxId } from './boxId';\r\nimport { TuidInner, TuidDiv } from './tuid';\r\n\r\nconst maxCacheSize = 10000;\r\n\r\nexport class IdCache {\r\n    private queue: number[] = [];                   // 每次使用，都排到队头\r\n    private readonly cache: Map<number, any>;    // 已经缓冲的\r\n\r\n    protected localArr: LocalArr;\r\n    protected waitingIds: number[] = [];          // 等待loading的\r\n    protected tuidInner: TuidInner;\r\n\r\n    constructor(tuidLocal: TuidInner) {\r\n        this.cache = tuidLocal.uq.tonwa.createObservableMap();\r\n        this.tuidInner = tuidLocal;\r\n        this.initLocalArr();\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        this.localArr = this.tuidInner.schemaLocal.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    cacheSet(id: number, val: any) {\r\n        this.cache.set(id, val);\r\n    }\r\n\r\n    useId(id: number, defer?: boolean) {\r\n        if (!id) return;\r\n        if (typeof id !== 'number') {\r\n            console.error('id cache ' + id + ' is not number');\r\n            return;\r\n        }\r\n        if (this.cache.has(id) === true) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n        this.tuidInner.cacheTuids(defer === true ? 70 : 20);\r\n        if (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n\r\n        if (this.queue.length >= maxCacheSize) {\r\n            // 缓冲已满，先去掉最不常用的\r\n            let r = this.queue.shift();\r\n            if (r === id) {\r\n                // 如果移除的，正好是现在用的，则插入\r\n                this.queue.push(r);\r\n                return;\r\n            }\r\n\r\n            if (this.cache.has(r) === true) {\r\n                // 如果移除r已经缓存\r\n                this.cache.delete(r);\r\n            }\r\n            else {\r\n                // 如果移除r还没有缓存\r\n                let index = this.waitingIds.findIndex(v => v === r);\r\n                this.waitingIds.splice(index, 1);\r\n            }\r\n        }\r\n        this.waitingIds.push(id);\r\n        this.queue.push(id);\r\n        return;\r\n    }\r\n\r\n    private moveToHead(id: number) {\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.queue.push(id);\r\n    }\r\n\r\n    getValue(id: number) {\r\n        return this.cache.get(id);\r\n    }\r\n\r\n    remove(id: number) {\r\n        this.cache.delete(id);\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.localArr.removeItem(id);\r\n    }\r\n\r\n    valueFromId(id: number | BoxId): any {\r\n        let _id: number;\r\n        switch (typeof id) {\r\n            case 'object': _id = (id as BoxId).id; break;\r\n            case 'number': _id = id as number; break;\r\n            default: return;\r\n        }\r\n        return this.getValue(_id);\r\n    }\r\n\r\n    resetCache(id: number) {\r\n        this.remove(id);\r\n        this.useId(id);\r\n    }\r\n\r\n    cacheValue(val: any): boolean {\r\n        if (val === undefined) return false;\r\n        let id = this.getIdFromObj(val);\r\n        if (id === undefined) return false;\r\n        this.cacheSet(id, val);\r\n        return true;\r\n    }\r\n    protected getIdFromObj(val: any) { return this.tuidInner.getIdFromObj(val) }\r\n\r\n    async cacheIds(): Promise<void> {\r\n        let tuidValues = await this.loadIds();\r\n        this.cacheIdValues(tuidValues);\r\n    }\r\n\r\n    protected cacheIdValues(tuidValues: any[]) {\r\n        if (tuidValues === undefined) return;\r\n        let tuids = this.unpackTuidIds(tuidValues);\r\n        for (let tuidValue of tuids) {\r\n            if (this.cacheValue(tuidValue) === true) {\r\n                this.cacheTuidFieldValues(tuidValue);\r\n            }\r\n        }\r\n    }\r\n    async modifyIds(ids: any[]): Promise<void> {\r\n        let tuidValues: string[] = await this.loadTuidIdsOrLocal(ids);\r\n        let localedValues = tuidValues.filter(v => {\r\n            let p = v.indexOf('\\t');\r\n            if (p < 0) p = v.length;\r\n            let id = Number(v.substr(0, p));\r\n            let val = this.localArr.getItem(id);\r\n            return (val !== undefined);\r\n        });\r\n        if (localedValues.length === 0) return;\r\n        this.cacheIdValues(localedValues);\r\n    }\r\n    protected async loadIds(): Promise<any[]> {\r\n        if (this.waitingIds.length === 0) return;\r\n        let loadingIds = [...this.waitingIds];\r\n        this.waitingIds = [];\r\n        return await this.loadTuidIdsOrLocal(loadingIds);\r\n    }\r\n    protected unpackTuidIds(values: string[]): any[] {\r\n        return this.tuidInner.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.tuidInner.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    async assureObj(id: number): Promise<object | number> {\r\n        let val = this.cache.get(id);\r\n        if (val !== undefined) return val;\r\n        /*\r\n        switch (typeof val) {\r\n            case 'object': return val;\r\n            // case 'number': this.cache.set(id, undefined); break;\r\n        }\r\n        */\r\n        let ret = await this.loadTuidIdsOrLocal([id]);\r\n        this.cacheIdValues(ret);\r\n    }\r\n\r\n    protected async loadValuesFromIds(netIds: number[]): Promise<any[]> {\r\n        let netRet = await this.tuidInner.loadValuesFromIds(undefined, netIds);\r\n        return netRet;\r\n    }\r\n\r\n    private async loadTuidIdsOrLocal(ids: number[]): Promise<string[]> {\r\n        let ret: string[] = [];\r\n        let netIds: number[] = [];\r\n        for (let id of ids) {\r\n            let value = this.localArr.getItem(id);\r\n            //if (value === undefined)\r\n            // 值不存在或者是空字符串，重新获取\r\n            if (!value)\r\n                netIds.push(id);\r\n            else\r\n                ret.push(value);\r\n        }\r\n        let len = netIds.length;\r\n        if (len === 0) return ret;\r\n\r\n        let netRet = await this.loadValuesFromIds(netIds);\r\n        for (let i = 0; i < len; i++) {\r\n            //有些id可能没有内容，不会返回\r\n            //let id = netIds[i]; \r\n            let row: string = netRet[i];\r\n            if (!row) continue;\r\n            let p = row.indexOf('\\t');\r\n            if (p < 0) p = row.length;\r\n            let id = Number(row.substr(0, p));\r\n            let pos = netIds.findIndex(v => v === id);\r\n            if (pos >= 0) netIds.splice(pos, 1);\r\n            ret.push(row);\r\n            this.localArr.setItem(id, row);\r\n        }\r\n        len = netIds.length;\r\n        for (let i = 0; i < len; i++) {\r\n            this.localArr.setItem(netIds[i], '');\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nexport class IdDivCache extends IdCache {\r\n    private div: TuidDiv;\r\n    protected divName: string;\r\n\r\n    constructor(tuidLocal: TuidInner, div: TuidDiv) {\r\n        super(tuidLocal);\r\n        this.div = div;\r\n        this.divName = div.name;\r\n        this.localArr = tuidLocal.schemaLocal.arr(tuidLocal.name + '.ids.' + this.divName);\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        // 这个不需要，必须去掉\r\n        // this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    protected getIdFromObj(val: any) { return this.div.getIdFromObj(val) }\r\n    protected unpackTuidIds(values: string[]): any[] {\r\n        return this.div.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.div.cacheTuidFieldValues(tuidValue);\r\n    }\r\n    protected async loadValuesFromIds(netIds: number[]): Promise<any[]> {\r\n        let netRet = await this.tuidInner.loadValuesFromIds(this.divName, netIds);\r\n        return netRet;\r\n    }\r\n}\r\n","import { LocalArr } from '../../tool';\r\nimport { Entity } from '../entity';\r\nimport { UqMan, ArrFields, Field, SchemaFrom } from '../uqMan';\r\nimport { EntityCaller } from '../caller';\r\nimport { BoxId } from './boxId';\r\nimport { IdCache, IdDivCache } from './idCache';\r\n\r\nexport interface TuidSaveResult {\r\n    id: number;\r\n    inId: number;\r\n}\r\n\r\nexport interface TuidNOResult {\r\n\tdate: string;\r\n\tno: number;\r\n}\r\n\r\nexport abstract class UqTuid<M> extends Entity {\r\n    protected noCache: boolean;\r\n    readonly typeName:string = 'tuid';\r\n    protected idName: string;\r\n    unique: string[];\r\n\t//render: Render<M>;\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {id} = schema;\r\n        this.idName = id;\r\n    }\r\n\r\n    buildTuidBox(): TuidBox {\r\n        return new TuidBox(this);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    stopCache():void {this.noCache = true}\r\n    //abstract tv(id:number, render?:Render<M>):JSX.Element;\r\n    abstract getObj(id:number):M;\r\n    abstract useId(id:number):void;\r\n    abstract boxId(id:number):BoxId;\r\n    abstract valueFromId(id:number):any;\r\n\tabstract resetCache(id:number|BoxId):void;\r\n\tabstract assureBox<T> (id:number|BoxId): Promise<T>;\r\n\tstatic idValue(id: {id:number}|number):number {\r\n\t\tlet t = typeof id;\r\n\t\tswitch (t) {\r\n\t\t\tdefault: debugger; throw new Error('unknown id type: ' + t);\r\n\t\t\tcase 'undefined': return undefined;\r\n\t\t\tcase 'object': return (id as any).id;\r\n\t\t\tcase 'number': return id as number;\r\n\t\t}\r\n\t}\r\n    static equ(id1:{id:number}|number, ix:{id:number}|number): boolean {\r\n        if (id1 === undefined || id1 === null) return false;\r\n\t\tif (ix === undefined || ix === null) return false;\r\n\t\treturn Tuid.idValue(id1) === Tuid.idValue(ix);\r\n\t\t/*\r\n        if (typeof id1 === 'object') {\r\n\t\t\tlet id1Id = id1.id;\r\n            return typeof ix === 'object'? id1Id === ix.id : id1Id === ix;\r\n        }\r\n        if (typeof ix === 'object') {\r\n\t\t\tlet id2Id = ix.id;\r\n            return typeof id1 === 'object'? id2Id === id1.id : id2Id === id1;\r\n        }\r\n\t\treturn id1 === ix;\r\n\t\t*/\r\n    }\r\n    cacheIds() {}\r\n    async modifyIds(ids:any[]) {}\r\n    isImport = false;\r\n    abstract get hasDiv():boolean;// {return this.divs!==undefined}\r\n    abstract div(name:string):TuidDiv;\r\n    abstract loadMain(id:number|BoxId):Promise<M>;\r\n\tabstract load(id:number|BoxId):Promise<M>;\r\n    abstract all():Promise<M[]>;\r\n\tabstract save(id:number, props:M):Promise<TuidSaveResult>;\r\n\tabstract saveProp(id:number, prop:string, value:any):Promise<void>;\r\n    abstract search(key:string, pageStart:string|number, pageSize:number):Promise<M[]>;\r\n    abstract searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any>;\r\n    abstract loadArr(arr:string, owner:number, id:number):Promise<any>;\r\n    abstract saveArr(arr:string, owner:number, id:number, props:any):Promise<void>;\r\n\tabstract posArr(arr:string, owner:number, id:number, order:number):Promise<void>;\r\n\tabstract no():Promise<TuidNOResult>;\r\n}\r\n\r\nexport abstract class Tuid extends UqTuid<any> {\r\n}\r\n\r\nexport class TuidInner extends Tuid {\r\n    private divs: {[div:string]: TuidDiv};\r\n    protected cacheFields: Field[];\r\n    protected idCache: IdCache;\r\n    protected localArr:LocalArr;\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        super(uq, name, typeId);\r\n        this.idCache = new IdCache(this);\r\n        this.localArr = this.schemaLocal.arr(this.name + '.whole');\r\n        if (uq.newVersion === true) this.localArr.removeAll();\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {arrs} = schema;\r\n        if (arrs !== undefined) {\r\n            this.divs = {};\r\n            for (let arr of arrs) {\r\n                let {name} = arr;\r\n                let tuidDiv = new TuidDiv(this.uq, this, name);\r\n                this.divs[name] = tuidDiv;\r\n                tuidDiv.setSchema(arr);\r\n                tuidDiv.buildFieldsTuid();\r\n            }\r\n        }\r\n    }\r\n    \r\n    getObj(id:number):any {\r\n        let obj = this.valueFromId(id);\r\n        if (obj) return obj;\r\n        this.useId(id);\r\n        return {id};\r\n    }\r\n\r\n    useId(id:number, defer?:boolean) {\r\n        if (this.noCache === true) return;\r\n        if (!id) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n    boxId(id:number):BoxId {\r\n        if (!id) return;\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        //let {createBoxId} = this.uq;\r\n        //if (!createBoxId) \r\n        return {id: id} as BoxId;\r\n        //return createBoxId(this, id);\r\n    }\r\n    valueFromId(id:number) {return this.idCache.getValue(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tthis.idCache.resetCache(id);\r\n\t}\r\n    async assureBox<T> (id:number|BoxId):Promise<T> {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    cacheIds() {\r\n        this.idCache.cacheIds();\r\n        if (this.divs === undefined) return;\r\n        for (let i in this.divs) this.divs[i].cacheIds();\r\n    }\r\n    async modifyIds(ids:any[]) {\r\n        await this.idCache.modifyIds(ids);\r\n    }\r\n    cacheTuids(defer:number) {this.uq.cacheTuids(defer)}\r\n    get hasDiv():boolean {return this.divs!==undefined}\r\n    div(name:string):TuidDiv {\r\n        return this.divs && this.divs[name];\r\n    }\r\n    async loadValuesFromIds(divName:string, ids:number[]):Promise<any[]> {\r\n        let ret:any[] = await new IdsCaller(this, {divName:divName, ids:ids}, undefined, false).request();\r\n        return ret;\r\n    }\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        if (typeof id === 'object') id = id.id;\r\n        await this.idCache.assureObj(id);\r\n        return this.idCache.valueFromId(id);\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let cacheValue = this.idCache.valueFromId(id); \r\n        //if (typeof cacheValue === 'object') return cacheValue;\r\n        if (typeof id === 'object') id = id.id;\r\n        let valuesText = undefined; //this.localArr.getItem(id);\r\n        let values: any;\r\n        if (valuesText) {\r\n            values = JSON.parse(valuesText);\r\n        }\r\n        else {\r\n            values = await new GetCaller(this, id).request();\r\n            if (values !== undefined) {\r\n                // this.localArr.setItem(id, JSON.stringify(values));\r\n            }\r\n        }\r\n        if (values === undefined) return;\r\n        for (let f of this.schema.fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.uq.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            let n = f.name;\r\n            values[n] = t.boxId(values[n]);\r\n        }\r\n        this.idCache.cacheValue(values);\r\n        this.cacheTuidFieldValues(values);\r\n        return values;\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let {fields, arrs} = this.schema;\r\n        this.cacheFieldsInValue(values, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs as ArrFields[]) {\r\n                let {name, fields} = arr;\r\n                let arrValues = values[name];\r\n                if (arrValues === undefined) continue;\r\n                let tuidDiv = this.div(name);\r\n                for (let row of arrValues) {\r\n                    //row._$tuid = tuidDiv;\r\n                    //row.$owner = this.boxId(row.owner);\r\n                    tuidDiv.cacheValue(row);\r\n                    this.cacheFieldsInValue(row, fields);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields, $create, $update, stampOnMain} = this.schema;\r\n\t\tif (mainFields === undefined) debugger;\r\n\t\tthis.cacheFields = mainFields || this.fields;\r\n\t\tif (stampOnMain === true) {\r\n\t\t\tif ($create === true) this.cacheFields.push({name: '$create', type: 'timestamp', _tuid: undefined});\r\n\t\t\tif ($update === true) this.cacheFields.push({name: '$update', type: 'timestamp', _tuid: undefined});\r\n\t\t}\r\n        this.uq.buildFieldTuid(this.cacheFields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        let ret = await new SaveCaller(this, {id:id, props:props}).request();\r\n        if (id !== undefined) {\r\n            this.idCache.remove(id);\r\n            this.localArr.removeItem(id);\r\n        }\r\n        return ret;\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait new SavePropCaller(this, {id, prop, value}).request();\r\n\t\tthis.idCache.remove(id);\r\n\t\tawait this.idCache.assureObj(id);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        let ret: any[] = await new AllCaller(this, {}).request();\r\n        return ret;\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any[]> {\r\n        let ret:any[] = await this.searchArr(undefined, key, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        //let api = this.uqApi;\r\n        //let ret = await api.tuidSearch(this.name, undefined, owner, key, pageStart, pageSize);\r\n        let params:any = {arr:undefined, owner:owner, key:key, pageStart:pageStart, pageSize:pageSize};\r\n        let ret = await new SearchCaller(this, params).request();\r\n        let {fields} = this.schema;\r\n        for (let row of ret) {\r\n            this.cacheFieldsInValue(row, fields);\r\n        }\r\n        return ret;\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let api = this.uqApi;\r\n        //return await api.tuidArrGet(this.name, arr, owner, id);\r\n        return await new LoadArrCaller(this, {arr:arr, owner:owner, id:id}).request();\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any) {\r\n        //let params = _.clone(props);\r\n        //params[\"$id\"] = id;\r\n        //return await this.uqApi.tuidArrSave(this.name, arr, owner, params);\r\n        return await new SaveArrCaller(this, {arr:arr, owner:owner, id:id, props:props}).request();\r\n    }\r\n\r\n    async posArr(arr:string, owner:number, id:number, order:number) {\r\n        //return await this.uqApi.tuidArrPos(this.name, arr, owner, id, order);\r\n        return await new ArrPosCaller(this, {arr:arr, owner:owner, id:id, order:order}).request();\r\n\t}\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await new TuidNoCaller(this, undefined).request();\r\n\t}\r\n}\r\n\r\nabstract class TuidCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Tuid {return this._entity as Tuid};\r\n}\r\n\r\n// 包含main字段的load id\r\n// 当前为了兼容，先调用的包含所有字段的内容\r\nclass GetCaller extends TuidCaller<number> {\r\n    method = 'GET';\r\n    get path():string {return `tuid/${this.entity.name}/${this.params}`}\r\n}\r\n\r\nclass IdsCaller extends TuidCaller<{divName:string, ids:number[]}> {\r\n    get path():string {\r\n        let {divName} = this.params;\r\n        return `tuidids/${this.entity.name}/${divName !== undefined?divName:'$'}`;\r\n    }\r\n    buildParams():any {return this.params.ids}\r\n    xresult(res:any):any {\r\n        return (res as string).split('\\n');\r\n    }\r\n}\r\n\r\n\r\nclass SaveCaller extends TuidCaller<{id:number, props:any}> {\r\n    get path():string {return `tuid/${this.entity.name}`}\r\n    buildParams():any {\r\n        let {fields, arrs} = this.entity.schema;\r\n        let {id, props} = this.params;\r\n        let params:any = {$id: id};\r\n        this.transParams(params, props, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let arrName = arr.name;\r\n                let arrParams = [];\r\n                let arrFields = arr.fields;\r\n                let arrValues = props[arrName];\r\n                if (arrValues !== undefined) {\r\n                    for (let arrValue of arrValues) {\r\n                        let row = {};\r\n                        this.transParams(row, arrValue, arrFields);\r\n                        arrParams.push(row);\r\n                    }\r\n                }\r\n                params[arrName] = arrParams;\r\n            }\r\n        }\r\n        return params;\r\n    }\r\n    private transParams(values:any, params:any, fields:Field[]) {\r\n        if (params === undefined) return;\r\n        for (let field of fields) {\r\n            let {name, tuid, type} = field;\r\n            let val = params[name];\r\n            if (tuid !== undefined) {\r\n                if (typeof val === 'object') {\r\n                    if (val !== null) val = val.id;\r\n                }\r\n            }\r\n            else {\r\n                switch (type) {\r\n                    case 'date':\r\n                        val = this.entity.buildDateParam(val); \r\n                        break;\r\n                    case 'datetime':\r\n                        val = this.entity.buildDateTimeParam(val);\r\n                        break;\r\n                }\r\n            }\r\n            values[name] = val;\r\n        }\r\n    }\r\n}\r\n\r\nclass SearchCaller extends TuidCaller<{arr:string, owner:number, key:string, pageStart:string|number, pageSize:number}> {\r\n    get path():string {return `tuids/${this.entity.name}`}\r\n}\r\n\r\nclass AllCaller extends TuidCaller<{}> {\r\n    method = 'GET';\r\n    get path():string {return `tuid-all/${this.entity.name}`}\r\n}\r\n\r\nclass LoadArrCaller extends TuidCaller<{arr:string, owner:number, id:number}> {\r\n    method = 'GET';\r\n    get path():string {\r\n        let {arr, owner, id} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/${id}`;\r\n    }\r\n}\r\nclass SavePropCaller extends TuidCaller<{id:number, prop:string, value:any}> {\r\n    get path():string {return `tuid-prop/${this.entity.name}/`;}\r\n}\r\nclass SaveArrCaller extends TuidCaller<{arr:string, owner:number, id:number, props:any}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, props} = this.params;\r\n        let params = Object.assign({}, props);\r\n        params['$id'] = id;\r\n        return params;\r\n    }\r\n}\r\nclass ArrPosCaller extends TuidCaller<{arr:string, owner:number, id:number, order:number}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr-pos/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, order} = this.params;\r\n        return { bid: id, $order: order}\r\n    }\r\n}\r\nclass TuidNoCaller extends TuidCaller<{}> {\r\n    get path():string {\r\n        return `tuid-no/${this.entity.name}/`;\r\n    }\r\n    buildParams():any {\r\n\t\tlet d = new Date();\r\n\t\tlet year = d.getFullYear();\r\n\t\tlet month = d.getMonth() + 1;\r\n\t\tlet date = d.getDate();\r\n        return {year, month, date};\r\n    }\r\n}\r\n\r\nexport class TuidImport extends Tuid {\r\n    private tuidLocal: TuidInner;\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number, from: SchemaFrom) {\r\n        super(uq, name, typeId);\r\n        this.from = from;\r\n    }\r\n\r\n    setFrom(tuidLocal: TuidInner) {this.tuidLocal = tuidLocal}\r\n    \r\n    readonly from: SchemaFrom;\r\n    isImport = true;\r\n\r\n    getObj(id:number): any {return this.tuidLocal?.getObj(id)}\r\n    /*\r\n\ttv(id:number, render?:Render<any>):JSX.Element {\r\n\t\treturn this.tuidLocal?.tv(id, render);\r\n\t}\r\n    */\r\n\r\n    useId(id:number) {this.tuidLocal?.useId(id);}\r\n    boxId(id:number):BoxId {\r\n\t\tif (!this.tuidLocal) debugger;\r\n\t\treturn this.tuidLocal?.boxId(id);\r\n\t}\r\n    valueFromId(id:number) {return this.tuidLocal?.valueFromId(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tthis.tuidLocal?.resetCache(id);\r\n\t}\r\n    async assureBox<T>(id:number):Promise<T> {\r\n        await this.tuidLocal.assureBox(id);\r\n\t\treturn this.tuidLocal.valueFromId(id);\r\n    }\r\n    get hasDiv():boolean {return this.tuidLocal?.hasDiv}\r\n    div(name:string):TuidDiv {return this.tuidLocal?.div(name)}\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        let ret = await this.tuidLocal.loadMain(id);\r\n        return ret;\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        return await this.tuidLocal.load(id);\r\n    }\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        return await this.tuidLocal.save(id, props);\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait this.tuidLocal.saveProp(id, prop, value);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        return await this.tuidLocal.all();\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.search(key, pageStart, pageSize);\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.searchArr(owner, key, pageStart, pageSize);\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.tuidLocal.loadArr(arr, owner, id);\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any):Promise<void> {\r\n        await this.tuidLocal.saveArr(arr, owner, id, props);\r\n    }\r\n    async posArr(arr:string, owner:number, id:number, order:number):Promise<void> {\r\n        await this.tuidLocal.posArr(arr, owner, id, order);\r\n    }\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await this.tuidLocal.no();\r\n\t}\r\n}\r\n\r\n// field._tuid 用这个接口\r\n// Tuid, TuidDiv 实现这个接口\r\nexport class TuidBox {\r\n    tuid: Tuid;\r\n    ownerField:Field = undefined;\r\n    constructor(tuid: Tuid) {\r\n        this.tuid = tuid;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.tuid.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.tuid.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.tuid.useId(id);\r\n    }\r\n    async showInfo() {\r\n        alert('showInfo not implemented');\r\n    }\r\n}\r\n\r\n\r\nexport class TuidDiv extends TuidInner {\r\n    readonly typeName:string = 'div';\r\n    protected cacheFields: Field[];\r\n    protected tuid: TuidInner;\r\n    protected idName: string;\r\n    protected idCache: IdDivCache;\r\n\r\n    constructor(uq: UqMan, tuid: TuidInner, name: string) {\r\n        super(uq, name, 0);\r\n        this.tuid = tuid;\r\n        this.idName = 'id';\r\n        this.idCache = new IdDivCache(tuid, this);\r\n    }\r\n\r\n    get owner() {return this.tuid}\r\n\r\n    buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields} = this.schema;\r\n        if (mainFields === undefined) debugger;\r\n        this.uq.buildFieldTuid(this.cacheFields = mainFields);\r\n    }\r\n\r\n    buildTuidDivBox(ownerField: Field): TuidBoxDiv {\r\n        return new TuidBoxDiv(this.tuid, this, ownerField);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    cacheValue(value:any):void {\r\n        this.idCache.cacheValue(value);\r\n    }\r\n\r\n    useId(id:number, defer?:boolean):void {\r\n        if (this.noCache === true) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n\r\n    valueFromId(id:number):any {\r\n        return this.idCache.getValue(id)\r\n    }\r\n\r\n    async assureBox<T>(id:number):Promise<T> {\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    async cacheIds() {\r\n        await this.idCache.cacheIds();\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let fields = this.schema.fields;\r\n        this.cacheFieldsInValue(values, fields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n}\r\n\r\nexport class TuidBoxDiv extends TuidBox {\r\n    ownerField: Field;\r\n    private div: TuidDiv;\r\n    constructor(tuid: Tuid, div: TuidDiv, ownerField: Field) {\r\n        super(tuid);\r\n        this.div = div;\r\n        this.ownerField = ownerField;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.div.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.div.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.div.useId(id);\r\n    }\r\n}\r\n","import { UqMan, TuidModify } from '../uqMan';\r\nimport { Tuid } from \"./tuid\";\r\nimport { env } from '../../tool';\r\n\r\ninterface Modify {\r\n    id: number;\r\n    entity: string;\r\n    key: string;\r\n}\r\n\r\nexport class TuidsCache {\r\n    private readonly uq: UqMan;\r\n    private modifyMax: TuidModify;\r\n    private cacheTimer: any;\r\n    constructor(uq: UqMan) {\r\n        this.uq = uq;\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.clearCacheTimer();\r\n        this.cacheTimer = env.setTimeout('TuidsCache.cacheTuids', this.loadIds, defer);\r\n    }\r\n    private clearCacheTimer() {\r\n        if (this.cacheTimer === undefined) return;\r\n        env.clearTimeout(this.cacheTimer);\r\n        this.cacheTimer = undefined;\r\n    }\r\n    private loadIds = () => {\r\n        this.clearCacheTimer();\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            let tuid = tuids[i];\r\n            tuid.cacheIds();\r\n        }\r\n    }\r\n    \r\n    pullModify(modifyMax:number) {\r\n        if (modifyMax === undefined) return;\r\n        let now = Math.floor(Date.now() / 1000);\r\n        if (this.modifyMax === undefined) {\r\n            this.modifyMax = this.uq.localModifyMax.get();\r\n            if (this.modifyMax === undefined) {\r\n                this.modifyMax = {\r\n                    max: modifyMax,\r\n                    seconds: now,\r\n                };\r\n                this.uq.localModifyMax.set(this.modifyMax);\r\n            }\r\n        }\r\n        let {max, seconds} = this.modifyMax;\r\n        let lockGap = 3600;\r\n        if (now - seconds < lockGap) return;\r\n        if (modifyMax <= max) return;\r\n        let tuidCached:string[] = [];\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            //if (tuids[i].cached === true) \r\n            tuidCached.push(i);\r\n        }\r\n        if (tuidCached.length === 0) return;\r\n        this.modifyMax.seconds = now;\r\n        this.innerPullModify(tuidCached.join('\\t'));\r\n    }\r\n\r\n    private async innerPullModify(tuidLists:string):Promise<void> {\r\n        let {uqApi, tuids} = this.uq;\r\n        let {max} = this.modifyMax;\r\n        let ret:{queue:Modify[], queueMax:number} = await uqApi.queueModify(max, 30, tuidLists);\r\n        let group:{[entity:string]: {tuid:Tuid; ids: string[]}} = {};\r\n        let modifyMax:number = 0;\r\n        for (let modify of ret.queue) {\r\n\t\t\tlet {id, entity, key} = modify;\r\n\t\t\tif (!key) continue;\r\n            let tuid = tuids[entity];\r\n            if (tuid === undefined) continue;\r\n            let item = group[entity];\r\n            if (item === undefined) {\r\n                item = group[entity] = {tuid: tuid, ids:[]};\r\n            }\r\n            item.ids.push(key);\r\n            if (id > modifyMax) modifyMax = id;\r\n        }\r\n        for (let i in group) {\r\n            let {tuid, ids} = group[i];\r\n            await tuid.modifyIds(ids);\r\n        }\r\n        let now = Math.floor(Date.now() / 1000);\r\n        this.modifyMax = {\r\n            max: modifyMax,\r\n            seconds: now,\r\n        }\r\n        this.uq.localModifyMax.set(this.modifyMax);\r\n    }\r\n}\r\n","import { Entity } from './entity';\r\nimport { ActionCaller } from './caller';\r\n\r\nexport class UqAction<P, R> extends Entity {\r\n    get typeName(): string { return 'action';}\r\n    async submit(data:P, $$user:number = undefined, waiting: boolean = true) {\r\n\t\tlet caller = new ActionSubmitCaller(this, data, $$user, waiting)\r\n\t\tlet ret = await caller.request();\r\n\t\treturn ret;\r\n    }\r\n    async submitReturns(data:P, $$user:number = undefined):Promise<R> {\r\n       return await new SubmitReturnsCaller(this, data, $$user).request();\r\n    }\r\n    async submitConvert(data:P, $$user:number = undefined) {\r\n        return await new SubmitConvertCaller(this, data, $$user).request();\r\n    }\r\n}\r\n\r\nexport class Action extends UqAction<any, any> {\r\n}\r\n\r\nexport class ActionSubmitCaller extends ActionCaller {\r\n    get path():string {return 'action/' + this.entity.name;}\r\n    buildParams():any {\r\n\t\treturn {\r\n            $$user: this.$$user,\r\n            data: this.entity.pack(this.params)\r\n        };\r\n\t}\r\n}\r\n\r\nclass SubmitReturnsCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action/' + this.entity.name + '/returns';}\r\n    xresult(res:any):any {\r\n        let {returns} = this.entity;\r\n        let len = returns.length;\r\n        let ret:{[r:string]:any[]} = {};\r\n        for (let i=0; i<len; i++) {\r\n            let retSchema = returns[i];\r\n            ret[retSchema.name] = res[i];\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass SubmitConvertCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action-convert/' + this.entity.name;}\r\n    buildParams():any {\r\n        return {\r\n            $$user: this.$$user,\r\n            data: this.params\r\n        };\r\n    }\r\n}\r\n","import { Entity } from './entity';\r\nimport { EntityCaller } from './caller';\r\nimport { ArrFields } from './uqMan';\r\n\r\nexport interface SheetState {\r\n    name: string;\r\n    actions: SheetAction[];\r\n}\r\n\r\nexport interface SheetAction {\r\n    name: string;\r\n}\r\n\r\nexport interface StateCount {\r\n    state: string;\r\n    count: number;\r\n}\r\n\r\nexport interface SheetSaveReturnV<V> {\r\n\tid: number;\r\n\tflow: number;\r\n\tstate: string;\r\n\tverify: V[];\r\n}\r\n\r\nexport interface SheetSaveReturn extends SheetSaveReturnV<any> {\r\n}\r\n\r\ninterface GetSheetReturn<M> {\r\n\tbrief: any;\r\n\tdata: M;\r\n\tflows: any[];\r\n}\r\n\r\nexport class UqSheet<M, V> extends Entity {\r\n    get typeName(): string { return 'sheet';}\r\n\tstates: SheetState[];\r\n\tverify: {returns: ArrFields[]};\r\n\r\n    /*\r\n    setStates(states: SheetState[]) {\r\n        for (let state of states) {\r\n            this.setStateAccess(this.states.find(s=>s.name==state.name), state);\r\n        }\r\n    }*/\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n\t\tthis.states = schema.states;\r\n\t\tthis.verify = schema.verify;\r\n    }\r\n    build(obj:any) {\r\n        this.states = [];\r\n        for (let op of obj.ops) {\r\n            this.states.push({name: op, actions:undefined});\r\n        }\r\n        /*\r\n        for (let p in obj) {\r\n            switch(p) {\r\n                case '#':\r\n                case '$': continue;\r\n                default: this.states.push(this.createSheetState(p, obj[p])); break;\r\n            }\r\n        }*/\r\n    }\r\n    private createSheetState(name:string, obj:object):SheetState {\r\n        let ret:SheetState = {name:name, actions:[]};\r\n        let actions = ret.actions;\r\n        for (let p in obj) {\r\n            let action:SheetAction = {name: p};\r\n            actions.push(action);\r\n        }\r\n        return ret;\r\n    }\r\n    async save(discription:string, data:M):Promise<SheetSaveReturnV<V>> {\r\n        let {id} = this.uq;\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveCaller(this, params).request();\r\n    }\r\n    async saveDebugDirect(discription:string, data:M):Promise<SheetSaveReturn> {\r\n        let {id} = this.uq;\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveDirectCaller(this, params).request();\r\n    }\r\n    async action(id:number, flow:number, state:string, action:string) {\r\n        return await new ActionCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    async actionDebugDirect(id:number, flow:number, state:string, action:string) {\r\n        return await new ActionDirectCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    private unpack(data:any):GetSheetReturn<M> {\r\n        //if (this.schema === undefined) await this.loadSchema();\r\n        let ret = data[0];\r\n        let brief = ret[0];\r\n        let sheetData = this.unpackSheet(brief.data);\r\n        let flows = data[1];\r\n        return {\r\n            brief: brief,\r\n            data: sheetData,\r\n            flows: flows,\r\n        }\r\n    }\r\n    async getSheet(id:number):Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.getSheet(this.name, id);\r\n        */\r\n        let ret = await new GetSheetCaller(this, id).request();\r\n        if (ret[0].length === 0) return await this.getArchive(id);\r\n        return this.unpack(ret);\r\n    }\r\n    async getArchive(id:number):Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchive(this.name, id)\r\n        return this.unpack(ret);\r\n        */\r\n        let ret = await new SheetArchiveCaller(this, id).request();\r\n        return this.unpack(ret);\r\n    }\r\n\r\n    async getArchives(pageStart:number, pageSize:number) {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchives(this.name, {pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {pageStart:pageStart, pageSize:pageSize};\r\n        return await new SheetArchivesCaller(this, params).request();\r\n    }\r\n\r\n    async getStateSheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.stateSheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new StateSheetsCaller(this, params).request();\r\n    }\r\n    //createPageStateItems<T>(): PageStateItems<T> {return new PageStateItems<T>(this);}\r\n\r\n    async stateSheetCount():Promise<StateCount[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret:StateCount[] = await this.uqApi.stateSheetCount(this.name);\r\n        return this.states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = ret.find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n        */\r\n        return await new StateSheetCountCaller(this, undefined).request();\r\n    }\r\n\r\n    async userSheets(state:string, user:number, pageStart:number, pageSize:number):Promise<any[]> {\r\n        let params = {state:state, user:user, pageStart:pageStart, pageSize:pageSize};\r\n        return await new UserSheetsCaller(this, params).request();\r\n    }\r\n\r\n    async mySheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.mySheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new MySheetsCaller(this, params).request();\r\n    }\r\n}\r\n\r\nexport class Sheet extends UqSheet<any, any> {\r\n}\r\n\r\nabstract class SheetCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Sheet {return this._entity as Sheet;}\r\n    protected readonly suffix:string;\r\n    get path():string {return `sheet/${this.entity.name}/${this.suffix}`;}\r\n}\r\n\r\nclass SaveCaller extends SheetCaller<{app:number; discription:string; data:any}> {\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n    buildParams() {\r\n        let {app, discription, data} = this.params;\r\n        return {\r\n            app: app,\r\n            discription: discription,\r\n            data: this.entity.pack(data)\r\n        };\r\n    }\r\n    xresult(res:any):any {\r\n\t\tlet {verify} = this.entity;\r\n\t\tif (verify === undefined) return res;\r\n\t\tlet resVerify = res.verify;\r\n\t\tif (resVerify === undefined || resVerify.length === 0) {\r\n\t\t\tres.verify = undefined;\r\n\t\t\treturn res;\r\n\t\t}\r\n\t\tlet {returns} = verify;\r\n\t\tres.verify = this.entity.unpackReturns(resVerify, returns);\r\n        return res;\r\n    }\r\n}\r\n\r\nclass SaveDirectCaller extends SaveCaller {\r\n    get path():string {return `sheet/${this.entity.name}/direct`;}\r\n}\r\n\r\nclass ActionCaller extends SheetCaller<{id:number, flow:number, state:string, action:string}> {\r\n    method = 'PUT';\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n}\r\n\r\nclass ActionDirectCaller extends ActionCaller {\r\n    get path():string {return `sheet/${this.entity.name}/direct`;}\r\n}\r\n\r\nclass GetSheetCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //private id:number;\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/get/${this.params}`;}\r\n}\r\n\r\nclass SheetArchiveCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/archive/${this.params}`;}\r\n}\r\n\r\nclass SheetArchivesCaller extends SheetCaller<{pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'archives';\r\n}\r\n\r\nclass StateSheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'states';\r\n}\r\n\r\nclass StateSheetCountCaller extends SheetCaller<undefined> {\r\n    method = 'GET';\r\n    protected readonly suffix = 'statecount';\r\n    xresult(res:any):any {\r\n        let {states} = this.entity;\r\n        return states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = (res as any[]).find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n    }\r\n}\r\n\r\nclass UserSheetsCaller extends SheetCaller<{state:string, user:number, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'user-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n\r\nclass MySheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'my-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n/*\r\nexport class PageStateItems<T> extends PageItems<T> {\r\n    private sheet: Sheet;\r\n    constructor(sheet: Sheet) {\r\n        super(true);\r\n        this.sheet = sheet;\r\n        this.pageSize = 10;\r\n\t}\r\n\tprotected async loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n\t\treturn {$page: ret};\r\n\t}\r\n\tprotected getPageId(item:T) {\r\n\t\treturn item === undefined? 0 : (item as any).id;\r\n\t}\r\n}\r\n*/\r\n","import { /*Field, */ArrFields } from './uqMan';\r\nimport { Entity } from './entity';\r\nimport { QueryQueryCaller, QueryPageCaller } from './caller';\r\n\r\nexport type QueryPageApi = (name:string, pageStart:any, pageSize:number, params:any) => Promise<string>;\r\n\r\nexport class UqQuery<P, R> extends Entity {\r\n    get typeName(): string { return 'query';}\r\n    /*\r\n    private pageStart: any;\r\n    private pageSize:number;\r\n    private params:any;\r\n    private more: boolean;\r\n    private startField: Field;\r\n    */\r\n    //list:IObservableArray; \r\n    returns: ArrFields[];\r\n\tisPaged: boolean;\r\n\t\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {returns} = schema;\r\n        this.returns = returns;\r\n        this.isPaged = returns && (returns as any[]).find(v => v.name === '$page') !== undefined;\r\n    }\r\n    /*\r\n    resetPage(size:number, params:any) {\r\n        this.pageStart = undefined;\r\n        this.pageSize = size;\r\n        this.params = params;\r\n        this.more = false;\r\n        //this.list = undefined;\r\n    }\r\n    */\r\n    //get hasMore() {return this.more;}\r\n    /*\r\n    async loadPage():Promise<void> {\r\n        if (this.pageSize === undefined) {\r\n            throw new Error('call resetPage(size:number, params:any) first');\r\n        }\r\n        let pageStart:any;\r\n        if (this.pageStart !== undefined) {\r\n            switch (this.startField.type) {\r\n                default: pageStart = this.pageStart; break;\r\n                case 'date':\r\n                case 'time':\r\n                case 'datetime': pageStart = (this.pageStart as Date).getTime(); break;\r\n            }\r\n        }\r\n\t\tlet ret = await this.page(this.params, pageStart, this.pageSize+1);\r\n\t\tlet page = (ret as any).$page;\r\n        this.list = observable.array([], {deep: false});\r\n        if (page !== undefined) {\r\n            if (page.length > this.pageSize) {\r\n                this.more = true;\r\n                page.pop();\r\n                let ret = this.returns.find(r => r.name === '$page');\r\n                this.startField = ret.fields[0];\r\n                this.pageStart = page[page.length-1][this.startField.name];\r\n            }\r\n            else {\r\n                this.more = false;\r\n            }\r\n            this.list.push(...page);\r\n        }\r\n    }\r\n    */\r\n    protected pageCaller(params: any, $$user:number = undefined, showWaiting: boolean = true): QueryPageCaller {\r\n        return new QueryPageCaller(this, params, $$user, showWaiting);\r\n    }\r\n\r\n    async page(params:P, pageStart:any, pageSize:number, $$user:number = undefined, showWaiting: boolean = true):Promise<R> {\r\n        let p = {pageStart, pageSize, params};\r\n        let res = await this.pageCaller(p, $$user, showWaiting).request();\r\n        return res;\r\n    }\r\n    protected queryCaller(params: P, $$user:number = undefined, showWaiting: boolean = true): QueryQueryCaller {\r\n        return new QueryQueryCaller(this, params, $$user, showWaiting);\r\n    }\r\n    async query(params:P, $$user:number = undefined, showWaiting:boolean = true):Promise<R> {\r\n        let res = await this.queryCaller(params, $$user, showWaiting).request();\r\n        return res;\r\n    }\r\n    async table(params:P, $$user:number = undefined, showWaiting:boolean = true): Promise<any[]> {\r\n        let ret = await this.query(params, $$user, showWaiting);\r\n        for (let i in ret) {\r\n            return (ret as any)[i];\r\n        }\r\n    }\r\n    async obj(params:P, $$user:number = undefined, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.table(params, $$user,showWaiting);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:P, $$user:number = undefined, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.obj(params, $$user, showWaiting);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Query extends UqQuery<any, any> {\r\n}\r\n","import { UqQuery} from './query';\r\nimport { QueryQueryCaller } from './caller';\r\n\r\nexport class UqBook<P, R> extends UqQuery<P, R> {\r\n    get typeName(): string { return 'book';}\r\n    protected queryApiName = 'book';\r\n\r\n    protected queryCaller(params: any): QueryQueryCaller {\r\n        return new BookQueryCaller(this, params);\r\n    }\r\n}\r\n\r\nexport class Book extends UqBook<any, any> {\r\n}\r\n\r\nexport class BookQueryCaller extends QueryQueryCaller {\r\n    get path():string {return `book/${this.entity.name}`;}\r\n}\r\n","import { UqQuery } from './query';\r\n\r\nexport class UqHistory<P,R> extends UqQuery<P,R>  {\r\n    get typeName(): string { return 'history';}\r\n    protected queryApiName = 'history';\r\n}\r\n\r\nexport class History extends UqHistory<any, any> {\r\n}\r\n","import { Entity } from './entity';\r\nimport { Action, ActionSubmitCaller } from './action';\r\nimport { Query } from './query';\r\nimport { Field } from './uqMan';\r\nimport { EntityCaller, QueryPageCaller, QueryQueryCaller } from './caller';\r\n\r\ninterface MapActions {\r\n    add: Action;\r\n    del: Action;\r\n}\r\ninterface MapQueries {\r\n    all: Query;\r\n    page: Query;\r\n    query: Query;\r\n}\r\n\r\nexport class UqMap extends Entity {\r\n    get typeName(): string { return 'map';}\r\n    keys: Field[];\r\n    actions: MapActions = {} as any;\r\n    queries: MapQueries = {} as any;\r\n    schemaFrom: {owner:string; uq:string};\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.schemaFrom = this.schema.from;\r\n        let {actions, queries, keys} = schema;\r\n        this.uq.buildFieldTuid(this.keys = keys);\r\n        for (let i in actions) {\r\n            let actionSchema = actions[i];\r\n            let {name} = actionSchema;\r\n            let action = this.uq.newAction(name, undefined);\r\n            action.setSchema(actionSchema);\r\n            action.buildFieldsTuid();\r\n            (this.actions as any)[i] = action;\r\n        }\r\n        for (let i in queries) {\r\n            let querySchema = queries[i];\r\n            let {name} = querySchema;\r\n            let query = this.uq.newQuery(name, undefined);\r\n            query.setSchema(querySchema);\r\n            query.buildFieldsTuid();\r\n            (this.queries as any)[i] = query;\r\n        }\r\n    }\r\n\r\n    async add(param:any) {\r\n        let ret = await new AddCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async del(param:any) {\r\n        let ret = await new DelCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async all() {\r\n        let ret = await new AllCaller(this, undefined).request();\r\n        return ret;\r\n    }\r\n\r\n    async page(param:any, pageStart:any, pageSize: number) {\r\n        let ret = await new PageCaller(this, {pageStart:pageStart, pageSize:pageSize, param:param}).request();\r\n        return ret;\r\n    }\r\n\r\n    async query(param:any) {\r\n       let qc = new QueryCaller(this, param);\r\n       let ret = await qc.request();\r\n       return ret;\r\n   }\r\n    async table(params:any): Promise<any[]> {\r\n        let ret = await this.query(params);\r\n        for (let i in ret) {\r\n            return ret[i];\r\n        }\r\n    }\r\n    async obj(params:any):Promise<any> {\r\n        let ret = await this.table(params);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:any):Promise<any> {\r\n        let ret = await this.obj(params);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Map extends UqMap {\r\n}\r\n\r\nabstract class MapCaller extends EntityCaller<any> {\r\n    protected get entity(): Map {return this._entity as Map;}\r\n    get path():string {return undefined;}\r\n\r\n    protected abstract getCaller(param: any):EntityCaller<any>;\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        let caller = this.getCaller(this.params);\r\n        let res = await this.entity.uqApi.xcall(caller);\r\n        let ret = caller.xresult(res.res);\r\n        return {res: ret};\r\n    }\r\n\r\n    buildParams() {\r\n        let p = super.buildParams();\r\n        return p;\r\n    }\r\n}\r\n\r\nclass AddCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAddCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass DelCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapDelCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass AllCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAllCaller(this.entity, this.entity.queries.all, param);\r\n    }\r\n}\r\n\r\nclass PageCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapPageCaller(this.entity, this.entity.queries.page, param);\r\n    }\r\n}\r\n\r\nclass QueryCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapQueryCaller(this.entity, this.entity.queries.query, param);\r\n    }\r\n}\r\n\r\nclass MapAddCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/add`}\r\n    get headers(): {[header:string]: string} {return undefined;}\r\n}\r\n\r\nclass MapDelCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/del`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapAllCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/all`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapPageCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/page`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapQueryCaller extends QueryQueryCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/query`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n","import { UqQuery } from './query';\r\n\r\nexport class UqPending<P,R> extends UqQuery<P,R>  {\r\n    get typeName(): string { return 'pending';}\r\n    protected queryApiName = 'pending';\r\n}\r\n\r\nexport class Pending extends UqPending<any, any> {\r\n}\r\n","import { Entity } from \"./entity\";\r\n\r\nexport class UqEnum extends Entity {\r\n    get typeName(): string { return 'enum';}\r\n}","import { Entity } from \"./entity\";\r\nimport { Uq } from \"./uqMan\";\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqID<M extends {id:number}> extends Entity {\r\n\tget typeName() {return 'id'}\r\n\tcreate: boolean;\r\n\tupdate: boolean;\r\n\towner: boolean;\r\n\tasync NO(): Promise<string> {\r\n\t\tlet ret = await this.uqApi.post('id-no', {ID:this.name});\r\n\t\treturn ret;\r\n\t};\r\n\tgetIdFromObj(value: any): number {return value['id'];}\r\n\tcacheTuids(defer: number): void {}\r\n\tasync loadValuesFromIds(divName: string, ids:number[]): Promise<M[]> {\r\n\t\tlet ret = await (this.uq as unknown as Uq).QueryID<M>({\r\n\t\t\tIDX: [this],\r\n\t\t\tid: ids\r\n\t\t});\r\n        return ret;\r\n\t}\r\n\tcacheTuidFieldValues(value: any): void {}\r\n\tunpackTuidIds(values:string[]): any[] {return;}\r\n}\r\n\r\nexport class ID extends UqID<any> {\t\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqIDX<M> extends Entity {\r\n\tget typeName() {return 'idx'}\r\n}\r\n\r\nexport class IDX extends UqIDX<any> {\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqIX<M> extends Entity {\r\n\tget typeName() {return 'ix'}\r\n}\r\n\r\nexport class IX extends UqIX<any> {\r\n}\r\n\r\n/* eslint-enable no-unused-vars */\r\n","import { UqMan } from '../uqMan';\r\n\r\nconst maxCacheSize = 1000;\r\nconst delayLoad = 30; \t// 延迟loading的时间\r\nexport class IDCache {\r\n\tprotected uqMan: UqMan;\r\n\tprivate queue: number[] = [];               \t\t\t\t\t\t\t// 每次使用，都排到队头\r\n\tprivate cache: Map<number, object | number>;    // 已经缓冲的, 如果是数值，则是重复取的次数\r\n\tprivate waitingIds: number[] = [];          \t\t\t\t\t\t\t// 等待loading的\r\n\tprivate timeoutHandler: any;\r\n\r\n\tconstructor(uqMan: UqMan) {\r\n\t\tthis.uqMan = uqMan;\r\n\t\tthis.cache = uqMan.tonwa.createObservableMap<number, object | number>();\r\n\t}\r\n\r\n\tgetValue(id: number): object {\r\n\t\tlet ret = this.cache.get(id);\r\n\t\tif (ret === null) return;\r\n\t\tif (ret === undefined) {\r\n\t\t\tthis.useId(id);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (typeof ret === 'number') return;\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected async TvIdValues(waitingIds: number[]) {\r\n\t\treturn await this.uqMan.IDTv(waitingIds);\r\n\t}\r\n\r\n\tprivate timeOut = async () => {\r\n\t\tlet waitingIds = this.waitingIds;\r\n\t\tthis.waitingIds = [];\r\n\t\tif (waitingIds.length === 0) return;\r\n\t\tlet values = await this.TvIdValues(waitingIds);\r\n\t\tfor (let val of values) {\r\n\t\t\tlet { id } = val;\r\n\t\t\tif (waitingIds[0] < 0) id = -id;\r\n\t\t\tthis.cache.set(id, val);\r\n\t\t\tlet index = waitingIds.findIndex(v => v === id);\r\n\t\t\tif (index >= 0) waitingIds.splice(index, 1);\r\n\t\t}\r\n\t\tfor (let id of waitingIds) {\r\n\t\t\tthis.cache.set(id, null);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate useId(id: number) {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id !== 'number') {\r\n\t\t\tconsole.error('id cache ' + id + ' is not number');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.cache.has(id) === true) {\r\n\t\t\tthis.moveToHead(id);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tclearTimeout(this.timeoutHandler);\r\n\t\tthis.timeoutHandler = setTimeout(this.timeOut, delayLoad);\r\n\t\t//this.cache.set(id, 0);\r\n\t\tif (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n\t\t\tthis.moveToHead(id);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.queue.length >= maxCacheSize) {\r\n\t\t\t// 缓冲已满，先去掉最不常用的\r\n\t\t\tlet r = this.queue.shift();\r\n\t\t\tif (r === id) {\r\n\t\t\t\t// 如果移除的，正好是现在用的，则插入\r\n\t\t\t\tthis.queue.push(r);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t//let rKey = String(r);\r\n\t\t\tif (this.cache.has(r) === true) {\r\n\t\t\t\t// 如果移除r已经缓存\r\n\t\t\t\tthis.cache.delete(r);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// 如果移除r还没有缓存\r\n\t\t\t\tlet index = this.waitingIds.findIndex(v => v === r);\r\n\t\t\t\tthis.waitingIds.splice(index, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.waitingIds.push(id);\r\n\t\tthis.queue.push(id);\r\n\t\treturn;\r\n\t}\r\n\r\n\tprivate moveToHead(id: number) {\r\n\t\tlet index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\tthis.queue.push(id);\r\n\t}\r\n\r\n\tremove(id: number) {\r\n\t\tthis.cache.delete(id);\r\n\t\tlet index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\t//this.localArr.removeItem(id);\r\n\t}\r\n\r\n\tresetCache(id: number) {\r\n\t\tthis.remove(id);\r\n\t\tthis.useId(id);\r\n\t}\r\n}\r\n","import { env } from '../tool';\r\nimport { UqMan } from './uqMan';\r\nimport { TuidImport, TuidInner } from './tuid';\r\nimport { Web, UqData } from '../web';\r\nimport { Tonwa, UqConfig } from '../core';\r\n\r\n/*\r\nexport interface TVs {\r\n\t[uqName:string]: {\r\n\t\t[tuidName: string]: (values: any) => JSX.Element;\r\n\t}\r\n}\r\n*/\r\n\r\nexport class UQsMan {\r\n\tprivate readonly tonwa: Tonwa;\r\n\tprivate readonly web: Web;\r\n\tprivate collection: { [uqLower: string]: UqMan };\r\n\t//private readonly tvs: TVs;\r\n\tproxy: any;\r\n\tuqMans: UqMan[] = [];\r\n\r\n\tconstructor(tonwa: Tonwa/*, tvs:TVs*/) {\r\n\t\tthis.tonwa = tonwa;\r\n\t\tthis.web = tonwa.web;\r\n\t\t//this.tvs = tvs || {};\r\n\t\t//this.buildTVs();\r\n\t\tthis.uqMans = [];\r\n\t\tthis.collection = {};\r\n\t}\r\n\r\n\tasync buildUqs(uqDataArr: UqData[], version: string, uqConfigs: UqConfig[], isBuildingUQ: boolean): Promise<string[]> {\r\n\t\tawait this.init(uqDataArr);\r\n\r\n\t\tlet localMap = env.localDb.map('$app');\r\n\t\tlet localCacheVersion = localMap.child('version');\r\n\t\tlet cacheVersion = localCacheVersion.get();\r\n\t\tif (version !== cacheVersion) {\r\n\t\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\t\tuqMan.localMap.removeAll();\r\n\t\t\t}\r\n\t\t\tlocalCacheVersion.set(version);\r\n\t\t}\r\n\r\n\t\tlet retErrors = await this.load();\r\n\t\tif (retErrors.length > 0) return retErrors;\r\n\t\tif (isBuildingUQ === false) {\r\n\t\t\tthis.setTuidImportsLocal();\r\n\t\t}\r\n\t\tif (retErrors.length > 0) return retErrors;\r\n\t\tif (uqConfigs) {\r\n\t\t\tfor (let uqConfig of uqConfigs) {\r\n\t\t\t\tlet { dev, name, alias } = uqConfig;\r\n\t\t\t\tlet { name: owner, alias: ownerAlias } = dev;\r\n\t\t\t\tlet uqLower = (ownerAlias ?? owner).toLowerCase() + '/' + (alias ?? name).toLowerCase();\r\n\t\t\t\tlet uq = this.collection[uqLower];\r\n\t\t\t\tuq.config = uqConfig;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.proxy = this.buildUQs();\r\n\t}\r\n\r\n\tuq(uqName: string): UqMan {\r\n\t\treturn this.collection[uqName.toLowerCase()];\r\n\t}\r\n\r\n\tasync getUqUserRoles(uqLower: string): Promise<string[]> {\r\n\t\tlet uqMan = this.collection[uqLower];\r\n\t\tif (uqMan === undefined) return null;\r\n\t\tlet roles = await uqMan.getRoles();\r\n\t\treturn roles;\r\n\t}\r\n\r\n\t/*\r\n\tprivate buildTVs() {\r\n\t\tif (!this.tvs) return;\r\n\t\tfor (let i in this.tvs) {\r\n\t\t\tlet uqTVs = this.tvs[i];\r\n\t\t\tif (uqTVs === undefined) continue;\r\n\t\t\tlet l = i.toLowerCase();\r\n\t\t\tif (l === i) continue;\r\n\t\t\tthis.tvs[l] = uqTVs;\r\n\t\t\tfor (let j in uqTVs) {\r\n\t\t\t\tlet en = uqTVs[j];\r\n\t\t\t\tif (en === undefined) continue;\r\n\t\t\t\tlet lj = j.toLowerCase();\r\n\t\t\t\tif (lj === j) continue;\r\n\t\t\t\tuqTVs[lj] = en;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t*/\r\n\r\n\tasync init(uqsData: UqData[]): Promise<void> {\r\n\t\tlet promiseInits: PromiseLike<void>[] = [];\r\n\t\tfor (let uqData of uqsData) {\r\n\t\t\tlet { uqOwner, ownerAlias, uqName, uqAlias } = uqData;\r\n\r\n\t\t\t// 原名加入collection\r\n\t\t\tlet uqFullName = uqOwner + '/' + uqName;\r\n\t\t\tlet uqFull = this.collection[uqFullName];\r\n\t\t\tlet uq: UqMan;\r\n\t\t\tif (uqFull) {\r\n\t\t\t\tuq = uqFull;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tuq = new UqMan(this.tonwa, uqData/*, undefined, this.tvs[uqFullName] || this.tvs[uqName]*/);\r\n\t\t\t\tthis.collection[uqFullName] = uq;\r\n\t\t\t\tpromiseInits.push(uq.init());\r\n\t\t\t}\r\n\t\t\tthis.uqMans.push(uq);\r\n\t\t\tlet lower = uqFullName.toLowerCase();\r\n\t\t\tthis.collection[lower] = uq;\r\n\r\n\t\t\t// 别名加入collection\r\n\t\t\tif (uqAlias) uqName = uqAlias;\r\n\t\t\tif (ownerAlias) uqOwner = ownerAlias;\r\n\t\t\tuqFullName = uqOwner + '/' + uqName;\r\n\t\t\tlower = uqFullName.toLowerCase();\r\n\t\t\tthis.collection[lower] = uq;\r\n\t\t}\r\n\t\tawait Promise.all(promiseInits);\r\n\t}\r\n\r\n\tasync load(): Promise<string[]> {\r\n\t\tlet retErrors: string[] = [];\r\n\t\tlet promises: PromiseLike<string>[] = [];\r\n\t\t//let lowerUqNames:string[] = [];\r\n\t\t// collection有小写名字，还有正常名字\r\n\t\t//for (let i in this.collection) {\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\t//let lower = (i as string).toLowerCase();\r\n\t\t\t//if (lowerUqNames.indexOf(lower) >= 0) continue;\r\n\t\t\t//lowerUqNames.push(lower);\r\n\t\t\t//let uq = this.collection[i];\r\n\t\t\tpromises.push(uqMan.loadEntities());\r\n\t\t}\r\n\t\tlet results = await Promise.all(promises);\r\n\t\tfor (let result of results) {\r\n\t\t\tlet retError = result; // await cUq.loadSchema();\r\n\t\t\tif (retError !== undefined) {\r\n\t\t\t\tretErrors.push(retError);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn retErrors;\r\n\t}\r\n\r\n\tprivate buildUQs(): any {\r\n\t\tlet uqs: any = {};\r\n\t\tfunction setUq(uqKey: string, proxy: any): void {\r\n\t\t\tif (!uqKey) return;\r\n\t\t\tlet lower = uqKey.toLowerCase();\r\n\t\t\tuqs[uqKey] = proxy;\r\n\t\t\tif (lower !== uqKey) uqs[lower] = proxy;\r\n\t\t}\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\tlet proxy = uqMan.createProxy();\r\n\t\t\tsetUq(uqMan.getUqKey(), proxy);\r\n\t\t\tsetUq(uqMan.getUqKeyWithConfig(), proxy);\r\n\t\t\t/*\r\n\t\t\tlet uqKey = uqMan.getUqKey();\r\n\t\t\tlet lower = uqKey.toLowerCase();\r\n\t\t\tuqs[uqKey] = proxy;\r\n\t\t\tif (lower !== uqKey) uqs[lower] = proxy;\r\n\t\t\tlet uqKeyWithConfig = uqMan.getUqKeyWithConfig();\r\n\t\t\tlet lowerWithConfig = uqKeyWithConfig.toLowerCase();\r\n\t\t\tuqs[uqKeyWithConfig] = proxy;\r\n\t\t\tif (lowerWithConfig !== uqKeyWithConfig) uqs[lowerWithConfig] = proxy;\r\n\t\t\t*/\r\n\t\t}\r\n\t\treturn new Proxy(uqs, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tlet lk = (key as string).toLowerCase();\r\n\t\t\t\tlet ret = target[lk];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tdebugger;\r\n\t\t\t\tconsole.error(`controller.uqs.${String(key)} undefined`);\r\n\t\t\t\tthis.showReload(`新增 uq ${String(key)}`);\r\n\t\t\t\treturn undefined;\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tgetUqMans() {\r\n\t\treturn this.uqMans;\r\n\t}\r\n\r\n\tprivate showReload(msg: string) {\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\tuqMan.localMap.removeAll();\r\n\t\t}\r\n\t\tthis.web.showReloadPage(msg);\r\n\t}\r\n\r\n\tsetTuidImportsLocal(): string[] {\r\n\t\tlet ret: string[] = [];\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\tfor (let tuid of uqMan.tuidArr) {\r\n\t\t\t\tif (tuid.isImport === true) {\r\n\t\t\t\t\tlet error = this.setInner(tuid as TuidImport);\r\n\t\t\t\t\tif (error) ret.push(error);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate setInner(tuidImport: TuidImport): string {\r\n\t\tlet { from } = tuidImport;\r\n\t\tlet fromName = from.owner + '/' + from.uq;\r\n\t\tlet uq = this.collection[fromName];\r\n\t\tif (uq === undefined) {\r\n\t\t\t//debugger;\r\n\t\t\tif (env.buildingUq === false) {\r\n\t\t\t\tconsole.error(`setInner(tuidImport: TuidImport): uq ${fromName} is not loaded`);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet iName = tuidImport.name\r\n\t\tlet tuid = uq.tuid(iName);\r\n\t\tif (tuid === undefined) {\r\n\t\t\t//debugger;\r\n\t\t\treturn `setInner(tuidImport: TuidImport): uq ${fromName} has no Tuid ${iName}`;\r\n\t\t}\r\n\t\tif (tuid.isImport === true) {\r\n\t\t\t//debugger;\r\n\t\t\treturn `setInner(tuidImport: TuidImport): uq ${fromName} Tuid ${iName} is import`;\r\n\t\t}\r\n\t\ttuidImport.setFrom(tuid as TuidInner);\r\n\t}\r\n}\r\n","import { Tonwa, AppConfig as AppConfigCore, UqConfig } from '../core';\r\nimport { UQsMan } from \"./uqsMan\";\r\nimport { LocalMap, LocalCache, env } from '../tool';\r\nimport { UqData, UqAppData, CenterAppApi } from '../web';\r\n\r\nexport class UQsLoader {\r\n\treadonly tonwa: Tonwa;\r\n\tprotected readonly appConfig: AppConfigCore;\r\n\tprotected isBuildingUQ: boolean = false;\r\n\tuqsMan: UQsMan;         // value\r\n\r\n\tconstructor(tonwa: Tonwa, appConfig: AppConfigCore) {\r\n\t\tthis.appConfig = appConfig;\r\n\t\tthis.tonwa = tonwa;\r\n\t}\r\n\r\n\tasync build() {\r\n\t\tlet { app, uqs } = this.appConfig;\r\n\t\tlet retErrors: string[];\r\n\t\tif (app) {\r\n\t\t\tretErrors = await this.loadApp();\r\n\t\t}\r\n\t\telse if (uqs) {\r\n\t\t\tretErrors = await this.loadUqs();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error('either uqs or app must be defined in AppConfig');\r\n\t\t}\r\n\t\treturn retErrors;\r\n\t}\r\n\t/*\r\n\tasync buildUQs(uqsConfig: AppConfig) {\r\n\t\tlet {uqs, tvs, version} = uqsConfig;\r\n\t\tlet retErrors:string[];\r\n\t\tif (uqs) {\r\n\t\t\tUQsMan.isBuildingUQ = true;\r\n\t\t\tretErrors = await this.loadUqs();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error('either uqs or app must be defined in AppConfig');\r\n\t\t}\r\n\t\treturn retErrors;\r\n\t}\r\n\t*/\r\n\r\n\t// 返回 errors, 每个uq一行\r\n\tprivate async loadApp(): Promise<string[]> {\r\n\t\tlet { app, uqs: uqConfigs, version } = this.appConfig;\r\n\r\n\t\tlet { name, dev } = app;\r\n\t\tlet uqsManApp = new UQsManApp(this.tonwa, `${dev.name}/${name}`);\r\n\t\tthis.uqsMan = uqsManApp;\r\n\t\tlet { appOwner, appName, localData } = uqsManApp;\r\n\t\tlet uqAppData: UqAppData = localData.get();\r\n\t\tif (!uqAppData || uqAppData.version !== version) {\r\n\t\t\tuqAppData = await this.loadUqAppData(appOwner, appName);\r\n\t\t\tif (!uqAppData.id) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t`${appOwner}/${appName}不存在。请仔细检查app全名。`\r\n\t\t\t\t];\r\n\t\t\t}\r\n\t\t\tuqAppData.version = version;\r\n\r\n\t\t\tif (uqConfigs) {\r\n\t\t\t\tlet data = await this.loadUqData(uqConfigs);\r\n\t\t\t\tuqAppData.uqs.push(...data);\r\n\t\t\t}\r\n\r\n\t\t\tlocalData.set(uqAppData);\r\n\t\t\t// \r\n\t\t\tfor (let uq of uqAppData.uqs) uq.newVersion = true;\r\n\t\t}\r\n\t\tlet { id, uqs } = uqAppData;\r\n\t\tuqsManApp.id = id;\r\n\t\treturn await this.uqsMan.buildUqs(uqs, version, uqConfigs, this.isBuildingUQ);\r\n\t}\r\n\r\n\t// 返回 errors, 每个uq一行\r\n\tasync loadUqs(/*uqConfigs: UqConfig[], version:string, tvs:TVs*/): Promise<string[]> {\r\n\t\tlet { uqs: uqConfigs, version } = this.appConfig;\r\n\t\tthis.uqsMan = new UQsMan(this.tonwa);\r\n\t\tlet uqs = await this.loadUqData(uqConfigs);\r\n\t\treturn await this.uqsMan.buildUqs(uqs, version, uqConfigs, this.isBuildingUQ);\r\n\t}\r\n\r\n\tprivate async loadUqAppData(appOwner: string, appName: string): Promise<UqAppData> {\r\n\t\tlet centerAppApi = new CenterAppApi(this.tonwa.web, 'tv/', undefined);\r\n\t\tlet ret = await centerAppApi.appUqs(appOwner, appName);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate async loadUqData(uqConfigs: UqConfig[]): Promise<UqData[]> {\r\n\t\tlet uqs: { owner: string; ownerAlias: string; name: string; alias: string; version: string }[] = uqConfigs.map(\r\n\t\t\tv => {\r\n\t\t\t\tlet { dev, name, version, alias } = v;\r\n\t\t\t\tlet { name: owner, alias: ownerAlias } = dev;\r\n\t\t\t\treturn { owner, ownerAlias, name, version, alias };\r\n\t\t\t}\r\n\t\t);\r\n\t\tlet centerAppApi = new CenterAppApi(this.tonwa.web, 'tv/', undefined);\r\n\t\tlet ret: UqData[] = await centerAppApi.uqs(uqs);\r\n\t\tif (ret.length < uqs.length) {\r\n\t\t\tlet err = `下列UQ：\\n${uqs.map(v => `${v.owner}/${v.name}`).join('\\n')}之一不存在`;\r\n\t\t\tconsole.error(err);\r\n\t\t\tthrow Error(err);\r\n\t\t}\r\n\t\tfor (let i = 0; i < uqs.length; i++) {\r\n\t\t\tlet { ownerAlias, alias } = uqs[i];\r\n\t\t\tret[i].ownerAlias = ownerAlias;\r\n\t\t\tret[i].uqAlias = alias;\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nclass UQsManApp extends UQsMan {\r\n\treadonly appOwner: string;\r\n\treadonly appName: string;\r\n\treadonly localMap: LocalMap;\r\n\treadonly localData: LocalCache;\r\n\tid: number;\r\n\r\n\tconstructor(tonwa: Tonwa, tonwaAppName: string/*, tvs:TVs*/) {\r\n\t\tsuper(tonwa/*, tvs*/);\r\n\t\tlet parts = tonwaAppName.split('/');\r\n\t\tif (parts.length !== 2) {\r\n\t\t\tthrow new Error('tonwaApp name must be / separated, owner/app');\r\n\t\t}\r\n\t\tthis.appOwner = parts[0];\r\n\t\tthis.appName = parts[1];\r\n\t\tthis.localMap = env.localDb.map(tonwaAppName);\r\n\t\tthis.localData = this.localMap.child('uqData');\r\n\t}\r\n}\r\n\r\nexport class UQsBuildingLoader extends UQsLoader {\r\n\tasync build() {\r\n\t\t//nav.forceDevelopment = true;\r\n\t\tenv.isDevelopment = true;\r\n\t\t//await nav.init();\r\n\t\t//await this.tonwa.web.navInit();\r\n\t\tawait this.tonwa.init();\r\n\t\tthis.isBuildingUQ = true;\r\n\t\tlet { uqs } = this.appConfig;\r\n\t\tlet retErrors: string[];\r\n\t\tif (uqs) {\r\n\t\t\tretErrors = await this.loadUqs();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error('uqs must be defined in AppConfig');\r\n\t\t}\r\n\t\treturn retErrors;\r\n\t}\r\n}\r\n","export function uqStringify(values: any): string {\r\n    let s = '{';\r\n    if (values === undefined) return 'undefined';\r\n    for (let i in values) {\r\n        let v = values[i];\r\n        s += i + ': ';\r\n        if (v === undefined) {\r\n            s += 'undefined';\r\n        }\r\n        else if (v === null) {\r\n            s += 'null';\r\n        }\r\n        else {\r\n            switch (typeof v) {\r\n                default:\r\n                    s += v;\r\n                    break;\r\n                case 'function':\r\n                    s += 'function';\r\n                    break;\r\n                case 'object':\r\n                    s += '{obj}';\r\n                    break;\r\n            }\r\n        }\r\n        s += ', ';\r\n    }\r\n    return s + '}';\r\n}\r\n","export interface KeyValueRes {\r\n    [key:string]: any;\r\n}\r\n\r\nexport interface Res<T extends KeyValueRes> {\r\n    [lang:string]: T | {[district:string]: T};\r\n}\r\n\r\nexport const resOptions:{\r\n\tlang: string;\r\n\t$lang: string;\r\n\tdistrict: string;\r\n\t$district: string;\r\n} = {\r\n\tlang: undefined,\r\n\t$lang: undefined,\r\n\tdistrict: undefined,\r\n\t$district: undefined,\r\n}\r\n\r\nexport function setResOptions(lang:string, district:string) {\r\n\tresOptions.lang = lang;\r\n\tresOptions.$lang = '$' + lang;\r\n    resOptions.district = district;\r\n    resOptions.$district = '$' + district;\r\n}\r\n\r\n(function() {\r\n    let lang: string, district: string;\r\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n        || navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n    setResOptions(lang, district);\r\n}());\r\n\r\nexport function resLang<T extends KeyValueRes>(res:Res<T>):T {\r\n    let {lang, district} = resOptions;\r\n    let ret:T = {} as T;\r\n    if (res === undefined) return ret;\r\n    Object.assign(ret, res._);\r\n    let l = res[lang];\r\n    if (l === undefined) return ret;\r\n    Object.assign(ret, l._);\r\n    let d = l[district];\r\n    if (d === undefined) return ret;\r\n    Object.assign(ret, d);\r\n    let {entity} = ret;\r\n    if (entity !== undefined) {\r\n        for (let i in entity) {\r\n            entity[i.toLowerCase()] = entity[i];\r\n        }\r\n    }\r\n    return ret;\r\n}\r\n\r\nexport const resGlobal:any = {};\r\nexport function setRes(target: any, res: any):(str:string)=>any {\r\n\tif (res === undefined) return;\r\n\tlet {$lang, $district} = resOptions;\r\n\tObject.assign(target, res);\r\n\tif ($lang !== undefined) {\r\n\t\tlet l = res[$lang];\r\n\t\tif (l !== undefined) {\r\n\t\t\tObject.assign(target, l);\r\n\t\t\tlet d = l[$district];\r\n\t\t\tif (d !== undefined) {\r\n\t\t\t\tObject.assign(target, d);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn function(str:string) {\r\n\t\treturn target[str] || str;\r\n\t}\r\n}\r\nexport function setGlobalRes(res: any) {\r\n\tsetRes(resGlobal, res);\r\n}\r\n/*\r\nexport function t(str:string):string|JSX.Element {\r\n\treturn resGlobal[str] || str;\r\n}\r\nexport type TFunc = (str:string|JSX.Element) => string|JSX.Element;\r\n*/\r\n\r\n","import { KeyValueRes, Res } from './res';\r\n\r\nexport interface InputRes extends KeyValueRes {\r\n    required: string;\r\n    number: string;\r\n    integer: string;\r\n    min: string;\r\n    max: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const inputRes:Res<InputRes> = {\r\n    _: {\r\n        required: 'required',\r\n        number: 'not valid number',\r\n        integer: 'not valid integer',\r\n        min: 'min value is ${min}',\r\n        max: 'max value is ${max}',\r\n    },\r\n    zh: {\r\n        _: {\r\n            required: '必须填',\r\n            number: '需要数字',\r\n            integer: '需要整数',\r\n            min: '不能小于${min}',\r\n            max: '不能大于${max}',\r\n        }\r\n    },\r\n}\r\n","import { Navigo, Hooks, NamedRoute, RouteFunc } from \"./Navigo\";\r\nimport { Nav, NavPage } from './Nav';\r\nimport { Web } from '../web';\r\nimport { resOptions } from '../res';\r\nimport { LocalData, env, User, Guest } from '../tool';\r\nimport { Login } from './Login';\r\n\r\nexport interface NavSettings {\r\n\toem?: string;\r\n\tloginTop?: JSX.Element;\r\n\tprivacy?: string;\r\n\thtmlTitle?: string;\r\n}\r\n\r\nlet logMark: number;\r\nconst logs: string[] = [];\r\n\r\nexport let tonwa: Tonwa;\r\n\r\nexport abstract class Tonwa {\r\n\treadonly web: Web;\r\n\tprivate wsHost: string;\r\n\tprivate local: LocalData = new LocalData();\r\n\tprivate navigo: Navigo;\r\n\t//isWebNav:boolean = false;\r\n\tnavSettings: NavSettings;\r\n\tuser: User = null;\r\n\ttesting: boolean;\r\n\tlanguage: string;\r\n\tculture: string;\r\n\tresUrl: string;\r\n\r\n\tconstructor() {\r\n\t\ttonwa = this;\r\n\t\tthis.web = this.createWeb();\r\n\t\tlet { lang, district } = resOptions;\r\n\t\tthis.language = lang;\r\n\t\tthis.culture = district;\r\n\t\tthis.testing = false;\r\n\t}\r\n\r\n\t/*\r\n\tprotected abstract startWait(): void;\r\n\tprotected abstract endWait(): void;\r\n\t*/\r\n\t//protected abstract showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean): Promise<void>;\r\n\tprotected abstract showRegister(): Promise<void>;\r\n\tprotected abstract showForget(): Promise<void>;\r\n\r\n\tabstract createWeb(): Web;\r\n\tabstract createObservableMap<K, V>(): Map<K, V>;\r\n\tabstract get nav(): Nav;\r\n\r\n\tabstract privacyEntry(): void;\r\n\t//abstract showLogout(callback?: ()=>Promise<void>): Promise<void>;\r\n\t//abstract openSysPage(url: string):boolean;\r\n\t//abstract changePassword(): Promise<void>;\r\n\t//abstract userQuit(): Promise<void>;\r\n\tabstract resetAll: () => void;\r\n\tabstract showAppView(isUserLogin?: boolean): Promise<void>;\r\n\t//abstract clear(): void;\r\n\r\n\tget guest(): number {\r\n\t\tlet guest = this.local.guest;\r\n\t\tif (guest === undefined) return 0;\r\n\t\tlet g = guest.get();\r\n\t\tif (g === undefined) return 0;\r\n\t\treturn g.guest;\r\n\t}\r\n\tasync onReceive(msg: any) {\r\n\t\t//if (this.ws === undefined) return;\r\n\t\tawait this.web.messageHub.dispatch(msg);\r\n\t}\r\n\r\n\tprivate async loadUnitJson() {\r\n\t\ttry {\r\n\t\t\tlet unitJsonPath = this.unitJsonPath();\r\n\t\t\tlet unitRes = await fetch(unitJsonPath, {});\r\n\t\t\tlet res = await unitRes.json();\r\n\t\t\treturn res.unit;\r\n\t\t}\r\n\t\tcatch (err1) {\r\n\t\t\tthis.local.unit.remove();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async getPredefinedUnitName() {\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\treturn el.innerText;\r\n\t\t}\r\n\t\tel = document.getElementById('unit.json');\r\n\t\tif (!el) {\r\n\t\t\treturn await this.loadUnitJson();\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tlet json = el.innerHTML;\r\n\t\t\tlet res = JSON.parse(json);\r\n\t\t\treturn res.unit;\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\treturn await this.loadUnitJson();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async loadPredefinedUnit() {\r\n\t\tlet envUnit = process.env.REACT_APP_UNIT;\r\n\t\tif (envUnit !== undefined) {\r\n\t\t\treturn Number(envUnit);\r\n\t\t}\r\n\t\tlet unitName: string;\r\n\t\tlet unit = this.local.unit.get();\r\n\t\tif (unit !== undefined) {\r\n\t\t\tif (env.isDevelopment !== true) return unit.id;\r\n\t\t\tunitName = await this.getPredefinedUnitName();\r\n\t\t\tif (unitName === undefined) return;\r\n\t\t\tif (unit.name === unitName) return unit.id;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tunitName = await this.getPredefinedUnitName();\r\n\t\t\tif (unitName === undefined) return;\r\n\t\t}\r\n\t\tlet unitId = await this.web.guestApi.unitFromName(unitName);\r\n\t\tif (unitId !== undefined) {\r\n\t\t\tthis.local.unit.set({ id: unitId, name: unitName });\r\n\t\t}\r\n\t\treturn unitId;\r\n\t}\r\n\r\n\tsetSettings(settings?: NavSettings) {\r\n\t\tthis.navSettings = settings;\r\n\t\tlet { htmlTitle } = settings;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) {\r\n\t\t\t\t//appConfig.version = version;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget oem(): string {\r\n\t\treturn this.navSettings && this.navSettings.oem;\r\n\t}\r\n\r\n\thashParam: string;\r\n\tprivate centerHost: string;\r\n\tprivate arrs = ['/test', '/test/'];\r\n\tprivate unitJsonPath(): string {\r\n\t\tlet { origin, pathname } = document.location;\r\n\t\tpathname = pathname.toLowerCase();\r\n\t\tfor (let item of this.arrs) {\r\n\t\t\tif (pathname.endsWith(item) === true) {\r\n\t\t\t\tpathname = pathname.substr(0, pathname.length - item.length);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (pathname.endsWith('/') === true || pathname.endsWith('\\\\') === true) {\r\n\t\t\tpathname = pathname.substr(0, pathname.length - 1);\r\n\t\t}\r\n\t\treturn origin + pathname + '/unit.json';\r\n\t}\r\n\tprivate windowOnError = (event: Event | string, source?: string, lineno?: number, colno?: number, error?: Error) => {\r\n\t\tdebugger;\r\n\t\tconsole.error('windowOnError');\r\n\t\tconsole.error(error);\r\n\t}\r\n\tprivate windowOnUnhandledRejection = (ev: PromiseRejectionEvent) => {\r\n\t\tdebugger;\r\n\t\tconsole.error('windowOnUnhandledRejection');\r\n\t\tconsole.error(ev.reason);\r\n\t}\r\n\tprivate windowOnClick = (ev: MouseEvent) => {\r\n\t\tconsole.error('windowOnClick');\r\n\t}\r\n\tprivate windowOnMouseMove = (ev: MouseEvent) => {\r\n\t\tconsole.log('navigator.userAgent: ' + navigator.userAgent);\r\n\t\tconsole.log('mouse move (%s, %s)', ev.x, ev.y);\r\n\t}\r\n\tprivate windowOnScroll = (ev: Event) => {\r\n\t\tconsole.log('scroll event');\r\n\t}\r\n\r\n\tforceDevelopment: boolean;\r\n\r\n\tasync init() {\r\n\t\tthis.testing = env.testing;\r\n\t\tif (this.forceDevelopment === true) {\r\n\t\t\tenv.isDevelopment = true;\r\n\t\t}\r\n\t\tawait this.web.host.start(this.testing);\r\n\t\t/*\r\n\t\tlet hash = document.location.hash;\r\n\t\tif (hash !== undefined && hash.length > 0) {\r\n\t\t\tlet pos = getExHashPos();\r\n\t\t\tif (pos < 0) pos = undefined;\r\n\t\t\tthis.hashParam = hash.substring(1, pos);\r\n\t\t}\r\n\t\t*/\r\n\t\tlet { url, ws, resHost } = this.web.host;\r\n\t\tthis.centerHost = url;\r\n\t\tthis.resUrl = this.web.resUrlFromHost(resHost);\r\n\t\tthis.wsHost = ws;\r\n\t\tthis.web.setCenterUrl(url);\r\n\r\n\t\tlet guest: Guest = this.local.guest.get();\r\n\t\tif (guest === undefined) {\r\n\t\t\tguest = await this.web.guestApi.guest();\r\n\t\t}\r\n\t\tif (!guest) {\r\n\t\t\tdebugger;\r\n\t\t\tthrow Error('guest can not be undefined');\r\n\t\t}\r\n\t\tthis.setGuest(guest);\r\n\t}\r\n\r\n\treloadUser = () => {\r\n\t\tlet user: User = this.local.user.get();\r\n\t\tlet curUser = this.user;\r\n\t\tif (!user && !curUser) return;\r\n\t\tif (user?.id === curUser?.id) return;\r\n\t\tif (!user) {\r\n\t\t\tthis.logout();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.logined(user);\r\n\t\t}\r\n\t}\r\n\r\n\t//private appStarted:boolean = false;\r\n\tprivate notLogined?: () => Promise<void>;\r\n\tprivate userPassword?: () => Promise<{ user: string; password: string; }>\r\n\tasync appStart(notLogined?: () => Promise<void>, userPassword?: () => Promise<{ user: string; password: string; }>) {\r\n\t\t//if (this.appStarted === true) return;\r\n\t\t//this.appStarted = true;\r\n\t\tthis.notLogined = notLogined;\r\n\t\tthis.userPassword = userPassword;\r\n\t\tawait this.init();\r\n\t\tawait this.start();\r\n\t}\r\n\r\n\tasync start() {\r\n\t\ttry {\r\n\t\t\twindow.onerror = this.windowOnError;\r\n\t\t\twindow.onunhandledrejection = this.windowOnUnhandledRejection;\r\n\t\t\twindow.onfocus = this.reloadUser;\r\n\t\t\tif (env.isMobile === true) {\r\n\t\t\t\tdocument.onselectstart = function () { return false; }\r\n\t\t\t\tdocument.oncontextmenu = function () { return false; }\r\n\t\t\t}\r\n\t\t\tthis.nav.clear();\r\n\t\t\tthis.nav.startWait();\r\n\r\n\t\t\tlet user: User = this.local.user.get();\r\n\t\t\tif (user === undefined) {\r\n\t\t\t\t//throw new Error('user logout to be implemented');\r\n\t\t\t\t//let {userPassword} = this.navView.props;\r\n\t\t\t\tif (this.userPassword) {\r\n\t\t\t\t\tlet ret = await this.userPassword();\r\n\t\t\t\t\tif (ret) {\r\n\t\t\t\t\t\tlet { user: userName, password } = ret;\r\n\t\t\t\t\t\tlet logindUser = await this.web.userApi.login({\r\n\t\t\t\t\t\t\tuser: userName,\r\n\t\t\t\t\t\t\tpwd: password,\r\n\t\t\t\t\t\t\tguest: this.guest,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tuser = logindUser;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (user === undefined) {\r\n\t\t\t\t\t//let {notLogined} = this.navView.props;\r\n\t\t\t\t\tif (this.notLogined !== undefined) {\r\n\t\t\t\t\t\tawait this.notLogined();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tawait this.showLogin(undefined);\r\n\t\t\t\t\t\t//nav.navigateToLogin();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tawait this.logined(user);\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\tfinally {\r\n\t\t\tthis.nav.endWait();\r\n\t\t}\r\n\t}\r\n\r\n\tresolveRoute() {\r\n\t\t//if (this.isRouting === false) return;\r\n\t\tif (this.navigo === undefined) return;\r\n\t\tthis.navigo.resolve();\r\n\t}\r\n\r\n\ton(routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\ton(url: string, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\ton(regex: RegExp, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\ton(options: { [url: string]: RouteFunc | NamedRoute }): Navigo;\r\n\ton(...args: any[]): Navigo {\r\n\t\tif (this.navigo === undefined) {\r\n\t\t\tthis.navigo = new Navigo();\r\n\t\t\tif (this.nav.isWebNav !== true) this.navigo.historyAPIUpdateMethod('replaceState');\r\n\t\t}\r\n\t\treturn this.navigo.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tnavigateToLogin() {\r\n\t\tthis.navigate('/login');\r\n\t}\r\n\r\n\tnavigate(url: string, absolute?: boolean) {\r\n\t\tif (!this.navigo) {\r\n\t\t\talert('Is not in webnav state, cannot navigate to url \"' + url + '\"');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.testing === true) {\r\n\t\t\turl += '#test';\r\n\t\t}\r\n\t\treturn this.navigo.navigate(url, absolute);\r\n\t}\r\n\r\n\tgo(showPage: () => void, url: string, absolute?: boolean) {\r\n\t\tif (this.navigo !== undefined) {\r\n\t\t\tthis.navigate(url, absolute);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tshowPage();\r\n\t\t}\r\n\t}\r\n\r\n\tsetGuest(guest: Guest) {\r\n\t\tthis.local.guest.set(guest);\r\n\t\tthis.web.setNetToken(0, guest.token);\r\n\t}\r\n\r\n\tsaveLocalUser() {\r\n\t\tthis.local.user.set(this.user);\r\n\t}\r\n\r\n\tsetUqRoles(uq: string, roles: string[]) {\r\n\t\tlet { roles: userRoles } = this.user;\r\n\t\tif (!userRoles) {\r\n\t\t\tthis.user.roles = {};\r\n\t\t}\r\n\t\tthis.user.roles[uq] = roles;\r\n\t\tthis.local.user.set(this.user);\r\n\t}\r\n\r\n\tasync loadMe() {\r\n\t\tlet me = await this.web.userApi.me();\r\n\t\tthis.user.icon = me.icon;\r\n\t\tthis.user.nick = me.nick;\r\n\t}\r\n\r\n\tprivate async internalLogined(user: User, callback: (user: User) => Promise<void>, isUserLogin: boolean) {\r\n\t\tthis.web.logoutApis();\r\n\t\tthis.user = user;\r\n\t\tthis.saveLocalUser();\r\n\t\tthis.web.setNetToken(user.id, user.token);\r\n\t\tthis.nav.clear();\r\n\r\n\t\tawait this.onChangeLogin?.(this.user);\r\n\t\tif (callback !== undefined) {\r\n\t\t\tawait callback(user);\r\n\t\t}\r\n\t\telse if (this.nav.isWebNav === true) {\r\n\t\t\tthis.navigate('/index');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tawait this.showAppView(isUserLogin);\r\n\t\t}\r\n\t}\r\n\r\n\tonChangeLogin: (user: User) => Promise<void>;\r\n\r\n\t// 缓冲登录\r\n\tasync logined(user: User, callback?: (user: User) => Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, false);\r\n\t}\r\n\r\n\t// 用户操作之后登录\r\n\tasync userLogined(user: User, callback?: (user: User) => Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, true);\r\n\t}\r\n\r\n\tloginTop(defaultTop: JSX.Element) {\r\n\t\treturn (this.navSettings && this.navSettings.loginTop) || defaultTop;\r\n\t}\r\n\r\n\tasync logout(callback?: () => Promise<void>) { //notShowLogin?:boolean) {\r\n\t\tthis.local.logoutClear();\r\n\t\tthis.user = undefined; //{} as User;\r\n\t\tthis.web.logoutApis();\r\n\t\tlet guest = this.local.guest.get();\r\n\t\tthis.web.setCenterToken(0, guest && guest.token);\r\n\t\tthis.nav.clear();\r\n\t\tif (callback === undefined)\r\n\t\t\tawait this.start();\r\n\t\telse\r\n\t\t\tawait callback();\r\n\t\tthis.onChangeLogin?.(undefined);\r\n\t}\r\n\r\n\r\n\tget logs() { return logs };\r\n\tlog(msg: string) {\r\n\t\tlogs.push(msg);\r\n\t}\r\n\tlogMark() {\r\n\t\tlet date = new Date();\r\n\t\tlogMark = date.getTime();\r\n\t\tlogs.push('log-mark: ' + date.toTimeString());\r\n\t}\r\n\tlogStep(step: string) {\r\n\t\tlogs.push(step + ': ' + (new Date().getTime() - logMark));\r\n\t}\r\n\r\n\treload = async () => {\r\n\t\tlet waiting: Promise<void> = new Promise<void>((resolve, reject) => {\r\n\t\t\tsetTimeout(resolve, 100);\r\n\t\t});\r\n\r\n\t\tif ('serviceWorker' in navigator) {\r\n\t\t\tlet registration = await Promise.race([waiting, navigator.serviceWorker.ready]);\r\n\t\t\tif (registration) registration.unregister();\r\n\t\t}\r\n\t\twindow.document.location.reload();\r\n\t\t// dcloud hbuilder里面的app自动升级，需要清webview的缓存\r\n\t\tlet plus = (window as any).plus;\r\n\t\tif (plus) {\r\n\t\t\tlet webview = plus.webview;\r\n\t\t\tif (webview) {\r\n\t\t\t\tif (webview.reload) webview.reload(true);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet webView = plus.webView;\r\n\t\t\t\tif (webView) {\r\n\t\t\t\t\tif (webView.reload) webView.reload(true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//plus.webview.reload(true)\r\n\t\t}\r\n\t}\r\n\r\n\topenSysPage(url: string): boolean {\r\n\t\tlet navPage: NavPage = this.sysRoutes[url];\r\n\t\tif (navPage === undefined) {\r\n\t\t\t//alert(url + ' is not defined in sysRoutes');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tnavPage(undefined);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate navLogin: NavPage = async (params: any) => {\r\n\t\tthis.showLogin(async (user: User) => window.history.back(), false);\r\n\t}\r\n\r\n\tprivate navLogout: NavPage = async (params: any) => {\r\n\t\tthis.showLogout(async () => window.history.back());\r\n\t}\r\n\r\n\tprivate navRegister: NavPage = async (params: any) => {\r\n\t\tthis.showRegister();\r\n\t}\r\n\r\n\tprivate navForget: NavPage = async (params: any) => {\r\n\t\tthis.showForget();\r\n\t}\r\n\r\n\r\n\tprivate navPageRoutes: { [url: string]: NavPage };\r\n\tprivate routeFromNavPage(navPage: NavPage) {\r\n\t\treturn (params: any, queryStr: any) => {\r\n\t\t\tif (navPage) {\r\n\t\t\t\tif (this.nav.isWebNav) this.nav.clear();\r\n\t\t\t\tnavPage(params);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tonNavRoute(navPage: NavPage) {\r\n\t\tthis.on(this.routeFromNavPage(navPage));\r\n\t}\r\n\tprivate doneSysRoutes: boolean = false;\r\n\tprivate sysRoutes: { [route: string]: NavPage } = {\r\n\t\t'/login': this.navLogin,\r\n\t\t'/logout': this.navLogout,\r\n\t\t'/register': this.navRegister,\r\n\t\t'/forget': this.navForget,\r\n\t}\r\n\t/*\r\n\tonSysNavRoutes() {\r\n\t\tthis.onNavRoutes(this.sysRoutes);\r\n\t}\r\n\t*/\r\n\tonNavRoutes(navPageRoutes: { [url: string]: NavPage }) {\r\n\t\tif (this.doneSysRoutes === false) {\r\n\t\t\tthis.doneSysRoutes = true;\r\n\t\t\tthis.internalOnNavRoutes(this.sysRoutes);\r\n\t\t}\r\n\t\tthis.internalOnNavRoutes(navPageRoutes);\r\n\t}\r\n\r\n\tprivate internalOnNavRoutes(navPageRoutes: { [url: string]: NavPage }) {\r\n\t\tif (!navPageRoutes) return;\r\n\t\tthis.navPageRoutes = Object.assign(this.navPageRoutes, navPageRoutes);\r\n\t\tlet navOns: { [route: string]: (params: any, queryStr: any) => void } = {};\r\n\t\tfor (let route in navPageRoutes) {\r\n\t\t\tlet navPage = navPageRoutes[route];\r\n\t\t\tnavOns[route] = this.routeFromNavPage(navPage);\r\n\t\t}\r\n\t\tthis.on(navOns);\r\n\t}\r\n\r\n\tasync checkVersion(): Promise<string> {\r\n\t\tlet { href } = document.location;\r\n\t\thref += (href.indexOf('?') >= 0 ? '&' : '?') + '_t_t_=' + new Date().getTime();\r\n\t\tlet ret = await fetch(href);\r\n\t\tlet r = await ret.text();\r\n\t\tlet parser = new DOMParser();\r\n\t\tlet htmlDoc = parser.parseFromString(r, 'text/html');\r\n\t\tlet elHtml = htmlDoc.getElementsByTagName('html');\r\n\t\tlet newVersion = elHtml[0].getAttribute('data-version');\r\n\t\treturn newVersion;\r\n\t}\r\n\r\n\tprivate createLogin: (tonwa: Tonwa) => Promise<Login>;\r\n\tsetCreateLogin(createLogin: (tonwa: Tonwa) => Promise<Login>) {\r\n\t\tthis.createLogin = createLogin;\r\n\t}\r\n\r\n\tasync changePassword() {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showChangePassword();\r\n\t}\r\n\r\n\tasync userQuit() {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showUserQuit();\r\n\t}\r\n\r\n\tprivate login: Login;\r\n\tprivate async getLogin(): Promise<Login> {\r\n\t\tif (this.login) return this.login;\r\n\t\treturn this.login = await this.createLogin(this);\r\n\t}\r\n\tasync showLogin(callback?: (user: User) => Promise<void>, withBack?: boolean) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogin(callback, withBack);\r\n\t}\r\n\r\n\tasync showLogout(callback?: () => Promise<void>) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogout(callback);\r\n\t}\r\n}\r\n","import { KeyValueRes, Res } from './res';\r\n\r\nexport interface ListRes extends KeyValueRes {\r\n    none: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const listRes:Res<ListRes> = {\r\n    _: {\r\n        none: '[none]',\r\n    },\r\n    zh: {\r\n        _: {\r\n            none: '[无]',\r\n        }\r\n    },\r\n}\r\n","// typescript version of krasimir/navigo\r\n\r\nexport type RouteFunc = (params?:string|{[name:string]:string}, query?:string) => void;\r\n\r\nexport interface NamedRoute {\r\n\tas: string;\r\n\tuses: RouteFunc;\r\n\thooks?: Hooks;\r\n}\r\nexport interface Hooks {\r\n\tbefore: (done:()=>void, params:object) => void;\r\n\tafter: (params:object) => void;\r\n\tleave: (params:object) => void;\r\n\talready: (params:object) => void;\r\n}\r\ninterface Handler {\r\n\thandler: RouteFunc;\r\n\thooks: Hooks;\r\n}\r\ninterface LastResolved {\r\n\turl: string;\r\n\tquery: string;\r\n\thooks: Hooks;\r\n\tparams?: {[name:string]:string};\r\n\tname?: string;\r\n}\r\ninterface Route {\r\n\troute: string|RegExp;\r\n\thandler: RouteFunc,\r\n\tname: string,\r\n\thooks: Hooks\r\n}\r\n\r\nexport class Navigo {\r\n\tprivate static PARAMETER_REGEXP = /([:*])(\\w+)/g;\r\n\tprivate static WILDCARD_REGEXP = /\\*/g;\r\n\tprivate static REPLACE_VARIABLE_REGEXP = '([^\\\\/]+)';   \t// 单\\，编译错误 ([^\\/]+)\r\n\tprivate static REPLACE_WILDCARD = `(?:.*)`;\r\n\tprivate static FOLLOWED_BY_SLASH_REGEXP = '(?:\\\\/$|$)';\t\t// 单\\，编译错误 (?:\\/$|$)\r\n\tprivate static MATCH_REGEXP_FLAGS = '';\r\n\r\n\tprivate static isPushStateAvailable() {\r\n\t\treturn !!(\r\n\t\t  typeof window !== 'undefined' &&\r\n\t\t  window.history &&\r\n\t\t  window.history.pushState\r\n\t\t);\r\n\t}\r\n\t\r\n\tprivate static clean(s:string|RegExp) {\r\n\t\tif (s instanceof RegExp) return s;\r\n\t\treturn Navigo.cleanUrl(s);\r\n\t}\r\n\tprivate static cleanUrl(s:string) {\r\n\t\treturn s.replace(/\\/+$/, '').replace(/^\\/+/, '^/');\r\n\t}\r\n\r\n\tprivate static regExpResultToParams(match:any[], names:string[]) {\r\n\t\tif (names.length === 0) return null;\r\n\t\tif (!match) return null;\r\n\t\treturn match\r\n\t\t  .slice(1, match.length)\r\n\t\t  .reduce((params, value, index) => {\r\n\t\t\t\tif (params === null) params = {};\r\n\t\t\t\tparams[names[index]] = decodeURIComponent(value);\r\n\t\t\t\treturn params;\r\n\t\t  }, null);\r\n\t}\r\n\t  \r\n\tprivate static replaceDynamicURLParts(route:string|RegExp) {\r\n\t\tlet paramNames:string[] = [], regexp:RegExp;\r\n\t  \r\n\t\tif (route instanceof RegExp) {\r\n\t\t\tregexp = route;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tregexp = new RegExp(\r\n\t\t\t\troute.replace(Navigo.PARAMETER_REGEXP, function (full, dots, name) {\r\n\t\t\t\t\t\tparamNames.push(name);\r\n\t\t\t\t\t\treturn Navigo.REPLACE_VARIABLE_REGEXP;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.replace(Navigo.WILDCARD_REGEXP, Navigo.REPLACE_WILDCARD) + Navigo.FOLLOWED_BY_SLASH_REGEXP\r\n\t\t\t\t, Navigo.MATCH_REGEXP_FLAGS);\r\n\t\t}\r\n\t\treturn { regexp, paramNames };\r\n\t}\r\n\t  \r\n\tprivate static getUrlDepth(url:string):number {\r\n\t\treturn url.replace(/\\/$/, '').split('/').length;\r\n\t}\r\n\t  \r\n\tprivate static compareUrlDepth(urlA:string, urlB:string) {\r\n\t\treturn Navigo.getUrlDepth(urlB) - Navigo.getUrlDepth(urlA);\r\n\t}\r\n\t  \r\n\tprivate static findMatchedRoutes(url:string, routes:Route[] = []) {\r\n\t\treturn routes.map(route => {\r\n\t\t\tlet { regexp, paramNames } = Navigo.replaceDynamicURLParts(Navigo.clean(route.route));\r\n\t\t\tlet match = url.replace(/^\\/+/, '/').match(regexp);\r\n\t\t\tlet params = Navigo.regExpResultToParams(match, paramNames);\r\n\t\t\treturn match ? { match, route, params } : false;\r\n\t\t}).filter(m => m);\r\n\t}\r\n\t  \r\n\tprivate static match(url:string, routes:Route[]) {\r\n\t\treturn Navigo.findMatchedRoutes(url, routes)[0] || false;\r\n\t}\r\n\t  \r\n\tprivate static root(url:string, routes:Route[]) {\r\n\t\tconst colonExp = RegExp('\\\\/:\\\\D(\\\\w*)', 'g');\r\n\t\tconst exp = ''; // '($|\\\\/)';  // 单\\，编译报错 ($|\\/)\r\n\t\tlet matched = routes.map(\r\n\t\t\troute => {\r\n\t\t\t\tlet r = route.route;\r\n\t\t\t\tif (r === '' || r === '*') return url;\r\n\t\t\t\tif (typeof r === 'string') {\r\n\t\t\t\t\tr = r.replace(colonExp, '\\\\/(\\\\w|%|[\\u4E00-\\u9FCC])+');\r\n\t\t\t\t}\r\n\t\t\t\tlet routeExp = r + exp;\r\n\t\t\t\tlet ret = url.split(new RegExp(routeExp))[0];\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t);\r\n\t\tlet fallbackURL = Navigo.cleanUrl(url);\r\n\t\tlet len = matched.length;\r\n\t\tif (len === 0) return fallbackURL;\r\n\t\tlet matched0 = matched[0];\r\n\t\tif (len === 1) return matched0;\r\n\t\treturn matched.reduce((result, url) => {\r\n\t\t\tif (result.length > url.length) result = url;\r\n\t\t\treturn result;\r\n\t\t}, matched0);\r\n\t}\r\n\t  \r\n\tprivate static isHashChangeAPIAvailable() {\r\n\t\treturn typeof window !== 'undefined' && 'onhashchange' in window;\r\n\t}\r\n\t  \r\n\tprivate static extractGETParameters(url:string):string {\r\n\t\treturn url.split(/\\?(.*)?$/).slice(1).join('');\r\n\t}\r\n\t  \r\n\tprivate static getOnlyURL(url:string, useHash:boolean, hash:string) {\r\n\t\tlet onlyURL = url, split:string[];\r\n\t\tvar cleanGETParam = (str:string) => str.split(/\\?(.*)?$/)[0];\r\n\t  \r\n\t\tif (typeof hash === 'undefined') {\r\n\t\t\t// To preserve BC\r\n\t\t\thash = '#';\r\n\t\t}\r\n\t  \r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  \tonlyURL = cleanGETParam(url).split(hash)[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsplit = url.split(hash);\r\n\t\t\tonlyURL = split.length > 1 ? cleanGETParam(split[1]) : cleanGETParam(split[0]);\r\n\t\t}\r\n\t\treturn onlyURL;\r\n\t}\r\n\t  \r\n\tprivate static manageHooks(handler:RouteFunc, hooks:Hooks, params?:any, exHooks?:Hooks) {\r\n\t\tif (hooks && typeof hooks === 'object') {\r\n\t\t\tif (hooks.before) {\r\n\t\t\t\thooks.before((shouldRoute = true) => {\r\n\t\t\t\tif (!shouldRoute) return;\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\t}, params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if (hooks.after) {\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\thandler();\r\n\t}\r\n\t  \r\n\tprivate static isHashedRoot(url:string, useHash:boolean, hash:string) {\r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tif (!url.match(hash)) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tlet split = url.split(hash);\r\n\t  \r\n\t\treturn split.length < 2 || split[1] === '';\r\n\t}\r\n\t\r\n\tprivate root:string;\r\n\tprivate _routes:Route[] = [];\r\n\tprivate _useHash:boolean;\r\n\tprivate _hash:string;\r\n\tprivate _paused:boolean;\r\n\tprivate _destroyed:boolean;\r\n\tprivate _lastRouteResolved:LastResolved;\r\n\tprivate _notFoundHandler:Handler;\r\n\tprivate _defaultHandler:Handler;\r\n\tprivate _usePushState:boolean;\r\n\tprivate _genericHooks:Hooks;\r\n\tprivate _historyUpdateMethod: 'pushState' | 'replaceState'; // HistoryUpdateMethod;\r\n\tprivate timout: any; //NodeJS.Timeout;\r\n\r\n\tconstructor(r:string = null, useHash:boolean = false, hash:string = '#') {\r\n\t\tthis.root = null;\r\n\t\tthis._useHash = useHash;\r\n\t\tthis._hash = (!hash)? '#' : hash;\r\n\t\tthis._paused = false;\r\n\t\tthis._destroyed = false;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._notFoundHandler = null;\r\n\t\tthis._defaultHandler = null;\r\n\t\tthis._usePushState = !useHash && Navigo.isPushStateAvailable();\r\n\t\t//this._onLocationChange = this._onLocationChange.bind(this);\r\n\t\tthis._genericHooks = null;\r\n\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\r\n\t\tif (r) {\r\n\t\t\tthis.root = useHash ? r.replace(/\\/$/, '/' + this._hash) : r.replace(/\\/$/, '');\r\n\t\t} else if (useHash) {\r\n\t\t\tthis.root = this._cLoc().split(this._hash)[0].replace(/\\/$/, '/' + this._hash);\r\n\t\t}\r\n\t\r\n\t\tthis._listen();\r\n\t\tthis.updatePageLinks();\r\n\t}\r\n  \r\n\tnavigate(path:string, absolute:boolean = false):Navigo {\r\n\t\tlet to:string;\r\n\t\tpath = path || '';\r\n\t\tif (this._usePushState) {\r\n\t\t\tto = (!absolute ? this._getRoot() + '/' : '') + path.replace(/^\\/+/, '/');\r\n\t\t\tto = to.replace(/([^:])(\\/{2,})/g, '$1/');\r\n\t\t\tto = to.replace('/#test/', '/');\r\n\t\t\tthis._historyUpdate({}, '', to);\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t\telse if (typeof window !== 'undefined') {\r\n\t\t\tpath = path.replace(new RegExp('^' + this._hash), '');\r\n\t\t\tlet {location} = window;\r\n\t\t\tlocation.href = location.href\r\n\t\t\t\t.replace(/#$/, '')\r\n\t\t\t\t.replace(new RegExp(this._hash + '.*$'), '') + this._hash + path;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\tlet arg0 = args[0];\r\n\t\tlet arg1 = args[1];\r\n\t\tswitch (typeof arg0) {\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis._defaultHandler = { handler: arg0, hooks: arg1 };\r\n\t\t\t\tif (!this._notFoundHandler) {\r\n\t\t\t\t\tthis._notFoundHandler = this._defaultHandler;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'object':\r\n\t\t\t\tlet orderedRoutes = Object.keys(arg0).sort(Navigo.compareUrlDepth);\r\n\t\t\t\torderedRoutes.forEach(route => this.on(route, arg0[route]));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tif (args.length < 2) break;\r\n\t\t\t\tif (arg0 === '/') {\r\n\t\t\t\t\tthis._defaultHandler = { \r\n\t\t\t\t\t\thandler: typeof arg1 === 'object'? arg1.uses : arg1, \r\n\t\t\t\t\t\thooks: args[2],\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tthis._add(arg0, arg1, args[2]);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\toff(handler:RouteFunc):Navigo {\r\n\t\tif (this._defaultHandler !== null && handler === this._defaultHandler.handler) {\r\n\t\t\tthis._defaultHandler = null;\r\n\t\t}\r\n\t\telse if (this._notFoundHandler !== null && handler === this._notFoundHandler.handler) {\r\n\t\t\tthis._notFoundHandler = null;\r\n\t\t}\r\n\t\tthis._routes = this._routes.reduce((result, r) => {\r\n\t\t\tif (r.handler !== handler) result.push(r);\r\n\t\t\treturn result;\r\n\t\t}, []);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnotFound(handler:RouteFunc, hooks:Hooks):Navigo {\r\n\t\tthis._notFoundHandler = { handler, hooks };\r\n\t\treturn this;\r\n\t}\r\n\r\n\tresolve(current?:string) {\r\n\t\tlet c = current || this._cLoc();\r\n\t\tlet root = this._getRoot();\r\n\t\tlet url = c.replace(root, '');\r\n\t\r\n\t\tif (this._useHash) {\r\n\t\t\tconst exp = '^\\\\/';  // 单\\，编译报错 ^\\/\r\n\t\t\turl = url.replace(new RegExp(exp + this._hash), '/');\r\n\t\t}\r\n\t\r\n\t\tlet GETParameters = Navigo.extractGETParameters(current || this._cLoc());\r\n\t\tlet onlyURL = Navigo.getOnlyURL(url, this._useHash, this._hash);\r\n\t\tif (onlyURL.startsWith('/') === false) {\r\n\t\t\tonlyURL = '/' + onlyURL;\r\n\t\t}\r\n\t\r\n\t\tif (this._paused) return false;\r\n\t\r\n\t\tif (\r\n\t\t\tthis._lastRouteResolved &&\r\n\t\t\tonlyURL === this._lastRouteResolved.url &&\r\n\t\t\tGETParameters === this._lastRouteResolved.query\r\n\t\t) {\r\n\t\t\tif (this._lastRouteResolved.hooks && this._lastRouteResolved.hooks.already) {\r\n\t\t\t\tthis._lastRouteResolved.hooks.already(this._lastRouteResolved.params);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\r\n\t\tlet matched = Navigo.match(onlyURL, this._routes);\r\n\t\r\n\t\tlet manageHooks = (handler:Handler) => {\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\thooks: handler.hooks\r\n\t\t\t\t\t};\r\n\t\t\t\t\thandler.handler(GETParameters);\r\n\t\t\t\t}, handler.hooks);\r\n\t\t\t}, this._genericHooks);\r\n\t\t}\r\n\r\n\t\tif (matched === false) {\r\n\t\t\tif (this._defaultHandler && (\r\n\t\t\t\tonlyURL === '' ||\r\n\t\t\t\tonlyURL === '/' ||\r\n\t\t\t\tonlyURL === this._hash ||\r\n\t\t\t\tNavigo.isHashedRoot(onlyURL, this._useHash, this._hash)\r\n\t\t\t)) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\t\thooks: this._defaultHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._defaultHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._defaultHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._defaultHandler);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse if (this._notFoundHandler) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters,\r\n\t\t\t\t\t\t\thooks: this._notFoundHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._notFoundHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._notFoundHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._notFoundHandler);\r\n\t\t\t}\r\n\t\t\treturn false;\t\r\n\t\t}\r\n\t\tlet m = matched;\r\n\t\tif (m) {\r\n\t\t\tthis._callLeave();\r\n\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\turl: onlyURL,\r\n\t\t\t\tquery: GETParameters,\r\n\t\t\t\thooks: m.route.hooks,\r\n\t\t\t\tparams: m.params,\r\n\t\t\t\tname: m.route.name\r\n\t\t\t};\r\n\t\t\tlet handler = m.route.handler;\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tm.route.route instanceof RegExp ?\r\n\t\t\t\t\thandler(...(m.match.slice(1, m.match.length))) :\r\n\t\t\t\t\thandler(m.params, GETParameters);\r\n\t\t\t\t}, m.route.hooks, m.params, this._genericHooks);\r\n\t\t\t}, this._genericHooks, m.params);\r\n\t\t\treturn m;\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis._routes = [];\r\n\t\tthis._destroyed = true;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._genericHooks = null;\r\n\t\tclearTimeout(this.timout);\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\twindow.removeEventListener('popstate', this._onLocationChange);\r\n\t\t\twindow.removeEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t}\r\n\r\n\tupdatePageLinks() {\r\n\t\t//var self = this;\r\n\t\tif (typeof document === 'undefined') return;\r\n\t\t\tthis._findLinks().forEach(link => {\r\n\t\t\tif (!link.hasListenerAttached) {\r\n\t\t\t\tlink.addEventListener('click', (e: any) => {\r\n\t\t\t\t\t// e: React.MouseEvent<HTMLElement>\r\n\t\t\t\t\tif((e.ctrlKey || e.metaKey) && e.currentTarget.tagName.toLowerCase() === 'a'){ return false; }\r\n\t\t\t\t\tvar location = this.getLinkPath(link);\r\n\t\t\r\n\t\t\t\t\tif (!this._destroyed) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tthis.navigate(location.replace(/\\/+$/, '').replace(/^\\/+/, '/'));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tlink.hasListenerAttached = true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgenerate(name:string, data:any = {}) {\r\n\t\tlet result = this._routes.reduce((result, route) => {\r\n\t\t\tif (route.name === name) {\r\n\t\t\t\tresult = route.route.toString();\r\n\t\t\t\tfor (let key in data) {\r\n\t\t\t\t\tresult = result.replace(':' + key, data[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}, '');\r\n\t\r\n\t\treturn this._useHash ? this._hash + result : result;\r\n\t}\r\n\r\n\tlink(path:string) {\r\n\t\treturn this._getRoot() + path;\r\n\t}\r\n\r\n\tpause(status:boolean = true) {\r\n\t\tthis._paused = status;\r\n\t\tif (status) {\r\n\t\t\tthis._historyUpdateMethod = 'replaceState';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\t}\r\n\t}\r\n\r\n\tresume() {\r\n\t\tthis.pause(false);\r\n\t}\r\n\r\n\thistoryAPIUpdateMethod(value:'pushState' | 'replaceState') {\r\n\t\tif (typeof value === 'undefined') return this._historyUpdateMethod;\r\n\t\tthis._historyUpdateMethod = value;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tdisableIfAPINotAvailable() {\r\n\t\tif (!Navigo.isPushStateAvailable()) {\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tlastRouteResolved() {\r\n\t\treturn this._lastRouteResolved;\r\n\t}\r\n\r\n\tgetLinkPath(link:any) {\r\n\t\treturn link.getAttribute('href');\r\n\t}\r\n\r\n\thooks(hooks:Hooks) {\r\n\t\tthis._genericHooks = hooks;\r\n\t}\r\n\r\n\tprivate _add(route:string|RegExp, handler:RouteFunc|NamedRoute, hooks:Hooks) {\r\n\t\tif (typeof route === 'string') {\r\n\t\t\troute = encodeURI(route);\r\n\t\t}\r\n\t\tthis._routes.push(\r\n\t\t\ttypeof handler === 'object' ?\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler: handler.uses,\r\n\t\t\t\tname: handler.as,\r\n\t\t\t\thooks: hooks || handler.hooks\r\n\t\t\t} \r\n\t\t\t:\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler, \r\n\t\t\t\tname: undefined,\r\n\t\t\t\thooks,\r\n\t\t\t}\r\n\t\t);\r\n\t\treturn this._add;\r\n\t}\r\n\r\n\tprivate _historyUpdate(data:any, title:string, url?:string) {\r\n\t\tswitch (this._historyUpdateMethod) {\r\n\t\t\tdefault: throw Error('unknow history method ' + this._historyUpdateMethod);\r\n\t\t\tcase 'pushState': window.history.pushState(data, title, url); return;\r\n\t\t\tcase 'replaceState': window.history.replaceState(data, title, url); return;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _getRoot() {\r\n\t\tif (this.root === null) {\r\n\t\t\tlet cLoc = this._cLoc();\r\n\t\t\tlet cLocRoot = cLoc.split('?')[0];\r\n\t\t\tthis.root = Navigo.root(cLocRoot, this._routes);\r\n\t\t}\r\n\t\tlet root = this.root.replace('#test', '');\r\n\t\treturn root;\r\n\t}\r\n\r\n\tprivate _listen() {\r\n\t\tif (this._usePushState) {\r\n\t\t\twindow.addEventListener('popstate', this._onLocationChange);\r\n\t\t}\r\n\t\telse if (Navigo.isHashChangeAPIAvailable()) {\r\n\t\t\twindow.addEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet cached = this._cLoc();\r\n\t\r\n\t\t\tlet check = () => {\r\n\t\t\t\tlet current = this._cLoc();\r\n\t\t\t\tif (cached !== current) {\r\n\t\t\t\t\tcached = current;\r\n\t\t\t\t\tthis.resolve();\r\n\t\t\t\t}\r\n\t\t\t\tif (this.timout) clearTimeout(this.timout);\r\n\t\t\t\tthis.timout = setTimeout(check, 200);\r\n\t\t\t};\r\n\t\t\tcheck();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _cLoc() {\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\t//if (typeof window.__NAVIGO_WINDOW_LOCATION_MOCK__ !== 'undefined') {\r\n\t\t\t//\treturn window.__NAVIGO_WINDOW_LOCATION_MOCK__;\r\n\t\t\t//}\r\n\t\t\tlet {href} = window.location;\r\n\t\t\treturn Navigo.cleanUrl(href);\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate _findLinks() {\r\n\t\treturn [].slice.call(document.querySelectorAll('[data-navigo]'));\r\n\t}\r\n\r\n\tprivate _onLocationChange = () => {\r\n\t\tconsole.log('_onLocationChange');\r\n\t\tthis.resolve();\r\n\t}\r\n\r\n\tprivate _callLeave() {\r\n\t\tconst lastRouteResolved = this._lastRouteResolved;\t\r\n\t\tif (lastRouteResolved) {\r\n\t\t\tlet {params, hooks} = lastRouteResolved;\r\n\t\t\tif (hooks) {\r\n\t\t\t\tif (hooks.leave) {\r\n\t\t\t\t\thooks.leave(params);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","import jwtDecode from 'jwt-decode';\r\n\r\nexport interface Unit {\r\n    id: number;\r\n    name: string;\r\n}\r\n\r\nexport interface Guest {\r\n    id: number;             // id = 0\r\n    guest: number;\r\n    token: string;\r\n}\r\n\r\nexport interface User extends Guest {\r\n    id: number;\r\n    name: string;\r\n    nick?: string;\r\n\ticon?: string;\r\n\troles?: {[uq:string]: string[]}\r\n}\r\n\r\nexport function decodeUserToken(token: string): User {\r\n    let ret:any = jwtDecode(token);\r\n    let user: User = {\r\n        id: ret.id,\r\n        name: ret.name,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return user;\r\n}\r\n\r\nexport function decodeGuestToken(token: string): Guest {\r\n    let ret:any = jwtDecode(token);\r\n    let guest: Guest = {\r\n        id: 0,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return guest;\r\n}\r\n","const ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\nconst ID_LENGTH = 8;\r\n\r\nexport function uid():string {\r\n    let len = ALPHABET.length;\r\n    let rtn = '';\r\n    for (let i = 0; i < ID_LENGTH; i++) {\r\n        rtn += ALPHABET.charAt(Math.floor(Math.random() * len));\r\n    }\r\n    return rtn;\r\n}\r\n","import { env } from './env';\r\n\r\nexport class LocalData {\r\n    user = env.localDb.child('user');\r\n    guest = env.localDb.child('guest');\r\n    unit = env.localDb.child('unit');\r\n\r\n    private _user:string;\r\n    private _guest:string;\r\n    private _unit:string;\r\n    readToMemory() {\r\n        this._user = this.user.get();\r\n        this._guest = this.guest.get();\r\n        this._unit = this.unit.get();\r\n    }\r\n    saveToLocalStorage() {\r\n        this.user.set(this._user);\r\n        this.guest.set(this._guest);\r\n        this.unit.set(this._unit);\r\n    }\r\n\r\n    logoutClear() {\r\n        [\r\n            this.user,\r\n            this.unit,\r\n        ].forEach(d => d.remove());\r\n    }\r\n}\r\n","export function getObjPropIgnoreCase(obj:any, prop:string):any {\r\n\tif (!obj) return;\r\n\tif (!prop) return;\r\n\tlet keys = Object.keys(obj);\r\n\tprop = prop.toLowerCase();\r\n\tfor (let key of keys) {\r\n\t\tif (key.toLowerCase() === prop) return obj[key];\r\n\t}\r\n\treturn;\r\n}\r\n","export function capitalCase(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\treturn parts.map(v => firstCharUppercase(v)).join('_');\r\n}\r\n\r\nexport function camelCase(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\tlet len = parts.length;\r\n\tparts[0] = firstCharLowercase(parts[0]);\r\n\tfor (let i=1; i<len; i++) {\r\n\t\tparts[1] = firstCharUppercase(parts[1]);\r\n\t}\r\n\treturn parts.join('_');\r\n}\r\n\r\nconst aCode = 'a'.charCodeAt(0);\r\nconst zCode = 'z'.charCodeAt(0);\r\nfunction firstCharUppercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= aCode && c <= zCode) {\r\n\t\treturn String.fromCharCode(c - 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\nconst ACode = 'A'.charCodeAt(0);\r\nconst ZCode = 'Z'.charCodeAt(0);\r\nfunction firstCharLowercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= ACode && c <= ZCode) {\r\n\t\treturn String.fromCharCode(c + 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\n","\r\nexport const mobileRegex = /^[0-9]*$/;\r\nexport const emailRegex = /\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*/;\r\n// /^([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/\r\n\r\nexport const EmailFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '电子邮件格式错误';\r\n}\r\n\r\nexport const MobileFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '手机格式错误';\r\n}\r\n","import _ from 'lodash';\r\nimport { resLang, inputRes, InputRes } from 'tonwa-core';\r\n\r\nexport abstract class Rule {\r\n    abstract check(defy: string[], value: any): void;\r\n}\r\n\r\n//export type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\nexport type FieldRule = (value: any) => string[] | string;\r\n\r\nconst defaultInputRes: InputRes = resLang<InputRes>(inputRes);\r\n\r\nexport class RuleCustom extends Rule {\r\n    private func: FieldRule;\r\n    constructor(func: FieldRule) {\r\n        super();\r\n        this.func = func;\r\n    }\r\n    check(defy: string[], value: any) {\r\n        let ret = this.func(value);\r\n        if (ret === undefined) return;\r\n        switch (typeof ret) {\r\n            case 'undefined': return;\r\n            case 'string': defy.push(ret as string); return;\r\n            default: defy.push(...ret); return;\r\n        }\r\n    }\r\n}\r\n\r\nexport abstract class RulePredefined extends Rule {\r\n    protected res: InputRes;\r\n    constructor(res?: InputRes) {\r\n        super();\r\n        this.res = res ?? defaultInputRes;\r\n    }\r\n}\r\n\r\nexport class RuleRequired extends RulePredefined {\r\n    check(defy: string[], value: any) {\r\n        switch (typeof value) {\r\n            default:\r\n            case 'boolean': return;\r\n            case 'object':\r\n                if (value !== null) return;\r\n                break;\r\n            case 'string':\r\n                if ((value as string).trim().length > 0) return;\r\n                break;\r\n            case 'number':\r\n                if (isNaN(value as number) === false) return;\r\n                break;\r\n            case 'undefined':\r\n                break;\r\n        }\r\n        defy.push(this.res.required);\r\n    }\r\n}\r\n\r\nexport class RuleNum extends RulePredefined {\r\n    private minMsg: _.TemplateExecutor;\r\n    private maxMsg: _.TemplateExecutor;\r\n    protected min: number;\r\n    protected max: number\r\n    constructor(res: InputRes, min?: number, max?: number) {\r\n        super(res);\r\n        this.minMsg = _.template(this.res.min);\r\n        this.maxMsg = _.template(this.res.max);\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    check(defy: string[], value: any) {\r\n        if (value === undefined || value === null) return;\r\n        let n = Number(value);\r\n        if (isNaN(n) === true) {\r\n            defy.push(this.res.number);\r\n        }\r\n        else {\r\n            this.checkMore(defy, n);\r\n        }\r\n    }\r\n\r\n    protected checkMore(defy: string[], value: number) {\r\n        if (this.min !== undefined && Number(value) < this.min) {\r\n            defy.push(this.minMsg({ min: this.min }));\r\n        }\r\n        if (this.max !== undefined && Number(value) > this.max) {\r\n            defy.push(this.maxMsg({ max: this.max }));\r\n        }\r\n    }\r\n}\r\n\r\nexport class RuleInt extends RuleNum {\r\n    protected checkMore(defy: string[], n: number) {\r\n        super.checkMore(defy, n);\r\n        if (Number.isInteger(n) === false) {\r\n            defy.push(this.res.integer);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiItem } from '../../schema';\r\nimport { ChangingHandler, ChangedHandler } from '../../../ui';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { ItemSchema } from '../../schema';\r\nimport { Rule, RuleRequired, RuleCustom, FieldRule } from '../../inputRules';\r\nimport { computed, makeObservable, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Widget {\r\n    name: string;\r\n    protected context: Context;\r\n    protected fieldProps:FieldProps;\r\n    protected children: React.ReactNode;\r\n    protected _itemSchema: ItemSchema;\r\n    protected _ui: UiItem;\r\n\tprotected defaultValue: any;\r\n    protected rules: Rule[];\r\n    protected readOnly:boolean;\r\n\t\r\n\tdisabled:boolean = false;\r\n    errors: string[] = [];\r\n    contextErrors: string[] = [];\r\n    get hasError():boolean {return (this.errors.length + this.contextErrors.length)>0}\r\n    visible:boolean = null;\r\n\tvalue: any = null;\r\n\r\n    constructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tmakeObservable(this, {\r\n\t\t\terrors: observable,\r\n\t\t\tcontextErrors: observable,\r\n\t\t\thasError: computed,\r\n\t\t\tvisible: observable,\r\n\t\t\tvalue: observable,\r\n\t\t\tdisabled: observable,\r\n\t\t\tisOk: computed,\r\n\t\t});\r\n        this.context = context;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this._itemSchema = itemSchema;\r\n        this.fieldProps = fieldProps;\r\n        this.children = children;\r\n        this._ui = context.getUiItem(name);\r\n        if (this.ui === undefined) {\r\n            this.readOnly = false;\r\n            this.disabled = false;\r\n            this.visible = true;\r\n        }\r\n        else {\r\n            let {readOnly, disabled, visible} = this.ui;\r\n            this.readOnly = (readOnly === true);\r\n            this.disabled = (disabled === true);\r\n            this.visible = !(visible === false);\r\n        }\r\n        this.value = this.defaultValue =  context.getValue(name); //defaultValue;\r\n        // this.init();\r\n    }\r\n\r\n    protected get itemSchema(): ItemSchema {return this._itemSchema};\r\n    protected get ui(): UiItem {return this._ui};\r\n\r\n    init() {\r\n        this.rules = [];\r\n        if (this.itemSchema.required === true) {\r\n            this.rules.push(new RuleRequired(this.context.form.res));\r\n        }\r\n        this.buildRules();\r\n        if (this.ui === undefined) return;\r\n        let {rules} = this.ui;\r\n        if (rules === undefined) return;\r\n        if (Array.isArray(rules) === false) {\r\n            this.rules.push(new RuleCustom(rules as FieldRule));\r\n            return;\r\n        }\r\n        for (let rule of rules as FieldRule[]) {\r\n            this.rules.push(new RuleCustom(rule));\r\n        }\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    checkRules() {\r\n        let defy:string[] = [];\r\n        for (let r of this.rules) r.check(defy, this.value);\r\n        if (defy.length === 0) {\r\n            this.context.removeErrorWidget(this);\r\n        }\r\n        else {\r\n            this.context.addErrorWidget(this);\r\n            this.errors.push(...defy);\r\n        }\r\n    }\r\n\r\n    get isOk() {\r\n        return this.errors.length ===0;\r\n    }\r\n\r\n    setError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.errors.push(err);\r\n        else this.errors.push(...err);\r\n    }\r\n\r\n    setContextError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.contextErrors.push(err);\r\n        else this.contextErrors.push(...err);\r\n    }\r\n\r\n    clearError() {\r\n        this.errors.splice(0);\r\n    }\r\n\r\n    clearContextError() {\r\n        this.contextErrors.splice(0);\r\n    }\r\n\r\n    protected parse(value:any):any {return value}\r\n\r\n    protected setElementValue(value:any) {}\r\n    protected setDataValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        this.context.initData[this.name] = this.value = this.parse(value);\r\n    }\r\n\r\n    setValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        this.changeValue(value, false);\r\n    }\r\n\r\n    getValue() {\r\n        return this.context.getValue(this.name);\r\n    }\r\n\r\n    getReadOnly():boolean {return this.readOnly}\r\n    getDisabled():boolean {return this.disabled}\r\n    getVisible():boolean {return this.visible}\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {\r\n\t\tthis.disabled = value;\r\n\t}\r\n    setVisible(value:boolean) {this.visible = value}\r\n\r\n    private isChanging: boolean;\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n\r\n    protected changeValue(newValue: any, fromElement: boolean) {\r\n        let prev = this.value;\r\n        let onChanging: ChangingHandler;\r\n        let onChanged: ChangedHandler;\r\n        if (this.ui !== undefined) {\r\n            onChanging = this.ui.onChanging;\r\n            onChanged = this.ui.onChanged;\r\n        }\r\n        let allowChange = true;\r\n        if (onChanging !== undefined) {\r\n            this.isChanging = true;\r\n            allowChange = onChanging(this.context, this.value, prev);\r\n            this.isChanging = false;\r\n        }\r\n        if (allowChange === true) {\r\n            this.setDataValue(newValue);\r\n            if (fromElement !== true) this.setElementValue(newValue);\r\n            if (onChanged !== undefined) {\r\n                this.isChanging = true;\r\n                onChanged(this.context, this.value, prev);\r\n                this.isChanging = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected get className():string {\r\n        let fieldClass:string;\r\n        if (this.context.inNode === false) fieldClass = 'form-control';\r\n        return classNames(fieldClass, this.context.form.FieldClass, this.ui && this.ui.className);\r\n    }\r\n\r\n    protected abstract render():JSX.Element;\r\n\r\n    protected renderBody():JSX.Element {\r\n        let elDiscription;\r\n        if (this.hasError === false && this.ui) {\r\n            let {discription, discriptionClassName} = this.ui;\r\n            if (discriptionClassName === undefined) discriptionClassName = 'small text-muted';\r\n            elDiscription = <span className={discriptionClassName}>\r\n                {discription}\r\n            </span>;\r\n        }\r\n        return <>\r\n            {this.render()}\r\n            {elDiscription}\r\n        </>;\r\n    }\r\n\r\n    container = observer(():JSX.Element => {\r\n        if (this.visible === false) return null;\r\n        let {form, inNode} = this.context;\r\n        if (inNode === true) return this.render();\r\n        let label:any = this.label;\r\n        if (this.itemSchema.required === true && form.props.requiredFlag !== false) {\r\n            if (label !== null) label = <>{label}&nbsp;<span className=\"text-danger\">*</span></>;\r\n        }\r\n        return form.FieldContainer(label, this.renderBody());\r\n    })\r\n\r\n    protected get label():string {\r\n        let label:any;\r\n        if (this.ui === undefined) {\r\n            label = this.name;\r\n        }\r\n        else {\r\n            let uiLabel = this.ui.label;\r\n            if (uiLabel === null) label = null;\r\n            else label = uiLabel || this.name;\r\n        }\r\n        return label;\r\n    }\r\n\r\n    protected renderTemplet():JSX.Element | undefined {\r\n        if (this.children !== undefined) {\r\n            return <>{this.children}</>;\r\n        }\r\n        if (this.ui === undefined) return undefined;\r\n        let {Templet} = this.ui;\r\n        if (typeof Templet === 'function') return Templet(this.value);\r\n        return Templet;\r\n    }\r\n\r\n    protected renderErrors() {\r\n        let errorList:string[] = [...this.errors, ...this.contextErrors];\r\n        if (errorList.length === 0) return null;\r\n        let {inNode} = this.context;\r\n        let tag = inNode === true? 'span' : 'div';\r\n        return errorList.map(err => React.createElement(tag, \r\n            {\r\n                key: err, \r\n                className: 'text-danger d-inline-block my-2 ms-3'\r\n            },\r\n            <><i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}</>\r\n        ));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { makeObservable, observable, runInAction } from 'mobx';\r\nimport { UiTextItem, StringSchema, ItemSchema } from '../../schema';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\nimport { Widget } from './widget';\r\n\r\nexport class TextWidget extends Widget {\r\n    protected inputType = 'text';\r\n    protected get ui(): UiTextItem {return this._ui as UiTextItem};\r\n    protected input: HTMLInputElement;\r\n    hasFocus: boolean = false;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\thasFocus: observable,\r\n\t\t})\r\n\t}\r\n\r\n    protected setElementValue(value:any) {\r\n        if (this.input === null) return;\r\n        this.input.value = value;\r\n    }\r\n    protected get placeholder() {\r\n\t\tif (this.ui) {\r\n\t\t\tlet {placeholder} = this.ui;\r\n\t\t\tif (placeholder) return placeholder;\r\n\t\t\tlet {label} = this.ui;\r\n\t\t\tif (label) return label;\r\n\t\t}\r\n\t\treturn this.name\r\n\t}\r\n    protected onKeyDown = async (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n        this.internalOnKeyDown(evt);\r\n        if (evt.keyCode !== 13) return;\r\n        let {onEnter} = this.context.form.props;\r\n        if (onEnter === undefined) return;\r\n\r\n        this.changeValue(evt.currentTarget.value, true);\r\n\r\n        //this.checkRules();\r\n        //this.context.checkContextRules();\r\n        this.input.blur();\r\n\r\n        let ret = await onEnter(this.name, this.context);\r\n        if (ret !== undefined) {\r\n            this.context.setError(this.name, ret);\r\n        }\r\n    }\r\n\r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n    }\r\n\r\n    protected onBlur = (evt: React.FocusEvent<any>) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.onInputChange(evt);\r\n\t\t\tthis.checkRules();\r\n\t\t\tthis.context.checkContextRules();\r\n\t\t\tthis.hasFocus = false;\r\n\t\t});\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.context.removeErrorWidget(this);\r\n\t\t\tthis.context.clearErrors();\r\n\t\t\tthis.hasFocus = true;\r\n\t\t});\r\n\t\tsetTimeout(() => {\r\n\t\t\tconsole.log('focus and select');\r\n\t\t\tthis.input.focus();\r\n\t\t\tthis.input.select();\r\n\t\t}, 10)\r\n    }\r\n    protected onChange(evt: React.ChangeEvent<any>) {\r\n\t\tthis.onInputChange(evt);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.readOnly = this.readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.disabled = this.disabled = value;\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {\r\n            //'form-control': true,\r\n        };\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, cn)}\r\n            type={this.inputType}\r\n            defaultValue={this.value}\r\n            onChange={(evt: React.ChangeEvent<any>) => this.onChange(evt)}\r\n            placeholder={typeof this.placeholder === 'string'? this.placeholder : undefined}\r\n            readOnly={this.readOnly}\r\n            disabled={this.disabled}\r\n            onKeyDown = {this.onKeyDown}\r\n            onFocus = {this.onFocus}\r\n            onBlur={this.onBlur}\r\n            maxLength={(this.itemSchema as StringSchema).maxLength} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextAreaItem } from '../../schema';\r\nimport { StringSchema } from '../../schema';\r\n\r\nexport class TextAreaWidget extends Widget {\r\n    protected get itemSchema(): StringSchema {return this._itemSchema as StringSchema};\r\n    protected input: HTMLTextAreaElement;\r\n    protected get ui(): UiTextAreaItem {return this._ui as UiTextAreaItem};\r\n\r\n    protected setElementValue(value:any) {this.input.value = value}\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.setValue(evt.currentTarget.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n\tprotected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n        this.context.checkContextRules();\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {};\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <>\r\n\t\t\t<textarea ref={(input) => this.input=input}\r\n\t\t\t\tonBlur={this.onBlur} \r\n\t\t\t\tonFocus={this.onFocus}\r\n                className={classNames(this.className, cn)}\r\n                rows={this.ui && this.ui.rows}\r\n                maxLength={this.itemSchema.maxLength}\r\n                defaultValue={this.defaultValue} onChange={this.onInputChange} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class PasswordWidget extends TextWidget {\r\n    protected inputType = 'password';\r\n}\r\n\r\nexport class UrlWidget extends TextWidget {\r\n    protected inputType = 'url';\r\n}\r\n\r\nexport class EmailWidget extends TextWidget {\r\n    protected inputType = 'email';\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\nimport { NumBaseSchema } from '../../schema';\r\nimport { RuleInt, RuleNum } from '../../inputRules';\r\n\r\nexport class NumberWidget extends TextWidget {\r\n    protected inputType = 'number';\r\n    protected get itemSchema(): NumBaseSchema {return this._itemSchema as NumBaseSchema};\r\n\r\n    protected buildRules() {\r\n        super.buildRules();\r\n        let res = this.context.form.res;\r\n        let {min, max} = this.itemSchema;\r\n        this.rules.push(\r\n            this.itemSchema.type === 'integer'?\r\n            new RuleInt(res, min, max) :\r\n            new RuleNum(res, min, max)\r\n        );\r\n    }\r\n\r\n    protected parse(value:any):any {\r\n        switch (typeof value) {\r\n            default: return;\r\n            case 'undefined': return;\r\n            case 'number': return value;\r\n            case 'string':\r\n                if ((value as string).trim().length === 0) return;\r\n                return Number(value);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { NumberWidget } from './numberWidget';\r\n\r\nexport class UpdownWidget extends NumberWidget {\r\n    protected inputType = 'number';\r\n\r\n    protected isValidKey(key:number):boolean {\r\n        return key===46 || key===8 || key===37 || key===39\r\n            || (key>=48 && key<=57)\r\n            || (key>=96 && key<=105)\r\n            || key===109 || key===189;\r\n    }\r\n    \r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n        let key = evt.keyCode;\r\n        window.event.returnValue = this.isValidKey(key);\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class DateWidget extends TextWidget {\r\n    protected inputType = 'date';\r\n}\r\n\r\nexport class DateTimeWidget extends TextWidget {\r\n    protected inputType = 'datetime';\r\n}\r\n\r\nexport class TimeWidget extends TextWidget {\r\n    protected inputType = 'time';\r\n}\r\n\r\nexport class MonthWidget extends TextWidget {\r\n    protected inputType = 'month';\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiCheckItem } from '../../schema';\r\n\r\nexport class CheckBoxWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiCheckItem {return this._ui as UiCheckItem};\r\n    protected trueValue: any;\r\n    protected falseValue: any;\r\n\r\n    init() {\r\n        super.init();\r\n        if (this.ui !== undefined) {\r\n            let {trueValue, falseValue} = this.ui;\r\n            if (trueValue === undefined) this.trueValue = true;\r\n            else this.trueValue = trueValue;\r\n            if (falseValue === undefined) this.falseValue = false;\r\n            else this.falseValue = falseValue;\r\n        }\r\n        else {\r\n            this.trueValue = true;\r\n            this.falseValue = false;\r\n        }\r\n    }\r\n    protected setElementValue(value:any) {\r\n        this.input.checked = value === this.trueValue;\r\n    }\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let v = evt.target.checked === true? this.trueValue : this.falseValue;\r\n        this.setDataValue(v);\r\n    }\r\n\r\n    protected onClick = () => {\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let cn = classNames(this.className, 'form-check-inline p-0');\r\n        let input = <input\r\n            ref={(input)=>this.input = input}\r\n            className={'align-self-center'}\r\n            type=\"checkbox\"\r\n            defaultChecked={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            onClick={this.onClick} />;\r\n        if (this.context.inNode === true) {\r\n            return <label className={cn}>\r\n                {input} {(this.ui&&this.ui.label) || this.name}\r\n            </label>\r\n        }\r\n        else {\r\n            return <div className={cn}>\r\n                <label className=\"w-100 h-100 mb-0 d-flex justify-content-center\">{input}</label>\r\n            </div>;\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Widget } from './widget';\r\nimport { ItemSchema, UiSelect } from '../../schema';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\n\r\nexport class SelectWidget extends Widget {\r\n    protected select: HTMLSelectElement;\r\n    protected get ui(): UiSelect {return this._ui as UiSelect};\r\n    readOnly: boolean = false;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\treadOnly: observable,\r\n\t\t})\r\n\t}\r\n\r\n    protected setElementValue(value:any) {this.select.value = value}\r\n    protected onInputChange = (evt:React.ChangeEvent<HTMLSelectElement>) => {\r\n        this.setDataValue(evt.target.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.select.disabled = this.readOnly = !value}\r\n    setDisabled(value:boolean) {this.select.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        if (this.readOnly === true) {\r\n            let option = this.ui.list.find(v => v.value === this.value);\r\n            let title = (option === undefined)? '(???)' : option.title;\r\n            return <span className=\"form-control w-min-6c\">{title}</span>;\r\n        }\r\n        return <select\r\n            ref={(select)=>this.select = select}\r\n            className={classNames(this.className, 'form-control')}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}>\r\n            {this.ui.list.map((v,index) => {\r\n                let {title, value} = v;\r\n                let cn:string;\r\n                //if (value === undefined || value === null) cn = 'text-light small';\r\n                //else cn = 'text-danger';\r\n                return <option className={cn} key={index} value={value}>{title || value}</option>\r\n            })}\r\n        </select>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n//import { TextWidget } from './textWidget';\r\nimport { Widget } from './widget';\r\nimport { UiRadio } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class RadioWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiRadio {return this._ui as UiRadio};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n    }\r\n\r\n    /*\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n    */\r\n\r\n    render() {\r\n        let {defaultValue, list} = this.ui;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n        return <span className={cn} style={radioStyle}>\r\n                {list.map((v,index) => {\r\n                    let {value, title} = v;\r\n                    let name = this.name;\r\n                    if (rowKey !== undefined) name += '-' + rowKey;\r\n                    return <label key={index} className=\"form-radio-inline\">\r\n                        <input ref={input=>this.inputs[index]=input} type=\"radio\" name={name}\r\n                            value={value} defaultChecked={(this.defaultValue || defaultValue)===value}\r\n                            onChange={this.onInputChange} />\r\n                        {title || value}\r\n                    </label>;\r\n                    //</span>\r\n                })}\r\n            </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiRange } from '../../schema';\r\nimport { Widget } from './widget';\r\n\r\nexport class RangeWidget extends Widget {\r\n    protected inputType = 'range';\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiRange {return this._ui as UiRange};\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        let {min, max, step} = this.ui;\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, 'form-control', 'w-min-6c')}\r\n            type={this.inputType}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            max={max}\r\n            min={min}\r\n            step={step}\r\n            />\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiIdItem, TempletType } from '../../schema';\r\nimport { runInAction } from 'mobx';\r\n\r\nconst none = <small className=\"text-muted\">[无]</small>;\r\n\r\nexport class IdWidget extends Widget {\r\n    protected get ui(): UiIdItem {return this._ui as UiIdItem};\r\n\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {this.disabled = value}    \r\n\r\n    protected onClick = async () => {\r\n        let pickId = this.ui && this.ui.pickId;\r\n        if (pickId === undefined) {\r\n            alert('no pickId defined!');\r\n            return;\r\n        }\r\n\t\tlet id = await pickId(this.context, this.name, this.value);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.setDataValue(id);\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.clearContextError();\r\n\t\t\tthis.checkRules();\t\r\n\t\t});\r\n    }\r\n\r\n\tsetValue(value:any) {\r\n\t\tsuper.setValue(value);\r\n\t}\r\n\r\n    render() {\r\n        let placeholder:string|JSX.Element, Templet: TempletType;\r\n        if (this.ui !== undefined) {\r\n            placeholder = this.ui.placeholder;\r\n            Templet = this.ui.Templet;\r\n        }\r\n        let cn:any = {\r\n            'form-control': true,\r\n            'required-item': this.itemSchema.required === true,\r\n            'cursor-pointer': true,\r\n            'is-invalid': this.hasError,\r\n        };\r\n        let content;\r\n        if (this.value === undefined || this.value === null) {\r\n            content = placeholder || none;\r\n            cn['text-muted'] = true;\r\n        }\r\n        else if (Templet === undefined) {\r\n            let c: any;\r\n            if (this.value === null) {\r\n                c = 'null';\r\n            }\r\n            else {\r\n                switch (typeof this.value) {\r\n                    case 'undefined': c = none; break;\r\n                    case 'object': c = (this.value as any).id; break;\r\n                    default: c = this.value; break;\r\n                }\r\n            }\r\n            content = <>{c}</>;\r\n        }\r\n        else if (typeof Templet === 'function') {\r\n            content = Templet(this.value);\r\n        }\r\n        else {\r\n            content = Templet;\r\n        }\r\n        return <>\r\n            <div className={classNames(cn)} onClick={this.onClick}>{content}</div>\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { DataType } from '../../schema';\r\nimport { UiType } from '../../schema';\r\n\r\nexport const Unknown = (dataType:DataType, uiType:UiType, dataTypes:DataType[]) => {\r\n    return <span className=\"text-danger\">!!data type {dataType} only support {(dataTypes || []).join(', ')}, can't use ui {uiType}!!</span>;\r\n};\r\n","import * as React from 'react';\r\nimport { UiButton, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { Widget } from './widget';\r\nimport { observer } from 'mobx-react';\r\nimport { runInAction } from 'mobx';\r\n\r\nexport class ButtonWidget extends Widget {\r\n    protected get ui(): UiButton {return this._ui as UiButton};\r\n\r\n    protected onClick = async () => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.clearContextError();\r\n\t\t})\r\n        let {name, type} = this.itemSchema;\r\n        if (type === 'submit') {\r\n\t\t\tawait this.context.submit(name);\r\n\t\t\treturn;\r\n        }\r\n        let {onButtonClick} = this.context.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${name} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(name, this.context);\r\n        if (ret === undefined) return;\r\n\t\trunInAction(() => {\r\n\t\t\tthis.context.setError(name, ret);\r\n\t\t});\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let {name, type} = this.itemSchema;\r\n        let Templet:TempletType, cn:string, caption:string|JSX.Element;\r\n        if (this.ui !== undefined) {\r\n            let {widget:widgetType} = this.ui;\r\n            if (widgetType !== 'button') return Unknown(type, widgetType, ['button']);\r\n            Templet = this.ui.Templet;\r\n            cn = this.ui.className;\r\n            caption = this.ui.label;\r\n        }\r\n        let {form, hasError} = this.context;\r\n        let context = this.context;\r\n        let disabled = (type==='submit' && hasError) || this.disabled;\r\n        let content:any;\r\n        if (this.children !== undefined) content = this.children;\r\n        else if (typeof Templet === 'function') content = Templet();\r\n        else if (Templet !== undefined) content = Templet;\r\n        else content = caption; \r\n        let button = <button \r\n            className={cn} \r\n            type=\"button\"\r\n            disabled={disabled}\r\n            onClick={this.onClick}>\r\n            {content || name}\r\n        </button>;\r\n        if (context.inNode === true) return <>{button}{this.renderErrors()}</>;\r\n        return <div className={form.ButtonClass}>\r\n            <div>{this.renderErrors()}</div>\r\n            {button}\r\n        </div>;\r\n    });\r\n    \r\n    protected get label():string {return null}\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Form } from './form';\r\nimport { UiSchema, UiArr, UiItem } from '../schema';\r\nimport { ArrSchema, ItemSchema } from '../schema';\r\nimport { Widget } from './widgets/widget';\r\n//import { ArrRow } from './arrRow';\r\nimport { observable, computed, makeObservable, runInAction } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\n\r\nexport abstract class Context {\r\n    private subContexts:{[name:string]:{[rowKey:string]:Context}};\r\n    readonly form: Form;\r\n    readonly uiSchema: UiSchema;\r\n    readonly initData: any;\r\n    readonly inNode: boolean;           // true: 在</> 流中定义Field\r\n    readonly widgets: {[name:string]: Widget} = {};\r\n    readonly rules: ContextRule[];\r\n\treadonly isRow: boolean;\r\n\t\r\n    errors: string[] = [];\r\n    errorWidgets:Widget[] = [];\r\n\r\n    constructor(form: Form, uiSchema: UiSchema, data: any, inNode: boolean, isRow: boolean) {\r\n\t\tmakeObservable(this, {\r\n\t\t\terrors: observable,\r\n\t\t\terrorWidgets: observable,\r\n\t\t\thasError: computed,\r\n\t\t});\r\n        this.form = form;\r\n        this.uiSchema = uiSchema;\r\n        this.initData = data;\r\n        this.inNode = inNode;\r\n        this.isRow = isRow;\r\n        if (uiSchema !== undefined) {\r\n            let {rules} = uiSchema;\r\n            if (rules !== undefined) {\r\n                this.rules = [];\r\n                if (Array.isArray(rules) === false)\r\n                    this.rules.push(rules as ContextRule);\r\n                else\r\n                    this.rules.push(...rules as ContextRule[]);\r\n            }\r\n        }\r\n    }\r\n\r\n    getArrRowContexts(arrName: string) {\r\n        if (this.subContexts === undefined) this.subContexts = {};\r\n        let arrRowContexts = this.subContexts[arrName];\r\n        if (arrRowContexts === undefined) this.subContexts[arrName] = arrRowContexts = {};\r\n        return arrRowContexts;\r\n    }\r\n\r\n    abstract get data():any;\r\n    abstract getItemSchema(itemName:string):ItemSchema;\r\n    abstract getUiItem(itemName:string):UiItem;\r\n    get arrName():string {return undefined}\r\n    getValue(itemName:string):any {return this.initData[itemName]}\r\n    setValue(itemName:string, value:any) {\r\n        this.initData[itemName] = value;\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setValue(value);\r\n    }\r\n    getDisabled(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) return widget.getDisabled();\r\n        return undefined;\r\n    }\r\n    setDisabled(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setDisabled(value);\r\n    }\r\n    getReadOnly(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getReadOnly();\r\n        return undefined;\r\n    }\r\n    setReadOnly(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setReadOnly(value);\r\n    }\r\n    getVisible(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getVisible();\r\n        return undefined;\r\n    }\r\n    setVisible(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setVisible(value);\r\n    }\r\n\r\n    async submit(buttonName: string) {\r\n        this.checkRules()\r\n        if (this.hasError === true) {\r\n            let err = '';\r\n            for (let ew of this.errorWidgets) {\r\n                err += ew.name + ':\\n' + ew.errors.join('\\n');\r\n            }\r\n            console.error(err);\r\n            return;\r\n        }\r\n        let {onButtonClick} = this.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${buttonName} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this);\r\n        if (ret === undefined) return;\r\n        this.setError(buttonName, ret);\r\n\r\n    }\r\n\r\n    checkFieldRules() {\r\n        for (let i in this.widgets) {\r\n            this.widgets[i].checkRules();\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                arrRowContexts[j].checkFieldRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    checkContextRules() {\r\n        this.clearErrors();\r\n        if (this.rules === undefined) return;\r\n        for (let rule of this.rules) {\r\n            let ret = rule(this);\r\n            if (ret === undefined) continue;\r\n            if (Array.isArray(ret) === true) {\r\n                this.errors.push(...ret as string[]);\r\n            }\r\n            else if (typeof ret === 'string') {\r\n                this.errors.push(ret as string);\r\n            }\r\n            else {\r\n                for (let i in ret as object) this.setError(i, (ret as any)[i]);\r\n            }\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                let rowContext = arrRowContexts[j];\r\n                rowContext.clearErrors();\r\n                rowContext.checkContextRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    setError(itemName:string, error:string) {\r\n\t\trunInAction(() => {\r\n\t\t\tlet widget = this.widgets[itemName];\r\n\t\t\tif (widget === undefined) return;\r\n\t\t\twidget.setContextError(error);\r\n\t\t\tthis.addErrorWidget(widget);\t\r\n\t\t})\r\n    }\r\n\r\n    clearContextErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tfor (let i in this.widgets) {\r\n\t\t\t\tlet widget = this.widgets[i];\r\n\t\t\t\tif (widget === undefined) continue;\r\n\t\t\t\twidget.clearContextError();\r\n\t\t\t}\t\r\n\t\t});\r\n    }\r\n\r\n    clearWidgetsErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tfor (let i in this.widgets) {\r\n\t\t\t\tlet widget = this.widgets[i];\r\n\t\t\t\tif (widget === undefined) continue;\r\n\t\t\t\twidget.clearError();\r\n\t\t\t}\t\r\n\t\t});\r\n    }\r\n\r\n    checkRules() {\r\n        this.clearErrors();\r\n        this.clearWidgetsErrors();\r\n        this.checkFieldRules();\r\n        if (this.hasError === true) return;\r\n        this.checkContextRules();\r\n    }\r\n\r\n    addErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos < 0) this.errorWidgets.push(widget);\r\n    }\r\n    removeErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos >= 0) this.errorWidgets.splice(pos, 1);\r\n    }\r\n\r\n    protected checkHasError():boolean {\r\n        let ret = (this.errorWidgets.length + this.errors.length) > 0;\r\n        if (ret === true) return true;\r\n        if (this.subContexts === undefined) return false;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                if (arrRowContexts[j].hasError === true) return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    get hasError():boolean {\r\n        return this.checkHasError();\r\n    };\r\n\r\n    clearErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.errors.splice(0);\r\n\t\t\tthis.errorWidgets.splice(0);\r\n\t\t\tthis.clearContextErrors();\t\r\n\t\t});\r\n    }\r\n\r\n    renderErrors = observer((): JSX.Element => {\r\n        let {errors} = this;\r\n        if (errors.length === 0) return null;\r\n        return <>\r\n            {errors.map(err => <span key={err} className=\"text-danger inline-block my-1 ms-3\">\r\n                <i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}\r\n            </span>)}\r\n        </>\r\n    });\r\n}\r\n\r\nlet rowKeySeed:number = 1;\r\nexport class RowContext extends Context {\r\n    readonly parentContext: Context;\r\n    readonly arrSchema: ArrSchema;\r\n    readonly rowKey: number;\r\n\treadonly data: any;\r\n    //readonly uiSchema: UiArr;\r\n\t\r\n    constructor(parentContext:Context, arrSchema: ArrSchema, data: any, inNode: boolean) {\r\n        let uiArr:UiArr;\r\n        let {uiSchema} = parentContext;\r\n        if (uiSchema !== undefined) {\r\n            let {items} = uiSchema;\r\n            if (items !== undefined) uiArr = items[arrSchema.name] as UiArr;\r\n        }\r\n        super(parentContext.form, uiArr, data, inNode, true);\r\n        this.parentContext = parentContext;\r\n        this.arrSchema = arrSchema;\r\n        this.rowKey = rowKeySeed++;\r\n        this.data = data;\r\n    }\r\n    getItemSchema(itemName:string):ItemSchema {return this.arrSchema.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        if (this.uiSchema === undefined) return undefined;\r\n        let {items} = this.uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName]\r\n    }\r\n    get arrName():string {return this.arrSchema.name}\r\n    clearErrors() {\r\n        super.clearErrors();\r\n        this.parentContext.clearErrors();\r\n    }\r\n\r\n    get parentData():any {return this.parentContext.data;}\r\n}\r\n\r\nexport class FormContext extends Context {\r\n    constructor(form:Form, inNode:boolean) {\r\n        super(form, form.uiSchema, form.data, inNode, false);\r\n    }\r\n    get data():any {return this.form.data}\r\n    getItemSchema(itemName:string):ItemSchema {return this.form.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        let {uiSchema} = this.form;\r\n        if (uiSchema === undefined) return undefined;\r\n        let {items} = uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName];\r\n    }\r\n}\r\n\r\nexport const ContextContainer = React.createContext<Context>({} as any);\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\n//import { ArrRow } from '../arrRow';\r\nimport { Context, RowContext, ContextContainer } from '../context';\r\nimport { ArrSchema } from '../../schema';\r\nimport { UiArr, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { factory } from './factory';\r\n\r\nexport const ArrComponent = observer((\r\n    {parentContext, arrSchema, children}:{parentContext: Context, arrSchema: ArrSchema, children: React.ReactNode}) => \r\n{\r\n    let {name, arr} = arrSchema;\r\n    let data = parentContext.initData[name] as any[];\r\n    let {form} = parentContext;\r\n    let arrRowContexts = parentContext.getArrRowContexts(name);\r\n\tlet ui = parentContext.getUiItem(name) as UiArr;\r\n\tlet {onDeleted, onRestored} = ui;\r\n    let arrLabel:string|JSX.Element = name;\r\n    let Templet:TempletType;\r\n    let selectable:boolean, deletable:boolean, restorable:boolean;\r\n    let {ArrContainer, RowContainer, RowSeperator, uiSchema} = form;\r\n    if (uiSchema !== undefined) {\r\n        let {selectable:formSelectable, deletable:formDeletable, restorable:formRestorable} = uiSchema;\r\n        if (selectable !== true) selectable = formSelectable;\r\n        if (deletable !== true) deletable = formDeletable;\r\n        if (restorable !== true) restorable = formRestorable;\r\n    }\r\n    if (ui !== undefined) {\r\n        let {widget:widgetType, label, \r\n            selectable:arrSelectable, deletable:arrDeletable, restorable:arrRestorable,\r\n            ArrContainer:ac, RowContainer:rc, RowSeperator:rs\r\n        } = ui;\r\n        if (arrSelectable !== undefined) selectable = arrSelectable;\r\n        if (arrDeletable !== undefined) deletable = arrDeletable;\r\n        if (arrRestorable !== undefined) restorable = arrRestorable;\r\n        if (ac !== undefined) ArrContainer = ac;\r\n        if (rc !== undefined) RowContainer = rc;\r\n        if (rs !== undefined) RowSeperator = rs;\r\n        Templet = ui.Templet;\r\n        if (widgetType !== 'arr') return Unknown(arrSchema.type, widgetType, ['arr']);\r\n        arrLabel = label || arrLabel;\r\n    }\r\n    let first = true;\r\n    return ArrContainer(arrLabel, <>\r\n        {data.map((row:any, index) => {\r\n            let rowContext: RowContext;\r\n            let rowContent: JSX.Element;\r\n            let sep = undefined;\r\n            if (first === false) sep = RowSeperator;\r\n            else first = false;\r\n            if (children !== undefined) {\r\n                rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                rowContent = <>{children}</>;\r\n            }\r\n            else {\r\n                let typeofTemplet = typeof Templet;\r\n                if (typeofTemplet === 'function') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = React.createElement(observer(Templet as React.StatelessComponent), row);\r\n                }\r\n                else if (typeofTemplet === 'object') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = Templet as JSX.Element;\r\n                }\r\n                else {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, false);\r\n                    rowContent = <>{\r\n                        arr.map((v, index) => {\r\n                            return <React.Fragment key={v.name}>\r\n                                {factory(rowContext, v, undefined)}\r\n                            </React.Fragment>\r\n                        })}\r\n                    </>;\r\n                }\r\n            }\r\n            let {rowKey} = rowContext;\r\n            arrRowContexts[rowKey] = rowContext;\r\n\r\n            let selectCheck:JSX.Element, deleteIcon:JSX.Element;\r\n            if (selectable === true) {\r\n                let onClick = (evt: React.MouseEvent<HTMLInputElement>)=>{\r\n                    let {checked} = (evt.target as HTMLInputElement);\r\n                    row.$isSelected = checked;\r\n                    let {$source} = row;\r\n                    if ($source !== undefined) $source.$isSelected = checked;\r\n                    rowContext.clearErrors();\r\n                }\r\n                selectCheck = <div className=\"form-row-checkbox\">\r\n                    <input type=\"checkbox\" onClick={onClick} defaultChecked={row.$isSelected} />\r\n                </div>;\r\n            }\r\n            let isDeleted = !(row.$isDeleted===undefined || row.$isDeleted===false);\r\n            if (deletable === true) {\r\n                let icon = isDeleted? 'fa-undo' : 'fa-trash';\r\n                let onDelClick = () => {\r\n                    if (restorable === true) {\r\n                        row.$isDeleted = !isDeleted;\r\n                        let {$source} = row;\r\n\t\t\t\t\t\tif ($source !== undefined) $source.$isDeleted = !isDeleted;\r\n\t\t\t\t\t\tif (onRestored) onRestored(row);\r\n                    }\r\n                    else {\r\n                        let p = data.indexOf(row);\r\n\t\t\t\t\t\tif (p>=0) data.splice(p, 1);\r\n\t\t\t\t\t\tif (onDeleted) onDeleted(row);\r\n                    }\r\n                    rowContext.clearErrors();\r\n                }\r\n                deleteIcon = <div className=\"form-row-edit text-info\" onClick={onDelClick}>\r\n                    <i className={classNames('fa', icon, 'fa-fw')} />\r\n                </div>;\r\n            }\r\n            let editContainer = selectable===true || deletable===true?\r\n                (content:any) => <fieldset disabled={isDeleted}><div className={classNames('d-flex', {'deleted':isDeleted, 'row-selected':row.$isSelected})}>\r\n                    {selectCheck}\r\n                    <div className={selectable===true && deletable===true? \"form-row-content\":\"form-row-content-1\"}>{content}</div>\r\n                    {deleteIcon}\r\n                </div></fieldset>\r\n                :\r\n                (content:any) => content;\r\n\r\n            return <ContextContainer.Provider key={rowKey} value={rowContext}>\r\n                {sep}\r\n                {RowContainer(editContainer(<><rowContext.renderErrors />{rowContent}</>))}\r\n            </ContextContainer.Provider>;\r\n        })}\r\n    </>);\r\n});\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { tonwa } from 'tonwa-core';\r\n//import { nav } from '../nav';\r\n\r\nexport interface ImageProps {\r\n\tsrc: string;\r\n\tclassName?: string;\r\n\tstyle?: React.CSSProperties;\r\n\taltImage?: string;\r\n}\r\n\r\n// src = .src, 表示fontawesome Icon\r\nexport function Image(props: ImageProps) {\r\n\tlet { className, style, src, altImage } = props;\r\n\tlet icon: string;\r\n\tif (src) {\r\n\t\tif (src.indexOf('.') !== 0) {\r\n\t\t\tif (src.startsWith(':') === true) {\r\n\t\t\t\tsrc = tonwa.resUrl + src.substr(1);\r\n\t\t\t}\r\n\t\t\treturn <img src={src} className={className} alt=\"img\"\r\n\t\t\t\tstyle={style}\r\n\t\t\t\tonError={evt => {\r\n\t\t\t\t\tif (altImage) evt.currentTarget.src = altImage;\r\n\t\t\t\t\telse evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n\t\t\t\t}} />;\r\n\t\t}\r\n\t\ticon = src.substr(1);\r\n\t}\r\n\telse {\r\n\t\ticon = 'file-o'\r\n\t}\r\n\treturn <span className={classNames(className, 'image-none')} style={style}>\r\n\t\t<i className={'fa fa-' + icon} />\r\n\t</span>;\r\n}\r\n","export function Loading() {\r\n    return <div className=\"d-flex h-100 align-items-center justify-content-center\">\r\n        <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />\r\n    </div>;\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-badge.css';\r\n\r\nexport interface BadgeProps {\r\n    className?: string;\r\n    badge?: string|number;\r\n    size?: 'xs' | 'sm' | 'lg';\r\n    color?: 'secondary'|'success'|'danger'|'primary'|'info'|'warning';\r\n    badgeAlign?: 'left'|'center'|'right';\r\n    badgeVertical?: 'top'|'middle'|'bottom';\r\n}\r\n\r\n@observer\r\nexport class Badge extends React.Component<BadgeProps> {\r\n    render() {\r\n        let {className, badge, size, color, badgeAlign, badgeVertical, children} = this.props;\r\n        let cn = classNames(\r\n            className,\r\n            'va-badge',\r\n            size && 'va-badge-'+size,\r\n            'va-badge-' + (color||'secondary'),\r\n            badgeAlign && 'va-badg-'+badgeAlign,\r\n            badgeVertical && 'va-badg-'+badgeVertical,\r\n        );\r\n        let b;\r\n        if (badge) b = <b>{badge}</b>;\r\n        return <div className={cn}>\r\n            {children}\r\n            {b}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-lmr.css';\r\n\r\nexport interface LMRProps {\r\n    className?: string | string[];\r\n\tstyle?: React.CSSProperties,\r\n    left?: string|JSX.Element;\r\n    right?: string|JSX.Element;\r\n    onClick?: ()=>void;\r\n}\r\n\r\n@observer\r\nexport class LMR extends React.Component<LMRProps> {\r\n    render() {\r\n        let {className, style, left, children, right, onClick} = this.props;\r\n        let l, r;\r\n        if (left !== undefined) l = <header>{left}</header>;\r\n        if (right !== undefined) r = <footer>{right}</footer>;\r\n        let cursor;\r\n        if (onClick !== undefined) cursor = 'cursor-pointer';\r\n        return <div className={classNames('va-lmr', className, cursor)}\r\n\t\t\tstyle={style}\r\n\t\t\tonClick={onClick}>\r\n            {l}\r\n            <div>{children}</div>\r\n            {r}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface FAProps {\r\n    name: string;\r\n    className?: string;\r\n    size?: 'lg'|'2x'|'3x'|'4x'|'5x';\r\n    spin?: boolean;\r\n    fixWidth?: boolean;\r\n    border?: boolean;\r\n    pull?: 'left'|'right';\r\n    pulse?: boolean;\r\n    rotate?: 90|180|270;\r\n    flip?: 'horizontal'|'vertical';\r\n    inverse?: boolean;\r\n}\r\n\r\nexport class FA extends React.Component<FAProps> {\r\n    render() {\r\n        let {name, className, size, spin, fixWidth, border, pull, pulse, rotate, flip, inverse} = this.props;\r\n        let cn = classNames(className, 'fa',\r\n            name && ('fa-' + name),\r\n            size && 'fa-'+size,\r\n            fixWidth && 'fa-fw',\r\n            border && 'fa-border',\r\n            pull && 'fa-pull-' + pull,\r\n            spin && 'fa-spin',\r\n            pulse && 'fa-pulse',\r\n            rotate && 'fa-rotate-' + rotate,\r\n            flip && 'fa-flip-' + flip,\r\n            inverse && 'fa-inverse',\r\n        );\r\n        return <i className={cn} />\r\n    }\r\n}\r\n\r\nexport interface StackedFAProps {\r\n    className?: string;\r\n    size?: 'lg',\r\n}\r\nexport class StackedFA extends React.Component<StackedFAProps> {\r\n    render() {\r\n        let {className, size, children} = this.props;\r\n        let cn = classNames(\r\n            'fa-stack',\r\n            className,\r\n            size && 'fa-' + size);\r\n        return <span className={cn}>\r\n            {children}\r\n        </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {FA} from './FA';\r\n\r\nexport interface IconTextProps {\r\n    icon: string;\r\n    iconClass?: string;\r\n    text: string | JSX.Element;\r\n    textClass?: string;\r\n}\r\n\r\nexport class IconText extends React.Component<IconTextProps> {\r\n    render() {\r\n        let {icon, iconClass, text, textClass} = this.props;\r\n        return <div className=\"py-2\">\r\n            <FA className={iconClass} name={icon} fixWidth={true} />\r\n            <span className={textClass}>{text}</span>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\n//import { nav } from '../nav';\r\nimport { Loading } from './loading';\r\nimport { Image as ImageControl } from './image';\r\nimport { Page } from './page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { LMR } from './simple';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport interface ResUploaderProps {\r\n    className?: string;\r\n    label?: string;\r\n    multiple?: boolean;\r\n    maxSize?: number;\r\n    onFilesChange?: (evt: React.ChangeEvent<HTMLInputElement>) => void;\r\n}\r\n\r\n@observer\r\nexport class ResUploader extends React.Component<ResUploaderProps> {\r\n    private fileInput: HTMLInputElement;\r\n    fileName: string = null;\r\n\r\n    constructor(props: ResUploaderProps) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            fileName: observable,\r\n        });\r\n    }\r\n\r\n    buildFormData(): FormData {\r\n        let { maxSize } = this.props;\r\n        if (maxSize === undefined || maxSize <= 0)\r\n            maxSize = 100000000000;\r\n        else\r\n            maxSize = maxSize * 1024;\r\n        var files: FileList = this.fileInput.files;\r\n        var data = new FormData();\r\n        let len = files.length;\r\n        for (let i = 0; i < len; i++) {\r\n            let file = files[i];\r\n            if (file.size > maxSize) return null;\r\n            data.append('files[]', file, file.name);\r\n        }\r\n    }\r\n\r\n    getFile0(): File {\r\n        return this.fileInput.files[0];\r\n    }\r\n\r\n    upload = async (formData?: FormData): Promise<string | { error: any }> => {\r\n        let resUrl = tonwa.resUrl + 'upload';\r\n        if (!formData) formData = this.buildFormData();\r\n        try {\r\n            tonwa.nav.startWait();\r\n            let headers = new Headers();\r\n            headers.append('Access-Control-Allow-Origin', '*');\r\n            //2019-12-18：因为 vivo按oppo某些版本不支持，暂时先不要 \r\n            //let abortController = new AbortController();\r\n            let res = await fetch(resUrl, {\r\n                method: \"POST\",\r\n                body: formData,\r\n                headers: headers,\r\n                //signal: abortController.signal,\r\n            });\r\n            let json = await res.json();\r\n            return ':' + json.res.id;\r\n        }\r\n        catch (err) {\r\n            console.error('%s %s', resUrl, err);\r\n            return { error: err };\r\n        }\r\n        finally {\r\n            tonwa.nav.endWait();\r\n        }\r\n    }\r\n\r\n    private onFilesChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let { onFilesChange } = this.props;\r\n        if (onFilesChange) onFilesChange(evt);\r\n        let files = evt.target.files;\r\n        let len = files.length;\r\n        let names: string[] = [];\r\n        for (let i = 0; i < len; i++) {\r\n            names.push(files.item(i).name);\r\n        }\r\n        this.fileName = names.join(', ');\r\n    }\r\n\r\n    render() {\r\n        let { className, multiple, label } = this.props;\r\n        return <div>\r\n            <label className=\"btn btn-outline-success\">\r\n                {label || '选择文件'}\r\n                <input\r\n                    className={className}\r\n                    ref={t => this.fileInput = t}\r\n                    onChange={this.onFilesChange}\r\n                    type='file' name='file'\r\n                    multiple={multiple} style={{ display: 'none' }} />\r\n            </label>\r\n            &nbsp;\r\n            {this.fileName}\r\n        </div>\r\n    }\r\n}\r\n\r\nfunction formatSize(size: number, pointLength: number = 2, units?: string[]) {\r\n    var unit;\r\n    units = units || ['B', 'K', 'M', 'G', 'TB'];\r\n    while ((unit = units.shift()) && size > 1024) {\r\n        size = size / 1024;\r\n    }\r\n    return (unit === 'B' ? size : size.toFixed(pointLength === undefined ? 2 : pointLength)) + unit;\r\n}\r\n\r\ninterface ImageUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw';\r\n    onSaved?: (imageId: string) => Promise<void>;\r\n    imageTypes?: string[];\r\n}\r\n\r\nconst xlargeSize = 1600;\r\nconst largeSize = 800;\r\nconst mediumSize = 400;\r\nconst smallSize = 180;\r\n\r\n@observer\r\nexport class ImageUploader extends React.Component<ImageUploaderProps> {\r\n    private static imageTypes = ['gif', 'jpg', 'jpeg', 'png', 'svg', 'apng', 'bmp', 'ico', 'cur', 'tiff', 'tif', 'webp'];\r\n    private imgBaseSize: number;\r\n    private imageTypes: string[];\r\n    private suffix: string;\r\n    private resUploader: ResUploader;\r\n\r\n    file: File = null;\r\n    desImgWidth: number = null;\r\n    desImgHeight: number = null;\r\n    desImgSize: number = null;\r\n    srcImgWidth: number = null;\r\n    srcImgHeight: number = null;\r\n    isChanged: boolean = false;\r\n    resId: string = null;\r\n    enableUploadButton: boolean = false;\r\n    srcImage: string = null;\r\n    desImage: string = null;\r\n    fileError: string = null;\r\n    uploaded: boolean = false;\r\n\r\n    constructor(props: ImageUploaderProps) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            file: observable,\r\n            desImgWidth: observable,\r\n            desImgHeight: observable,\r\n            desImgSize: observable,\r\n            srcImgWidth: observable,\r\n            srcImgHeight: observable,\r\n            isChanged: observable,\r\n            resId: observable,\r\n            enableUploadButton: observable,\r\n            srcImage: observable,\r\n            desImage: observable,\r\n            fileError: observable,\r\n            uploaded: observable,\r\n        });\r\n        this.resId = props.id;\r\n        this.imageTypes = props.imageTypes || ImageUploader.imageTypes;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos + 1).toLowerCase();\r\n            if (this.imageTypes.indexOf(this.suffix) < 0) {\r\n                this.fileError = `图片类型必须是 ${this.imageTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n                this.srcImage = reader.result as string;\r\n                switch (this.suffix) {\r\n                    default:\r\n                        await this.setSize(this.props.size);\r\n                        break;\r\n                    case 'svg':\r\n                        this.imgBaseSize = mediumSize;\r\n                        this.desImgSize = this.srcImage.length;\r\n                        this.desImage = this.srcImage;\r\n                        break;\r\n                }\r\n            };\r\n        }\r\n    }\r\n\r\n    private async setSize(size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw') {\r\n        switch (size) {\r\n            default:\r\n            case 'sm':\r\n                this.imgBaseSize = smallSize; break;\r\n            case 'md':\r\n                this.imgBaseSize = mediumSize; break;\r\n            case 'lg':\r\n                this.imgBaseSize = largeSize; break;\r\n            case 'xl':\r\n                this.imgBaseSize = xlargeSize; break;\r\n            case 'raw':\r\n                this.imgBaseSize = -1; break;\r\n        }\r\n        this.desImage = await this.compress();\r\n    }\r\n\r\n    private compress = (): Promise<string> => {\r\n        return new Promise<string>((resolve, reject) => {\r\n            var img = new Image();\r\n            img.src = this.srcImage;\r\n            img.onload = () => {\r\n                //var that = this;\r\n                // 默认按比例压缩\r\n                let { width, height } = img;\r\n                this.srcImgWidth = width;\r\n                this.srcImgHeight = height;\r\n                let scale = width / height;\r\n                let w: number, h: number;\r\n                if (this.imgBaseSize < 0) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (width <= this.imgBaseSize && height <= this.imgBaseSize) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (scale < 0) {\r\n                    w = this.imgBaseSize;\r\n                    h = w / scale;\r\n                }\r\n                else {\r\n                    h = this.imgBaseSize;\r\n                    w = h * scale;\r\n                }\r\n                this.desImgWidth = Math.round(w);\r\n                this.desImgHeight = Math.round(h);\r\n                var quality = 0.7;  // 默认图片质量为0.7\r\n                //生成canvas\r\n                var canvas = document.createElement('canvas');\r\n                var ctx = canvas.getContext('2d');\r\n                // 创建属性节点\r\n                var anw = document.createAttribute(\"width\");\r\n                anw.nodeValue = String(w);\r\n                var anh = document.createAttribute(\"height\");\r\n                anh.nodeValue = String(h);\r\n                canvas.setAttributeNode(anw);\r\n                canvas.setAttributeNode(anh);\r\n                ctx.drawImage(img, 0, 0, w, h);\r\n                let base64 = canvas.toDataURL('image/' + this.suffix, quality);\r\n                let blob = this.convertBase64UrlToBlob(base64);\r\n                this.desImgSize = blob.size;\r\n                if (this.desImgSize > 3 * 1024 * 1024) {\r\n                    this.fileError = \"图片大于3M，无法上传\";\r\n                    this.enableUploadButton = false;\r\n                }\r\n                resolve(base64);\r\n            }\r\n        });\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string): Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while (n--) {\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], { type: mime });\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.desImage);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let { error } = ret;\r\n            let type = typeof error;\r\n            let err: string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let { onSaved } = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    private showOrgImage = () => {\r\n        tonwa.nav.push(<Page header=\"原图\">\r\n            <div className=\"p-3 text-center\">\r\n                <ImageControl className=\"h-min-4c\" style={{ maxWidth: '100%' }} src={this.srcImage} />\r\n            </div>\r\n        </Page>);\r\n    }\r\n\r\n    private levelDiv() {\r\n        if (this.props.size) return;\r\n        let arr = [{ caption: '小图', size: 'sm' }];\r\n        if (this.srcImgHeight > mediumSize || this.srcImgWidth > mediumSize) {\r\n            arr.push({ caption: '中图', size: 'md' });\r\n        }\r\n        if (this.srcImgHeight > largeSize || this.srcImgWidth > largeSize) {\r\n            arr.push({ caption: '大图', size: 'lg' });\r\n        }\r\n        if (this.srcImgHeight > xlargeSize || this.srcImgWidth > xlargeSize) {\r\n            arr.push({ caption: '超大图', size: 'xl' });\r\n            arr.push({ caption: '原图', size: 'raw' });\r\n        }\r\n        if (arr.length < 2) return;\r\n        return <div>{arr.map((v, index) => {\r\n            let { caption, size } = v;\r\n            return <label key={index} className=\"me-3\"><input type=\"radio\" name=\"size\"\r\n                onChange={() => this.setSize(size as any)}\r\n                defaultChecked={index === 0} /> {caption}</label>;\r\n        })}</div>\r\n    }\r\n\r\n    render() {\r\n        let { label } = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改图片'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v => this.resUploader = v}\r\n                            multiple={false} maxSize={2048}\r\n                            label=\"选择图片文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {this.imageTypes.join(', ')} 格式图片。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                    <LMR left=\r\n                        {\r\n                            this.uploaded === true ?\r\n                                <div className=\"text-success p-2\">上传成功！</div>\r\n                                :\r\n                                this.file && this.desImgSize > 0 && <div className=\"mb-3 d-flex align-items-end\">\r\n                                    <div className=\"me-5\">\r\n                                        {this.levelDiv()}\r\n                                        <div>分辨率：{this.desImgWidth} x {this.desImgHeight}\r\n                                            &nbsp; &nbsp;\r\n                                            文件大小：{formatSize(this.desImgSize)}\r\n                                        </div>\r\n                                    </div>\r\n                                    <button className=\"btn btn-primary\"\r\n                                        disabled={!this.enableUploadButton}\r\n                                        onClick={this.upload}>上传</button>\r\n                                </div>\r\n                        }\r\n                        right={this.desImage &&\r\n                            <button className=\"btn btn-link btn-sm text-right mb-3\" onClick={this.showOrgImage}>\r\n                                原图大小: {formatSize(this.file.size)}<br />\r\n                                分辨率：{this.srcImgWidth} x {this.srcImgHeight}\r\n                            </button>\r\n                        }\r\n                    ></LMR>\r\n                </div>\r\n                <div className=\"text-center\"\r\n                    style={{\r\n                        border: (this.uploaded === true ? '2px solid green' : '1px dotted gray'),\r\n                        padding: '8px'\r\n                    }}>\r\n                    <ImageControl className=\"h-min-4c\" style={{ maxWidth: '100%' }} src={this.desImage} />\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface AudioUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    onSaved?: (imageId: string) => Promise<void>;\r\n}\r\n\r\n@observer\r\nexport class AudioUploader extends React.Component<AudioUploaderProps> {\r\n    private static audioTypes = ['mp3', 'wav'];\r\n\r\n    private suffix: string;\r\n    private resUploader: ResUploader;\r\n\r\n    content: string = null;\r\n    file: File = null;\r\n    fileSize: number = null;\r\n    isChanged: boolean = false;\r\n    resId: string = null;\r\n    enableUploadButton: boolean = false;\r\n    fileError: string = null;\r\n    uploaded: boolean = false;\r\n    uploading: boolean = false;\r\n\r\n    constructor(props: AudioUploaderProps) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            content: observable,\r\n            file: observable,\r\n            fileSize: observable,\r\n\r\n            isChanged: observable,\r\n            resId: observable,\r\n            enableUploadButton: observable,\r\n            fileError: observable,\r\n            uploaded: observable,\r\n            uploading: observable,\r\n        });\r\n        this.resId = props.id;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos + 1).toLowerCase();\r\n            if (AudioUploader.audioTypes.indexOf(this.suffix) < 0) {\r\n                this.fileError = `音频类型必须是 ${AudioUploader.audioTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n                this.content = reader.result as string;\r\n                this.fileSize = this.content.length;\r\n            };\r\n        }\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string): Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while (n--) {\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], { type: mime });\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        this.uploading = true;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.content);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let { error } = ret;\r\n            let type = typeof error;\r\n            let err: string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let { onSaved } = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    render() {\r\n        let { label } = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改文件'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v => this.resUploader = v}\r\n                            multiple={false} maxSize={2048}\r\n                            label=\"选择音频文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {AudioUploader.audioTypes.join(', ')} 格式。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <LMR left=\r\n                {\r\n                    this.uploaded === true ?\r\n                        <div className=\"text-success p-2\">上传成功！</div>\r\n                        :\r\n                        this.uploading === true ?\r\n                            <div className=\"m-3\"><Loading /></div>\r\n                            :\r\n                            this.file && this.content && <div className=\"m-3\">\r\n                                <div className=\"mb-3\">\r\n                                    文件大小：{formatSize(this.fileSize)}\r\n                                </div>\r\n                                <button className=\"btn btn-primary\"\r\n                                    disabled={!this.enableUploadButton}\r\n                                    onClick={this.upload}>上传</button>\r\n                            </div>\r\n                }\r\n            />\r\n        </Page>;\r\n    }\r\n}\r\n","import { ItemSchema, UiItem, UiSelectBase } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Image } from '../image';\r\nimport { Edit } from './edit';\r\nimport { FieldRule } from '../inputRules';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport abstract class ItemEdit {\r\n    protected edit: Edit;\r\n    protected name: string;\r\n    protected _itemSchema: ItemSchema;\r\n    get itemSchema(): ItemSchema { return this._itemSchema }\r\n    protected _uiItem: UiItem;\r\n    get uiItem(): UiItem { return this._uiItem }\r\n    value: any;\r\n    label: string | JSX.Element;\r\n    get editInRow(): boolean { return false; }\r\n    protected newValue: any;\r\n\r\n    error: string = null;\r\n    isChanged: boolean = false;\r\n\r\n    constructor(edit: Edit, itemSchema: ItemSchema, uiItem: UiItem, label: string | JSX.Element, value: any) {\r\n        makeObservable(this, {\r\n            error: observable,\r\n            isChanged: observable,\r\n        });\r\n        this.edit = edit;\r\n        this._itemSchema = itemSchema;\r\n        this._uiItem = uiItem\r\n        this.value = value;\r\n        let { name } = itemSchema;\r\n        this.name = name;\r\n        this.label = label;\r\n    }\r\n\r\n    init() {\r\n    }\r\n\r\n    async start(): Promise<any> {\r\n        return await this.internalStart();\r\n    }\r\n\r\n    protected abstract internalStart(): Promise<any>;\r\n\r\n    async end(): Promise<any> {\r\n        await this.internalEnd()\r\n    }\r\n\r\n    renderContent() {\r\n        let { name, type } = this._itemSchema;\r\n        let divValue: any;\r\n        let uiItem = this._uiItem;\r\n        let label: string | JSX.Element, labelHide: boolean;\r\n        if (uiItem === undefined) {\r\n            label = name;\r\n        }\r\n        else {\r\n            label = uiItem.label;\r\n            labelHide = uiItem.labelHide;\r\n            let templet = uiItem.Templet;\r\n            if (templet !== undefined) {\r\n                if (typeof templet === 'function') {\r\n                    if (this.value !== undefined) divValue = templet(this.value);\r\n                }\r\n                else {\r\n                    divValue = { templet };\r\n                }\r\n            }\r\n            else if (this.value !== undefined) {\r\n                switch (uiItem.widget) {\r\n                    case 'radio':\r\n                    case 'select':\r\n                        let { list } = uiItem as UiSelectBase;\r\n                        divValue = <b>{list.find(v => v.value === this.value).title}</b>;\r\n                        break;\r\n                    case 'id':\r\n                        divValue = <b>no templet for {name}={this.value}</b>\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        if (divValue === undefined) {\r\n            switch (type) {\r\n                default:\r\n                    divValue = this.value ?\r\n                        <b>{this.value}</b>\r\n                        :\r\n                        <small className=\"text-muted\">[{labelHide === true ? label : '无'}]</small>;\r\n                    break;\r\n                case 'image':\r\n                    divValue = <Image className=\"w-4c h-4c\" src={this.value} />;\r\n                    break;\r\n            }\r\n        }\r\n        return divValue;\r\n    }\r\n\r\n    protected async internalEnd(): Promise<void> { tonwa.nav.pop(1) }\r\n\r\n    protected verifyValue() {\r\n        if (this.uiItem === undefined) return;\r\n        let { rules } = this.uiItem;\r\n        if (rules === undefined) return;\r\n        let nv = this.newValue;\r\n        function verifyRule(rule: FieldRule, value: any): string {\r\n            let error = rule(nv);\r\n            if (error !== undefined) {\r\n                if (typeof error !== 'object')\r\n                    return error;\r\n                else\r\n                    return JSON.stringify(error);\r\n            }\r\n        }\r\n        if (Array.isArray(rules)) {\r\n            for (let rule of rules) {\r\n                let error = verifyRule(rule as FieldRule, nv);\r\n                if (error !== undefined) {\r\n                    this.error = error;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.error = verifyRule(rules as FieldRule, nv);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { ItemSchema, UiImageItem, UiItem } from '../schema';\r\nimport { ImageUploader } from '../resUploader';\r\n//import { nav } from '../../nav';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { Edit } from './edit';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport class ImageItemEdit extends ItemEdit {\r\n    get uiItem(): UiImageItem { return this._uiItem as UiImageItem }\r\n    resId: string = null;\r\n\r\n    constructor(edit: Edit, itemSchema: ItemSchema, uiItem: UiItem, label: string | JSX.Element, value: any) {\r\n        super(edit, itemSchema, uiItem, label, value);\r\n        makeObservable(this, {\r\n            resId: observable\r\n        })\r\n    }\r\n\r\n    protected async internalStart(): Promise<any> {\r\n        this.resId = this.value;\r\n        return new Promise<any>((resolve, reject) => {\r\n            tonwa.nav.push(React.createElement(this.page, { resolve: resolve, reject: reject }), () => reject());\r\n        });\r\n    }\r\n\r\n    /*\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let ret = await this.resUploader.upload();\r\n        if (ret === null) {\r\n            this.overSize = true;\r\n            env.setTimeout('imageItemEdit upload', () => this.overSize = false, 3000);\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.value);\r\n    }\r\n    */\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let size: any = this.uiItem && this.uiItem.size;\r\n\r\n        /*\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>resolve(this.resId)}>保存</button>;\r\n        let overSize:any;\r\n        if (this.overSize === true) {\r\n            overSize = <div className=\"text-danger\">\r\n                <i className=\"fa fa-times-circle\" /> 图片文件大小超过2M，无法上传\r\n            </div>;\r\n        }\r\n        */\r\n        return <ImageUploader\r\n            label={'更改' + this.label}\r\n            id={this.resId}\r\n            size={size}\r\n            onSaved={(resId): Promise<void> => { resolve(resId); return; }} />;\r\n        /*\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div>上传图片：</div>\r\n                    <div className=\"my-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} multiple={false} maxSize={2048} />\r\n                    </div>\r\n                    <div>\r\n                        <button className=\"btn btn-primary\" onClick={this.upload}>上传</button>\r\n                    </div>\r\n                </div>\r\n                {overSize}\r\n                <div className=\"small muted my-4\">支持JPG、GIF、PNG格式图片，不超过2M。</div>\r\n                <div className=\"d-flex\">\r\n                    <div className=\"w-12c h-12c me-4\"\r\n                        style={{border: '1px dotted gray', padding: '8px'}}>\r\n                        <Image className=\"w-100 h-100\" src={this.resId} />\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"small\">图片预览</div>\r\n                        <Image className=\"w-4c h-4c mt-3\" src={this.resId} />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n        */\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { ItemSchema, UiImageItem } from '../../schema';\r\nimport { Image } from '../../image';\r\nimport { ImageItemEdit } from '../../edit/imageItemEdit';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\n\r\nexport class ImageWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiImageItem {return this._ui as UiImageItem};\r\n\r\n\timageSrc: string = null;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\timageSrc: observable,\r\n\t\t})\r\n\t}\r\n\r\n    init() {\r\n        super.init();\r\n        this.imageSrc = this.value;\r\n    }\r\n\r\n    protected onClick = async () => {\r\n        let edit = new ImageItemEdit(undefined, this.itemSchema, this.ui, this.ui.label, this.value);\r\n        let ret = await edit.start();\r\n        if (ret !== null) {\r\n            this.setValue(ret);\r\n            this.imageSrc = ret;\r\n        }\r\n        await edit.end();\r\n    }\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let cn = [\r\n            'bg-white p-1 d-flex justify-content-center',\r\n        ];\r\n        let onClick: any;\r\n        if (!this.readOnly && !this.disabled) {\r\n            cn.push('cursor-pointer');\r\n            onClick = this.onClick;\r\n        }\r\n        return <div className={classNames(cn)} onClick={onClick}>\r\n            <Image src={this.imageSrc} className=\"w-4c h-4c\"/>\r\n        </div>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTag, IValuesViewRenderOptions } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\nabstract class TagWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiTag {return this._ui as UiTag};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n\t}\r\n\t\r\n\tabstract render():JSX.Element;\r\n}\r\n\r\nexport class TagSingleWidget extends TagWidget {\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet name = this.name;\r\n\t\tif (rowKey !== undefined) name += '-' + rowKey;\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputName: name,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderRadios(this.defaultValue, options);\r\n    }\r\n}\r\n\r\nexport class TagMultiWidget extends TagWidget {\r\n\tprivate defaultArr:number[];\r\n\tinit() {\r\n\t\tsuper.init();\r\n\t\tlet def = this.defaultValue;\r\n\t\tswitch (typeof def) {\r\n\t\t\tdefault:\r\n\t\t\t\tthis.defaultArr = [];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'string':\r\n\t\t\t\tthis.defaultArr = def.split('|').map(v => Number(v));\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.changeValue(values.join('|'), true);\r\n\t}\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputs: this.inputs,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderChecks(this.defaultValue, options);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ArrSchema, DataType, ItemSchema } from '../../schema';\r\nimport { TypeWidget, UiCustom } from '../../schema';\r\nimport { TextWidget } from './textWidget';\r\nimport { TextAreaWidget } from './textareaWidget';\r\nimport { PasswordWidget, UrlWidget, EmailWidget } from './passwordWidget';\r\nimport { UpdownWidget } from './updownWidget';\r\nimport { NumberWidget } from './numberWidget';\r\nimport { DateWidget, DateTimeWidget, TimeWidget, MonthWidget } from './dateWidget';\r\nimport { CheckBoxWidget } from './checkBoxWidget';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { SelectWidget } from './selectWidget';\r\nimport { RadioWidget } from './radioWidget';\r\nimport { RangeWidget } from './rangeWidget';\r\nimport { IdWidget } from './idWidget';\r\nimport { ButtonWidget } from './buttonWidget';\r\nimport { ArrComponent } from './arrComponent';\r\nimport { ImageWidget } from './imageWidget';\r\nimport { TagSingleWidget, TagMultiWidget } from './tagWidget';\r\n\r\ninterface WidgetFactory {\r\n\twidget?: TypeWidget;\r\n\tdataTypes?: DataType[];\r\n};\r\n\r\nconst stringWidget: WidgetFactory = {\r\n\tdataTypes: ['integer', 'number', 'string'],\r\n\twidget: TextWidget\r\n};\r\n\r\nconst widgetFactories: {[type: string]: WidgetFactory} = {\r\n    id: {\r\n        dataTypes: ['id'],\r\n        widget: IdWidget,\r\n    },\r\n    text: stringWidget,\r\n\tstring: stringWidget,\r\n    textarea: {\r\n        dataTypes: ['string'],\r\n        widget: TextAreaWidget\r\n    },\r\n    password: {\r\n        dataTypes: ['string'],\r\n        widget: PasswordWidget\r\n    },\r\n    date: {\r\n        dataTypes: ['date'],\r\n        widget: DateWidget\r\n    },\r\n    datetime: {\r\n        dataTypes: ['date'],\r\n        widget: DateTimeWidget\r\n    },\r\n    time: {\r\n        dataTypes: ['date'],\r\n        widget: TimeWidget\r\n    },\r\n    month: {\r\n        dataTypes: ['date'],\r\n        widget: MonthWidget\r\n    },\r\n    select: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: SelectWidget\r\n    },\r\n    url: {\r\n        dataTypes: ['string'],\r\n        widget: UrlWidget\r\n    },\r\n    email: {\r\n        dataTypes: ['string'],\r\n        widget: EmailWidget\r\n    },\r\n    number: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: NumberWidget\r\n    },\r\n    updown: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: UpdownWidget\r\n    },\r\n    color: {\r\n\r\n    },\r\n    checkbox: {\r\n        dataTypes: ['boolean', 'integer', 'number'],\r\n        widget: CheckBoxWidget\r\n    },\r\n    image: {\r\n        dataTypes: ['string'],\r\n        widget: ImageWidget,\r\n    },\r\n    checkboxes: {\r\n\r\n    },\r\n    radio: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: RadioWidget\r\n\t},\r\n\ttagSingle: {\r\n\t\tdataTypes: ['integer'],\r\n\t\twidget: TagSingleWidget\r\n\t},\r\n\ttagMulti: {\r\n\t\tdataTypes: ['string'],\r\n\t\twidget: TagMultiWidget\r\n\t},\r\n    range: {\r\n        dataTypes: ['integer'],\r\n        widget: RangeWidget,\r\n    },\r\n    button: {\r\n        dataTypes: ['button', 'submit'],\r\n        widget: ButtonWidget,\r\n    }\r\n}\r\n\r\nexport function factory(context: Context, itemSchema: ItemSchema, children:React.ReactNode, fieldProps?: FieldProps):JSX.Element {\r\n    if (context === undefined) {\r\n        debugger;\r\n        return null;\r\n    }\r\n    if (itemSchema === undefined) return undefined;\r\n    let {name, type} = itemSchema;\r\n    switch (type) {\r\n    case 'arr':\r\n        let arrSchema = context.getItemSchema(name) as ArrSchema;\r\n        return <ArrComponent parentContext={context} arrSchema={arrSchema} children={children} />;\r\n    default:\r\n        break;\r\n    }\r\n\r\n    let typeWidget: TypeWidget;\r\n    let ui = context.getUiItem(name);\t\r\n    function getTypeWidget(t:DataType): TypeWidget {\r\n        switch(t) {\r\n        default: return TextWidget; \r\n        case 'id': return IdWidget;\r\n        case 'integer': return UpdownWidget;\r\n        case 'number': return NumberWidget; \r\n        case 'string': return TextWidget; \r\n        case 'date': return DateWidget; \r\n        case 'boolean': return CheckBoxWidget; \r\n        case 'button':\r\n        case 'submit': return ButtonWidget;\r\n        }\r\n    }\r\n    if (ui === undefined) { \r\n        typeWidget = getTypeWidget(type);\r\n    }\r\n    else {\r\n        let {widget:widgetType, hiden} = ui;\r\n\t\tif (hiden === true) return null;\r\n        switch (widgetType) {\r\n        default:\r\n            if (widgetType !== undefined) {\r\n                let widgetFactory = widgetFactories[widgetType];\r\n\t\t\t\tif (!widgetFactory) {\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\tthrow new Error(`unknown widget ${widgetType}`);\r\n\t\t\t\t}\r\n                typeWidget = widgetFactory.widget;\r\n            }\r\n            if (typeWidget === undefined) typeWidget = getTypeWidget(type);\r\n            break;\r\n        case 'custom':\r\n            typeWidget = (ui as UiCustom).WidgetClass;\r\n            break;\r\n        case 'group':\r\n            return <span>impletment group</span>;\r\n        }\r\n        //label = uiLabel || name;\r\n    }\r\n    \r\n\tlet {widgets} = context;\r\n\tlet widget = widgets[name];\r\n\tif (!widget) {\r\n\t\twidget = new typeWidget(context, itemSchema, fieldProps, children);\r\n\t\twidget.init();\r\n\t\twidgets[name] = widget;\r\n\t}\r\n\r\n    return <widget.container />;\r\n    /*\r\n    if (isRow === false) {\r\n        let WidgetElement = observer(() => widget.container());\r\n        return <WidgetElement />;\r\n    }\r\n    else {\r\n        let widgetElement = widget.container();\r\n        return widgetElement;\r\n    }\r\n    */\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { observable, IReactionDisposer, autorun } from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { InputRes, inputRes, resLang } from 'tonwa-core';\r\nimport { Schema, ItemSchema, ArrSchema, UiSchema, TempletType } from '../schema';\r\nimport { factory } from './widgets';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport { ContextContainer, FormContext, Context } from './context';\r\n\r\nexport type FormButtonClick = (name: string, context: Context) => Promise<any>;\r\nexport type InputEnter = (name: string, context: Context) => Promise<any>;\r\n\r\nexport interface FormProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    uiSchema?: UiSchema;\r\n    formData?: any;\r\n    onButtonClick?: FormButtonClick;\r\n    onEnter?: InputEnter;\r\n    fieldLabelSize?: number;            // col-sm-2 for label\r\n    fieldLabelAlign?: 'left' | 'center' | 'right';\r\n    requiredFlag?: boolean;             // default=true\r\n    beforeShow?: (formContext: FormContext) => void;\r\n    res?: InputRes;\r\n\r\n    Container?: (content: JSX.Element) => JSX.Element;\r\n    FieldContainer?: (label: string | JSX.Element, content: JSX.Element) => JSX.Element;\r\n    FieldClass?: string;\r\n    ButtonClass?: string;\r\n}\r\n\r\nexport class Form extends React.Component<FormProps> {\r\n    readonly schema: Schema;\r\n    readonly itemSchemas: { [name: string]: ItemSchema };\r\n    readonly uiSchema: UiSchema;\r\n    readonly res?: InputRes;\r\n    formContext: FormContext;\r\n    private disposer: IReactionDisposer;\r\n    readonly data: any;\r\n\r\n    readonly Container: (content: JSX.Element) => JSX.Element;\r\n    readonly FieldContainer: (label: any, content: JSX.Element) => JSX.Element;\r\n    readonly FieldClass: string;\r\n    readonly ButtonClass: string;\r\n\r\n    constructor(props: FormProps) {\r\n        super(props);\r\n        let { schema, uiSchema,\r\n            Container, FieldContainer, FieldClass,\r\n            ButtonClass, res,\r\n        } = props;\r\n        this.Container = Container || this.DefaultContainer;\r\n        this.FieldContainer = FieldContainer || this.DefaultFieldContainer;\r\n        this.FieldClass = FieldClass !== undefined && FieldClass !== '' && FieldClass !== null ? FieldClass : this.DefaultFieldClass;\r\n        this.res = res || this.DefaultRes;\r\n        this.ButtonClass = ButtonClass || this.DefaultButtonClass;\r\n\r\n        this.schema = schema;\r\n        this.itemSchemas = {};\r\n        for (let itemSchema of this.schema) {\r\n            this.itemSchemas[itemSchema.name] = itemSchema;\r\n        }\r\n        this.uiSchema = uiSchema;\r\n\r\n        this.disposer = autorun(this.watch);\r\n        this.data = {};\r\n    }\r\n\r\n    private renderContent(): any {\r\n        this.initData(this.props.formData);\r\n        let { children } = this.props;\r\n        if (children !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return <>{children}</>;\r\n        }\r\n\r\n        let Templet: TempletType;\r\n        if (this.uiSchema !== undefined) {\r\n            Templet = this.uiSchema.Templet;\r\n        }\r\n        if (Templet !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return typeof (Templet) === 'function' ? Templet(this.data) : Templet;\r\n        }\r\n\r\n        if (!this.formContext) {\r\n            this.formContext = new FormContext(this, false);\r\n        }\r\n        return <>{this.schema.map((v, index) => {\r\n            return <React.Fragment key={index}>{factory(this.formContext, v, children)}</React.Fragment>\r\n        })}</>;\r\n    }\r\n\r\n    private initData(formData: any) {\r\n        if (formData === undefined) formData = {};\r\n        if (this.uiSchema !== undefined) {\r\n            let { items } = this.uiSchema;\r\n            if (items !== undefined) {\r\n                for (let i in items) {\r\n                    let ui = items[i];\r\n                    let dv = ui.defaultValue;\r\n                    if (dv !== undefined) {\r\n                        if (formData[i] === undefined) {\r\n                            formData[i] = dv;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let itemSchema of this.schema) {\r\n            this.initDataItem(itemSchema, this.data, formData);\r\n        }\r\n    }\r\n\r\n    private initDataItem(itemSchema: ItemSchema, data: any, formData: any): any {\r\n        let { name, type } = itemSchema;\r\n        if (type === 'button') return;\r\n        if (type !== 'arr') {\r\n            data[name] = formData[name];\r\n            return;\r\n        }\r\n\r\n        let arrItem: ArrSchema = itemSchema as ArrSchema;\r\n        let { arr: arrItems } = arrItem;\r\n        if (arrItems === undefined) return;\r\n        let arrDict: any = arrItem.itemSchemas = {};\r\n        for (let item of arrItems) {\r\n            arrDict[item.name] = item;\r\n        }\r\n        let val: any[] = formData[name];\r\n        if (val === undefined) val = [];\r\n        else if (Array.isArray(val) === false) val = [val];\r\n        let arr: any[] = [];\r\n        for (let row of val) {\r\n            let { $isSelected, $isDeleted } = row;\r\n            let r = {\r\n                $source: row,\r\n                $isSelected: $isSelected,\r\n                $isDeleted: $isDeleted,\r\n            };\r\n            for (let item of arrItems) {\r\n                this.initDataItem(item, r, row);\r\n            }\r\n            arr.push(r);\r\n        }\r\n        // 如果没有observable，行删除标志点击不管用\r\n        // 不知道这里为什么要去掉observable。有可能会有别的问题\r\n        data[name] = observable(arr);\r\n        //data[name] = arr;\r\n        return;\r\n    }\r\n\r\n    private watch = () => {\r\n        let { formData } = this.props;\r\n        if (formData === undefined) return;\r\n        //this.initData(formData);\r\n        this.calcSelectOrDelete();\r\n    }\r\n    private calcSelectOrDelete() {\r\n        for (let itemSchema of this.schema) {\r\n            this.arrItemOperated(itemSchema);\r\n        }\r\n    }\r\n\r\n    private arrItemOperated(itemSchema: ItemSchema) {\r\n        let { name, type } = itemSchema;\r\n        if (type !== 'arr') return;\r\n        if (this.data === undefined) return;\r\n        let formArrVal = this.data[name];\r\n        if (formArrVal === undefined) return;\r\n        let { arr: arrItems } = itemSchema as ArrSchema;\r\n        for (let row of formArrVal) {\r\n            let { $source } = row;\r\n            if ($source === undefined) continue;\r\n            let { $isSelected, $isDeleted } = $source;\r\n            row.$isSelected = $isSelected;\r\n            row.$isDeleted = $isDeleted;\r\n            //console.log($isSelected, $isDeleted);\r\n            for (let item of arrItems) {\r\n                this.arrItemOperated(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        let { beforeShow } = this.props;\r\n        if (beforeShow !== undefined) beforeShow(this.formContext);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        if (this.disposer !== undefined) this.disposer();\r\n    }\r\n\r\n    render() {\r\n        let content = this.renderContent();\r\n        return <ContextContainer.Provider value={this.formContext}>\r\n            {React.createElement(this.formContext.renderErrors)}\r\n            {this.Container(content)}\r\n        </ContextContainer.Provider>;\r\n    }\r\n\r\n    async buttonClick(buttonName: string) {\r\n        this.formContext.checkRules()\r\n        if (this.formContext.hasError === true) return;\r\n\r\n        let { onButtonClick } = this.formContext.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this.formContext);\r\n        if (ret === undefined) return;\r\n        this.formContext.setError(buttonName, ret);\r\n    }\r\n\r\n    protected DefaultContainer = (content: JSX.Element): JSX.Element => {\r\n        return <form className={classNames(this.props.className)} onSubmit={e => e.preventDefault()}>\r\n            {content}\r\n        </form>;\r\n    }\r\n    protected DefaultFieldContainer = (label: string | JSX.Element, content: JSX.Element): JSX.Element => {\r\n        let { fieldLabelSize, fieldLabelAlign } = this.props;\r\n\r\n        if (fieldLabelSize > 0) {\r\n            let labelView: any;\r\n            if (label === null) {\r\n                fieldLabelSize = 0;\r\n            }\r\n            else {\r\n                let cnAlign: string;\r\n                switch (fieldLabelAlign) {\r\n                    case 'right': cnAlign = 'text-sm-right'; break;\r\n                    case 'center': cnAlign = 'text-sm-center'; break;\r\n                }\r\n                labelView = <label className={classNames('col-sm-' + fieldLabelSize, 'col-form-label', cnAlign)}>{label}</label>\r\n            }\r\n            let fieldCol = 'col-sm-' + (12 - fieldLabelSize);\r\n            return <div className=\"mb-3 row\">\r\n                {labelView}\r\n                <div className={fieldCol}>{content}</div>\r\n            </div>;\r\n        }\r\n        return <div className=\"mb-3\">\r\n            {label === null ? null : <label className=\"col-form-label\">{label}</label>}\r\n            {content}\r\n        </div>;\r\n    }\r\n    protected DefaultFieldClass: string = undefined;\r\n    protected DefaultButtonClass = 'text-center py-2';\r\n    protected DefaultRes: InputRes = resLang<InputRes>(inputRes);\r\n\r\n    ArrContainer = (label: any, content: JSX.Element): JSX.Element => {\r\n        return <div>\r\n            <div className={classNames('small text-muted text-center bg-light py-1 px-3 mt-4 mb-1')}>{label}</div>\r\n            {content}\r\n        </div>;\r\n    }\r\n    RowContainer = (content: JSX.Element): JSX.Element => {\r\n        let cn = classNames({\r\n            'py-3': true\r\n        });\r\n        return <div className={cn}>{content}</div>\r\n    }\r\n    RowSeperator = <div className=\"border border-gray border-top\" />;\r\n}\r\n","import * as React from 'react';\r\nimport { factory } from './widgets';\r\nimport { ContextContainer, Context } from './context';\r\n\r\nexport interface FieldProps {\r\n    name: string;\r\n}\r\n\r\nexport class FormField extends React.Component<FieldProps> {\r\n    static contextType = ContextContainer;\r\n    render() {\r\n        let {name, children } = this.props;\r\n        let context:Context = this.context;\r\n        if (context === undefined) return <span className=\"text-danger\">!only in Form!</span>;\r\n        let itemSchema = context.getItemSchema(name);\r\n        let content = factory(context, itemSchema, children, this.props);\r\n        if (content === undefined) {\r\n            return <span className=\"text-danger\">!!{name} is not defined!!</span>;\r\n        }\r\n        return content;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport interface InputOptions {\r\n    type: string;\r\n    min?: number;\r\n    max?: number;\r\n    step?: number;\r\n}\r\n\r\nexport class StringItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem { return this._uiItem as UiTextItem }\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, { resolve, reject });\r\n            tonwa.nav.push(element, reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    protected inputOptions(): InputOptions {\r\n        return {\r\n            type: 'text',\r\n        }\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let onSave = () => {\r\n            this.verifyValue();\r\n            if (!this.error) {\r\n                let val = this.newValue;\r\n                resolve(val);\r\n            }\r\n        }\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n        let onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n            if (evt.keyCode === 13) onSave();\r\n        }\r\n        let { type, max, min, step } = this.inputOptions();\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <input type={type}\r\n                    onChange={this.onChange}\r\n                    onKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\"\r\n                    defaultValue={this.value} min={min} max={max} step={step} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiRadio } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport class RadioItemEdit extends ItemEdit {\r\n    get uiItem(): UiRadio { return this._uiItem as UiRadio }\r\n\r\n    init() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem === undefined ? undefined : this._uiItem.defaultValue;\r\n        }\r\n    }\r\n\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, { resolve: resolve, reject: reject });\r\n            tonwa.nav.push(element, reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let { name } = this.itemSchema;\r\n        let { list } = this.uiItem;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={() => {\r\n                this.verifyValue();\r\n                if (!this.error) resolve(this.newValue);\r\n            }}>保存</button>;\r\n        let content = list ?\r\n            list.map((v, index: number) => {\r\n                let { title, value } = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input name={name} type=\"radio\" value={value}\r\n                        onClick={() => this.onChange(value)}\r\n                        defaultChecked={value === this.value} /> {title || value} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <div className=\"row row-cols-2 row-cols-sm-3 row-cols-md-4\">{content}</div>\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiSelect } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport class SelectItemEdit extends ItemEdit {\r\n    get uiItem(): UiSelect { return this._uiItem as UiSelect }\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, { resolve: resolve, reject: reject });\r\n            tonwa.nav.push(element, reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let { list } = this.uiItem;\r\n        let content = list ?\r\n            list.map((v, index: number) => {\r\n                let { title, value } = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={() => { this.onChange(value); resolve(this.newValue) }}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiIdItem } from '../schema';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class IdItemEdit extends ItemEdit {\r\n    get uiItem(): UiIdItem {return this._uiItem as UiIdItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            //let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            //nav.push(element,reject);\r\n\r\n            let {pickId} = this.uiItem;\r\n            if (pickId === undefined) {\r\n                alert('IdItemEdit.pickId = undefined');\r\n                return;\r\n            }\r\n            let boxId = await pickId(undefined, undefined, this.value);\r\n            //if (typeof id === 'object') {\r\n            //    id = (id as any).id;\r\n            //}\r\n            this.onChange(boxId.id);\r\n            resolve(boxId);\r\n            //this.newValue = id;\r\n        });\r\n    }\r\n\r\n    protected async internalEnd():Promise<void> {}\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        /*\r\n        let {resolve, reject} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n        */\r\n        return <Page header={'更改' + this.label}>\r\n            ddd\r\n        </Page>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiTag } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nabstract class TagItemEdit extends ItemEdit {\r\n\tprotected inputs: { [index: number]: HTMLInputElement } = {};\r\n\tprotected inputType: 'checkbox' | 'radio';\r\n\tget uiItem(): UiTag { return this._uiItem as UiTag };\r\n\r\n\tinit() {\r\n\t\tif (this.value === undefined) {\r\n\t\t\tthis.value = this._uiItem === undefined ? undefined : this._uiItem.defaultValue;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected async internalStart(): Promise<any> {\r\n\t\treturn new Promise<any>((resolve, reject) => {\r\n\t\t\tlet element = React.createElement(this.page, { resolve: resolve, reject: reject });\r\n\t\t\ttonwa.nav.push(element, reject);\r\n\t\t});\r\n\t}\r\n\r\n\trenderContent() {\r\n\t\tlet valuesView = this.uiItem.valuesView;\r\n\t\tif (valuesView === undefined) return super.renderContent();\r\n\t\treturn valuesView.render(this.value);\r\n\t}\r\n\r\n\tprotected abstract renderInputs(): JSX.Element;\r\n\tprivate page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n\t\tlet { resolve } = props;\r\n\t\tlet right = <button\r\n\t\t\tclassName=\"btn btn-sm btn-success align-self-center me-2\"\r\n\t\t\tdisabled={!this.isChanged}\r\n\t\t\tonClick={() => {\r\n\t\t\t\tthis.verifyValue();\r\n\t\t\t\tif (!this.error) resolve(this.newValue);\r\n\t\t\t}}>保存</button>;\r\n\t\t/*\r\n\t\tlet content = list?\r\n\t\t\tlist.map((v, index:number) => {\r\n\t\t\t\tlet {name:itemName, id} = v;\r\n\t\t\t\treturn <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n\t\t\t\t\t<input ref={input=>this.inputs[id] = input} name={name} type={this.inputType} value={id} \r\n\t\t\t\t\t\tonClick={(e)=>this.onChange(e.currentTarget.checked, id)}\r\n\t\t\t\t\t\tdefaultChecked={this.defaultChecked(id)} /> {itemName} &nbsp;\r\n\t\t\t\t</label></div>;\r\n\t\t\t})\r\n\t\t\t:\r\n\t\t\t<>no list defined</>;\r\n\t\t*/\r\n\t\treturn <Page header={'更改' + this.label} right={right}>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t{this.renderInputs()}\r\n\t\t\t</div>\r\n\t\t</Page>;\r\n\t})\r\n}\r\n\r\nexport class TagSingleItemEdit extends TagItemEdit {\r\n\tprotected inputType: 'radio' | 'checkbox' = 'radio';\r\n\tprotected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet { currentTarget } = evt;\r\n\t\tif (currentTarget.checked === false) return;\r\n\t\tthis.newValue = Number(currentTarget.value);\r\n\t\tlet preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\r\n\tprotected renderInputs(): JSX.Element {\r\n\t\tlet { valuesView } = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange,\r\n\t\t};\r\n\t\treturn valuesView.renderRadios(this.value, options);\r\n\t}\r\n}\r\n\r\nexport class TagMultiItemEdit extends TagItemEdit {\r\n\t//private arr:number[];\r\n\tprotected inputType: 'radio' | 'checkbox' = 'checkbox';\r\n\r\n\tprivate onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet values: string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n\t\tthis.newValue = values.join('|');\r\n\t\t//this.newValue = value;\r\n\t\tlet preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\tprotected renderInputs(): JSX.Element {\r\n\t\tlet { valuesView } = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t};\r\n\t\treturn valuesView.renderChecks(this.value, options);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport class TextAreaItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem { return this._uiItem as UiTextItem }\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, { resolve, reject });\r\n            tonwa.nav.push(element, reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let onSave = () => {\r\n            this.verifyValue();\r\n            if (!this.error) {\r\n                let val = this.newValue;\r\n                resolve(val);\r\n            }\r\n        }\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n        let onKeyDown = (evt: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n            // if (evt.keyCode === 13) onSave();\r\n        }\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <textarea\r\n                    onChange={this.onChange}\r\n                    onKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\"\r\n                    defaultValue={this.value}\r\n                    rows={6} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import { UiCheckItem } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class CheckBoxItemEdit extends ItemEdit {\r\n\tprivate input: HTMLInputElement;\r\n    get uiItem(): UiCheckItem {return this._uiItem as UiCheckItem}\r\n\tget editInRow(): boolean {return true;}\r\n    protected async internalStart():Promise<any> {\r\n\t\tif (!this.input) return;\r\n\t\tlet uiItem = this.uiItem;\r\n\t\tif (uiItem === undefined) return this.input.checked;\r\n\t\tlet {checked} = this.input;\r\n\t\treturn this.getValue(checked);\r\n    }\r\n\tasync end():Promise<any> {}\r\n\trenderContent() {\r\n\t\tlet {readOnly} = this.uiItem;\r\n\t\tlet disabled = readOnly === true;\r\n\t\tlet onChange:any;\r\n\t\tif (readOnly !== true) onChange = this.onChange;\r\n\t\treturn <input ref={r => this.input=r} type=\"checkbox\" \r\n\t\t\tdefaultChecked={this.value} disabled={disabled}\r\n\t\t\tonChange={onChange} />\r\n\t}\r\n\r\n\tprivate getValue(checked: boolean) {\r\n\t\tlet {trueValue, falseValue} = this.uiItem;\r\n        return checked === true? (trueValue??true) : (falseValue??false);\r\n\t}\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = this.getValue(evt.target.checked);\r\n        let preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t\tthis.edit.onItemChanged(this, this.newValue);\r\n    }\r\n}\r\n","import { UiRange } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class RangeItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiRange).min\r\n\t\t\tmax = (this._uiItem as UiRange).max\r\n\t\t\tstep = (this._uiItem as UiRange).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'range',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import { UiNumberItem } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class NumberItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiNumberItem).min\r\n\t\t\tmax = (this._uiItem as UiNumberItem).max\r\n\t\t\tstep = (this._uiItem as UiNumberItem).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'number',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import * as React from 'react';\r\n//import _ from 'lodash';\r\nimport { observer } from 'mobx-react';\r\nimport { Schema, UiSchema, ItemSchema, UiItem, UiRadio, UiTagSingle, UiTagMulti } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { StringItemEdit } from './stringItemEdit';\r\nimport { ImageItemEdit } from './imageItemEdit';\r\nimport { RadioItemEdit } from './radioItemEdit';\r\nimport { SelectItemEdit } from './selectItemEdit';\r\nimport { IdItemEdit } from './idItemEdit';\r\nimport { TagSingleItemEdit, TagMultiItemEdit } from './tagItemEdit';\r\nimport { TextAreaItemEdit } from './textAreaItemEdit';\r\nimport { CheckBoxItemEdit } from './checkBoxItemEdit';\r\nimport { RangeItemEdit } from './rangeItemEdit';\r\nimport { NumberItemEdit } from './numberItemEdit';\r\n\r\nexport interface EditProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    data: any;\r\n    onItemClick?: (itemSchema: ItemSchema, uiItem: UiItem, value: any) => Promise<void>;\r\n    onItemChanged?: (itemSchema: ItemSchema, newValue:any, preValue:any) => Promise<void>;\r\n    stopEdit?: boolean;\r\n    uiSchema?: UiSchema;\r\n    sepClassName?: string;\r\n    topBorderClassName?: string;\r\n    bottomBorderClassName?: string;\r\n    rowContainerClassName?: string;\r\n}\r\n\r\n@observer\r\nexport class Edit extends React.Component<EditProps> {\r\n    private defaultSepClassName = 'border-top edit-sep-light-gray';\r\n    private defaultRowContainerClassName = 'd-flex px-3 py-2 bg-white align-items-center';\r\n    private topBorder:JSX.Element;\r\n    private bottomBorder:JSX.Element;\r\n    private rowContainerClassName?: string;\r\n    private sep:JSX.Element;\r\n\tprivate uiSchema: {[name:string]: UiItem};\r\n\r\n    constructor(props: EditProps) {\r\n        super(props);\r\n        let {topBorderClassName, bottomBorderClassName, sepClassName, rowContainerClassName, uiSchema} = props;\r\n        this.topBorder = <div className={topBorderClassName || this.defaultSepClassName} />;\r\n        this.bottomBorder = <div className={bottomBorderClassName || this.defaultSepClassName} />;\r\n        this.rowContainerClassName = rowContainerClassName || this.defaultRowContainerClassName;\r\n        //if (stopEdit !== true) this.rowContainerClassName += ' cursor-pointer';\r\n        this.sep = <div className={sepClassName || this.defaultSepClassName} />;\r\n\t\tthis.uiSchema = (uiSchema && uiSchema.items) || {};\r\n    }\r\n\r\n    render() {\r\n        let {schema} = this.props;\r\n\t\tlet sep:any;\r\n        return <div>\r\n\t\t\t{this.topBorder}\r\n            {schema.map((itemSchema, index) => {\r\n\t\t\t\tlet {stopEdit} = this.props;\r\n\t\t\t\tlet {name} = itemSchema;\r\n\t\t\t\tlet uiItem = this.uiSchema===undefined? undefined : this.uiSchema[name];\r\n\t\t\t\tlet label:string|JSX.Element, labelHide:any;\r\n\t\t\t\tif (uiItem !== undefined) {\r\n\t\t\t\t\tlabel = uiItem.label || name;\r\n\t\t\t\t\tlabelHide = uiItem.labelHide;\r\n\t\t\t\t};\r\n\t\t\t\tlet value = this.props.data[name];\r\n\t\t\t\tlet itemEdit = createItemEdit(this, itemSchema, uiItem, label, value);\r\n\t\t\t\tlet rowContainerClassName = this.rowContainerClassName;\r\n\t\t\t\tlet {editInRow} = itemEdit;\r\n\t\t\t\tif (editInRow === false) {\r\n\t\t\t\t\tif (stopEdit !== true) editInRow = false;\r\n\t\t\t\t}\r\n\t\t\t\tif (editInRow === false) rowContainerClassName += ' cursor-pointer';\r\n\r\n\t\t\t\tlet {required} = itemSchema;\r\n\t\t\t\tlet requireFlag = required===true && <span className=\"text-danger\">*</span>;\r\n\t\t\t\tlet divLabel:any, cn:string = 'flex-fill d-flex ';\r\n\t\t\t\tif (labelHide === true) {\r\n\t\t\t\t\tdivLabel = undefined;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tdivLabel = <div>{label} {requireFlag}</div>;\r\n\t\t\t\t\tcn += 'justify-content-end';\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = <React.Fragment key={index}>\r\n\t\t\t\t\t{sep}\r\n\t\t\t\t\t<div className={'d-flex align-items-center' + rowContainerClassName} \r\n\t\t\t\t\t\tonClick={async ()=>await this.rowClick(itemEdit)}>\r\n\t\t\t\t\t\t{divLabel}\r\n\t\t\t\t\t\t<div className={cn}>{\r\n\t\t\t\t\t\t\titemEdit===undefined? undefined: itemEdit.renderContent()\r\n\t\t\t\t\t\t}</div>\r\n\t\t\t\t\t\t{editInRow === false && <div className=\"w-2c text-right\"><i className=\"fa fa-angle-right\" /></div>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</React.Fragment>;\r\n\t\t\t\tsep = this.sep;\r\n\t\t\t\treturn ret;\r\n\t\t\t})}\r\n\t\t\t{this.bottomBorder}\r\n\t\t</div>;\r\n    }\r\n\r\n\tasync onItemChanged(itemEdit:ItemEdit, newValue:any) {\r\n\t\tlet {itemSchema, uiItem, value} = itemEdit;\r\n\t\tthis.props.data[itemSchema.name] = newValue;\r\n        let {onItemChanged, stopEdit} = this.props;\r\n\t\tif (stopEdit === true) return;\r\n\t\tif (uiItem?.readOnly === true) return;\r\n\t\tif (onItemChanged === undefined) {\r\n\t\t\talert(`${itemSchema.name} value changed, new: ${newValue}, pre: ${value}`);\r\n\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n\t\t\t//this.props.data[itemSchema.name] = changeValue;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tawait onItemChanged(itemSchema, newValue, value);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate rowClick = async (itemEdit:ItemEdit) => {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\talert('item has no edit');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet {itemSchema, uiItem, value, editInRow} = itemEdit;\r\n\t\tif (editInRow === true) return;\r\n        let {onItemChanged, onItemClick, stopEdit} = this.props;\r\n\t\tif (stopEdit === true) return;\r\n\t\tif (uiItem?.readOnly === true) return;\r\n        let changeValue:any;\r\n        if (onItemClick !== undefined) {\r\n            await onItemClick(itemSchema, uiItem, value);\r\n            return;\r\n        }\r\n        //let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);\r\n        if (itemEdit === undefined) {\r\n            alert('undefined: let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);');\r\n            return;\r\n        }\r\n        try {\r\n            changeValue = await itemEdit.start();\r\n            if (changeValue !== value) {\r\n\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以移到这里来\r\n\t\t\t\tthis.props.data[itemSchema.name] = changeValue;\r\n                if (onItemChanged === undefined) {\r\n                    alert(`${itemSchema.name} value changed, new: ${changeValue}, pre: ${value}`);\r\n\t\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n                    //this.props.data[itemSchema.name] = changeValue;\r\n                }\r\n                else {\r\n                    await onItemChanged(itemSchema, changeValue, value);\r\n                }\r\n            }\r\n            await itemEdit.end();\r\n        }\r\n        catch (err) {\r\n            // 如果直接back，会触发reject，就到这里了\r\n\t\t\tconsole.log('no value changed');\r\n\t\t\tconsole.error(err);\r\n        }\r\n    }\r\n}\r\n\r\ntype NewItemEdit = new (edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any) => ItemEdit;\r\n\r\nfunction createItemEdit(edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any):ItemEdit {\r\n\tlet ie: ItemEdit;\r\n    let itemEdit: NewItemEdit;\r\n    if (uiItem !== undefined) {\r\n        switch (uiItem.widget) {\r\n            default: break;\r\n            case 'id': itemEdit = IdItemEdit; break;\r\n\t\t\tcase 'text': itemEdit = StringItemEdit; break;\r\n\t\t\tcase 'textarea': itemEdit = TextAreaItemEdit; break;\r\n            case 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\tcase 'select': itemEdit = SelectItemEdit; break;\r\n\t\t\tcase 'range': itemEdit = RangeItemEdit; break;\r\n\t\t\tcase 'number':\r\n\t\t\tcase 'updown': itemEdit = NumberItemEdit; break;\r\n\t\t\tcase 'checkbox': itemEdit = CheckBoxItemEdit; break;\r\n            case 'radio': \r\n\t\t\t\tie = new RadioItemEdit(edit, itemSchema, uiItem as UiRadio, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagSingle':\r\n\t\t\t\tie = new TagSingleItemEdit(edit, itemSchema, uiItem as UiTagSingle, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagMulti':\r\n\t\t\t\tie = new TagMultiItemEdit(edit, itemSchema, uiItem as UiTagMulti, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t}\r\n\tif (ie === undefined) {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\tswitch (itemSchema.type) {\r\n\t\t\t\tcase 'string': itemEdit = StringItemEdit; break;\r\n\t\t\t\tcase 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\t\tcase 'boolean': itemEdit = CheckBoxItemEdit; break;\r\n\t\t\t\tcase 'number':\r\n\t\t\t\tcase 'integer': itemEdit = RangeItemEdit; break;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (itemEdit === undefined) return;\r\n\t\tie = new itemEdit(edit, itemSchema, uiItem, label, value);\r\n\t}\r\n\tie.init();\r\n\treturn ie;\r\n}\r\n","import { IObservableArray, computed, makeObservable } from 'mobx';\r\nimport { IPageItems } from '../../tool/IPageItems';\r\nimport { List } from './index';\r\n\r\nexport abstract class ListBase {\r\n    protected list: List;\r\n    constructor(list: List) {\r\n        this.list = list;\r\n\t\tmakeObservable(this, {\r\n\t\t\tloading: computed,\r\n\t\t});\r\n    }\r\n    get isPaged():boolean {\r\n        let items = this.list.props.items;\r\n        return (items !== null && items !== undefined && Array.isArray(items) === false);\r\n    }\r\n    get items():any[]|IObservableArray<any> {\r\n        let items = this.list.props.items;\r\n        if (items === null) return null;\r\n        if (items === undefined) return undefined;\r\n        if (Array.isArray(items) === true)\r\n            return items as IObservableArray<any>;\r\n        else\r\n            return (items as IPageItems<any>).items;\r\n    }\r\n    get loading():boolean {\r\n        let items = this.list.props.items;\r\n        if (items === null) return false;\r\n        if (items === undefined) return true;\r\n        let pageItems = items as IPageItems<any>;\r\n        if (pageItems.items === undefined) return false;\r\n        return pageItems.loading;\r\n    }\r\n    get selectedItems():any[] { return undefined; }\r\n    //updateProps(nextProps:any) {}\r\n    dispose() {};\r\n    abstract render: (item:any, index:number) => JSX.Element;\r\n    protected renderContent(item:any, index:number) {\r\n        let {render} = this.list.props.item;\r\n        if (render === undefined) return <div className=\"px-3 py-2\">{JSON.stringify(item)}</div>;\r\n        return render(item, index);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\n\r\nexport class Clickable extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key, onClick} = this.list.props.item;\r\n        return <li key={key===undefined?index:key(item)} className={classNames('va-row-clickable', className)} onClick={()=>onClick && onClick(item)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import classNames from 'classnames';\r\nimport { uid } from 'tonwa-core';\r\nimport { ListBase } from './base';\r\n\r\nexport class Static extends ListBase {\r\n    render = (item: any, index: number): JSX.Element => {\r\n        let { className, key } = this.list.props.item;\r\n        if (typeof item === 'string') {\r\n            let cn = classNames('va-list-gap', 'px-3', 'pt-1');\r\n            return <li key={uid()} className={cn}>{item}</li>;\r\n        }\r\n        return <li key={key === undefined ? index : key(item)} className={classNames(className)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable, IObservableArray, isObservableArray, observe, makeObservable } from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { uid } from 'tonwa-core';\r\nimport { ListBase } from './base';\r\nimport { List } from './index';\r\nimport { IPageItems } from '../../tool';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface SelectableItem {\r\n    selected: boolean;\r\n    item: any;\r\n    labelId: string;\r\n}\r\n\r\nexport class Selectable extends ListBase {\r\n    _items: SelectableItem[] = null;\r\n    private inputItems: { [uid: string]: HTMLInputElement } = {};\r\n\r\n    constructor(list: List) {\r\n        super(list);\r\n        makeObservable(this, {\r\n            _items: observable\r\n        })\r\n        this.buildItems();\r\n        this.listenArraySplice();\r\n    }\r\n\r\n    private listenArraySplice() {\r\n        let { items } = this.list.props;\r\n        if (items === undefined) return;\r\n        if (items === null) return;\r\n        let itemsArray: any;\r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as IPageItems<any>).items;\r\n        }\r\n        if (isObservableArray(items) === true) {\r\n            observe(itemsArray as IObservableArray<any>, (change) => {\r\n                if (change.type === 'splice') {\r\n                    let { index, removedCount, added } = change;\r\n                    let _added = added && added.map(v => {\r\n                        return {\r\n                            selected: false,\r\n                            item: v,\r\n                            labelId: uid()\r\n                        }\r\n                    });\r\n                    this._items.splice(index, removedCount, ..._added);\r\n                    this.buildItems();\r\n                }\r\n            }, true);\r\n        }\r\n    }\r\n\r\n    private buildItems = () => {\r\n        let { items, isItemSelected, selectedItems, compare } = this.list.props;\r\n        let itemsArray: any[] | IObservableArray<any>;\r\n        if (items === undefined) {\r\n            this._items = undefined;\r\n            return;\r\n        }\r\n        if (items === null) {\r\n            this._items = null;\r\n            return;\r\n        }\r\n\r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as IPageItems<any>).items;\r\n        }\r\n\r\n        if (isItemSelected) {\r\n            let retItems = itemsArray.map(v => {\r\n                return {\r\n                    selected: isItemSelected(v),\r\n                    item: v,\r\n                    labelId: uid()\r\n                };\r\n            });\r\n            this._items = retItems;\r\n        }\r\n        else {\r\n            let comp: ((item: any, selectItem: any) => boolean);\r\n            if (compare === undefined) {\r\n                comp = (item: any, selectItem: any) => item === selectItem;\r\n            }\r\n            else {\r\n                comp = compare;\r\n            }\r\n            let retItems = itemsArray.map(v => {\r\n                //let isObserved = isObservable(v);\r\n                //let obj = isObserved === true? toJS(v) : v;\r\n                //let obj = v;\r\n                let selected = selectedItems === undefined ?\r\n                    false\r\n                    : selectedItems.find(si => comp(v, si)) !== undefined;\r\n                return {\r\n                    selected: selected,\r\n                    item: v,\r\n                    labelId: uid()\r\n                };\r\n            });\r\n            this._items = retItems;\r\n        }\r\n    }\r\n\r\n    get items() {\r\n        //if (this._items === undefined) \r\n        //this.buildItems();\r\n        return this._items;\r\n    }\r\n    private checkAll(on: boolean) {\r\n        for (let i in this.inputItems) this.inputItems[i].checked = on;\r\n        for (let item of this._items) item.selected = on;\r\n    }\r\n    selectAll() {\r\n        //if (this._items) this._items.forEach(v => v.selected = true);\r\n        this.checkAll(true);\r\n        this.list.props.item.onSelect(undefined, true, this.anySelected);\r\n    }\r\n    unselectAll() {\r\n        this.checkAll(false);\r\n        this.list.props.item.onSelect(undefined, false, this.anySelected);\r\n    }\r\n\r\n    private get anySelected(): boolean { return this._items.some(v => v.selected) }\r\n    private onSelect(item: SelectableItem, selected: boolean) {\r\n        item.selected = selected;\r\n        this.list.props.item.onSelect(item.item, selected, this.anySelected);\r\n    }\r\n\r\n    get selectedItems(): any[] {\r\n        return this._items.filter(v => v.selected === true).map(v => v.item);\r\n    }\r\n\r\n    render = (item: SelectableItem, index: number): JSX.Element => {\r\n        let { key } = this.list.props.item;\r\n        return React.createElement(this.row, { item, index, key: key === undefined ? index : key(item) });\r\n    }\r\n\r\n    private row = observer((props: { item: SelectableItem, index: number }): JSX.Element => {\r\n        let { item, index } = props;\r\n        let { className } = this.list.props.item;\r\n        let { labelId, selected, item: obItem } = item;\r\n        return <li className={classNames(className)}>\r\n            <div className=\"d-flex align-items-center px-3\">\r\n                <input ref={input => { if (input) this.inputItems[labelId] = input; }}\r\n                    className=\"\" type=\"checkbox\" value=\"\" id={labelId}\r\n                    defaultChecked={selected}\r\n                    onChange={(e) => {\r\n                        this.onSelect(item, e.target.checked)\r\n                    }\r\n                    } />\r\n                <label className=\"\" style={{ flex: 1, marginBottom: 0 }} htmlFor={labelId}>\r\n                    {this.renderContent(obItem, index)}\r\n                </label>\r\n            </div>\r\n        </li>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observer } from 'mobx-react';\r\nimport { resLang } from 'tonwa-core';\r\nimport { ListRes, listRes } from 'tonwa-core';\r\nimport _ from 'lodash';\r\nimport { ListBase } from './base';\r\nimport { Clickable } from './clickable';\r\nimport { Static } from './static';\r\nimport { Selectable } from './selectable';\r\nimport '../../css/va-list.css';\r\nimport { IObservableArray } from 'mobx';\r\nimport { IPageItems } from '../../tool';\r\n\r\ntype StaticRow = string | JSX.Element | (() => string | JSX.Element);\r\ninterface ItemProps {\r\n    className?: string | string[];\r\n    render?: (item: any, index: number) => JSX.Element;\r\n    onSelect?: (item: any, isSelected: boolean, anySelected: boolean) => void;\r\n    onClick?: (item: any) => void;\r\n    key?: (item: any) => string | number;\r\n}\r\n\r\nexport interface ListProps {\r\n    className?: string | string[];\r\n    items: any[] | IObservableArray<any> | IPageItems<any>;\r\n    item: ItemProps;\r\n    isItemSelected?: (item: any) => boolean;\r\n    compare?: (item: any, selectItem: any) => boolean;\r\n    selectedItems?: any[];\r\n    header?: StaticRow;\r\n    footer?: StaticRow;\r\n    before?: StaticRow;\r\n    loading?: StaticRow;\r\n    none?: StaticRow;\r\n    onFocus?: (evt: React.FocusEvent<HTMLUListElement>) => void;\r\n}\r\n\r\n@observer\r\nexport class List extends React.Component<ListProps> {\r\n    private static res: ListRes = resLang<ListRes>(listRes);\r\n\r\n    private listBase: ListBase;\r\n    private selectable: Selectable;\r\n    constructor(props: ListProps) {\r\n        super(props);\r\n        this.buildBase();\r\n    }\r\n    _$scroll = (direct: 'top' | 'bottom') => {\r\n        console.log('############### items scroll to ' + direct);\r\n    }\r\n    private buildBase() {\r\n        let { item } = this.props;\r\n        let { onClick, onSelect } = item;\r\n        if (onSelect !== undefined)\r\n            this.selectable = this.listBase = new Selectable(this);\r\n        else if (onClick !== undefined)\r\n            this.listBase = new Clickable(this);\r\n        else\r\n            this.listBase = new Static(this);\r\n    }\r\n    componentDidUpdate(prevProps: Readonly<ListProps>, prevState: Readonly<any>) {\r\n        if (_.isEqual(this.props.item, prevProps.item) === false) {\r\n            this.buildBase();\r\n            this.forceUpdate();\r\n        }\r\n    }\r\n    componentWillUnmount() {\r\n        this.listBase.dispose();\r\n    }\r\n    selectAll() {\r\n        if (this.selectable) this.selectable.selectAll();\r\n    }\r\n    unselectAll() {\r\n        if (this.selectable) this.selectable.unselectAll();\r\n    }\r\n    get selectedItems(): any[] {\r\n        return this.listBase.selectedItems;\r\n    }\r\n    render() {\r\n        let { className, header, footer, before, loading, none, onFocus } = this.props;\r\n        if (before === undefined) before = '-';\r\n        if (loading === undefined) loading = () => <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />;\r\n        if (none === undefined) none = List.res.none;\r\n        let { items, loading: isLoading } = this.listBase;\r\n        function staticRow(row: StaticRow, type: string) {\r\n            if (!row) return;\r\n            switch (typeof row) {\r\n                default:\r\n                case 'string': return <li className={\"va-list-\" + type}>{row}</li>;\r\n                case 'function': return <li className={\"va-list-\" + type}>{(row as () => string | JSX.Element)()}</li>;\r\n                case 'object': return <li>{row}</li>\r\n            }\r\n        }\r\n        let content: any, waitingMore: any;\r\n        if (items === null)\r\n            content = staticRow(before, 'before');\r\n        else if (items === undefined)\r\n            content = staticRow(loading, 'loading');\r\n        else if (items.length === 0)\r\n            content = staticRow(none, 'none');\r\n        else {\r\n            content = items.map((item, index) => {\r\n                return this.listBase.render(item, index);\r\n            });\r\n        }\r\n        if (isLoading === true && items) {\r\n            waitingMore = staticRow(loading, 'loading');\r\n        }\r\n        let tabIndex: number;\r\n        if (onFocus !== undefined) tabIndex = -1;\r\n        return <ul className={classNames('va-list', className)} onFocus={onFocus} tabIndex={tabIndex}>\r\n            {staticRow(header, 'header')}\r\n            {content}\r\n            {waitingMore}\r\n            {staticRow(footer, 'footer')}\r\n        </ul>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { setRes } from 'tonwa-core';\r\n\r\nexport interface EasyDateProps {\r\n\tdate: Date | number;\r\n\ttimeZone?: number;\r\n}\r\n\r\n//type YMD = (year:number, month:number, date:number) => string;\r\n//type MD = (month:number, date:number) => string;\r\n\r\nconst timeRes: { [prop: string]: any } = {\r\n\tmd: (month: number, date: number) => `${month}-${date}`,\r\n\tymd: (year: number, month: number, date: number) => `${year}-${month}-${date}`,\r\n\tyesterday: 'Yday',\r\n\ttoday: 'Today',\r\n\ttomorrow: 'Tmw',\r\n\t$zh: {\r\n\t\tmd: (month: number, date: number) => `${month}月${date}日`,\r\n\t\tymd: (year: number, month: number, date: number) => `${year}年${month}月${date}日`,\r\n\t\tyesterday: '昨天',\r\n\t\ttoday: '今天',\r\n\t\ttomorrow: '明天',\r\n\t},\r\n\t$en: {\r\n\t\tmd: (month: number, date: number) => `${month}-${date}`,\r\n\t\tymd: (year: number, month: number, date: number) => `${year}-${month}-${date}`,\r\n\t\tyesterday: 'Yday',\r\n\t\ttoday: 'Today',\r\n\t\ttomorrow: 'Tmw',\r\n\t}\r\n}\r\n\r\nsetRes(timeRes, timeRes);\r\n\r\nfunction tt(str: string): any {\r\n\treturn timeRes[str];\r\n}\r\n\r\nfunction renderDate(vDate: Date | number, withTime: boolean, always: boolean = false) {\r\n\tif (!vDate) return null;\r\n\tlet date: Date;\r\n\tswitch (typeof vDate) {\r\n\t\tdefault: date = vDate as Date; break;\r\n\t\tcase 'string': date = new Date(vDate); break;\r\n\t\tcase 'number': date = new Date((vDate as number) * 1000); break;\r\n\t}\r\n\r\n\tlet now = new Date();\r\n\tlet tick: number, nDate: number, _date: number, month: number, year: number, nowYear: number;\r\n\tlet d = date;\r\n\ttick = now.getTime() - d.getTime();\r\n\tlet hour = d.getHours(), minute = d.getMinutes();\r\n\tnDate = now.getDate();\r\n\t_date = d.getDate();\r\n\tmonth = d.getMonth() + 1;\r\n\tyear = d.getFullYear();\r\n\tnowYear = now.getFullYear();\r\n\r\n\tlet appendTime: boolean = false;\r\n\tlet dPart: string = (function () {\r\n\t\tif (tick < -24 * 3600 * 1000) {\r\n\t\t\tif (year === nowYear) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('md')(month, _date);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('ymd')(year, month, _date);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tick < 24 * 3600 * 1000) {\r\n\t\t\tif (_date !== nDate) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt(tick < 0 ? 'tomorrow' : 'yesterday');\r\n\t\t\t}\r\n\t\t\tif (withTime === true) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\treturn tt('today');\r\n\t\t}\r\n\t\tif (year === nowYear) {\r\n\t\t\treturn tt('md')(month, _date);\r\n\t\t}\r\n\t\treturn tt('ymd')(year, month, _date);\r\n\t})();\r\n\r\n\tlet hm = hour + ((minute < 10 ? ':0' : ':') + minute);\r\n\r\n\t/*\r\n\tif (tick < -24*3600*1000) {\r\n\t\tif (year === nowYear)\r\n\t\t\treturn tt('md')(month, _date) + ' ' + hm;\r\n\t\telse\r\n\t\t\treturn tt('ymd')(year, month, _date) + ' ' + hm;\r\n\t}\r\n\tif (always === true || tick < 24*3600*1000) {\r\n\t\treturn _date!==nDate? \r\n\t\t\ttt(tick < 0? 'tomorrow' : 'yesterday') + ' ' + hm \r\n\t\t\t: withTime===true? hm : tt('today');\r\n\t}\r\n\tif (year === nowYear) {\r\n\t\treturn tt('md')(month, _date);\r\n\t}\r\n\treturn tt('ymd')(year, month, _date);\r\n\t*/\r\n\tif (appendTime === true || always === true) {\r\n\t\treturn dPart + ' ' + hm;\r\n\t}\r\n\treturn dPart;\r\n}\r\n\r\n\r\nexport class EasyDate extends React.Component<EasyDateProps> {\r\n\trender() {\r\n\t\treturn renderDate(this.props.date, false);\r\n\t}\r\n}\r\n\r\ninterface EasyTimeProps extends EasyDateProps {\r\n\talways?: boolean;\r\n}\r\nexport class EasyTime extends React.Component<EasyTimeProps> {\r\n\trender() {\r\n\t\tlet { date, always } = this.props;\r\n\t\treturn renderDate(date, true, always);\r\n\t}\r\n}\r\n\r\ninterface DateProps {\r\n\tdate: Date;\r\n\thideTime?: boolean;\r\n\thideSameYear?: boolean;\r\n}\r\nexport const VDate: React.FunctionComponent<DateProps> = (props) => {\r\n\tlet { date, hideTime, hideSameYear } = props;\r\n\tlet year = date.getFullYear();\r\n\tlet vTime: any;\r\n\tif (hideTime !== true) {\r\n\t\tvTime = <>{date.getHours()}:{String(100 + date.getMinutes()).substr(1, 2)}</>;\r\n\t}\r\n\tlet vDate = <>{date.getMonth() + 1}-{date.getDate()}</>;\r\n\tif (hideSameYear === true && year === new Date().getFullYear()) {\r\n\t}\r\n\telse {\r\n\t\tvDate = <>{year}-{vDate}</>;\r\n\t}\r\n\treturn <>\r\n\t\t{vDate} {vTime}\r\n\t</>;\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface DropdownAction {\r\n    icon?: string;\r\n    caption?: string;\r\n\taction?: () => void;\r\n\ticonClass?: string;\r\n\tcaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsProps {\r\n    icon?: string;\r\n\tcontent?: string|JSX.Element;\r\n    actions: DropdownAction[];\r\n    isRight?: boolean;\r\n\tclassName?: string;\r\n\tcontainerClass?: string;\r\n\titemIconClass?: string;\r\n\titemCaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsState {\r\n    dropdownOpen: boolean;\r\n}\r\n\r\nexport class DropdownActions extends React.Component<DropdownActionsProps, DropdownActionsState> {\r\n    private menu: HTMLDivElement;\r\n    private button: HTMLElement;\r\n    constructor(props:DropdownActionsProps) {\r\n        super(props);\r\n        this.state = {\r\n            dropdownOpen: false\r\n        };\r\n    }\r\n\r\n\t/*\r\n    componentDidMount() {\r\n        document.addEventListener('click', this.handleDocumentClick);\r\n        document.addEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.removeEventListener('click', this.handleDocumentClick);\r\n        document.removeEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\t*/\r\n\r\n    private handleDocumentClick = (evt:any) => {\r\n\t\tdocument.removeEventListener('click', this.handleDocumentClick);\r\n\t\tdocument.removeEventListener('touchstart', this.handleDocumentClick);\r\n\t\tif (this.state.dropdownOpen === false) return;\r\n        //if (this.button && this.button.contains(evt.target)) return;\r\n        if (!this.menu) return;\r\n        //if (!this.menu.contains(evt.target)) \r\n        this.toggle();\r\n    }\r\n\r\n    private toggle = () => {\r\n\t\tlet {dropdownOpen} = this.state;\r\n\t\tdropdownOpen = !dropdownOpen;\r\n        this.setState({dropdownOpen});\r\n\t\tif (dropdownOpen === true) {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tdocument.addEventListener('click', this.handleDocumentClick);\r\n\t\t\t\tdocument.addEventListener('touchstart', this.handleDocumentClick);\t\r\n\t\t\t},10)\r\n\t\t}\r\n    }\r\n\r\n    render() {\r\n        let {icon, content, actions, isRight, className, containerClass, itemIconClass, itemCaptionClass} = this.props;\r\n        if (isRight === undefined) isRight = true;\r\n        let hasIcon = actions.some(v => {\r\n\t\t\tif (!v) return false;\r\n\t\t\treturn v.icon !== undefined\r\n\t\t});\r\n        let {dropdownOpen} = this.state;\r\n\t\t//isOpen={this.state.dropdownOpen} toggle={this.toggle}\r\n\t\tlet cn = className || 'cursor-pointer dropdown-toggle btn btn-sm';\r\n\t\t//if (className) cn += className;\r\n        return <div className={classNames('dropdown', containerClass)}>\r\n\t\t\t<button ref={v=>this.button=v} \r\n\t\t\t\tclassName={cn}\r\n                data-toggle=\"dropdown\"\r\n                aria-expanded={dropdownOpen}\r\n                onClick={this.toggle}>\r\n                {icon!==null && <i className={classNames('fa fa-fw ', 'fa-'+(icon||'ellipsis-v'))} />}\r\n\t\t\t\t{content && <span className=\"ms-1\">{content}</span>}\r\n            </button>\r\n            <div ref={v => this.menu=v} className={classNames({\"dropdown-menu\":true, \"dropdown-menu-right\":isRight, \"show\":dropdownOpen})}>\r\n                {\r\n                    actions.map((v,index) => {\r\n\t\t\t\t\t\tif (!v) {\r\n                            return <div className=\"dropdown-divider\" key={index}/>;\r\n\t\t\t\t\t\t}\r\n                        let {icon, caption, action, iconClass, captionClass} = v;\r\n                        if (icon === undefined && caption === undefined) \r\n                            return <div className=\"dropdown-divider\" />;\r\n                        let i:any;\r\n                        if (hasIcon === true) {\r\n                            if (icon !== undefined) icon = 'fa-' + icon;\r\n\t\t\t\t\t\t\tif (!iconClass) iconClass = 'text-info';\r\n\t\t\t\t\t\t\ti = <i className={classNames('me-2', 'fa', icon, 'fa-fw', iconClass || itemIconClass)}\r\n\t\t\t\t\t\t\t\taria-hidden={true}></i>;\r\n                        }\r\n                        if (action === undefined) \r\n                            return <h6 className=\"dropdown-header\">{i} {caption}</h6>;\r\n                        let onMenuItemClick = (evt:React.MouseEvent<HTMLAnchorElement>)=>{\r\n                            evt.preventDefault();\r\n                            action();\r\n                        }\r\n                        let onTouchStart = (evt: React.TouchEvent<HTMLAnchorElement>) => {\r\n                            action();\r\n                        }\r\n                            // eslint-disable-next-line\r\n                        return <a className=\"dropdown-item\" key={index} href=\"#/\" \r\n                            onClick={onMenuItemClick} onTouchStart={onTouchStart}\r\n                            >{i} <span className={captionClass || itemCaptionClass}>{caption}</span></a>\r\n                    })\r\n                }\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport className from 'classnames';\r\nimport {PropGridProps} from './PropGrid';\r\nimport {LabeledProp, StringProp, NumberProp, ListProp, ComponentProp} from './propView';\r\n\r\nexport abstract class PropRow {\r\n    setValues(values: any) {}\r\n    abstract render(key:string): any;\r\n}\r\n\r\nexport class PropBorder extends PropRow {\r\n    render(key:string): JSX.Element {\r\n        return <div key={'_b_' + key} className=\"\">\r\n            <div className=\"w-100\">\r\n                <div style={{borderTop: '1px solid #f0f0f0'}} />\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class PropGap extends PropRow {\r\n    private param: string;\r\n    constructor(param?: string) {\r\n        super();\r\n        this.param = param;\r\n    }\r\n    render(key:string): JSX.Element {\r\n        let w: string;\r\n        switch (this.param) {\r\n            default: w = 'py-2'; break;\r\n            case '=': w = 'py-1'; break;\r\n            case '-': w = 'pb-1'; break;\r\n        }\r\n        let cn = className(w);\r\n        return <div key={'_g_' + key} className={cn} />;\r\n    }\r\n}\r\n\r\nconst valueAlignStart = 'justify-content-start';\r\nconst valueAlignCenter = 'justify-content-center';\r\nconst valueAlignEnd = 'justify-content-end';\r\nexport abstract class LabeledPropRow extends PropRow {\r\n    protected gridProps: PropGridProps;\r\n    protected _prop: LabeledProp;\r\n    protected get prop():LabeledProp {return this._prop}\r\n    protected content: any;\r\n    protected col: string;\r\n    //protected values: any;\r\n    constructor(gridProps:PropGridProps, prop: LabeledProp) {\r\n        super();\r\n        this.gridProps = gridProps;\r\n        this._prop = prop;\r\n        this.col = gridProps.labelFixLeft === true? 'col' : 'col-sm';\r\n        //this.values = values;\r\n    }\r\n    render(key:string):any {\r\n        let {onClick, bk} = this.prop;\r\n        let cn = className({\r\n            \"cursor-pointer\": onClick !== undefined,\r\n            \"bg-white\": bk === undefined, \r\n            \"row\": true\r\n        });\r\n        return <div key={key} className={cn} onClick={onClick}>\r\n            {this.renderLabel()}\r\n            {this.renderProp()}\r\n        </div>;\r\n    }\r\n    protected renderLabel():any {\r\n        let {label} = this.prop;\r\n        if (label === undefined) return null;\r\n        return <label className={this.col + '-3 col-form-label'}>\r\n            {label}\r\n        </label>;\r\n    }\r\n    protected renderProp():any {\r\n        let {label} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string = this.col + (label===undefined? '-12':'-9');\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n    protected renderPropBody():any {\r\n        return <div className=\"form-control-plaintext\">\r\n            {this.renderPropContent()}\r\n        </div>;\r\n    }\r\n    protected renderPropContent():any {\r\n        return this.content;\r\n    }\r\n}\r\n\r\nexport class StringPropRow extends LabeledPropRow {\r\n    protected get prop(): StringProp {return this._prop as StringProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class NumberPropRow extends LabeledPropRow {\r\n    protected get prop(): NumberProp {return this._prop as NumberProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class ListPropRow extends LabeledPropRow {\r\n    protected get prop(): ListProp {return this._prop as ListProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else {\r\n            let list = this.prop.list;\r\n            if (typeof list === 'string') this.content = values[list];\r\n            else this.content = undefined;\r\n        }\r\n    }\r\n    protected renderPropBody() {\r\n        let {list, row} = this.prop;\r\n        let items:any[] = typeof list === 'string'? this.content : list;\r\n        if (items === undefined) return <div/>;\r\n        // new row(item)\r\n        return <div className=\"w-100\">\r\n            {\r\n                items.map((item, index) => <React.Fragment key={index}>\r\n                    {index===0? null: <div style={{width:'100%', borderBottom:'1px solid #f0f0f0'}} />}\r\n                    {React.createElement(row, item)}\r\n                </React.Fragment>)\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class ComponentPropRow extends LabeledPropRow {\r\n    protected get prop(): ComponentProp {return this._prop as ComponentProp;}\r\n    protected renderPropBody() {\r\n        let {component} = this.prop;\r\n        return component;\r\n    }\r\n    protected renderProp():any {\r\n        let {label, full} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string;\r\n        if (full !== true)\r\n            col = this.col + (label===undefined? '-12':'-9');\r\n        else\r\n            col = 'w-100';\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n}\r\n","import { PropGridProps } from './PropGrid';\r\nimport {\r\n    PropRow, PropBorder, PropGap, \r\n    StringPropRow, NumberPropRow, ListPropRow, ComponentPropRow\r\n} from './row';\r\n\r\nexport interface Format {\r\n\r\n}\r\n\r\nexport interface PropBase {\r\n    onClick?: () => void;\r\n}\r\n\r\nexport interface LabeledProp extends PropBase {\r\n    label?: string;\r\n    bk?: string;\r\n    vAlign?: 'top' | 'bottom' | 'center' | 'stretch';\r\n}\r\n\r\nexport interface StringProp extends LabeledProp {\r\n    type: 'string';\r\n    name: string;\r\n}\r\n\r\nexport interface NumberProp extends LabeledProp {\r\n    type: 'number';\r\n    name: string;\r\n\tisInt: boolean;\t\t// 整数\r\n\ttime: boolean;\t\t// 字段log的time可以客户端输入\r\n}\r\n\r\nexport interface FormatProp extends LabeledProp {\r\n    type: 'format';\r\n    format: Format;\r\n}\r\n\r\nexport interface ListProp extends LabeledProp {\r\n    type: 'list';\r\n    list: string | any[];  // string 表示名字，否则就是值\r\n    row: new (props: any) => React.Component;\r\n}\r\n\r\nexport interface ComponentProp extends LabeledProp {\r\n    type: 'component';\r\n    full?: boolean;\r\n    component: any; //JSX.Element;\r\n}\r\n\r\nexport type Prop = StringProp | NumberProp | FormatProp | ListProp | ComponentProp | string;\r\n\r\nexport class PropView {\r\n    private gridProps: PropGridProps\r\n    private props: Prop[];\r\n    //private values:any;\r\n    private rows: PropRow[];\r\n\r\n    constructor(gridProps: PropGridProps, props: Prop[]) {\r\n        this.gridProps = gridProps;\r\n        this.props = props;\r\n        //this.values = values;\r\n        this.buildRows();\r\n    }\r\n\r\n    private buildRows() {\r\n        this.rows = [];\r\n        let isGap: boolean = true;\r\n        for (let prop of this.props) {\r\n            if (typeof prop === 'string') {\r\n                this.rows.push(new PropGap(prop));\r\n                isGap = true;\r\n            }\r\n            else {\r\n                if (!isGap) this.rows.push(new PropBorder());\r\n                let row;\r\n                switch (prop.type) {\r\n                    default: continue;\r\n                    case 'string': row = new StringPropRow(this.gridProps, prop); break;\r\n                    case 'number': row = new NumberPropRow(this.gridProps, prop); break;\r\n                    case 'list': row = new ListPropRow(this.gridProps, prop); break;\r\n                    case 'component': row = new ComponentPropRow(this.gridProps, prop); break;\r\n                }\r\n                this.rows.push(row);\r\n                isGap = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    setValues(values: any) {\r\n        for (let r of this.rows) r.setValues(values);\r\n    }\r\n\r\n    render() {\r\n        return this.rows.map((row, index) => row.render(String(index)));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, PropView} from './propView';\r\n\r\nexport interface PropGridProps {\r\n    className?: string;\r\n    rows: Prop[];\r\n    values: any;\r\n    alignValue?: 'left'|'center'|'right';\r\n    labelFixLeft?: boolean;\r\n}\r\n\r\n@observer\r\nexport class PropGrid extends React.Component<PropGridProps> {\r\n    render() {\r\n        let {className, rows, values} = this.props;\r\n        let propView = new PropView(this.props, rows);\r\n        propView.setValues(values);\r\n        let cn = classNames('container-fluid', className);\r\n        return <div className={cn}>\r\n            {propView.render()}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Image } from './image';\r\n\r\nexport interface MediaProps {\r\n    icon: string;\r\n    main: string|JSX.Element;\r\n    discription?: string | JSX.Element;\r\n    px?: number;\r\n    py?: number;\r\n}\r\n\r\nexport class Media extends React.Component<MediaProps> {\r\n    render() {\r\n        let {icon, main, discription, px, py} = this.props;\r\n        let disp:any;\r\n        if (typeof discription === 'string')\r\n            disp = <div>{discription}</div>;\r\n        else\r\n            disp = discription;\r\n        let cn = classNames(\r\n            'media', \r\n            px===undefined? 'px-0':'px-'+px, \r\n            py===undefined? 'py-2':'py-'+py);\r\n        return <div className={cn}>\r\n            <Image className=\"me-3 w-4c h-4c\" src={icon} />\r\n            <div className=\"media-body\">\r\n                <h5 className=\"mt-0\">{main}</h5>\r\n                {disp}\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { env } from 'tonwa-core';\r\n\r\nexport interface SearchBoxProps {\r\n    className?: string;\r\n    label?: string;\r\n    initKey?: string;\r\n    placeholder?: string;\r\n    buttonText?: string;\r\n    maxLength?: number;\r\n    size?: 'sm' | 'md' | 'lg';\r\n    inputClassName?: string;\r\n    onSearch: (key: string) => Promise<void>;\r\n    onFocus?: () => void;\r\n    allowEmptySearch?: boolean;\r\n}\r\n\r\n/*\r\nexport interface SearchBoxState {\r\n    disabled: boolean;\r\n}*/\r\n\r\nexport class SearchBox extends React.Component<SearchBoxProps> { //}, SearchBoxState> {\r\n    private input: HTMLInputElement;\r\n    private button: HTMLButtonElement;\r\n    private key: string = null;\r\n\r\n    private onChange = (evt: React.ChangeEvent<any>) => {\r\n        this.key = evt.target.value;\r\n        if (this.key !== undefined) {\r\n            this.key = this.key.trim();\r\n            if (this.key === '') this.key = undefined;\r\n        }\r\n        console.log('key = ' + this.key);\r\n        if (this.props.allowEmptySearch === true) {\r\n        }\r\n        else {\r\n            this.button.disabled = this.key === undefined || this.key.length === 0;\r\n        }\r\n    }\r\n    private onSubmit = async (evt: React.FormEvent<any>) => {\r\n        evt.preventDefault();\r\n        if (this.key === null) this.key = this.props.initKey || '';\r\n        if (this.props.allowEmptySearch !== true) {\r\n            if (!this.key) return;\r\n            if (this.input) this.input.disabled = true;\r\n            if (this.button) this.button.disabled = true;\r\n        }\r\n        await this.props.onSearch(this.key);\r\n        if (this.input) this.input.disabled = false;\r\n        if (this.button) this.button.disabled = false;\r\n    }\r\n    clear() {\r\n        if (this.input) this.input.value = '';\r\n    }\r\n    render() {\r\n        let { className, inputClassName, onFocus,\r\n            label, placeholder, buttonText, maxLength, size } = this.props;\r\n        let inputSize: string;\r\n        switch (size) {\r\n            default:\r\n            case 'sm': inputSize = 'input-group-sm'; break;\r\n            case 'md': inputSize = 'input-group-md'; break;\r\n            case 'lg': inputSize = 'input-group-lg'; break;\r\n        }\r\n        let autoComplete: string;\r\n        if (env.isMobile === true) autoComplete = 'off';\r\n        return <form className={className} onSubmit={this.onSubmit} autoComplete={autoComplete}>\r\n            <div className={classNames(\"input-group\", inputSize)}>\r\n                {label && <div className=\"input-group-addon align-self-center me-2\">{label}</div>}\r\n                <input ref={v => this.input = v} onChange={this.onChange}\r\n                    type=\"text\"\r\n                    name=\"key\"\r\n                    onFocus={onFocus}\r\n                    className={classNames('form-control', inputClassName || 'border-primary')}\r\n                    placeholder={placeholder}\r\n                    defaultValue={this.props.initKey}\r\n                    maxLength={maxLength} />\r\n                <div className=\"input-group-append\">\r\n                    <button ref={v => this.button = v} className=\"btn btn-primary\"\r\n                        type=\"submit\"\r\n                        disabled={this.props.allowEmptySearch !== true}>\r\n                        <i className='fa fa-search' />\r\n                        <i className=\"fa\" />\r\n                        {buttonText}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </form>;\r\n    }\r\n}\r\n","import React from \"react\";\r\nimport classNames from 'classnames';\r\nimport { tonwa } from \"tonwa-core\";\r\n// import { nav } from \"../../nav\";\r\n\r\nexport interface AxProps extends React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement> {\r\n\t//children: React.ReactNode;\r\n\t//href: string;\r\n\t//onClick?: (event:React.MouseEvent) => void;\r\n\t//className?: string;\r\n\taClassName?: string;\r\n\tnaClassName?: string;\r\n\t//target?: string;\r\n\t//props?: any;\r\n}\r\n\r\n// 如果是web方式，用webNav方式route网页\r\n// 如果是app方式，用click方式压栈页面\r\nexport const Ax = (axProps: AxProps) => {\r\n\tlet { href, children, className, onClick } = axProps;\r\n\tif (tonwa.nav.isWebNav === true) {\r\n\t\tlet { aClassName } = axProps;\r\n\t\tif (!href) return <span className=\"text-danger\">Error: href not defined in Ax</span>;\r\n\t\tlet onAxClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tlet ret: boolean;\r\n\t\t\tif (onClick) {\r\n\t\t\t\tret = onClick(evt) as unknown as boolean;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttonwa.navigate(href);\r\n\t\t\t\tret = false;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\treturn <a {...axProps} className={classNames(className, aClassName)} onClick={onAxClick}>{children}</a>;\r\n\t}\r\n\telse {\r\n\t\tlet { naClassName } = axProps;\r\n\t\tif (!onClick) {\r\n\t\t\tonClick = () => {\r\n\t\t\t\tif (tonwa.openSysPage(href) === false) {\r\n\t\t\t\t\ttonwa.navigate(href);\r\n\t\t\t\t};\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <span className={classNames(className, 'cursor-pointer', naClassName)} onClick={onClick}>{children}</span>;\r\n\t}\r\n}\r\n\r\n// 同普通的a tag\r\n// 会自动处理href，处理生产版跟测试版之间的不同\r\nexport const A = (props: React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement>) => {\r\n\tlet { children } = props;\r\n\tif (tonwa.nav.isWebNav === false) {\r\n\t\treturn <a {...props}>{children}</a>;\r\n\t}\r\n\tlet { href } = props;\r\n\t//if (nav.testing === true) href += '#test';\r\n\tlet onClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\tevt.preventDefault();\r\n\t\ttonwa.navigate(href);\r\n\t\treturn false;\r\n\t}\r\n\treturn <a {...props} href={href} onClick={onClick}>{children}</a>;\r\n}\r\n","import { action, makeObservable, observable } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport React, { Component } from \"react\";\r\nimport { Rule, RuleCustom, RuleRequired } from \"../inputRules\";\r\n\r\nexport interface InputProps {\r\n    className?: string;\r\n    defaultValue?: any;\r\n    disabled?: boolean;\r\n    onValueChange?: (newValue:any, preValue:any, ruleMessage:string) => void;\r\n    required?: boolean;\r\n    containerClassName?: string;\r\n    ruleClassName?: string;\r\n    requiredFlagElement?: JSX.Element;\r\n    rules?: ((value:any) => string[] | string)[];\r\n}\r\n\r\nexport abstract class Input<P extends InputProps, V> extends Component<P> {\r\n    static defaultRequiredFlagElement = <span className=\"mx-2 text-danger\">*</span>;\r\n    static defaultRuleClassName = ' mx-2 text-danger ';\r\n    protected readonly rules: Rule[] = [];\r\n    protected value: V = null;\r\n    protected input: HTMLInputElement;\r\n    protected abstract get type(): 'text' | 'number' | 'checkbox' | 'radio';\r\n    protected get placeholder(): string {return undefined;}\r\n    protected get max(): number {return undefined;}\r\n    protected get min(): number {return undefined;}\r\n    protected get maxLength(): number {return undefined;}\r\n    protected get className(): string {return this.props.className}\r\n    protected requiredFlagElement?: JSX.Element;\r\n    ruleMessage: string = null;\r\n    constructor(props: P) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            ruleMessage: observable,\r\n            onChange: action,\r\n            onFocus: action,\r\n            onBlur: action,\r\n        });\r\n        this.init();\r\n    }\r\n\r\n    private init() {\r\n        let {required, rules, requiredFlagElement, defaultValue} = this.props;\r\n        if (required === true) {\r\n            if (requiredFlagElement === undefined) requiredFlagElement = Input.defaultRequiredFlagElement;\r\n            this.requiredFlagElement = requiredFlagElement;\r\n            this.rules.push(new RuleRequired());\r\n        }\r\n        this.buildRules();\r\n        if (rules) {\r\n            for (let rule of rules) {this.rules.push(new RuleCustom(rule))};\r\n        }\r\n        this.value = defaultValue;\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    getValue(): V {return this.value;}\r\n    setValue(v: V) {\r\n        let p = this.value;\r\n        this.value = v;\r\n        this.checkRules();\r\n        let {onValueChange} = this.props;\r\n        if (!onValueChange) return;\r\n        if (v !== p) onValueChange(v, p, this.ruleMessage);\r\n    }\r\n\r\n    render(): JSX.Element {\r\n        let {defaultValue, disabled, required} = this.props;\r\n        let content = <input ref={inp => this.input = inp}\r\n            className={this.className} type={this.type}\r\n            placeholder={this.placeholder}\r\n            defaultValue={defaultValue}\r\n            defaultChecked={defaultValue}\r\n            maxLength={this.maxLength}\r\n            max={this.max}\r\n            min={this.min}\r\n            disabled={disabled}\r\n            onChange={() => this.onChange()}\r\n            onBlur={() => this.onBlur()}\r\n            onFocus={() => this.onFocus()} />;\r\n        if (this.rules.length === 0) return content;\r\n        let {containerClassName, ruleClassName} = this.props;\r\n        return <span className={containerClassName}>\r\n            {required===true && this.requiredFlagElement}\r\n            {content}\r\n            {\r\n                React.createElement(observer(() => {\r\n                    return <span className={ruleClassName ?? Input.defaultRuleClassName}>{this.ruleMessage}</span>\r\n                }))\r\n            }\r\n        </span>;\r\n    }\r\n\r\n    onChange() {\r\n        let preValue = this.value;\r\n        let value = this.value = this.valueFromInput();\r\n        this.checkRules();\r\n        let {onValueChange} = this.props;\r\n        if (!onValueChange) return;\r\n        if (value !== preValue) onValueChange(value, preValue, this.ruleMessage);\r\n    }\r\n\r\n    protected valueFromInput():V {return;}\r\n\r\n    protected checkRules() {\r\n        let defy:string[] = [];\r\n        for (let rule of this.rules) {\r\n            rule.check(defy, this.value);\r\n        }\r\n        if (defy.length === 0) {\r\n            this.ruleMessage = null;\r\n        }\r\n        else {\r\n            this.ruleMessage = defy[0];\r\n        }\r\n    }\r\n\r\n    onBlur() {\r\n        this.checkRules();\r\n    }\r\n\r\n    onFocus() {\r\n        this.ruleMessage = null;\r\n    }\r\n}\r\n","import { RuleInt, RuleNum } from \"../../inputRules\";\r\nimport { Input, InputProps } from \"../input\";\r\n\r\ninterface InputNumberProps extends InputProps {\r\n    placeholder?: string;\r\n    max?: number;\r\n    min?: number;\r\n}\r\n\r\nexport class InputNumber<P extends InputNumberProps> extends Input<P, number> {\r\n    static defaultClassName = 'form-control w-8c d-inline text-right';\r\n\r\n    protected get type(): 'text' | 'number' | 'checkbox' | 'radio' { return 'number' }\r\n    protected get max(): number { return this.props.max; }\r\n    protected get min(): number { return this.props.min; }\r\n    protected get className(): string {\r\n        let { className } = this.props;\r\n        if (className === null) return null;\r\n        if (!className) return InputNumber.defaultClassName;\r\n        return className;\r\n    }\r\n\r\n    protected buildRules() {\r\n        let { max, min } = this.props;\r\n        this.rules.push(new RuleNum(undefined, min, max));\r\n    }\r\n\r\n    protected parseValue(): number {\r\n        return Number.parseFloat(this.input.value);\r\n    }\r\n\r\n    protected valueFromInput(): number {\r\n        let v = this.parseValue();\r\n        if (isNaN(v) === true) return undefined;\r\n        return v;\r\n    }\r\n}\r\n\r\nexport interface InputIntegerProps extends InputNumberProps {\r\n}\r\n\r\nexport class InputInteger<P extends InputIntegerProps> extends InputNumber<P> {\r\n    protected buildRules() {\r\n        let { max, min } = this.props;\r\n        this.rules.push(new RuleInt(undefined, min, max));\r\n    }\r\n\r\n    protected parseValue(): number {\r\n        return Number.parseInt(this.input.value);\r\n    }\r\n}\r\n","import { Input, InputProps } from \"../input\";\r\n\r\nexport interface InputCheckBoxProps extends InputProps {\r\n}\r\n\r\nexport class InputCheckBox extends Input<InputCheckBoxProps, boolean> {\r\n    static defaultClassName = 'form-check-input p-2';\r\n\r\n    protected get type(): 'text' | 'number' | 'checkbox' | 'radio' {return 'checkbox'}\r\n    protected get className(): string {\r\n        let {className} = this.props;\r\n        if (className === null) return null;\r\n        if (!className) return InputCheckBox.defaultClassName;\r\n        return className;\r\n    }\r\n\r\n    protected valueFromInput(): boolean {\r\n        return this.input.checked;\r\n    }\r\n    onBlur() {}\r\n    onFocus() {}\r\n    setValue(v: boolean) {\r\n        super.setValue(v);\r\n        this.input.checked = v;\r\n    }\r\n}\r\n","import fs from 'fs';\r\nimport { capitalCase } from \"../tool\";\r\nimport { UqMan } from \"../uqCore\";\r\nimport { UqBuildContext } from './UqBuildContext';\r\n\r\nexport const red = '\\x1b[41m%s\\x1b[0m';\r\nexport let lastBuildTime:number = 0;\r\n//export const uqTsSrcPath = 'src/UqApp';\r\n\r\nexport function saveSrcTsFileIfNotExists(context:UqBuildContext, fileName:string, suffix:string, content:string) {\r\n\tlet tsFilePath = `${context.uqTsSrcPath}/${fileName}.${suffix}`;\r\n\tsaveTsFileIfNotExists(tsFilePath, content);\r\n\t//if (fs.existsSync(tsFile) === true) return;\r\n\t//saveTsFile(fileName, content, suffix);\r\n}\r\nexport function saveTsFile(context:UqBuildContext, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet {uqTsSrcPath} = context;\r\n\tlet srcFile = `${uqTsSrcPath}/${fileName}.${suffix}.txt`;\r\n\tlet tsFile = `${uqTsSrcPath}/${fileName}.${suffix}`;\r\n\tif (!fs.existsSync(srcFile)) {\r\n\t\tif (fs.existsSync(tsFile)) {\r\n\t\t\tfs.renameSync(tsFile, srcFile);\r\n\t\t}\r\n\t}\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\nexport function overrideTsFile(path:string, content:string) {\r\n\t//let tsFile = `${path}/${fileName}.${suffix}`;\r\n\tfs.writeFileSync(path, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${path} is built`);\r\n}\r\n//fileName:string, \r\n//, suffix:string = 'ts'\r\nexport function saveTsFileIfNotExists(tsFilePath:string, content:string) {\r\n\t//let tsFilePath = `${path}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFilePath) === true) return;\r\n\toverrideTsFile(tsFilePath, content);\r\n}\r\n\r\n/*\r\nfunction createTsFile(path:string, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet tsFile = `${path}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFile) === true) return;\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\n*/\r\nexport function entityName(s:string):string {\r\n\treturn capitalCase(s);\r\n}\r\n\r\nexport function getNameFromUq(uqMan:UqMan):{devName:string; uqName:string} {\r\n\tlet {config} = uqMan;\r\n\tlet devPart:string, uqPart:string;\r\n\tif (config) {\r\n\t\tlet {dev, name, alias} = config;\r\n\t\tlet {name:devName, alias:devAlias} = dev;\r\n\t\tdevPart = devAlias || devName;\r\n\t\tuqPart = alias || name;\r\n\t}\r\n\telse {\r\n\t\tlet {uqOwner, uqName} = uqMan;\r\n\t\tdevPart = uqOwner;\r\n\t\tuqPart = uqName;\r\n\t}\r\n\treturn {\r\n\t\tdevName: capitalCase(devPart),\r\n\t\tuqName: capitalCase(uqPart),\r\n\t};\r\n}\r\n","import { Tonwa, User, Web } from \"tonwa-core\";\r\nimport { VPage } from \"./VPage\";\r\nimport { Controller, WebNav } from \"./Controller\";\r\n\r\nexport abstract class ControllerWithWeb extends Controller {\r\n    readonly web: Web;\r\n    constructor(tonwa: Tonwa) {\r\n        super(tonwa);\r\n        this.web = tonwa.web;\r\n    }\r\n\r\n    private receiveHandlerId: number;\r\n    //private disposer:()=>void;\r\n\r\n    protected dispose = () => {\r\n        // message listener的清理\r\n        //nav.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.web.messageHub.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.onDispose();\r\n    }\r\n\r\n    protected onDispose() {\r\n    }\r\n\r\n    protected async internalStart(param?: any, ...params: any[]): Promise<void> {\r\n        return;\r\n    }\r\n\r\n    get user(): User { return this.tonwa.user }\r\n    get isLogined(): boolean {\r\n        let { user } = this.tonwa;\r\n        if (!user) return false;\r\n        return user.id > 0;\r\n    }\r\n\r\n    get webNav(): WebNav<any> { return undefined; }\r\n\r\n    getWebNav(): WebNav<any> { return this.webNav; }\r\n\r\n    get isWebNav(): boolean { return this.nav.isWebNav }\r\n    navigate(url: string) {\r\n        this.navigate(url);\r\n    }\r\n\r\n    isMe(id: any): boolean {\r\n        if (id === null) return false;\r\n        let { user } = this;\r\n        let userId = user.id;\r\n        switch (typeof id) {\r\n            default: return false;\r\n            case 'string': return Number(id) === userId;\r\n            case 'number': return id === userId;\r\n            case 'object': return id.id === userId;\r\n        }\r\n    }\r\n\r\n    protected onMessage(message: any): Promise<void> {\r\n        return;\r\n    }\r\n\r\n    private onMessageReceive = async (message: any): Promise<void> => {\r\n        await this.onMessage(message);\r\n    }\r\n\r\n    protected async beforeStart(): Promise<boolean> {\r\n        return true;\r\n    }\r\n    protected async afterStart(): Promise<void> {\r\n    }\r\n    protected registerReceiveHandler() {\r\n        this.receiveHandlerId = this.web.messageHub.registerReceiveHandler(this.onMessageReceive);\r\n    }\r\n\r\n    async start(param?: any, ...params: any[]): Promise<void> {\r\n        this.registerReceiveHandler();\r\n        let ret = await this.beforeStart();\r\n        if (ret === false) return;\r\n        await this.internalStart(param, ...params);\r\n        await this.afterStart();\r\n    }\r\n\r\n    get isCalling(): boolean { return this._resolve_$ !== undefined }\r\n\r\n    private _resolve_$: ((value: any) => void)[];\r\n    async call<T>(param?: any, ...params: any[]): Promise<T> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<T>(async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await this.start(param, ...params);\r\n        });\r\n    }\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C) => VPage<C>, param?: any): Promise<any> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await (new vp(this as any)).open(param);\r\n        });\r\n    }\r\n\r\n    returnCall(value: any) {\r\n        if (this._resolve_$ === undefined) return;\r\n        let resolve = this._resolve_$.pop();\r\n        if (resolve === undefined) {\r\n            alert('the Controller call already returned, or not called');\r\n            return;\r\n        }\r\n        resolve(value);\r\n    }\r\n\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { Page } from '../components';\r\nimport { env, Nav, Tonwa } from 'tonwa-core';\r\nimport { Controller } from './Controller';\r\nimport { VPage } from './VPage';\r\n\r\nexport abstract class View<C extends Controller> {\r\n    protected readonly tonwa: Tonwa;\r\n    protected readonly controller: C;\r\n    protected readonly nav: Nav;\r\n    protected readonly res: any;\r\n    protected readonly x: any;\r\n    protected readonly t: (str: string) => any;\r\n\r\n    constructor(controller: C) {\r\n        let tonwa = controller.getTonwa();\r\n        this.tonwa = tonwa;\r\n        this.controller = controller;\r\n        this.nav = tonwa.nav;\r\n        this.t = controller.t;\r\n    }\r\n\r\n    protected get isDev() { return env.isDevelopment }\r\n    get isWebNav(): boolean { return this.nav.isWebNav }\r\n    navigate(url: string) { this.tonwa.navigate(url) }\r\n    abstract render(param?: any): JSX.Element;\r\n\r\n    protected shallow<T extends object>(data: T) {\r\n        return this.controller.shallow(data);\r\n    }\r\n\r\n    protected deep<T extends object>(data: T) {\r\n        return this.controller.deep(data);\r\n    }\r\n\r\n    protected runInAction<T>(fn: () => T): T {\r\n        return this.controller.runInAction(fn);\r\n    }\r\n\r\n    protected react(func: () => JSX.Element): JSX.Element {\r\n        let V = observer(func.bind(this));\r\n        return <V />;\r\n    }\r\n\r\n    protected renderVm(vm: new (controller: C) => View<C>, param?: any) {\r\n        return (new vm(this.controller)).render(param);\r\n    }\r\n\r\n    protected async openVPage(vp: new (controller: C) => VPage<C>, param?: any, afterBack?: () => Promise<void>): Promise<void> {\r\n        await (new vp(this.controller)).open(param, afterBack);\r\n    }\r\n\r\n    protected async event(type: string, value?: any) {\r\n        await this.controller.event(type, value);\r\n    }\r\n\r\n    protected go(showPage: () => void, url: string, absolute?: boolean) {\r\n        this.controller.go(showPage, url, absolute);\r\n    }\r\n    /*\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        return await this.controller.vCall(vp, param);\r\n    }\r\n\r\n    protected returnCall(value:any) {\r\n        this.controller.returnCall(value);\r\n    }\r\n\r\n    protected renderUser(user:any, imageClassName?:string, textClassName?:string) {\r\n        let renderUser = (user:User) => {\r\n            let {name, nick, icon} = user;\r\n            return <>\r\n                <Image src={icon} className={imageClassName || 'w-1c h-1c me-2'} />\r\n                <span className={textClassName}>{nick || name}</span>\r\n            </>;\r\n        }\r\n        return <UserView user={user} render={renderUser} />\r\n    }\r\n\r\n    protected renderUserText(user:any) {\r\n        let renderUser = (user:User) => {\r\n            let {name, nick} = user;\r\n            return <>{nick || name}</>;\r\n        }\r\n        return <UserView user={user} render={renderUser} />\r\n    }\r\n\r\n    protected renderMe(imageClassName?:string, textClassName?:string) {\r\n        let {user} = this.controller;\r\n        if (!user) return;\r\n        return this.renderUser(user.id, imageClassName, textClassName);\r\n    }\r\n    */\r\n    protected openPage(view: React.StatelessComponent<any>, param?: any, onClosePage?: (ret: any) => void) {\r\n        let type = typeof param;\r\n        if (type === 'object' || type === 'undefined') {\r\n            this.controller.openPage(React.createElement(view, param), onClosePage);\r\n        }\r\n        else {\r\n            this.controller.openPage(<Page header=\"param type error\">\r\n                View.openPage param must be object, but here is {type}\r\n            </Page>, onClosePage);\r\n        }\r\n    }\r\n\r\n    protected replacePage(view: React.StatelessComponent<any>, param?: any) {\r\n        this.controller.replacePage(React.createElement(view, param));\r\n    }\r\n\r\n    protected openPageElement(page: JSX.Element, onClosePage?: () => void) {\r\n        this.controller.openPage(page, onClosePage);\r\n    }\r\n\r\n    protected replacePageElement(page: JSX.Element, onClosePage?: () => void) {\r\n        this.controller.replacePage(page, onClosePage);\r\n    }\r\n\r\n    protected backPage() {\r\n        this.controller.backPage();\r\n    }\r\n\r\n    protected closePage(level?: number) {\r\n        this.controller.closePage(level);\r\n    }\r\n\r\n    protected ceasePage(level?: number) {\r\n        this.controller.ceasePage(level);\r\n    }\r\n\r\n    protected removeCeased() {\r\n        this.controller.removeCeased();\r\n    }\r\n\r\n    protected regConfirmClose(confirmClose: () => Promise<boolean>) {\r\n        this.controller.regConfirmClose(confirmClose);\r\n    }\r\n\r\n    protected popToTopPage() {\r\n        this.controller.popToTopPage();\r\n    }\r\n}\r\n","import { Page, Scroller, TabsProps } from \"../components\";\r\nimport { View } from \"./View\";\r\nimport { Controller } from \"./Controller\";\r\n\r\nexport abstract class VPage<C extends Controller> extends View<C> {\r\n\tprotected retOnClosePage: any;\r\n\r\n    open(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.openPageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n    replaceOpen(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.replacePageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n\trender(param?:any):JSX.Element {\r\n\t\tthis.init(param);\r\n\t\treturn this.renderPage();\r\n\t}\r\n\r\n\tinit(param?:any):void {return;}\r\n\r\n\theader():string|boolean|JSX.Element {return null;}\r\n\tright():JSX.Element {return null;}\r\n\tcontent():JSX.Element {return null;}\r\n\tfooter():JSX.Element {return null;}\r\n\tlogout(): boolean | (()=>Promise<void>) {return false;}\r\n\tprotected renderPage():JSX.Element {\r\n\t\tlet header = this.header();\r\n\t\tif (!header) header = false;\r\n\t\tlet logout = this.logout();\r\n\t\treturn <Page\r\n\t\t\theader={header} right={this.right()} footer={this.footer()}\r\n\t\t\tonScroll={(e:any)=>this.onPageScroll(e)}\r\n\t\t\tonScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n\t\t\tonScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n\t\t\tback={this.back}\r\n\t\t\theaderClassName={this.headerClassName}\r\n\t\t\tclassName={this.className}\r\n\t\t\tafterBack={()=>this.afterBack()}\r\n\t\t\ttabsProps={this.tabsProps}\r\n\t\t\tlogout={logout}\r\n\t\t\twebNav={this.controller.pageWebNav}\r\n\t\t>\r\n\t\t\t{this.content()}\r\n\t\t</Page>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {return;}\r\n\tprotected afterBack():void {}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'back'}\r\n\tprotected get headerClassName(): string {return null;}\r\n\tprotected get className(): string {return null;}\r\n\tprotected get tabsProps(): TabsProps {return null;}\r\n}\r\n","import React from 'react';\r\nimport { FA, Page } from '../../components';\r\nimport { Controller } from \"../Controller\";\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport interface CStringEditProps {\r\n\tlabel?: string;\r\n\tplaceholder?: string;\r\n\tmaxLength?: number;\r\n\tonValueChange?: (value: string) => Promise<void>;\r\n}\r\n\r\nexport class CStringEdit extends Controller {\r\n\tprivate props: CStringEditProps = {\r\n\t\tlabel: '编辑'\r\n\t}\r\n\tvalue: string = null;\r\n\tnewValue: string = null;\r\n\tisChanged: boolean = null;\r\n\terror: string = null;\r\n\r\n\tconstructor() {\r\n\t\tsuper(tonwa);\r\n\t\tmakeObservable(this, {\r\n\t\t\tvalue: observable,\r\n\t\t\tnewValue: observable,\r\n\t\t\tisChanged: observable,\r\n\t\t\terror: observable,\r\n\t\t});\r\n\t}\r\n\r\n\tprotected async internalStart() { }\r\n\trender(value: string, props?: CStringEditProps) {\r\n\t\tthis.value = value;\r\n\t\tif (props) Object.assign(this.props, props);\r\n\t\treturn React.createElement(observer(() => <>{this.renderValue()}{this.renderPencil()}</>))\r\n\t}\r\n\r\n\tprotected renderValue() { return <>{this.value}</> }\r\n\tprotected renderPencil() {\r\n\t\treturn <span onClick={this.onEdit} className=\"cursor-pointer\">\r\n\t\t\t&nbsp; <FA className=\"text-info\" name=\"pencil-square-o\" /> &nbsp;\r\n\t\t</span>;\r\n\t}\r\n\r\n\tprivate onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.newValue = evt.target.value;\r\n\t\tlet preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\r\n\tprivate onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.verifyValue();\r\n\t}\r\n\r\n\tprotected verifyValue() { }\r\n\r\n\tprivate onFocus = () => {\r\n\t\tthis.error = undefined;\r\n\t}\r\n\r\n\tprivate onEdit = () => {\r\n\t\tlet { label, maxLength, placeholder, onValueChange } = this.props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tthis.value = this.newValue;\r\n\t\t\t\tthis.closePage();\r\n\t\t\t\tif (onValueChange) onValueChange(this.value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet right = React.createElement(observer(() => <button\r\n\t\t\tclassName=\"btn btn-sm btn-success align-self-center me-2\"\r\n\t\t\tdisabled={!this.isChanged}\r\n\t\t\tonClick={onSave}>保存</button>));\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n\t\tthis.openPage(<Page header={label} right={right}>\r\n\t\t\t<div className=\"m-3\">\r\n\t\t\t\t<input type=\"text\"\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n\t\t\t\t\tonBlur={this.onBlur}\r\n\t\t\t\t\tonFocus={this.onFocus}\r\n\t\t\t\t\tclassName=\"form-control\"\r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\tmaxLength={maxLength} />\r\n\t\t\t\t{\r\n\t\t\t\t\tReact.createElement(observer(() => placeholder && <div className=\"small muted m-2\">{placeholder}</div>))\r\n\t\t\t\t}\r\n\t\t\t\t{this.error && <div className=\"text-danger\">{this.error}</div>}\r\n\t\t\t</div>\r\n\t\t</Page>);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { renderPageHeader } from './pageHeader';\r\nimport { TabsProps, TabsView } from './tabs';\r\nimport { ScrollProps, ScrollView, WebNavScrollView } from './scrollView';\r\nimport { PageHeaderProps, PageWebNav, tonwa } from 'tonwa-core';\r\n//import { nav } from '../../nav';\r\n\r\nexport interface IVPage {\r\n\tcontent(): JSX.Element;\r\n\theader(): JSX.Element | string;\r\n\tfooter(): JSX.Element;\r\n}\r\n\r\nexport interface PageProps extends ScrollProps {\r\n\tback?: 'close' | 'back' | 'none';\r\n\theader?: boolean | string | JSX.Element;\r\n\tright?: JSX.Element;\r\n\tfooter?: JSX.Element;\r\n\tlogout?: boolean | (() => Promise<void>);\r\n\theaderClassName?: string;\r\n\tclassName?: string;\r\n\tafterBack?: () => void;\r\n\ttabsProps?: TabsProps;\r\n\twebNav?: PageWebNav<JSX.Element>;\r\n}\r\n\r\n@observer\r\nexport class Page extends React.Component<PageProps> {\r\n\tprivate tabsView: TabsView;\r\n\tconstructor(props: PageProps) {\r\n\t\tsuper(props);\r\n\t\tlet { tabsProps } = props;\r\n\t\tif (tabsProps) {\r\n\t\t\tthis.tabsView = new TabsView(tabsProps);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderHeader(webNav?: PageWebNav) {\r\n\t\tconst { back, header, right, headerClassName, afterBack, logout } = this.props;\r\n\t\tif (header === false) return;\r\n\t\t//const {webNav} = this.props;\r\n\t\tlet inWebNav = false;\r\n\t\tlet pageHeaderProps: PageHeaderProps<JSX.Element> = {\r\n\t\t\tback,\r\n\t\t\tcenter: header as any,\r\n\t\t\tright,\r\n\t\t\tlogout,\r\n\t\t\tclassName: headerClassName,\r\n\t\t\tafterBack,\r\n\t\t};\r\n\t\tif (webNav !== undefined) {\r\n\t\t\tinWebNav = true;\r\n\t\t\tlet { renderPageHeader: rph } = webNav;\r\n\t\t\tif (rph) return rph(pageHeaderProps);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinWebNav = false;\r\n\t\t}\r\n\t\treturn renderPageHeader(pageHeaderProps, inWebNav);\r\n\t\t/*\r\n\t\tlet pageHeader = header !== false && <PageHeader \r\n\t\t\tback={back} \r\n\t\t\tcenter={header as any}\r\n\t\t\tright={right}\r\n\t\t\tlogout={this.props.logout}\r\n\t\t\tclassName={headerClassName}\r\n\t\t\tafterBack={afterBack}\r\n\t\t\t/>;\r\n\t\treturn pageHeader;\r\n\t\t*/\r\n\t}\r\n\r\n\tprivate renderFooter(webNav?: PageWebNav) {\r\n\t\tconst { footer } = this.props;\r\n\t\tif (!footer) return;\r\n\t\tlet elFooter = <footer>{footer}</footer>;\r\n\t\tif (webNav) return elFooter;\r\n\t\treturn <>\r\n\t\t\t<section className=\"tv-page-footer\">{elFooter}</section>\r\n\t\t\t{elFooter}\r\n\t\t</>;\r\n\t}\r\n\r\n\tcomponentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n\t\t// You can also log the error to an error reporting service\r\n\t\t//logErrorToMyService(error, errorInfo);\r\n\t\tdebugger;\r\n\t}\r\n\r\n\trender() {\r\n\t\tif (this.tabsView) {\r\n\t\t\treturn React.createElement(this.tabsView.content);\r\n\t\t}\r\n\t\tconst { onScroll, onScrollTop, onScrollBottom, children, className, webNav } = this.props;\r\n\t\tlet pageWebNav: PageWebNav;\r\n\t\tif (!webNav) {\r\n\t\t\tpageWebNav = tonwa.nav.pageWebNav;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpageWebNav = webNav;\r\n\t\t}\r\n\t\tlet content = <>\r\n\t\t\t{this.renderHeader(pageWebNav)}\r\n\t\t\t<main>{children}</main>\r\n\t\t\t{this.renderFooter(pageWebNav)}\r\n\t\t</>;\r\n\t\tif (pageWebNav) {\r\n\t\t\treturn <WebNavScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t\twebNav={pageWebNav}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</WebNavScrollView>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn <ScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</ScrollView>;\r\n\t\t}\r\n\t}\r\n}\r\n","import { from62 } from './62';\r\nimport { LocalMap } from './localDb';\r\n\r\nexport const env = (function () {\r\n\tlet {unit, testing, buildingUq, params, lang, district, timeZone, isMobile} = initEnv();\r\n    return {\r\n\t\tunit,\r\n\t\ttesting,\r\n\t\tbuildingUq, \r\n\t\tparams,\r\n\t\tlang, \r\n\t\tdistrict,\r\n\t\ttimeZone,\r\n\t\tbrowser: detectBrowser(), \r\n        isDevelopment: process.env.NODE_ENV === 'development',\r\n\t\tisMobile,\r\n        localDb: new LocalMap(testing===true? '$$':'$'),\r\n        setTimeout: (tag:string, callback: (...args: any[]) => void, ms: number, ...args: any[]):NodeJS.Timer => {\r\n            return global.setTimeout(callback, ms, ...args);\r\n        },\r\n        clearTimeout: (handle:NodeJS.Timer):void => {\r\n            global.clearTimeout(handle);\r\n        },\r\n        setInterval: (callback: (...args: any[]) => void, ms: number, ...args: any[]): NodeJS.Timer => {\r\n            return global.setInterval(callback, ms, ...args);\r\n        },\r\n        clearInterval: (handle:NodeJS.Timer):void => {\r\n            global.clearInterval(handle);\r\n        }\r\n    }\r\n}());\r\n\r\nfunction initEnv(): {\r\n\tunit: number; \r\n\ttesting: boolean; \r\n\tbuildingUq: boolean;\r\n\tparams: {[key:string]: string}; \r\n\tlang: string; \r\n\tdistrict: string;\r\n\ttimeZone: number;\r\n\tisMobile: boolean;\r\n}\r\n{\r\n\tlet pl     = /\\+/g,  // Regex for replacing addition symbol with a space\r\n        search = /([^&=]+)=?([^&]*)/g,\r\n        decode = function (s:any) { return decodeURIComponent(s.replace(pl, \" \")); },\r\n        query  = window.location.search.substring(1);\r\n    let params:{[key:string]:string} = {};\r\n    for (;;) {\r\n\t   let match = search.exec(query);\r\n\t   if (!match) break;\r\n       params[decode(match[1])] = decode(match[2]);\t\r\n\t}\r\n\r\n\tlet testing:boolean; // = isTesting();\r\n\tlet unit:number;\r\n\r\n\tlet sUnit = params['u'] || params['unit'];\r\n\tif (sUnit) {\r\n\t\tlet p = sUnit.indexOf('-');\t\t\r\n\t\tif (p>=0) {\r\n\t\t\tlet tc = sUnit.charCodeAt(p+1);\r\n\t\t\tconst tt = 'tT';\r\n\t\t\ttesting = tc === tt.charCodeAt(0) || tc === tt.charCodeAt(1);\r\n\t\t\tsUnit = sUnit.substr(0, p);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttesting = false;\r\n\t\t}\r\n\t\tif (sUnit[0] === '0') {\r\n\t\t\tunit = Number(sUnit);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tunit = from62(sUnit);\r\n\t\t}\r\n\t\tif (isNaN(unit) === true) unit = undefined;\r\n\t}\r\n\telse {\r\n\t\t// 下面都是为了兼容以前的操作。\r\n\t\t// 整个url上，只要有test作为独立的字符串出现，就是testing\r\n\t\ttesting = /(\\btest\\b)/i.test(document.location.href);\r\n\t\tlet unitName:string;\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\tunitName = el.innerText;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tel = document.getElementById('unit.json');\r\n\t\t\tif (el) {\r\n\t\t\t\tlet json = el.innerHTML;\r\n\t\t\t\tif (json) {\r\n\t\t\t\t\tlet res = JSON.parse(json);\r\n\t\t\t\t\tunitName = res?.unit;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!unitName) {\r\n\t\t\tunitName = process.env.REACT_APP_UNIT;\r\n\t\t}\r\n\r\n\t\tif (unitName) {\r\n\t\t\tunit = Number.parseInt(unitName);\r\n\t\t\tif (Number.isInteger(unit) === false) {\r\n\t\t\t\tif (unitName === '百灵威') {\r\n\t\t\t\t\tunit = 24;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!unit) unit = 0;\r\n\t}\r\n    let lang: string, district: string;\r\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n        || navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n\tlet timeZone = -new Date().getTimezoneOffset() / 60;\r\n\tconst regEx = new RegExp('Android|webOS|iPhone|iPad|' +\r\n    'BlackBerry|Windows Phone|'  +\r\n    'Opera Mini|IEMobile|Mobile' , \r\n    'i');\r\n\tconst isMobile = regEx.test(navigator.userAgent);\r\n\treturn {unit, testing, buildingUq:false, params, lang, district, timeZone, isMobile};\r\n}\r\n\r\nfunction detectBrowser() { \r\n    if((navigator.userAgent.indexOf(\"Opera\") || navigator.userAgent.indexOf('OPR')) >= 0 )\r\n        return 'Opera';\r\n\tif(navigator.userAgent.indexOf(\"Chrome\") >= 0 )\r\n        return 'Chrome';\r\n\tif(navigator.userAgent.indexOf(\"Safari\") >= 0)\r\n        return 'Safari';\r\n\tif(navigator.userAgent.indexOf(\"Firefox\") >= 0 )\r\n        return 'Firefox';\r\n\tif((navigator.userAgent.indexOf(\"MSIE\") >= 0 ) || (!!(document as any).documentMode === true ))\r\n        return 'IE'; //crap\r\n    return 'Unknown';\r\n}\r\n","import { env, resOptions, PageHeaderProps, PageWebNav, Tonwa, Nav } from 'tonwa-core';\r\nimport { t } from '../ui';\r\nimport { Page } from '../components';\r\n//import { nav } from '../nav';\r\nimport { VPage } from './VPage';\r\nimport { View } from './View';\r\nimport { AnnotationsMap, makeObservable, observable, runInAction } from 'mobx';\r\n// import { messageHub } from 'tonwa-core';\r\n\r\nexport interface ConfirmOptions {\r\n    caption?: string;\r\n    message: string | JSX.Element;\r\n    classNames?: string;\r\n    ok?: string;\r\n    yes?: string;\r\n    no?: string;\r\n}\r\n\r\nexport interface WebNav<C extends Controller> {\r\n    VNavHeader?: new (controller: C) => View<C>;\r\n    VNavRawHeader?: new (controller: C) => View<C>;\r\n    VNavFooter?: new (controller: C) => View<C>;\r\n    VNavRawFooter?: new (controller: C) => View<C>;\r\n    renderPageHeader?: (props: PageHeaderProps<JSX.Element>) => JSX.Element;\r\n}\r\n\r\nexport abstract class Controller {\r\n    protected readonly tonwa: Tonwa;\r\n    protected nav: Nav;\r\n    protected res: any = {};\r\n    t = (str: string): string | JSX.Element => this.internalT(str) || str;\r\n    icon: string | JSX.Element;\r\n    label: string | JSX.Element;\r\n    readonly isDev: boolean = env.isDevelopment;\r\n    pageWebNav: PageWebNav<JSX.Element>;\r\n\r\n    constructor(tonwa: Tonwa) {\r\n        this.tonwa = tonwa;\r\n        this.nav = tonwa.nav;\r\n    }\r\n\r\n    shallow<T extends object>(data: T) {\r\n        let ret = makeObservable(data, this.buildReactiveProps(data, observable.shallow));\r\n        return ret;\r\n    }\r\n\r\n    deep<T extends object>(data: T) {\r\n        let ret = makeObservable(data, this.buildReactiveProps(data, observable));\r\n        return ret;\r\n    }\r\n\r\n    private buildReactiveProps<T extends object>(data: T, ob: any): AnnotationsMap<T, never> {\r\n        let ret: AnnotationsMap<T, never> = {};\r\n        for (let i in data) {\r\n            let v = data[i];\r\n            switch (typeof v) {\r\n                default:\r\n                    ob = observable;\r\n                    break;\r\n                case 'object':\r\n                case 'function':\r\n                    break;\r\n            }\r\n            (ret as any)[i] = ob;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    runInAction<T>(fn: () => T): T {\r\n        return runInAction(fn);\r\n    }\r\n\r\n    getTonwa() { return this.tonwa; }\r\n\r\n    protected beforeInit() { }\r\n    protected afterInit() { }\r\n\r\n    internalInit(...param: any[]) {\r\n        this.beforeInit();\r\n        this.init(...param);\r\n        this.pageWebNav = this.getPageWebNav();\r\n        this.afterInit();\r\n    }\r\n\r\n    init(...param: any[]) {\r\n    }\r\n\r\n    internalT(str: string): any {\r\n        return this.res?.[str] ?? t(str);\r\n    }\r\n\r\n    getPageWebNav(): PageWebNav { return undefined; }\r\n\r\n    setRes(res: any) {\r\n        if (res === undefined) return;\r\n        let { $lang, $district } = resOptions;\r\n        Object.assign(this.res, res);\r\n        if ($lang !== undefined) {\r\n            let l = res[$lang];\r\n            if (l !== undefined) {\r\n                Object.assign(this.res, l);\r\n                let d = l[$district];\r\n                if (d !== undefined) {\r\n                    Object.assign(this.res, d);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    getRes(): any { return this.res; }\r\n\r\n    protected async openVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C) => P, param?: any, afterBack?: (ret: any) => void): Promise<P> {\r\n        let ret = new vp((this as any) as C);\r\n        await ret.open(param, afterBack);\r\n        return ret;\r\n    }\r\n\r\n    protected async replaceVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C) => P, param?: any, afterBack?: (ret: any) => void): Promise<P> {\r\n        let ret = new vp((this as any) as C);\r\n        await ret.replaceOpen(param, afterBack);\r\n        return ret;\r\n    }\r\n\r\n    protected renderView<C extends Controller, V extends View<C>>(view: new (controller: C) => V, param?: any): JSX.Element {\r\n        let v = new view((this as any) as C);\r\n        return v.render(param);\r\n    }\r\n\r\n    async event(type: string, value: any) {\r\n        await this.onEvent(type, value);\r\n    }\r\n\r\n    protected async onEvent(type: string, value: any) {\r\n    }\r\n\r\n    protected msg(text: string) {\r\n        alert(text);\r\n    }\r\n    protected errorPage(header: string, err: any) {\r\n        this.openPage(<Page header=\"App error!\">\r\n            <pre>\r\n                {typeof err === 'string' ? err : err.message}\r\n            </pre>\r\n        </Page>);\r\n    }\r\n\r\n    openPage(page: JSX.Element, onClosePage?: (ret: any) => void) {\r\n        let disposer: () => void;\r\n        if (onClosePage !== undefined) {\r\n            disposer = () => {\r\n                //if (this.disposer) this.disposer();\r\n                onClosePage(undefined);\r\n            }\r\n        }\r\n\r\n        this.nav.push(page, disposer);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    replacePage(page: JSX.Element, onClosePage?: () => void) {\r\n        this.nav.replace(page, onClosePage);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    backPage() {\r\n        this.nav.back(false);\r\n    }\r\n\r\n    closePage(level?: number) {\r\n        this.nav.pop(level);\r\n    }\r\n\r\n    ceasePage(level?: number) {\r\n        this.nav.ceaseTop(level);\r\n    }\r\n\r\n    go(showPage: () => void, url: string, absolute?: boolean) {\r\n        this.go(showPage, url, absolute);\r\n    }\r\n\r\n    removeCeased() {\r\n        this.nav.removeCeased();\r\n    }\r\n\r\n    regConfirmClose(confirmClose: () => Promise<boolean>) {\r\n        this.nav.regConfirmClose(confirmClose);\r\n    }\r\n\r\n    private topPageKey: any;\r\n    protected startAction() {\r\n        this.topPageKey = this.nav.topKey();\r\n    }\r\n    get TopKey() {\r\n        return this.topPageKey;\r\n    }\r\n    SetTopKey(key: any) {\r\n        this.topPageKey = key;\r\n    }\r\n    public popToTopPage() {\r\n        this.nav.popTo(this.topPageKey);\r\n    }\r\n\r\n    async confirm(options: ConfirmOptions): Promise<'ok' | 'yes' | 'no' | undefined> {\r\n        return new Promise<'ok' | 'yes' | 'no' | undefined>(async (resolve, reject) => {\r\n            let { caption, message, ok, yes, no, classNames } = options;\r\n            let close = (res: 'ok' | 'yes' | 'no' | undefined) => {\r\n                this.closePage();\r\n                resolve(res);\r\n            }\r\n            let buttons: any[] = [];\r\n            if (ok !== undefined) {\r\n                buttons.push(<button key=\"ok\" className=\"btn btn-primary me-3\" onClick={() => close('ok')}>{ok}</button>);\r\n            }\r\n            if (yes !== undefined) {\r\n                buttons.push(<button key=\"yes\" className=\"btn btn-success me-3\" onClick={() => close('yes')}>{yes}</button>);\r\n            }\r\n            if (no !== undefined) {\r\n                buttons.push(<button key=\"no\" className=\"btn btn-outline-danger me-3\" onClick={() => close('no')}>{no}</button>);\r\n            }\r\n            this.openPage(<Page header={caption || '请确认'} back=\"close\">\r\n                <div className={classNames || \"rounded bg-white m-5 p-3 border\"}>\r\n                    <div className=\"d-flex align-items-center justify-content-center\">\r\n                        {message}\r\n                    </div>\r\n                    <div className=\"mt-3 d-flex align-items-center justify-content-center\">\r\n                        {buttons}\r\n                    </div>\r\n                </div>\r\n            </Page>);\r\n            this.nav.regConfirmClose(async (): Promise<boolean> => {\r\n                resolve(undefined);\r\n                return true;\r\n            });\r\n        });\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { PageWebNav } from 'tonwa-core';\r\n//import { PageHeaderProps } from './pageHeader';\r\n\r\nconst scrollAfter = 20; // 20ms之后，scroll执行\r\nexport class Scroller {\r\n    private el: HTMLBaseElement;\r\n    constructor(el: HTMLBaseElement) {\r\n        this.el = el;\r\n    }\r\n\r\n    scrollToTop(): void {\r\n        setTimeout(() => this.el.scrollTo(0, 0), scrollAfter);\r\n    }\r\n    scrollToBottom(): void {\r\n        setTimeout(() => this.el.scrollTo(0, this.el.scrollTop + this.el.offsetHeight), scrollAfter);\r\n    }\r\n}\r\n\r\nexport interface ScrollProps {\r\n    onScroll?: (e: any) => void;\r\n    onScrollTop?: (scroller: Scroller) => Promise<boolean>;\r\n    onScrollBottom?: (scroller: Scroller) => Promise<void>;\r\n    className?: string;\r\n}\r\ninterface ScrollViewProps extends ScrollProps {\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n}\r\nconst scrollTimeGap = 100;\r\nconst scrollEdgeGap = 30;\r\nabstract class ScrollViewBase<T extends ScrollViewProps> extends React.Component<T, null> {\r\n    private bottomTime: number = 0;\r\n    private topTime: number = 0;\r\n    private div: HTMLDivElement;\r\n\r\n    protected refDiv = (div: HTMLDivElement) => {\r\n        if (!div) {\r\n            if (this.div) {\r\n                this.div.removeEventListener('resize', this.onResize)\r\n            }\r\n            return;\r\n        }\r\n        this.div = div;\r\n        this.div.addEventListener('resize', this.onResize);\r\n    }\r\n\r\n    private onResize = (ev: UIEvent) => {\r\n        console.error('div resize');\r\n    };\r\n\r\n    protected onScroll = async (e: any) => {\r\n        let { onScroll, onScrollTop, onScrollBottom } = this.props;\r\n        if (onScroll) onScroll(e);\r\n        let el = e.target as HTMLBaseElement;\r\n        let scroller = new Scroller(el);\r\n        if (el.scrollTop < scrollEdgeGap) {\r\n            if (onScrollTop !== undefined) {\r\n                let topTime = new Date().getTime();\r\n                if (topTime - this.topTime > scrollTimeGap) {\r\n                    this.topTime = topTime;\r\n                    onScrollTop(scroller).then(ret => {\r\n                        // has more\r\n                        if (ret === true) {\r\n                            let sh = el.scrollHeight;\r\n                            let top = 200;\r\n                            if (top > sh) top = sh;\r\n                            el.scrollTop = top;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        if (el.scrollTop + el.offsetHeight > el.scrollHeight - scrollEdgeGap) {\r\n            if (onScrollBottom !== undefined) {\r\n                let bottomTime = new Date().getTime();\r\n                if (bottomTime - this.bottomTime > scrollTimeGap) {\r\n                    this.bottomTime = bottomTime;\r\n                    onScrollBottom(scroller);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    private eachChild(c: any, direct: 'top' | 'bottom') {\r\n        let { props } = c;\r\n        if (props === undefined)\r\n            return;\r\n        let { children } = props;\r\n        if (children === undefined)\r\n            return;\r\n        React.Children.forEach(children, (child, index) => {\r\n            let { _$scroll } = child as any;\r\n            if (_$scroll) _$scroll(direct);\r\n            console.log(child.toString());\r\n            this.eachChild(child, direct);\r\n        });\r\n    }\r\n}\r\n\r\nexport class ScrollView extends ScrollViewBase<ScrollViewProps> {\r\n    render() {\r\n        let { className, style } = this.props;\r\n        return <div ref={this.refDiv} className=\"tv-page\"\r\n            onScroll={this.onScroll} style={style}>\r\n            <article className={className}>\r\n                {this.props.children}\r\n            </article>\r\n        </div>;\r\n    }\r\n}\r\n\r\ninterface WebNavScrollViewProps extends ScrollViewProps {\r\n    webNav: PageWebNav<JSX.Element>;\r\n}\r\n\r\nexport class WebNavScrollView extends ScrollViewBase<WebNavScrollViewProps> {\r\n    render() {\r\n        let { className, style, webNav } = this.props;\r\n        let { navHeader, navRawHeader, navFooter, navRawFooter } = webNav;\r\n        let vHeader: any, vFooter: any;\r\n        if (navRawHeader) vHeader = navRawHeader;\r\n        else if (navHeader) vHeader = <header><main>{navHeader}</main></header>\r\n        if (navRawFooter) vFooter = navRawFooter;\r\n        else if (navFooter) vFooter = <footer><main>{navFooter}</main></footer>\r\n\r\n        return <div ref={this.refDiv} className=\"tv-page-webnav\"\r\n            onScroll={this.onScroll} style={style}>\r\n            {vHeader}\r\n            <article className={className}>\r\n                {this.props.children}\r\n            </article>\r\n            {vFooter}\r\n        </div>;\r\n    }\r\n}\r\n","class _LocalStorage {\r\n    getItem(key:string) {\r\n        return localStorage.getItem(key)\r\n    }\r\n    setItem(key:string, value:string) {\r\n        localStorage.setItem(key, value);\r\n    }\r\n    removeItem(key:string) {\r\n        localStorage.removeItem(key);\r\n    }\r\n}\r\n\r\nconst __ls = new _LocalStorage(); // new Ls;\r\n\r\nexport class LocalCache {\r\n    private readonly local: Local;\r\n    //private value: T;\r\n    readonly key: string|number;\r\n\r\n    constructor(local:Local, key:string|number) {\r\n        this.local = local;\r\n        this.key = key;\r\n    }\r\n    get():any {\r\n        try {\r\n            // 下面缓冲的内容不能有，可能会被修改，造成circular引用\r\n            //if (this.value !== undefined) return this.value;\r\n            let text = this.local.getItem(this.key);\r\n            if (text === null) return;\r\n            if (text === undefined) return undefined;\r\n            //return this.value = \r\n            return JSON.parse(text);\r\n        }\r\n        catch (err) {\r\n            this.local.removeItem(this.key);\r\n            return;\r\n        }\r\n    }\r\n    set(value:any) {\r\n\t\tlet t = JSON.stringify(value, (key, value) => {\r\n\t\t\tif (key !== '_tuid') return value;\r\n\t\t});\r\n\t\tthis.local.setItem(this.key, t);\r\n    }\r\n    remove(local?:Local) {\r\n        if (local === undefined) {\r\n            this.local.removeItem(this.key);\r\n        }\r\n        else {\r\n            this.local.removeLocal(local);\r\n        }\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        return this.local.child(key);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        return this.local.arr(key);\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        return this.local.map(key);\r\n    }\r\n}\r\n\r\nabstract class Local {\r\n    private readonly caches: {[key:string]:LocalCache};\r\n    private readonly locals: {[key:string]:Local};\r\n    protected readonly name: string;\r\n    constructor(name: string) {\r\n        this.name = name;\r\n        this.caches = {};\r\n        this.locals = {};\r\n    }\r\n\r\n    protected abstract keyForGet(key:string|number):string;\r\n    protected abstract keyForSet(key:string|number):string;\r\n    protected abstract keyForRemove(key:string|number):string;\r\n    abstract removeAll():void;\r\n    getItem(key:string|number):string {\r\n        let k = this.keyForGet(key);\r\n        if (k === undefined) return;\r\n        return __ls.getItem(k);\r\n    }\r\n    setItem(key:string|number, value: string):void {\r\n        let k = this.keyForSet(key);\r\n        __ls.setItem(k, value);\r\n    }\r\n    removeItem(key:string|number):void {\r\n        let k = this.keyForSet(key);\r\n        if (k === undefined) return;\r\n        localStorage.removeItem(k);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        let sk = String(key);\r\n        let arr = this.locals[sk] as LocalArr;\r\n        if (arr === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = arr = new LocalArr(k);\r\n        }\r\n        return arr;\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        let sk = String(key);\r\n        let map = this.locals[sk] as LocalMap;\r\n        if (map === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = map = new LocalMap(k);\r\n        }\r\n        return map;\r\n    }\r\n    removeLocal(local:Local) {\r\n        let sk = local.name;\r\n        let k = this.keyForRemove(sk);\r\n        if (k === undefined) return;\r\n        let arr = this.locals[sk];\r\n        if (arr === undefined) arr = new LocalArr(k);\r\n        else this.locals[sk] = undefined;\r\n        arr.removeAll();\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        let ks = String(key);\r\n        let ret = this.caches[ks];\r\n        if (ret !== undefined) return ret;\r\n        return this.caches[ks] =ret = new LocalCache(this, key);\r\n    }\r\n}\r\n\r\nconst maxArrSize = 500;\r\nexport class LocalArr extends Local {\r\n    private readonly index: number[];\r\n    constructor(name: string) {\r\n        super(name);\r\n        let index = __ls.getItem(this.name);\r\n        this.index = index === null? [] : index.split('\\n').map(v => Number(v));\r\n    }\r\n    private saveIndex() {\r\n        __ls.setItem(this.name, this.index.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = this.index.indexOf(key);\r\n        if (i < 0) return undefined;\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = this.index.indexOf(key);\r\n        if (i<0) {\r\n            this.index.unshift(key);\r\n            if (this.index.length > maxArrSize) this.index.pop();\r\n        }\r\n        else {\r\n            this.index.splice(i, 1);\r\n            this.index.unshift(key)\r\n        }\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForRemove(key:number):string {\r\n        let i = this.index.indexOf(key);\r\n        if (i<0) return;\r\n        this.index.splice(i, 1);\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i of this.index) {\r\n            __ls.removeItem(`${this.name}.${i}`);\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.index.splice(0);\r\n    }\r\n    item(index:number):LocalCache {\r\n        return this.child(index);\r\n    }\r\n}\r\n\r\nexport class LocalMap extends Local {\r\n    private readonly index: {[key:string]:number};\r\n    private max: number;\r\n    constructor(name: string) {\r\n        super(name);\r\n        this.max = 0;\r\n        this.index = {};\r\n        let index = __ls.getItem(this.name);\r\n        if (index !== null) {\r\n            let ls = index.split('\\n');\r\n            ls.forEach(l => {\r\n                let p = l.indexOf('\\t');\r\n                if (p<0) return;\r\n                let key = l.substr(0, p);\r\n                let i = Number(l.substr(p+1));\r\n                if (isNaN(i) === true) return;\r\n                this.index[key] = i;\r\n                if (i>this.max) this.max = i;\r\n            });\r\n        }\r\n    }\r\n    private saveIndex() {\r\n        let ls:string[] = [];\r\n        for (let k in this.index) {\r\n            let v = this.index[k];\r\n            if (v === undefined) continue;\r\n            ls.push(`${k}\\t${v}`);\r\n        }\r\n        __ls.setItem(this.name, ls.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) return undefined;\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) {\r\n            ++this.max;\r\n            i = this.max;\r\n            this.index[key] = i;\r\n            this.saveIndex();\r\n        }\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForRemove(key:string|number):string {\r\n        let i = this.index[key];\r\n        if (i===undefined) return;\r\n        this.index[key] = undefined;\r\n        this.saveIndex();\r\n        return `${this.name}.${i}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i in this.index) {\r\n            __ls.removeItem(`${this.name}.${this.index[i]}`);\r\n            this.index[i] = undefined;\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.max = 0;\r\n    }\r\n    item(key:string):LocalCache {\r\n        return this.child(key);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { env, FetchError, PageWebNav } from 'tonwa-core';\r\nimport { Loading } from '../components';\r\nimport FetchErrorView from './FetchErrorView';\r\nimport { FA } from '../components';\r\n\r\nexport interface Props {\r\n    onLogined: (isUserLogin?: boolean) => Promise<void>;\r\n    notLogined?: () => Promise<void>;\r\n    userPassword?: () => Promise<{ user: string; password: string }>;\r\n};\r\nlet stackKey = 1;\r\nexport interface StackItem {\r\n    key: number;\r\n    view: JSX.Element;\r\n    ceased: boolean;\r\n    confirmClose?: () => Promise<boolean>;\r\n    disposer?: () => void;\r\n}\r\nexport interface NavViewState {\r\n    notSupportedBrowser: boolean;\r\n    stack: StackItem[];\r\n    wait: 0 | 1 | 2;\r\n    fetchError: FetchError;\r\n}\r\n\r\nconst notSupportedBrowsers = ['IE'];\r\n\r\nexport class NavView extends React.Component<Props, NavViewState> {\r\n    private stack: StackItem[];\r\n    private waitCount: number = 0;\r\n    private waitTimeHandler?: NodeJS.Timer;\r\n    isWebNav: boolean = false;\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.stack = [];\r\n        let { browser } = env;\r\n        let notSupportedBrowser = notSupportedBrowsers.findIndex(v => v === browser) >= 0;\r\n        this.state = {\r\n            notSupportedBrowser,\r\n            stack: this.stack,\r\n            wait: 0,\r\n            fetchError: undefined\r\n        };\r\n        //nav.set(this);\r\n    }\r\n    async componentDidMount() {\r\n        if (this.state.notSupportedBrowser === true) return;\r\n        window.addEventListener('popstate', this.navBack);\r\n    }\r\n\r\n    get level(): number {\r\n        return this.stack.length;\r\n    }\r\n\r\n    startWait() {\r\n        if (this.waitCount === 0) {\r\n            this.setState({ wait: 1 });\r\n            this.waitTimeHandler = env.setTimeout(\r\n                'NavView.startWait',\r\n                () => {\r\n                    this.waitTimeHandler = undefined;\r\n                    this.setState({ wait: 2 });\r\n                },\r\n                1000) as NodeJS.Timer;\r\n        }\r\n        ++this.waitCount;\r\n        this.setState({\r\n            fetchError: undefined,\r\n        });\r\n    }\r\n\r\n    endWait() {\r\n        env.setTimeout(\r\n            undefined, //'NavView.endWait',\r\n            () => {\r\n                /*\r\n                this.setState({\r\n                    fetchError: undefined,\r\n                });*/\r\n                --this.waitCount;\r\n                if (this.waitCount === 0) {\r\n                    if (this.waitTimeHandler !== undefined) {\r\n                        env.clearTimeout(this.waitTimeHandler);\r\n                        this.waitTimeHandler = undefined;\r\n                    }\r\n                    this.setState({ wait: 0 });\r\n                }\r\n            }, 100);\r\n    }\r\n\r\n    show(view: JSX.Element, disposer?: () => void): number {\r\n        this.clear();\r\n        return this.push(view, disposer);\r\n    }\r\n\r\n    push(view: JSX.Element, disposer?: () => void): number {\r\n        this.removeCeased();\r\n        if (this.stack.length > 0) {\r\n            window.history.pushState('forward', null, null);\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view,\r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        this.refresh();\r\n        //console.log('push: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    replace(view: JSX.Element, disposer?: () => void): number {\r\n        let item: StackItem = undefined;\r\n        let stack = this.stack;\r\n        if (stack.length > 0) {\r\n            item = stack.pop();\r\n            //this.popAndDispose();\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view,\r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        if (item !== undefined) this.dispose(item.disposer);\r\n        this.refresh();\r\n        //console.log('replace: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    ceaseTop(level: number = 1) {\r\n        let p = this.stack.length - 1;\r\n        for (let i = 0; i < level; i++, p--) {\r\n            if (p < 0) break;\r\n            let item = this.stack[p];\r\n            item.ceased = true;\r\n        }\r\n    }\r\n\r\n    pop(level: number = 1) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        //console.log('pop start: %s pages level=%s', len, level);\r\n        if (level <= 0 || len <= 1) return;\r\n        if (len < level) level = len;\r\n        let backLevel = 0;\r\n        for (let i = 0; i < level; i++) {\r\n            if (stack.length === 0) break;\r\n            //stack.pop();\r\n            this.popAndDispose();\r\n            ++backLevel;\r\n        }\r\n        if (backLevel >= len) backLevel--;\r\n        this.refresh();\r\n        if (this.isHistoryBack !== true) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(backLevel);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n        //console.log('pop: %s pages', stack.length);\r\n    }\r\n\r\n    popTo(key: number) {\r\n        if (key === undefined) return;\r\n        if (this.stack.find(v => v.key === key) === undefined) return;\r\n        while (this.stack.length > 0) {\r\n            let len = this.stack.length;\r\n            let top = this.stack[len - 1];\r\n            if (top.key === key) break;\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    topKey(): number {\r\n        let len = this.stack.length;\r\n        if (len === 0) return undefined;\r\n        return this.stack[len - 1].key;\r\n    }\r\n\r\n    removeCeased() {\r\n        for (; ;) {\r\n            let p = this.stack.length - 1;\r\n            if (p < 0) break;\r\n            let top = this.stack[p];\r\n            if (top.ceased === false) break;\r\n            let item = this.stack.pop();\r\n            let { disposer } = item;\r\n            this.dispose(disposer);\r\n        }\r\n        this.refresh();\r\n    }\r\n\r\n    private popAndDispose() {\r\n        this.removeCeased();\r\n        let item = this.stack.pop();\r\n        if (item === undefined) return;\r\n        //if (nav.isRouting) {\r\n        //\twindow.history.back();\r\n        //}\r\n        let { disposer } = item;\r\n        this.dispose(disposer);\r\n        this.removeCeased();\r\n        return item;\r\n    }\r\n\r\n    private dispose(disposer: () => void) {\r\n        if (disposer === undefined) return;\r\n        let item = this.stack.find(v => v.disposer === disposer);\r\n        if (item === undefined) disposer();\r\n    }\r\n\r\n    clear() {\r\n        let len = this.stack.length;\r\n        while (this.stack.length > 0) this.popAndDispose();\r\n        //this.refresh();\r\n        if (len > 1) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(len-1);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n    }\r\n\r\n    regConfirmClose(confirmClose: () => Promise<boolean>) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        let top = stack[len - 1];\r\n        top.confirmClose = confirmClose;\r\n    }\r\n\r\n    private isHistoryBack: boolean = false;\r\n    navBack = () => {\r\n        //nav.log('backbutton pressed - nav level: ' + this.stack.length);\r\n        let tick = Date.now();\r\n        this.isHistoryBack = true;\r\n        this.back(true);\r\n        this.isHistoryBack = false;\r\n        console.log(`///\\\\\\\\ ${Date.now() - tick}ms backbutton pressed - nav level: ${this.stack.length}`);\r\n    }\r\n\r\n    back = async (confirm: boolean = true) => {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        if (len === 1) {\r\n            if (window.self !== window.top) {\r\n                window.top.postMessage({ type: 'pop-app' }, '*');\r\n            }\r\n            return;\r\n        }\r\n        let top = stack[len - 1];\r\n        if (confirm === true && top.confirmClose) {\r\n            if (await top.confirmClose() === true) this.pop();\r\n        }\r\n        else {\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    confirmBox(message?: string): boolean {\r\n        return window.confirm(message);\r\n    }\r\n    clearError = () => {\r\n        this.setState({ fetchError: undefined });\r\n    }\r\n\r\n    setFetchError(fetchError: FetchError) {\r\n        this.setState({ fetchError });\r\n    }\r\n\r\n    render() {\r\n        const { notSupportedBrowser, wait, fetchError } = this.state;\r\n        if (notSupportedBrowser === true) {\r\n            return <div className=\"p-3 text-danger\">\r\n                {env.browser} not supported !\r\n            </div>;\r\n        }\r\n        let { stack } = this.state;\r\n        let top = stack.length - 1;\r\n        let elWait = null, elError = null;\r\n        switch (wait) {\r\n            case 1:\r\n                elWait = <div className=\"va-wait va-wait1\">\r\n                </div>;\r\n                break;\r\n            case 2:\r\n                elWait = <div className=\"va-wait va-wait2\">\r\n                    <Loading />\r\n                </div>;\r\n                break;\r\n        }\r\n        if (fetchError) {\r\n            elError = <FetchErrorView clearError={this.clearError} {...fetchError} />;\r\n            ++top;\r\n        }\r\n        let test = env.testing === true &&\r\n            <span className=\"cursor-pointer position-fixed\" style={{ top: 0, left: '0.2rem', zIndex: 90001 }}>\r\n                <FA className=\"text-warning\" name=\"info-circle\" />\r\n            </span>;\r\n        return <>\r\n            {stack.map((item, index) => {\r\n                let { key, view } = item;\r\n                return <div key={key} style={index < top ? { visibility: 'hidden', position: 'absolute' } : undefined}>\r\n                    {view}\r\n                </div>\r\n            })}\r\n            {elWait}\r\n            {elError}\r\n            {test}\r\n        </>;\r\n    }\r\n\r\n    private refresh() {\r\n        this.setState({ stack: this.stack });\r\n    }\r\n\r\n    backIcon = <i className=\"fa fa-angle-left\" />;\r\n    closeIcon = <i className=\"fa fa-close\" />;\r\n\r\n    setIsWebNav(): void {\r\n        this.isWebNav = true;\r\n        this.backIcon = <i className=\"fa fa-arrow-left\" />;\r\n        this.closeIcon = <i className=\"fa fa-close\" />;\r\n    }\r\n\r\n    pageWebNav: PageWebNav<JSX.Element>;\r\n\r\n    renderNavView(onLogined: any, onNotLogined?: any): JSX.Element {\r\n        throw new Error('renderNavView');\r\n    }\r\n}\r\n","import { resGlobal } from 'tonwa-core';\r\n\r\nexport function t(str: string): string | JSX.Element {\r\n\treturn resGlobal[str] || str;\r\n}\r\nexport type TFunc = (str: string | JSX.Element) => string | JSX.Element;\r\n","import { Login, Tonwa } from 'tonwa-core';\r\n\r\nexport async function createLogin(tonwa: Tonwa): Promise<Login> {\r\n\tlet importCLogin = await import('../auth/CLogin');\r\n\treturn new importCLogin.CLogin(tonwa);\r\n}\r\n\r\nexport async function showRegister(tonwa: Tonwa): Promise<void> {\r\n\tlet importCRegister = await import('../auth/register/CRegister');\r\n\tlet c = new importCRegister.CRegister(tonwa);\r\n\tc.start();\r\n}\r\n\r\nexport async function showForget(tonwa: Tonwa): Promise<void> {\r\n\tlet importCRegister = await import('../auth/register/CRegister');\r\n\tlet c = new importCRegister.CForget(tonwa);\r\n\tc.start();\r\n}\r\n","const digits = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\r\nconst c0 = digits.charCodeAt(0);\r\nconst c9 = digits.charCodeAt(9);\r\nconst A = digits.charCodeAt(10);\r\nconst Z = digits.charCodeAt(35);\r\nconst a = digits.charCodeAt(36);\r\nconst z = digits.charCodeAt(61);\r\nexport function from62(v:string):number {\r\n\tif (v === null) return null;\r\n\tif (v === undefined) return undefined;\r\n\tif (typeof v !== 'string') return Number.NaN;\r\n\tlet len = v.length;\r\n\tif (len === 0) return Number.NaN;\r\n\tlet ret = 0;\r\n\tfor (let i=0; i<len; i++) {\r\n\t\tlet c = v.charCodeAt(i);\r\n\t\tlet n:number;\r\n\t\tif (c < c0) return Number.NaN;\r\n\t\tif (c <= c9) {\r\n\t\t\tn = c - c0;\r\n\t\t}\r\n\t\telse if (c < A) {\r\n\t\t\treturn Number.NaN;\r\n\t\t} \r\n\t\telse if (c <= Z) {\r\n\t\t\tn = c - A + 10;\r\n\t\t}\r\n\t\telse if (c < a) {\r\n\t\t\treturn Number.NaN;\r\n\t\t}\r\n\t\telse if (c <= z) {\r\n\t\t\tn = c - a + 36;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn Number.NaN;\r\n\t\t}\r\n\t\tret *= 62;\r\n\t\tret += n;\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nexport function to62(v:number):string {\r\n\tif (v === null) return null;\r\n\tif (v === undefined) return undefined;\r\n\tif (typeof v !== 'number') return '';\r\n\tif (v < 0) return '';\r\n\tlet ret = '';\r\n\tfor (;;) {\r\n\t\tret = digits[v % 62] + ret;\r\n\t\tv = Math.floor(v / 62);\r\n\t\tif (v === 0) break;\r\n\t}\r\n\treturn ret;\r\n}\r\n","import * as React from 'react';\r\nimport { PageHeaderProps, tonwa } from 'tonwa-core';\r\n//import {nav} from '../../nav';\r\n\r\nexport function renderPageHeader(props: PageHeaderProps<JSX.Element>, inWebNav?: boolean) {\r\n\tlet onBack = async () => {\r\n\t\tawait tonwa.nav.back(false); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet { afterBack } = props;\r\n\t\tif (afterBack) afterBack();\r\n\t}\r\n\tlet onLogoutClick = () => {\r\n\t\tlet logout = async () => {\r\n\t\t\tlet { logout } = props;\r\n\t\t\tif (typeof logout === 'function') {\r\n\t\t\t\tawait logout();\r\n\t\t\t}\r\n\t\t\tawait tonwa.logout(undefined);\r\n\t\t}\r\n\t\ttonwa.showLogout(logout);\r\n\t}\r\n\r\n\tlet b = tonwa.nav.level > 1 || window.self !== window.top;\r\n\tlet { back, right, center, logout, className, ex } = props;\r\n\tif (inWebNav === true && !back && !right && !center) return;\r\n\tlet vBack: any, debugLogout: any;\r\n\tif (logout !== undefined && window.self === window.top) {\r\n\t\tif ((typeof logout === 'boolean' && logout === true)\r\n\t\t\t|| typeof logout === 'function') {\r\n\t\t\tlet { user } = tonwa;\r\n\t\t\tif (user !== undefined) {\r\n\t\t\t\tlet { nick, name } = user;\r\n\t\t\t\tdebugLogout = <div className=\"d-flex align-items-center\">\r\n\t\t\t\t\t<small className=\"text-light\">{nick || name}</small>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\t\t<div className=\"ms-2 py-2 px-3 cursor-pointer\"\r\n\t\t\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\t\t\tonClick={onLogoutClick}>\r\n\t\t\t\t\t\t\t<i className=\"fa fa-sign-out fa-lg\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (b) {\r\n\t\tswitch (props.back) {\r\n\t\t\tcase 'none':\r\n\t\t\t\tvBack = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\tcase 'back':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{tonwa.nav.backIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'close':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{tonwa.nav.closeIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (window.self !== window.top) {\r\n\t\tconsole.log(document.location.href);\r\n\t\t// pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n\t}\r\n\tif (vBack === undefined && typeof center === 'string') {\r\n\t\tcenter = <div className=\"px-3\">{center}</div>;\r\n\t}\r\n\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\tlet header = <header className={className}>\r\n\t\t<nav>\r\n\t\t\t{vBack}\r\n\t\t\t{/*pop 弹出window暂时停止作用 */}\r\n\t\t\t<div>{center}</div>\r\n\t\t\t{rightView}\r\n\t\t</nav>\r\n\t\t{ex}\r\n\t</header>;\r\n\tif (inWebNav === true) return header;\r\n\treturn <>\r\n\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t{header}\r\n\t</>;\r\n}\r\n\r\nexport class PageHeader extends React.Component<PageHeaderProps<JSX.Element>> {\r\n\trender() { return renderPageHeader(this.props) }\r\n\t/*\r\n\tprivate back = async () => {\r\n\t\tawait nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = this.props;\r\n\t\tif (afterBack) afterBack();\r\n\t}\r\n\topenWindow() {\r\n\t\twindow.open(document.location.href);\r\n\t}\r\n\tprivate logoutClick = () => {\r\n\t\tnav.showLogout(this.logout);\r\n\t}\r\n\tprivate logout = async () => {\r\n\t\tlet {logout} = this.props;\r\n\t\tif (typeof logout === 'function') {\r\n\t\t\tawait logout(); \r\n\t\t}\r\n\t\tawait nav.logout(undefined);\r\n\t}\r\n\trender() {\r\n\t\tlet b = nav.level > 1 || window.self !== window.top;\r\n\t\tlet {right, center, logout, className, ex} = this.props;\r\n\t\tlet back:any, debugLogout:any;\r\n\t\tif (logout !== undefined && window.self === window.top) {\r\n\t\t\tif ((typeof logout === 'boolean' && logout === true)\r\n\t\t\t\t|| typeof logout === 'function')\r\n\t\t\t{\r\n\t\t\t\tlet {user} = nav;\r\n\t\t\t\tif (user !== undefined) {\r\n\t\t\t\t\tlet {nick, name} = user;\r\n\t\t\t\t\tdebugLogout = <div className=\"d-flex align-items-center\">\r\n\t\t\t\t\t\t<small className=\"text-light\">{nick || name}</small>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\t\t\t<div className=\"ms-2 py-2 px-3 cursor-pointer\"\r\n\t\t\t\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\t\t\t\tonClick={this.logoutClick}>\r\n\t\t\t\t\t\t\t\t<i className=\"fa fa-sign-out fa-lg\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (b) {\r\n\t\t\tswitch (this.props.back) {\r\n\t\t\t\tcase 'none':\r\n\t\t\t\t\tback = undefined;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tcase 'back':\r\n\t\t\t\t\tback = <nav onClick={this.back}><i className=\"fa fa-angle-left\" /></nav>;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'close':\r\n\t\t\t\t\tback = <nav onClick={this.back}><i className=\"fa fa-close\" /></nav>;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (window.self !== window.top) {\r\n\t\t\tconsole.log(document.location.href);\r\n\t\t\t// pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n\t\t}\r\n\t\tif (back === undefined && typeof center === 'string') {\r\n\t\t\tcenter = <div className=\"px-3\">{center}</div>;\r\n\t\t}\r\n\t\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\t\tlet header = <header className={className}>\r\n\t\t\t<nav>\r\n\t\t\t\t{back}\r\n\t\t\t\t<div>{center}</div>\r\n\t\t\t\t{rightView}\r\n\t\t\t</nav>\r\n\t\t\t{ex}\r\n\t\t</header>;\r\n\t\treturn <>\r\n\t\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t\t{header}\r\n\t\t</>;\r\n\t}\r\n\t*/\r\n}\r\n","import * as React from 'react';\r\nimport { makeObservable, observable, runInAction } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport { IVPage } from './page';\r\nimport { IObservableValue } from 'mobx';\r\nimport '../../css/va-tab.css';\r\nimport { ScrollView } from './scrollView';\r\n\r\nexport type TabCaption = (selected:boolean) => JSX.Element;\r\n\r\nexport interface TabProp {\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontent?: () => JSX.Element;\r\n\tpage?: IVPage;\r\n    notify?: IObservableValue<number> | number;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tisSelected?: boolean;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n}\r\n\r\nexport interface TabsProps {\r\n    tabs: TabProp[];\r\n    tabPosition?: 'top' | 'bottom';\r\n    size?: 'sm' | 'lg' | 'md';\r\n    tabBg?: string;\r\n    contentBg?: string;\r\n    sep?: string;\r\n    selected?: string;\r\n    borderColor?: string;\r\n    borderWidth?: string;\r\n}\r\n\r\nclass Tab {\r\n\tloaded: boolean = false;\r\n\tselected: boolean = false;\r\n\t\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontentBuilder: ()=>JSX.Element;\r\n\tpage: IVPage;\r\n    notify: IObservableValue<number> | number;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n\r\n\tprivate _content: JSX.Element;\r\n\t\r\n\tconstructor() {\r\n\t\tmakeObservable(this, {\r\n\t\t\tloaded: observable, \r\n\t\t\tselected: observable, \r\n\t\t});\r\n\t}\r\n    \r\n    get content(): JSX.Element {\r\n\t\tif (this.load && this.loaded === false) return null;\r\n\t\tif (this.selected === false) return this._content;\r\n\t\tif (!this._content) {\r\n\t\t\tif (this.contentBuilder !== undefined) {\r\n\t\t\t\tthis._content = this.contentBuilder();\r\n\t\t\t}\r\n\t\t\telse if (this.page !== undefined) {\r\n\t\t\t\tthis._content = this.page.content();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._content = <div className=\"p-5\">tab 应该定义content或者page</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._content;\r\n    }\r\n\r\n    async shown() {\r\n        if (this.onShown !== undefined) {\r\n            await this.onShown();\r\n        }\r\n        if (this.load !== undefined) {\r\n\t\t\tif (this.loaded === false) {\r\n\t\t\t\tawait this.load();\r\n\t\t\t\trunInAction(() => {\r\n\t\t\t\t\tthis.loaded = true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n        }\r\n    }\r\n}\r\n\r\nexport const TabCaptionComponent = (label:string|JSX.Element, icon:string, color:string) => <div \r\n    className={'d-flex justify-content-center align-items-center flex-column cursor-pointer ' + color}>\r\n    <div><i className={'fa fa-lg fa-' + icon} /></div>\r\n    <small>{label}</small>\r\n</div>;\r\n\r\n//export const TabCaption = TabCaptionComponent;\r\n\r\nexport class TabsView {\r\n\tprivate props: TabsProps;\r\n    private size: string;\r\n    private tabBg: string;\r\n    private sep: string;\r\n    selectedTab: Tab;\r\n    tabArr: Tab[];\r\n\r\n    constructor(props: TabsProps) {\r\n\t\tthis.props = props;\r\n\t\tlet {size, tabs, tabBg: tabBack, sep, selected} = props;\r\n\t\tthis.size = size || 'md';\r\n        this.tabArr = tabs.map(v => {\r\n            let tab = new Tab();\r\n            let {name, caption, content, page, notify, load, onShown, isSelected, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\ttab.name = name;\r\n\t\t\tif (isSelected === true || name === selected) {\r\n\t\t\t\tthis.selectedTab = tab;\r\n\t\t\t}\r\n\t\t\ttab.selected = false;\r\n\t\t\ttab.caption = caption;\r\n\t\t\tif (content !== undefined) {\r\n\t\t\t\ttab.contentBuilder = content;\r\n\t\t\t}\r\n\t\t\telse if (page !== undefined) {\r\n\t\t\t\ttab.page = page;\r\n\t\t\t\t//contentBuilder = () => {return page.content()};\r\n\t\t\t}\r\n            tab.notify = notify;\r\n            tab.load = load;\r\n\t\t\ttab.onShown = onShown;\r\n\t\t\ttab.onScroll = onScroll;\r\n\t\t\ttab.onScrollTop = onScrollTop;\r\n\t\t\ttab.onScrollBottom = onScrollBottom;\r\n\t\t\ttab.className = className;\r\n            return tab;\r\n        });\r\n        this.tabBg = tabBack;\r\n        //this.contentBg = contentBack;\r\n        this.sep = sep;\r\n        if (this.selectedTab === undefined) {\r\n\t\t\tthis.selectedTab = this.tabArr[0];\r\n\t\t}\r\n        this.selectedTab.selected = true;\r\n\t\tmakeObservable(this, {\r\n\t\t\tselectedTab: observable, \r\n\t\t\ttabArr: observable,\r\n\t\t});\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabClick(this.selectedTab);\r\n\t\t}, 100);\t\t\r\n    }\r\n\r\n    tabClick = async (tab:Tab) => {\r\n\t\tif (!tab) {\r\n\t\t\ttab = this.selectedTab;\r\n\t\t\tif (tab === undefined) {\r\n\t\t\t\tif (this.tabArr === undefined) return;\r\n\t\t\t\tif (this.tabArr.length === 0) return;\r\n\t\t\t\ttab = this.tabArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\trunInAction(() => {\r\n\t\t\tthis.selectedTab.selected = false;\r\n\t\t\ttab.selected = true;\r\n\t\t\tthis.selectedTab = tab;\r\n\t\t});\r\n\t\t\r\n\t\tawait tab.shown();\r\n    }\r\n\r\n\tprivate tabs = observer(() => {\r\n        let {tabPosition, borderColor} = this.props;\r\n        let bsCur:React.CSSProperties, bsTab:React.CSSProperties\r\n        if (borderColor) {\r\n            bsCur = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderLeftWidth: 1,\r\n                borderRightWidth: 1,\r\n                borderBottomWidth: 1,\r\n            }\r\n            bsTab = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderBottomWidth: 1,\r\n                borderLeftWidth: 0,\r\n                borderRightWidth: 0,\r\n\t\t\t\tcursor: 'pointer',\r\n            }\r\n            if (tabPosition === 'top') {\r\n                bsCur.borderBottomWidth = 0;\r\n                bsCur.borderTopLeftRadius = 10;\r\n                bsCur.borderTopRightRadius = 10;\r\n                bsTab.borderTopWidth = 0;\r\n            }\r\n            else {\r\n                bsCur.borderTopWidth = 0;\r\n                bsCur.borderBottomLeftRadius = 10;\r\n                bsCur.borderBottomRightRadius = 10;\r\n                bsTab.borderBottomWidth = 0;\r\n            }\r\n        }\r\n\t\tlet cn = classNames('tv-tabs', this.tabBg, this.sep, 'tv-tabs-' + this.size);\r\n\t\tlet tabs = <div className={cn}>\r\n            {this.tabArr.map((v,index) => {\r\n                let {selected, caption, notify} = v;\r\n                let notifyCircle:any;\r\n                if (notify !== undefined) {\r\n                    let num = typeof notify === 'number'? notify : notify.get();\r\n                    if (num !== undefined) {\r\n                        if (num > 0) notifyCircle = <u>{num>99?'99+':num}</u>;\r\n                        else if (num < 0) notifyCircle = <u className=\"dot\" />;\r\n                    }\r\n                }\r\n                return <div key={index} onClick={()=>this.tabClick(v)} \r\n\t\t\t\t\tstyle={selected===true? bsCur:bsTab}>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t{notifyCircle}\r\n\t\t\t\t\t{caption(selected)}\r\n\t\t\t\t\t</div>\r\n                </div>\r\n            })}\r\n\t\t</div>;\r\n\t\treturn tabs;\r\n\t});\r\n\r\n\tcontent = observer(() => {\r\n\t\tlet displayNone:React.CSSProperties = {visibility: 'hidden'};\r\n\t\treturn <>\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet {tabPosition} = this.props;\r\n\t\t\t\tlet {content, page, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\t\tlet tabs = React.createElement(this.tabs);\r\n\t\t\t\tlet pageHeader:any, pageFooter:any;\r\n\t\t\t\tif (page !== undefined) {\r\n\t\t\t\t\tpageHeader = page.header();\r\n\t\t\t\t\tpageFooter = page.footer();\r\n\t\t\t\t}\r\n\t\t\t\tlet header:any, footer:any;\r\n\t\t\t\tlet visibility:React.CSSProperties = {visibility:'hidden'};\r\n\t\t\t\tif (tabPosition === 'top') {\r\n\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t<section className=\"tv-page-header\">\r\n\t\t\t\t\t\t\t<header>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<header style={visibility}>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t\tif (pageFooter !== undefined) {\r\n\t\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t\t<footer style={visibility}>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t<section className=\"tv-page-footer\">\r\n\t\t\t\t\t\t\t\t<footer>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pageHeader !== undefined) {\r\n\t\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t\t<section className='tv-page-header'>\r\n\t\t\t\t\t\t\t\t<header>{pageHeader}</header>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t<header style={visibility}>{pageHeader}</header>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t<footer style={visibility}>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t<section className='tv-page-footer'>\r\n\t\t\t\t\t\t\t<footer>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = displayNone;\r\n\t\t\t\treturn <ScrollView key={index} className={className}\r\n\t\t\t\t\tstyle={style}\r\n\t\t\t\t\tonScroll={onScroll} onScrollTop={onScrollTop} onScrollBottom={onScrollBottom}>\r\n\t\t\t\t\t{header}\r\n\t\t\t\t\t{content}\r\n\t\t\t\t\t{footer}\r\n\t\t\t\t</ScrollView>;\r\n\t\t\t})}\r\n\t\t</>;\r\n\t});\r\n\r\n    render() {\r\n\t\tlet {tabPosition} = this.props;\r\n\t\tlet tabs = React.createElement(this.tabs);\r\n\t\tlet header:any, footer:any;\r\n\t\tlet visibility:React.CSSProperties = {display:'none'};\r\n\t\tif (tabPosition === 'top') {\r\n\t\t\theader = <header>{tabs}</header>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfooter = <footer>{tabs}</footer>;\r\n\t\t}\r\n\t\treturn <>\r\n\t\t\t{header}\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = visibility;\r\n\t\t\t\treturn <div key={index} className={classNames(v.className)} style={style}>\r\n\t\t\t\t\t{v.content}\r\n\t\t\t\t</div>;\r\n\t\t\t})}\r\n\t\t\t{footer}\r\n\t\t</>;\r\n    }\r\n};\r\n\r\n@observer export class Tabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n\t\t*/\r\n    }\r\n\r\n    render() {\r\n\t\treturn this.tabsView.render();\r\n    }\r\n};\r\n\r\n@observer export class RootTabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n\t\t*/\r\n    }\r\n\r\n    render() {\r\n\t\treturn React.createElement(this.tabsView.content);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport { FetchError, refetchApi } from 'tonwa-core';\r\nimport { Page } from '../components';\r\n\r\nexport interface FetchErrorProps extends FetchError {\r\n    clearError: () => void\r\n}\r\n\r\nexport default class FetchErrorView extends React.Component<FetchErrorProps, null> {\r\n    private reApi = async () => {\r\n        this.props.clearError();\r\n        const { channel, url, options, resolve, reject } = this.props;\r\n        await refetchApi(channel, url, options, resolve, reject);\r\n    }\r\n    private close = async () => {\r\n        this.props.clearError();\r\n    }\r\n    render() {\r\n        let { error, url } = this.props;\r\n        let errContent: any;\r\n        if (typeof error === 'object') {\r\n            let err = [];\r\n            for (let i in error) {\r\n                err.push(<li key={i}><label>{i}</label><div style={{ wordWrap: \"break-word\" }}>{error[i]}</div></li>);\r\n            }\r\n            errContent = <ul>{err}</ul>;\r\n        }\r\n        else {\r\n            errContent = <div>{error}</div>;\r\n        }\r\n        return <div className=\"tv-page\">\r\n            <article>\r\n                <main className=\"va-error p-3\">\r\n                    <div>网络出现问题</div>\r\n                    <div>点击重新访问</div>\r\n                    <div style={{ wordWrap: \"break-word\" }}>url: {url}</div>\r\n                    {errContent}\r\n                    <div className=\"p-3 text-center\">\r\n                        <button className=\"btn btn-primary me-3\" type='button' onClick={this.close}>关闭</button>\r\n                        <button className=\"btn btn-outline-primary\" type='button' onClick={this.reApi}>重试</button>\r\n                    </div>\r\n                </main>\r\n            </article>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport const SystemNotifyPage = ({ message }: { message: string }): JSX.Element => {\r\n    return <Page header=\"系统提醒\">\r\n        <div className=\"px-3\">{message}</div>\r\n    </Page>;\r\n}","import { capitalCase } from \"../tool\";\r\n//import { FieldItem, FieldUIType } from \"../../tonwa-react/ui\";\r\n\r\nexport function buildFieldItem(field: any, isKey: boolean): any/*FieldItem*/ {\r\n\tlet $FieldItemType: string, fieldItemType: string, widget: any/*FieldUIType*/;\r\n\tlet { name, type } = field;\r\n\tswitch (type) {\r\n\t\tcase 'id':\r\n\t\t\t$FieldItemType = 'FieldItemId';\r\n\t\t\tfieldItemType = 'id';\r\n\t\t\tbreak;\r\n\t\tcase 'char':\r\n\t\t\t$FieldItemType = 'FieldItemString';\r\n\t\t\tfieldItemType = 'string';\r\n\t\t\twidget = 'string';\r\n\t\t\tbreak;\r\n\t\tcase 'smallint':\r\n\t\tcase 'int':\r\n\t\tcase 'bigint':\r\n\t\t\t$FieldItemType = 'FieldItemInt';\r\n\t\t\tfieldItemType = 'integer';\r\n\t\t\twidget = 'updown';\r\n\t\t\tbreak;\r\n\t\tcase 'dec':\r\n\t\tcase 'float':\r\n\t\tcase 'double':\r\n\t\t\t$FieldItemType = 'FieldItemNumber';\r\n\t\t\tfieldItemType = 'number';\r\n\t\t\twidget = 'number';\r\n\t\t\tbreak;\r\n\t}\r\n\treturn {\r\n\t\tname,\r\n\t\ttype: fieldItemType,\r\n\t\tisKey,\r\n\t\twidget,\r\n\t\tlabel: capitalCase(name),\r\n\t\t$FieldItemType,\r\n\t} /*as FieldItem*/;\r\n}\r\n","import { VPage } from '../vm';\r\nimport { CLogin } from './CLogin';\r\n\r\nexport class VLogout extends VPage<CLogin> {\r\n\tprivate onLogout: () => void;\r\n\r\n\tinit(param: any) {\r\n\t\tthis.onLogout = param;\r\n\t}\r\n\theader() { return this.isWebNav === true ? false : '安全退出'; }\r\n\tfooter() {\r\n\t\treturn <div className=\"mt-5 text-center justify-content-center\">\r\n\t\t\t<button className=\"btn btn-outline-warning\" onClick={this.tonwa.resetAll}>升级软件</button>\r\n\t\t</div>;\r\n\t}\r\n\tprotected get back(): 'close' | 'back' | 'none' { return 'close' }\r\n\tcontent() {\r\n\t\treturn <div className=\"m-5 border border-info bg-white rounded-3 p-5 text-center\">\r\n\t\t\t<div>退出当前账号不会删除任何历史数据，下次登录依然可以使用本账号</div>\r\n\t\t\t<div className=\"mt-5 text-center\">\r\n\t\t\t\t<button className=\"btn btn-danger\" onClick={this.onLogout}>安全退出</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { Form, Schema, UiSchema, UiTextItem, UiPasswordItem, Context, UiButton, StringSchema, Ax } from '../components';\r\nimport { defaultLoginTop, getSender } from './tools';\r\nimport { CLogin } from './CLogin';\r\nimport { VPage } from '../vm';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nconst schema: Schema = [\r\n\t{ name: 'username', type: 'string', required: true, maxLength: 100 } as StringSchema,\r\n\t{ name: 'password', type: 'string', required: true, maxLength: 100 } as StringSchema,\r\n\t{ name: 'login', type: 'submit' },\r\n];\r\n\r\nexport class VLogin extends VPage<CLogin> {\r\n\tprivate onLogin: (un: string, pwd: string) => Promise<boolean>;\r\n\tprivate withBack: boolean;\r\n\r\n\tinit({ onLogin, withBack }: { onLogin: (un: string, pwd: string) => Promise<boolean>; withBack: boolean; }) {\r\n\t\tthis.onLogin = onLogin;\r\n\t\tthis.withBack = withBack;\r\n\t}\r\n\r\n\tprivate uiSchema: UiSchema = {\r\n\t\titems: {\r\n\t\t\tusername: { placeholder: '手机/邮箱/用户名', label: '登录账号' } as UiTextItem,\r\n\t\t\tpassword: { widget: 'password', placeholder: '密码', label: '密码' } as UiPasswordItem,\r\n\t\t\tlogin: { widget: 'button', className: 'btn btn-primary btn-block mt-3', label: '登录' } as UiButton,\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onSubmit = async (name: string, context: Context): Promise<string> => {\r\n\t\tlet values = context.form.data;\r\n\t\tlet un = values['username'];\r\n\t\tlet pwd = values['password'];\r\n\t\tif (pwd === undefined) {\r\n\t\t\treturn 'something wrong, pwd is undefined';\r\n\t\t}\r\n\t\tlet ret = await this.onLogin(un, pwd);\r\n\t\tif (ret === true) return;\r\n\r\n\t\tlet sender = getSender(un);\r\n\t\tlet type: string = sender !== undefined ? sender.caption : '用户名';\r\n\t\treturn type + '或密码错！';\r\n\t}\r\n\tprivate onEnter = async (name: string, context: Context): Promise<string> => {\r\n\t\tif (name === 'password') {\r\n\t\t\treturn await this.onSubmit('login', context);\r\n\t\t}\r\n\t}\r\n\r\n\theader() {\r\n\t\tif (this.withBack === true) {\r\n\t\t\treturn '登录';\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcontent() {\r\n\t\treturn <div className=\"d-flex p-5 flex-column justify-content-center align-items-center\">\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t\t<div className=\"w-20c\">\r\n\t\t\t\t{this.tonwa.loginTop(defaultLoginTop)}\r\n\t\t\t\t<div className=\"h-2c\" />\r\n\t\t\t\t<Form schema={schema} uiSchema={this.uiSchema}\r\n\t\t\t\t\tonButtonClick={this.onSubmit}\r\n\t\t\t\t\tonEnter={this.onEnter}\r\n\t\t\t\t\trequiredFlag={false} />\r\n\t\t\t\t<div className=\"text-center\">\r\n\t\t\t\t\t<Ax className=\"btn btn-link\" href=\"/forget\">\r\n\t\t\t\t\t\t忘记密码\r\n\t\t\t\t\t</Ax>\r\n\t\t\t\t\t<Ax href=\"/register\" className=\"btn btn-link\">\r\n\t\t\t\t\t\t注册账号\r\n\t\t\t\t\t</Ax>\r\n\t\t\t\t</div>\r\n\t\t\t\t{tonwa.privacyEntry()}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { VPage } from '../vm';\r\nimport { Page, Form, ItemSchema, UiSchema, StringSchema, UiPasswordItem, Context, ButtonSchema, UiButton } from '../components';\r\n//import { CenterAppApi } from '../net';\r\nimport { CLogin } from './CLogin';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport class VChangePassword extends VPage<CLogin> {\r\n    private schema: ItemSchema[] = [\r\n        { name: 'orgPassword', type: 'string', maxLength: 60, required: true } as StringSchema,\r\n        { name: 'newPassword', type: 'string', maxLength: 60, required: true } as StringSchema,\r\n        { name: 'newPassword1', type: 'string', maxLength: 60, required: true } as StringSchema,\r\n        { name: 'submit', type: 'submit' } as ButtonSchema\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            orgPassword: {\r\n                widget: 'password',\r\n                label: '原密码',\r\n                placeholder: '输入原来的密码'\r\n            } as UiPasswordItem,\r\n            newPassword: {\r\n                widget: 'password',\r\n                label: '新密码',\r\n                placeholder: '输入新设的密码'\r\n            } as UiPasswordItem,\r\n            newPassword1: {\r\n                widget: 'password',\r\n                label: '确认密码',\r\n                placeholder: '再次输入新设密码'\r\n            } as UiPasswordItem,\r\n            submit: {\r\n                widget: 'button',\r\n                label: '提交',\r\n                className: 'btn btn-primary'\r\n            } as UiButton,\r\n        }\r\n    };\r\n\r\n    private onChange: (orgPassword: string, newPassword: string) => Promise<boolean>\r\n    init(onChange: (orgPassword: string, newPassword: string) => Promise<boolean>) {\r\n        this.onChange = onChange;\r\n    }\r\n\r\n    private onSubmit = async (name: string, context: Context): Promise<any> => {\r\n        let { orgPassword, newPassword, newPassword1 } = context.data;\r\n        if (newPassword !== newPassword1) {\r\n            context.setError('newPassword1', '新密码错误，请重新输入');\r\n            return;\r\n        }\r\n        //let centerAppApi = new CenterAppApi('tv/', undefined);\r\n        //let ret = await centerAppApi.changePassword({orgPassword, newPassword});\r\n        let ret = await this.onChange(orgPassword, newPassword);\r\n        if (ret === false) {\r\n            context.setError('orgPassword', '原密码错误');\r\n            return;\r\n        }\r\n        tonwa.nav.replace(<Page header=\"修改密码\" back=\"close\">\r\n            <div className=\"m-3  text-success\">\r\n                密码修改成功！\r\n            </div>\r\n        </Page>);\r\n        return;\r\n    }\r\n\r\n    header() { return '修改密码' }\r\n\r\n    content() {\r\n        return <Form\r\n            className=\"m-3\"\r\n            schema={this.schema}\r\n            uiSchema={this.uiSchema}\r\n            onButtonClick={this.onSubmit}\r\n            fieldLabelSize={2} />\r\n    }\r\n}\r\n","import { CLogin } from \"./CLogin\";\r\nimport { VPage } from \"../vm\";\r\nimport { CenterAppApi } from \"tonwa-core\";\r\n\r\nconst waitingTime = '一小时';\r\n\r\nabstract class VUserQuitBase extends VPage<CLogin> {\r\n    protected abstract get note(): any;\r\n    protected get button1Caption(): string { return undefined; }\r\n    protected get button2Caption(): string { return undefined; }\r\n    protected renderButton1(): JSX.Element {\r\n        let caption = this.button1Caption;\r\n        if (caption === null) return null;\r\n        return <button className=\"btn btn-primary\" onClick={() => this.onClickButton1()}>\r\n            {caption ?? '不注销'}\r\n        </button>;\r\n    }\r\n    protected renderButton2(): JSX.Element {\r\n        let caption = this.button2Caption;\r\n        if (caption === null) return null;\r\n        return <button className=\"btn btn-outline-info ms-3\" onClick={() => this.onClickButton2()}>\r\n            {caption ?? '确认注销'}\r\n        </button>;\r\n    }\r\n    header() { return '注销账号' }\r\n    content() {\r\n        return <div className=\"border border-danger rounded mx-auto m-3 w-max-30c bg-white \">\r\n            <div className=\"p-4 border-bottom\">{this.note}</div>\r\n            <div className=\"p-3 text-center\">\r\n                {this.renderButton1()}\r\n                {this.renderButton2()}\r\n            </div>\r\n        </div>\r\n    }\r\n\r\n    protected onClickButton1() {\r\n        this.closePage();\r\n    }\r\n\r\n    protected onClickButton2() {\r\n    }\r\n}\r\n\r\nexport class VUserQuit extends VUserQuitBase {\r\n    protected get note(): any {\r\n        return <>\r\n            注意：账号注销后，账号绑定手机、邮件等相关信息将被释放。账号无法将登录。<br />\r\n            请确认！\r\n        </>;\r\n    }\r\n    protected get button2Caption(): string { return '我已了解，仍然注销'; }\r\n\r\n    protected onClickButton2() {\r\n        this.openVPage(VQuitConfirm);\r\n    }\r\n}\r\n\r\nclass VQuitConfirm extends VUserQuitBase {\r\n    protected get note(): any {\r\n        return <>\r\n            账号注销后，如果在{waitingTime}内容重新登录账号，账号自动恢复。\r\n            {waitingTime}之后，账号绑定手机、邮件等相关信息将被释放。账号无法将登录。<br />\r\n            请再次确认！\r\n        </>;\r\n    }\r\n    protected get button2Caption(): string { return '确认注销'; }\r\n\r\n    protected onClickButton1() {\r\n        this.closePage(2);\r\n    }\r\n\r\n    protected async onClickButton2() {\r\n        let centerAppApi = new CenterAppApi(this.controller.web, 'tv/', undefined);\r\n        await centerAppApi.userQuit();\r\n        this.openVPage(VQuitDone);\r\n    }\r\n}\r\n\r\nclass VQuitDone extends VUserQuitBase {\r\n    header() { return '注销已账号' }\r\n    protected get back(): 'close' | 'back' | 'none' { return 'none' }\r\n    protected get note(): any {\r\n        return <>\r\n            账号将在{waitingTime}后彻底注销。<br />\r\n            如果在{waitingTime}内容重新登录账号，注销操作自动取消。\r\n            {waitingTime}之后，账号绑定手机、邮件等相关信息将被释放。账号无法将登录。\r\n        </>;\r\n    }\r\n    protected get button1Caption(): string { return '退出'; }\r\n    protected get button2Caption(): string { return null; }\r\n    protected onClickButton1() {\r\n        this.tonwa.logout();\r\n    }\r\n}\r\n","import { User, CenterAppApi, Login } from 'tonwa-core';\r\nimport { ControllerWithWeb, VPage } from \"../vm\";\r\nimport { VLogout } from './VLogout';\r\nimport { VLogin } from './VLogin';\r\nimport { VChangePassword } from './VChangePassword';\r\nimport { VUserQuit } from './VUserQuit';\r\n\r\nexport class CLogin extends ControllerWithWeb implements Login {\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\tasync showLogin(callback?: (user: User) => Promise<void>, withBack?: boolean): Promise<void> {\r\n\t\tlet onLogin = async (un: string, pwd: string): Promise<boolean> => {\r\n\t\t\tlet user = await this.web.userApi.login({\r\n\t\t\t\tuser: un,\r\n\t\t\t\tpwd: pwd,\r\n\t\t\t\tguest: this.tonwa.guest,\r\n\t\t\t});\r\n\r\n\t\t\tif (user === undefined) return false;\r\n\t\t\tconsole.log(\"onLoginSubmit: user=%s pwd:%s\", user.name, user.token);\r\n\t\t\tawait this.tonwa.userLogined(user, callback);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tthis.openVPage(VLogin, { onLogin, withBack });\r\n\t}\r\n\r\n\tasync showLogout(callback?: () => Promise<void>) {\r\n\t\tthis.openVPage(VLogout, () => {\r\n\t\t\tthis.tonwa.logout(callback);\r\n\t\t});\r\n\t}\r\n\t/*\r\n\tasync showRegister() {\r\n\t\tlet cRegister = new (await import('./register')).CRegister(this.res);\r\n\t\tawait cRegister.start();\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tlet cForget = new (await import('./register')).CForget(this.res);\r\n\t\tawait cForget.start();\r\n\t}\r\n\t*/\r\n\r\n\tprotected getVChangePassword(): new (cLogin: CLogin) => VPage<CLogin> {\r\n\t\treturn VChangePassword;\r\n\t}\r\n\tasync showChangePassword() {\r\n\t\tlet vPage = this.getVChangePassword();\r\n\t\tthis.openVPage(vPage, async (orgPassword: string, newPassword: string): Promise<boolean> => {\r\n\t\t\tlet centerAppApi = new CenterAppApi(this.web, 'tv/', undefined);\r\n\t\t\tlet ret = await centerAppApi.changePassword({ orgPassword, newPassword });\r\n\t\t\treturn ret;\r\n\t\t});\r\n\t}\r\n\r\n\tasync showUserQuit(): Promise<void> {\r\n\t\tthis.openVPage(VUserQuit);\r\n\t}\r\n}\r\n","export default __webpack_public_path__ + \"static/media/logo.2d27ead7.svg\";","import { mobileRegex, emailRegex } from 'tonwa-core';\r\nimport logo from '../img/logo.svg';\r\n\r\nexport const defaultLoginTop = <div className=\"d-flex align-items-center position-relative\">\r\n    <img className=\"App-logo h-3c position-absolute\" src={logo} alt=\"img\" />\r\n    <div className=\"h3 flex-fill text-center\"><span className=\"text-primary me-3\">同</span>\r\n        <span className=\"text-danger\">花</span>\r\n    </div>\r\n</div>;\r\n\r\ninterface Sender {\r\n    type: string;\r\n    caption: string;\r\n    regex: RegExp;\r\n}\r\n\r\nconst senders: Sender[] = [\r\n    { type: 'mobile', caption: '手机号', regex: mobileRegex },\r\n    { type: 'email', caption: '邮箱', regex: emailRegex }\r\n];\r\n\r\nexport function getSender(un: string): Sender {\r\n    let sender = senders.find(v => v.regex.test(un) === true);\r\n    return sender;\r\n}","import fs from \"fs\";\r\nimport { capitalCase } from \"../tool\";\r\nimport { Entity, ID, IDX, IX, UqMan } from \"../uqCore\";\r\nimport { TsUQ } from \"./TsUQ\";\r\nimport { buildFieldItem } from \"./buildFieldItem\";\r\nimport { overrideTsFile, saveTsFileIfNotExists } from \"./tools\";\r\nimport { UqBuildContext } from \"./UqBuildContext\";\r\n\r\ninterface FieldItem {\r\n\tname: string;\r\n};\r\n\r\ninterface ReplaceSection {\r\n\tbegin: string;\r\n\tend: string;\r\n\tcontent: string;\r\n};\r\n\r\nconst fieldItemReplaceProps = ['label', 'placeholder', 'widget', 'type'];\r\n\r\nexport class TsUqFolder {\r\n\tprivate buildContext: UqBuildContext;\r\n\tprivate readonly uq: UqMan;\r\n\tprivate readonly uqsFolder: string;\r\n\tprivate readonly uqAlias: string;\r\n\r\n\tconstructor(buildContext: UqBuildContext, uq: UqMan, uqsFolder: string, uqAlias: string) {\r\n\t\tthis.buildContext = buildContext;\r\n\t\tthis.uq = uq;\r\n\t\tthis.uqsFolder = uqsFolder;\r\n\t\tthis.uqAlias = uqAlias;\r\n\t}\r\n\r\n\tbuild() {\r\n\t\tlet uqFolder = this.uqsFolder + '/' + this.uqAlias;\r\n\t\tif (fs.existsSync(uqFolder) === false) {\r\n\t\t\tfs.mkdirSync(uqFolder);\r\n\t\t}\r\n\t\tlet tsUq = this.buildContext.tsTemplate.tsHeader;\r\n\t\tlet tsUqBuilder = new TsUQ(this.buildContext, this.uq, this.uqAlias);\r\n\t\t//tsUq += buildUQ(this.uq, this.uqAlias);\r\n\t\ttsUq += tsUqBuilder.build();\r\n\t\toverrideTsFile(`${uqFolder}/${this.uqAlias}.ts`, tsUq);\r\n\t\tthis.saveTuidAndIDTsIndexAndRender(uqFolder);\r\n\t}\r\n\r\n\tprivate saveTuidAndIDTsIndexAndRender(uqFolder: string) {\r\n\t\tlet imports = '', sets = '';\r\n\t\tlet { idArr, idxArr, ixArr, tuidArr } = this.uq;\r\n\t\tlet coll: { [name: string]: Entity } = {};\r\n\r\n\t\tfor (let i of tuidArr) {\r\n\t\t\tlet { sName } = i;\r\n\t\t\tcoll[sName.toLowerCase()] = i;\r\n\t\t\tlet cName = capitalCase(sName);\r\n\t\t\tif (cName[0] === '$') continue;\r\n\t\t\timports += `\\nimport * as ${cName} from './${cName}.ui';`;\r\n\t\t\tsets += `\\n\tassign(uq, '${cName}', ${cName});`;\r\n\r\n\t\t\tlet tsUI = `/* eslint-disable */\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-${this.buildContext.uiPlatform}';\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\r\nimport { Tuid${cName} } from \"./${this.uqAlias}\";\r\n\r\nconst resRaw: Res<any> = {\r\n\t$zh: {\r\n\t},\r\n\t$en: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|${this.buildContext.element}): string|${this.buildContext.element} => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: Tuid${cName}):${this.buildContext.element} {\r\n\treturn <>{uqStringify(item)}</>;\r\n};\r\n`;\r\n\r\n\t\t\tlet path = `${uqFolder}/${cName}.ui.tsx`;\r\n\t\t\tsaveTsFileIfNotExists(path, tsUI);\r\n\t\t}\r\n\r\n\t\tfor (let i of [...idArr, ...idxArr, ...ixArr]) {\r\n\t\t\tlet { sName } = i;\r\n\t\t\t//coll[sName.toLowerCase()] = i;\r\n\t\t\tlet cName = capitalCase(sName);\r\n\t\t\tif (cName[0] === '$') continue;\r\n\t\t\tcoll[cName.toLocaleLowerCase()] = i;\r\n\t\t\timports += `\\nimport * as ${cName} from './${cName}.ui';`;\r\n\t\t\tsets += `\\n\tassign(uq, '${cName}', ${cName});`;\r\n\r\n\t\t\tlet tsUI = `// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-${this.buildContext.uiPlatform}';\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\r\nimport { ${cName} } from \"./${this.uqAlias}\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"${cName}\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\t$zh: {\r\n\t},\r\n\t$en: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|${this.buildContext.element}): string|${this.buildContext.element} => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: ${cName}):${this.buildContext.element} {\r\n\treturn <>{uqStringify(item)}</>;\r\n};\r\n`;\r\n\r\n\t\t\tlet path = `${uqFolder}/${cName}.ui.tsx`;\r\n\t\t\tsaveTsFileIfNotExists(path, tsUI);\r\n\r\n\t\t\tlet fields = this.buildFields(i);\r\n\t\t\tlet tsFieldArr: string = this.buildFieldArr(i);\r\n\r\n\t\t\tthis.replaceTsFileFields(path, fields);\r\n\t\t\tlet tsImportFieldItemsBegin = 'import { FieldItem, ';\r\n\t\t\tlet tsImportFieldItemsEnd = ` } from \"tonwa-${this.buildContext.uiPlatform}\";`;\r\n\t\t\tlet tsImportFieldItems = 'FieldItemInt, FieldItemNumber, FieldItemString, FieldItemId';\r\n\t\t\tthis.replaceTsFileString(path,\r\n\t\t\t\t{\r\n\t\t\t\t\tbegin: tsImportFieldItemsBegin,\r\n\t\t\t\t\tend: tsImportFieldItemsEnd,\r\n\t\t\t\t\tcontent: tsImportFieldItemsBegin + tsImportFieldItems + tsImportFieldItemsEnd,\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t\tthis.replaceTsFileString(path,\r\n\t\t\t\t{ begin: '\\nconst fieldArr: FieldItem[] = [\\n', end: '\\n];\\n', content: tsFieldArr }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tlet tsIndex = `import { UqExt as Uq, assign } from './${this.uqAlias}';${imports}\r\n\t\r\nexport function setUI(uq: Uq) {${sets}\r\n}\r\nexport * from './${this.uqAlias}';\r\n`;\r\n\t\toverrideTsFile(`${uqFolder}/index.ts`, tsIndex);\r\n\r\n\t\tlet files = fs.readdirSync(uqFolder);\r\n\t\tconst suffix = '.ui.tsx';\r\n\t\tfor (let file of files) {\r\n\t\t\tif (file.endsWith(suffix) === false) continue;\r\n\t\t\tlet from = file.length - suffix.length;\r\n\t\t\tlet fileEntityName = file.substring(0, from);\r\n\t\t\tlet entity = coll[fileEntityName.toLocaleLowerCase()];\r\n\t\t\tif (entity === undefined || fileEntityName[0] === '$') {\r\n\t\t\t\tlet unFile = `${uqFolder}/${file}`;\r\n\t\t\t\tfs.unlinkSync(unFile);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildFields(i: ID | IDX | IX): { [name: string]: FieldItem } {\r\n\t\tswitch (i.typeName) {\r\n\t\t\tcase 'id': return this.buildIDFields(i as ID);\r\n\t\t\tcase 'idx': return this.buildIDXFields(i);\r\n\t\t\tcase 'ix': return this.buildIXFields(i);\r\n\t\t}\r\n\t};\r\n\r\n\tprivate buildIDFields(ID: ID): { [name: string]: FieldItem } {\r\n\t\tlet ret: { [name: string]: FieldItem } = {};\r\n\t\tlet { schema } = ID;\r\n\t\tlet { keys, fields } = schema;\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\t\tret[name] = buildFieldItem(f, isKey);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate buildIDXFields(IDX: IDX): { [name: string]: FieldItem } {\r\n\t\tlet ret: { [name: string]: FieldItem } = {};\r\n\t\tlet { schema } = IDX;\r\n\t\tlet { keys, fields } = schema;\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\t\tret[name] = buildFieldItem(f, isKey);\r\n\t\t}\r\n\t\treturn ret;\r\n\t};\r\n\r\n\tprivate buildIXFields(IX: IX): { [name: string]: FieldItem } {\r\n\t\tlet ret: { [name: string]: FieldItem } = {};\r\n\t\tlet { schema } = IX;\r\n\t\tlet { keys, fields } = schema;\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\t\tret[name] = buildFieldItem(f, isKey);\r\n\t\t}\r\n\t\treturn ret;\r\n\t};\r\n\r\n\tprivate buildFieldArr(i: ID | IDX | IX): string {\r\n\t\tlet ts = '\\nconst fieldArr: FieldItem[] = [\\n\\t';\r\n\t\tswitch (i.typeName) {\r\n\t\t\tcase 'id': ts += this.buildIDFieldArr(i as ID); break;\r\n\t\t\tcase 'idx': ts += this.buildIDXFieldArr(i); break;\r\n\t\t\tcase 'ix': ts += this.buildIXFieldArr(i); break;\r\n\t\t}\r\n\t\treturn ts += '\\n];\\n';\r\n\t}\r\n\r\n\tprivate buildIDFieldArr(i: ID): string {\r\n\t\tlet { schema } = i;\r\n\t\tlet ts = '';\r\n\t\tfor (let f of schema.fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tif (name === 'id') continue;\r\n\t\t\tts += `fields.${name}, `;\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDXFieldArr(i: IDX): string {\r\n\t\tlet { schema } = i;\r\n\t\tlet ts = '';\r\n\t\tfor (let f of schema.fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tif (name === 'id') continue;\r\n\t\t\tts += `fields.${name}, `;\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIXFieldArr(i: IX): string {\r\n\t\tlet { schema } = i;\r\n\t\tlet ts = '';\r\n\t\tfor (let f of schema.fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tif (name === 'ix') continue;\r\n\t\t\tif (name === 'id') continue;\r\n\t\t\tts += `fields.${name}, `;\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate replaceTsFileFields(path: string, fields: { [name: string]: FieldItem }) {\r\n\t\tlet text = fs.readFileSync(path).toString();\r\n\t\tlet startStr = '\\n/*--fields--*/';\r\n\t\tlet endStr = '\\n/*==fields==*/\\n';\r\n\t\tlet start = text.indexOf(startStr);\r\n\t\tif (start > 0) {\r\n\t\t\tlet end = text.indexOf(endStr, start + startStr.length);\r\n\t\t\tif (end > 0) {\r\n\t\t\t\tlet lBrace = text.indexOf('{', start + startStr.length);\r\n\t\t\t\tlet rBrace = text.lastIndexOf('}', end);\r\n\t\t\t\tlet oldText = text.substring(lBrace, rBrace + 1);\r\n\t\t\t\tlet fieldsText = this.buildFieldsFromOldText(fields, oldText);\r\n\t\t\t\ttext = text.substring(0, start)\r\n\t\t\t\t\t+ startStr + '\\nconst fields = {'\r\n\t\t\t\t\t+ fieldsText\r\n\t\t\t\t\t+ '\\n};'\r\n\t\t\t\t\t+ text.substring(end);\r\n\t\t\t\tfs.writeFileSync(path, text);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildFieldsFromOldText(fields: { [name: string]: FieldItem }, oldText: string): string {\r\n\t\tlet ret = '';\r\n\t\tfor (let i in fields) {\r\n\t\t\tlet field = fields[i];\r\n\t\t\tthis.setFieldOldProp(field, oldText);\r\n\t\t\tret += this.buildFieldText(field);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate setFieldOldProp(field: FieldItem, text: string) {\r\n\t\tlet fieldStart = field.name + ':';\r\n\t\tlet start = text.indexOf('\\t' + fieldStart);\r\n\t\tif (start < 0) start = text.indexOf('\\n' + fieldStart);\r\n\t\tif (start < 0) start = text.indexOf(' ' + fieldStart);\r\n\t\tif (start < 0) return;\r\n\t\t++start;\r\n\t\tlet end = text.indexOf('}', start + fieldStart.length);\r\n\t\tif (end < 0) return;\r\n\t\tlet fieldText = text.substring(start + fieldStart.length, end + 1);\r\n\t\t/* eslint no-eval: 0 */\r\n\t\tlet obj = eval('(' + fieldText + ')');\r\n\t\tfieldItemReplaceProps.forEach(v => {\r\n\t\t\tlet prop = obj[v];\r\n\t\t\tif (!prop) return;\r\n\t\t\tif (v === 'type') return; // 这个是由新的schema决定的\r\n\t\t\t(field as any)[v] = prop;\r\n\t\t});\r\n\t}\r\n\r\n\tprivate buildFieldText(field: FieldItem): string {\r\n\t\tlet { $FieldItemType } = field as any;\r\n\t\tdelete (field as any).$FieldItemType;\r\n\t\tlet ret = '\\n\\t' + field.name + ': ';\r\n\t\tlet json = JSON.stringify(field, null, '\\t\\t');\r\n\t\tjson = json.replace('}', '\\t}');\r\n\t\tret += json;\r\n\t\treturn ret + ' as ' + $FieldItemType + ',';\r\n\t}\r\n\r\n\tprivate replaceTsFileString(path: string, sec: ReplaceSection) {\r\n\t\tlet text = fs.readFileSync(path).toString();\r\n\t\tlet { begin, end, content } = sec;\r\n\t\tlet b = text.indexOf(begin);\r\n\t\tif (b < 0) return;\r\n\t\tlet e = text.indexOf(end, b + begin.length - 1);\r\n\t\tif (e < 0) return;\r\n\t\ttext = text.substring(0, b) + content + text.substr(e + end.length);\r\n\t\tfs.writeFileSync(path, text);\r\n\t}\r\n}\r\n","import { UqBuildContext } from \"./UqBuildContext\";\r\nimport { camelCase, capitalCase } from \"../tool\";\r\nimport {\r\n\tUqMan, Action, Book, Query, Sheet\r\n\t, Tuid, UqEnum, Map, History, Pending\r\n\t, Entity, ID, IX, IDX, ArrFields, Field\r\n} from '../uqCore';\r\nimport { entityName } from \"./tools\";\r\n\r\nconst fieldTypeMap: { [type: string]: string } = {\r\n\t\"char\": \"string\",\r\n\t\"text\": \"string\",\r\n\t\"id\": \"number\",\r\n\t\"textid\": \"string\",\r\n\t\"int\": \"number\",\r\n\t\"bigint\": \"number\",\r\n\t\"smallint\": \"number\",\r\n\t\"tinyint\": \"number\",\r\n\t\"dec\": \"number\",\r\n\t\"float\": \"number\",\r\n\t\"double\": \"number\",\r\n};\r\nconst sysFields = ['id', 'main', 'row', 'no', '$create', '$update', '$owner'];\r\n\r\nexport class TsUQ {\r\n\tprivate buildContext: UqBuildContext;\r\n\tprivate readonly uq: UqMan;\r\n\tprivate readonly uqAlias: string;\r\n\r\n\tconstructor(buildContext: UqBuildContext, uq: UqMan, uqAlias: string) {\r\n\t\tthis.buildContext = buildContext;\r\n\t\tthis.uq = uq;\r\n\t\tthis.uqAlias = uqAlias;\r\n\t}\r\n\r\n\tbuild() {\r\n\t\tlet tsImport = `\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { IDXValue, Uq`;\r\n\t\tlet ts: string = `\\n\\n`;\r\n\t\tts += '\\n//===============================';\r\n\t\tts += `\\n//======= UQ ${this.uq.name} ========`;\r\n\t\tts += '\\n//===============================';\r\n\t\tts += '\\n';\r\n\r\n\t\tlet { enumArr, tuidArr, actionArr, sheetArr\r\n\t\t\t, queryArr, bookArr, mapArr, historyArr\r\n\t\t\t, pendingArr, idArr, idxArr, ixArr\r\n\t\t} = this.uq;\r\n\t\tenumArr.forEach(v => ts += this.uqEntityInterface<UqEnum>(v, this.buildEnumInterface));\r\n\t\ttuidArr.forEach(v => ts += this.uqEntityInterface<Tuid>(v, this.buildTuidInterface));\r\n\t\tactionArr.forEach(v => ts += this.uqEntityInterface<Action>(v, this.buildActionInterface));\r\n\t\tsheetArr.forEach(v => ts += this.uqEntityInterface<Sheet>(v, this.buildSheetInterface));\r\n\t\tqueryArr.forEach(v => ts += this.uqEntityInterface<Query>(v, this.buildQueryInterface));\r\n\t\tbookArr.forEach(v => ts += this.uqEntityInterface<Book>(v, this.buildBookInterface));\r\n\t\tmapArr.forEach(v => ts += this.uqEntityInterface<Map>(v, this.buildMapInterface));\r\n\t\thistoryArr.forEach(v => ts += this.uqEntityInterface<History>(v, this.buildHistoryInterface));\r\n\t\tpendingArr.forEach(v => ts += this.uqEntityInterface<Pending>(v, this.buildPendingInterface));\r\n\t\tidArr.forEach(v => ts += this.uqEntityInterface<ID>(v, this.buildIDInterface));\r\n\t\tidxArr.forEach(v => ts += this.uqEntityInterface<IDX>(v, this.buildIDXInterface));\r\n\t\tidxArr.forEach(v => ts += this.uqEntityInterface<IDX>(v, this.buildIDXActParamInterface));\r\n\t\tixArr.forEach(v => ts += this.uqEntityInterface<IX>(v, this.buildIXInterface));\r\n\r\n\t\tts += this.buildActsInterface(this.uq);\r\n\r\n\t\tts += `\r\n\r\nexport interface UqExt extends Uq {\r\n\tActs(param:ParamActs): Promise<any>;\r\n\tSQL: Uq;\r\n\tIDRender(id:number):${this.buildContext.element};\r\n\tIDLocalRender(id:number):${this.buildContext.element};\r\n`;\r\n\t\tfunction appendArr<T extends Entity>(arr: T[], type: string, tsBuild: (v: T) => string) {\r\n\t\t\tif (arr.length === 0) return;\r\n\t\t\tlet tsLen = ts.length;\r\n\t\t\tarr.forEach(v => ts += tsBuild(v));\r\n\t\t\tif (ts.length - tsLen > 0) {\r\n\t\t\t\ttsImport += ', Uq' + type;\r\n\t\t\t}\r\n\t\t}\r\n\t\tappendArr<Tuid>(tuidArr, 'Tuid', v => this.uqBlock<Tuid>(v, this.buildTuid));\r\n\t\tappendArr<Action>(actionArr, 'Action', v => this.uqBlock<Action>(v, this.buildAction));\r\n\t\tappendArr<Sheet>(sheetArr, 'Sheet', v => this.uqBlock<Sheet>(v, this.buildSheet));\r\n\t\tappendArr<Book>(bookArr, 'Book', v => this.uqBlock<Book>(v, this.buildBook));\r\n\t\tappendArr<Query>(queryArr, 'Query', v => this.uqBlock<Query>(v, this.buildQuery));\r\n\t\tappendArr<Map>(mapArr, 'Map', v => this.uqBlock<Map>(v, this.buildMap));\r\n\t\tappendArr<History>(historyArr, 'History', v => this.uqBlock<History>(v, this.buildHistory));\r\n\t\tappendArr<Pending>(pendingArr, 'Pending', v => this.uqBlock<Pending>(v, this.buildPending));\r\n\t\tappendArr<ID>(idArr, 'ID', v => this.uqBlock<ID>(v, this.buildID));\r\n\t\tappendArr<IDX>(idxArr, 'IDX', v => this.uqBlock<IDX>(v, this.buildIDX));\r\n\t\tappendArr<IX>(ixArr, 'IX', v => this.uqBlock<IX>(v, this.buildIX));\r\n\t\tts += '\\n}\\n';\r\n\t\tts += `\r\nexport function assign(uq: any, to:string, from:any): void {\r\n\tlet hasEntity = uq.hasEntity(to);\r\n\tif (hasEntity === false) {\r\n\t\treturn;\r\n\t}\r\n\tObject.assign((uq as any)[to], from);\r\n}\r\n`;\r\n\r\n\t\ttsImport += ` } from \"tonwa-core\";\r\nimport { Render, IDXEntity } from \"tonwa-${this.buildContext.uiPlatform}\";`;\r\n\r\n\t\treturn tsImport + ts;\r\n\t}\r\n\r\n\tprivate uqEntityInterface<T extends Entity>(entity: T, buildInterface: (entity: T) => string) {\r\n\t\tlet { name } = entity;\r\n\t\tif (name.indexOf('$') > 0) return '';\r\n\t\tlet entityCode = buildInterface(entity);\r\n\t\tif (!entityCode) return '';\r\n\t\treturn '\\n' + entityCode + '\\n';\r\n\t}\r\n\r\n\tprivate uqBlock<T extends Entity>(entity: T, build: (entity: T) => string) {\r\n\t\tlet { name } = entity;\r\n\t\tif (name.indexOf('$') > 0) return '';\r\n\t\tlet entityCode = build(entity);\r\n\t\tif (!entityCode) return '';\r\n\t\treturn '\\n' + entityCode;\r\n\t}\r\n\r\n\tprivate buildFields(fields: Field[], isInID: boolean = false, indent: number = 1) {\r\n\t\tif (!fields) return '';\r\n\t\tlet ts = '';\r\n\t\tfor (let f of fields) {\r\n\t\t\tts += this.buildField(f, isInID, indent);\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildField(field: Field, isInID: boolean, indent: number = 1) {\r\n\t\tlet { name, type } = field;\r\n\t\tlet s = fieldTypeMap[type];\r\n\t\tif (!s) s = 'any';\r\n\t\tlet q: string = (isInID === true && sysFields.indexOf(name) >= 0) ? '?' : '';\r\n\t\treturn `\\n${'\\t'.repeat(indent)}${name}${q}: ${s};`;\r\n\t}\r\n\r\n\tprivate buildArrs(arrFields: ArrFields[]): string {\r\n\t\tif (!arrFields) return '';\r\n\t\tlet ts = '\\n';\r\n\t\tfor (let af of arrFields) {\r\n\t\t\tts += `\\t${camelCase(af.name)}: {`;\r\n\t\t\tts += this.buildFields(af.fields, false, 2);\r\n\t\t\tts += '\\n\\t}[];\\n';\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildReturns(entity: Entity, returns: ArrFields[]): string {\r\n\t\tif (!returns) return;\r\n\t\t//let {typeName} = entity;\r\n\t\t//let type = typeMap[typeName] || typeName;\r\n\t\tlet { sName } = entity;\r\n\t\tsName = capitalCase(sName);\r\n\t\tlet ts = '';\r\n\t\tfor (let ret of returns) {\r\n\t\t\tlet retName = capitalCase(ret.name);\r\n\t\t\tts += `export interface Return${sName}${retName} {`;\r\n\t\t\tts += this.buildFields(ret.fields);\r\n\t\t\tts += '\\n}\\n';\r\n\t\t}\r\n\r\n\t\tts += `export interface Result${sName} {\\n`;\r\n\t\tfor (let ret of returns) {\r\n\t\t\tlet retName = capitalCase(ret.name);\r\n\t\t\tts += `\\t${ret.name}: Return${sName}${retName}[];\\n`;\r\n\t\t}\r\n\t\tts += '}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildTuid = (tuid: Tuid) => {\r\n\t\tlet ts = `\\t${entityName(tuid.sName)}: UqTuid<Tuid${capitalCase(tuid.sName)}>&{tv:(id:number, render?:Render<any>)=>${this.buildContext.element}};`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildTuidInterface = (tuid: Tuid) => {\r\n\t\tlet ts = `export interface Tuid${capitalCase(tuid.sName)} {`;\r\n\t\tts += `\\n\\tid?: number;`;\r\n\t\tts += this.buildFields(tuid.fields);\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildAction = (action: Action) => {\r\n\t\tlet ts = `\\t${entityName(action.sName)}: UqAction<Param${capitalCase(action.sName)}, Result${capitalCase(action.sName)}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildActionInterface = (action: Action) => {\r\n\t\tlet ts = `export interface Param${capitalCase(action.sName)} {`;\r\n\t\tts += this.buildFields(action.fields);\r\n\t\tts += this.buildArrs(action.arrFields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += this.buildReturns(action, action.returns);\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildEnumInterface = (enm: UqEnum) => {\r\n\t\tlet { schema } = enm;\r\n\t\tif (!schema) return;\r\n\t\tlet { values } = schema;\r\n\t\tlet ts = `export enum ${capitalCase(enm.sName)} {`;\r\n\t\tlet first: boolean = true;\r\n\t\tfor (let i in values) {\r\n\t\t\tif (first === false) {\r\n\t\t\t\tts += ',';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfirst = false;\r\n\t\t\t}\r\n\t\t\tlet v = values[i];\r\n\t\t\tts += '\\n\\t' + i + ' = ';\r\n\t\t\tif (typeof v === 'string') {\r\n\t\t\t\tts += '\"' + v + '\"';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tts += v;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ts += '\\n}'\r\n\t}\r\n\r\n\tprivate buildQuery = (query: Query) => {\r\n\t\tlet { sName } = query;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqQuery<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildQueryInterface = (query: Query) => {\r\n\t\tlet ts = `export interface Param${capitalCase(query.sName)} {`;\r\n\t\tts += this.buildFields(query.fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += this.buildReturns(query, query.returns);\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildSheet = (sheet: Sheet) => {\r\n\t\tlet { sName, verify } = sheet;\r\n\t\tlet cName = capitalCase(sName);\r\n\t\tlet v = verify ? `Verify${cName}` : 'any';\r\n\t\tlet ts = `\\t${entityName(sName)}: UqSheet<Sheet${cName}, ${v}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildSheetInterface = (sheet: Sheet) => {\r\n\t\tlet { sName, fields, arrFields, verify } = sheet;\r\n\t\tlet ts = `export interface Sheet${capitalCase(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += this.buildArrs(arrFields);\r\n\t\tts += '}';\r\n\r\n\t\tif (verify) {\r\n\t\t\tlet { returns } = verify;\r\n\t\t\tts += `\\nexport interface Verify${capitalCase(sName)} {`;\r\n\t\t\tfor (let item of returns) {\r\n\t\t\t\tlet { name: arrName, fields } = item;\r\n\t\t\t\tts += '\\n\\t' + arrName + ': {';\r\n\t\t\t\tts += this.buildFields(fields, false, 2);\r\n\t\t\t\tts += '\\n\\t}[];';\r\n\t\t\t}\r\n\t\t\tts += '\\n}';\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildBook = (book: Book): string => {\r\n\t\tlet { sName } = book;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqBook<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildBookInterface = (book: Book): string => {\r\n\t\tlet { sName, fields, returns } = book;\r\n\t\tlet ts = `export interface Param${capitalCase(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += this.buildReturns(book, returns);\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildMap = (map: Map): string => {\r\n\t\tlet { sName } = map;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqMap;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildMapInterface = (map: Map): string => {\r\n\t\t/*\r\n\t\tlet {sName, fields, returns} = map;\r\n\t\tlet ts = `export interface Param${capitalCaseString(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += buildReturns(map, returns);\r\n\t\treturn ts;\r\n\t\t*/\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate buildHistory = (history: History): string => {\r\n\t\tlet { sName } = history;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqHistory<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildHistoryInterface = (history: History): string => {\r\n\t\tlet { sName, fields, returns } = history;\r\n\t\tlet ts = `export interface Param${capitalCase(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += this.buildReturns(history, returns);\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildPending = (pending: Pending): string => {\r\n\t\tlet { sName } = pending;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqPending<any, any>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildPendingInterface = (pending: Pending): string => {\r\n\t\t/*\r\n\t\tlet {sName, fields, returns} = pending;\r\n\t\tlet ts = `export interface Param${capitalCaseString(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += buildReturns(pending, returns);\r\n\t\treturn ts;\r\n\t\t*/\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate buildID = (id: ID): string => {\r\n\t\tlet { sName } = id;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqID<any> & IDXEntity<any>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDX = (idx: IDX): string => {\r\n\t\tlet { sName } = idx;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqIDX<any>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIX = (ix: IX): string => {\r\n\t\tlet { sName } = ix;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqIX<any>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDInterface = (idEntity: ID): string => {\r\n\t\tlet { sName, fields, schema } = idEntity;\r\n\t\tlet { keys: schemaKeys } = schema;\r\n\t\tlet keys: Field[] = [], others: Field[] = [];\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tif (name === 'id') continue;\r\n\t\t\tif ((schemaKeys as any[]).find(v => v.name === name)) keys.push(f);\r\n\t\t\telse others.push(f);\r\n\t\t}\r\n\t\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\t\tts += `\\n\\tid?: number;`;\r\n\t\tts += this.buildFields(keys, true);\r\n\t\tts += this.buildFields(others, true);\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDXInterface = (idx: IDX): string => {\r\n\t\tlet { sName, fields, schema } = idx;\r\n\t\tlet { exFields } = schema;\r\n\t\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\t\tlet indent = 1;\r\n\t\tfor (let field of fields) {\r\n\t\t\tlet { name, type } = field;\r\n\t\t\tlet s = fieldTypeMap[type];\r\n\t\t\tif (!s) s = 'any';\r\n\t\t\tts += `\\n${'\\t'.repeat(indent)}${name}`;\r\n\t\t\tif (name !== 'id') ts += '?';\r\n\t\t\tts += `: ${s};`;\r\n\t\t}\r\n\r\n\t\tts += `\\n\\t$act?: number;`;\r\n\r\n\t\tlet hasTrack: boolean = false;\r\n\t\tlet hasMemo: boolean = false;\r\n\t\tif (exFields) {\r\n\t\t\tfor (let exField of exFields) {\r\n\t\t\t\tlet { track, memo } = exField;\r\n\t\t\t\tif (track === true) hasTrack = true;\r\n\t\t\t\tif (memo === true) hasMemo = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hasTrack === true) {\r\n\t\t\tts += `\\n\\t$track?: number;`;\r\n\t\t}\r\n\t\tif (hasMemo === true) {\r\n\t\t\tts += `\\n\\t$memo?: string;`;\r\n\t\t}\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDXActParamInterface = (idx: IDX): string => {\r\n\t\tlet { sName, fields, schema } = idx;\r\n\t\tlet { exFields } = schema;\r\n\t\tlet ts = `export interface ActParam${capitalCase(sName)} {`;\r\n\t\tlet indent = 1;\r\n\t\tfor (let field of fields) {\r\n\t\t\tlet { name, type } = field;\r\n\t\t\tlet s = fieldTypeMap[type];\r\n\t\t\tif (!s) s = 'any';\r\n\t\t\tts += `\\n${'\\t'.repeat(indent)}${name}`;\r\n\t\t\tif (name !== 'id') ts += '?';\r\n\t\t\tts += `: ${s}|IDXValue;`;\r\n\t\t}\r\n\r\n\t\tts += `\\n\\t$act?: number;`;\r\n\r\n\t\tlet hasTrack: boolean = false;\r\n\t\tlet hasMemo: boolean = false;\r\n\t\tif (exFields) {\r\n\t\t\tfor (let exField of exFields) {\r\n\t\t\t\tlet { track, memo } = exField;\r\n\t\t\t\tif (track === true) hasTrack = true;\r\n\t\t\t\tif (memo === true) hasMemo = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hasTrack === true) {\r\n\t\t\tts += `\\n\\t$track?: number;`;\r\n\t\t}\r\n\t\tif (hasMemo === true) {\r\n\t\t\tts += `\\n\\t$memo?: string;`;\r\n\t\t}\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIXInterface = (ix: IX): string => {\r\n\t\tlet { sName, fields } = ix;\r\n\t\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildActsInterface(uq: UqMan) {\r\n\t\tlet ts = `\\nexport interface ParamActs {`;\r\n\t\tuq.idArr.forEach(v => {\r\n\t\t\tlet { sName } = v;\r\n\t\t\tts += `\\n\\t${camelCase(sName)}?: ${capitalCase(sName)}[];`;\r\n\t\t});\r\n\t\tuq.idxArr.forEach(v => {\r\n\t\t\tlet { sName } = v;\r\n\t\t\tts += `\\n\\t${camelCase(sName)}?: ActParam${capitalCase(sName)}[];`;\r\n\t\t});\r\n\t\tuq.ixArr.forEach(v => {\r\n\t\t\tlet { sName } = v;\r\n\t\t\tts += `\\n\\t${camelCase(sName)}?: ${capitalCase(sName)}[];`;\r\n\t\t});\r\n\t\tts += '\\n}\\n';\r\n\t\treturn ts;\r\n\t}\r\n}","import * as React from 'react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Page, ItemSchema, UiSchema, StringSchema, UiTextItem, Edit, ImageSchema, UiImageItem } from '../components';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport class EditMeInfo extends React.Component {\r\n    private schema: ItemSchema[] = [\r\n        { name: 'nick', type: 'string' } as StringSchema,\r\n        { name: 'icon', type: 'image' } as ImageSchema\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            nick: { widget: 'text', label: '别名', placeholder: '好的别名更方便记忆' } as UiTextItem,\r\n            icon: { widget: 'image', label: '头像' } as UiImageItem,\r\n        }\r\n    }\r\n    data: any;\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            data: observable,\r\n        })\r\n        let { nick, icon } = tonwa.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        }\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        //let {name} = itemSchema;        \r\n        //await userApi.userSetProp(name, newValue);\r\n        throw new Error('await userApi.userSetProp(name, newValue);');\r\n        /*\r\n        this.data[name] = newValue;\r\n        let user:any = nav.user;\r\n        user[name] = newValue;\r\n        nav.saveLocalUser();\r\n        */\r\n    }\r\n\r\n    render() {\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={this.schema} uiSchema={this.uiSchema}\r\n                data={this.data}\r\n                onItemChanged={this.onItemChanged} />\r\n        </Page>;\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { Page, LMR } from \"../components\";\r\nimport { VPage } from '../vm';\r\n//import { appInFrame } from '../net';\r\nimport { CAppBase } from \"./CAppBase\";\r\n//import { UQsMan } from '../uq';\r\n\r\n/*\r\nexport class VAppMain extends VPage<CMainBase> {\r\n    async open(param?:any) {\r\n        this.openPage(this.appPage);\r\n    }\r\n\r\n    render(param?:any) {\r\n        return this.appContent();\r\n    }\r\n\r\n    protected appPage = () => {\r\n        let {caption} = this.controller;\r\n        return <Page header={caption} logout={async()=>{appInFrame.unit = undefined}}>\r\n            {this.appContent()}\r\n        </Page>;\r\n    }\r\n\r\n    protected appContent = () => {\r\n        let {cUqArr} = this.controller;\r\n        let content:any;\r\n        if (cUqArr.length === 0) {\r\n            content = <div className=\"text-danger\">\r\n                <FA name=\"\" /> 此APP没有绑定任何的UQ\r\n            </div>;\r\n        }\r\n        else {\r\n            content = cUqArr.map((v,i) => <div key={i}>{v.render()}</div>);\r\n        }\r\n        return <>{content}</>;\r\n    };\r\n}\r\n*/\r\nexport class VUnsupportedUnit extends VPage<CAppBase<any>> {\r\n    private params: { predefinedUnit: number, uqsLoadErrors: string[] };\r\n    async open(params: { predefinedUnit: number, uqsLoadErrors: string[] }) {\r\n        this.params = params;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = () => {\r\n        let { predefinedUnit, uqsLoadErrors } = this.params;\r\n        let { user } = this.tonwa;\r\n        let userName: string = user ? user.name : '[未登录]';\r\n        //let {appOwner, appName} = UQsMan.value;\r\n        return <Page header=\"APP无法运行\" logout={true}>\r\n            <div className=\"m-3 text-danger container\">\r\n                <div className=\"mb-3 row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">登录用户</div>\r\n                    <div className=\"col-sm text-body\">{userName}</div>\r\n                </div>\r\n                <div className=\"mb-3 row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">预设小号</div>\r\n                    <div className=\"col-sm text-body\">{predefinedUnit || <small className=\"\">[无预设小号]</small>}</div>\r\n                </div>\r\n                {\r\n                    uqsLoadErrors && uqsLoadErrors.map(v => {\r\n                        return <div className=\"mb-3 row\">\r\n                            <div className=\"col-sm-3 font-weight-bold\">App</div>\r\n                            <div className=\"col-sm text-body\">{v}</div>\r\n                        </div>\r\n                    })\r\n                }\r\n                <div className=\"mb-3 row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">小号{predefinedUnit}</div>\r\n                    <div className=\"col-sm text-body\">\r\n                        预设小号定义在 public/unit.json 文件中。\r\n                        定义了这个文件的程序，只能由url直接启动。\r\n                        用户第一次访问app之后，会缓存在localStorage里。<br />\r\n                        如果要删去缓存的预定义Unit，logout然后再login。\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n    /*\r\n    <div className=\"mb-3 row\">\r\n        <div className=\"col-sm-3 font-weight-bold\">\r\n            可能原因<FA name=\"exclamation-triangle\" />\r\n        </div>\r\n        <div className=\"col-sm text-body\">\r\n            <ul className=\"p-0\">\r\n                <li>没有小号运行 {appName}</li>\r\n                <li>用户 <b>{userName}</b> 没有加入任何一个运行{appName}的小号</li>\r\n                {\r\n                    predefinedUnit && \r\n                    <li>预设小号 <b>{predefinedUnit}</b> 没有运行App {appName}</li>\r\n                }\r\n            </ul>\r\n        </div>\r\n    </div>\r\n    */\r\n}\r\n\r\nexport class VUnitSelect extends VPage<CAppBase<any>> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (item: any, index: number): JSX.Element => {\r\n        let { id, nick, name } = item;\r\n        return <LMR className=\"px-3 py-2\" right={'id: ' + id}>\r\n            <div>{nick || name}</div>\r\n        </LMR>;\r\n    }\r\n    private onRowClick = async (appUnit: any) => {\r\n        //appInFrame.unit = appUnit.id; // 25;\r\n        //this.controller.setAppUnit(appUnit);\r\n        await this.controller.start();\r\n    }\r\n\r\n    private page = () => {\r\n        return <Page header=\"选择小号\" logout={true}>\r\n            <div>this.controller.appUnits appUnits removed</div>\r\n        </Page>\r\n        // <List items={this.controller.appUnits} item={{render: this.renderRow, onClick: this.onRowClick}}/>\r\n    }\r\n}\r\n\r\nexport class VErrorsPage extends VPage<CAppBase<any>> {\r\n    async open(errors: string[]) {\r\n        this.openPage(this.page, { errors: errors });\r\n    }\r\n\r\n    private page = (errors: { errors: string[] }) => {\r\n        return <Page header=\"ERROR\">\r\n            <div className=\"m-3\">\r\n                <div className=\"p-3 d-flex justify-content-center align-items-center\">\r\n                    <button className=\"btn btn-danger\" onClick={this.tonwa.resetAll}>重启网页</button>\r\n                </div>\r\n\r\n                <div>Load Uqs 发生错误：</div>\r\n                {errors.errors.map((r, i) => <div key={i}>{r}</div>)}\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VStartError extends VPage<CAppBase<any>> {\r\n    async open(error: any) {\r\n        this.openPage(this.page, { error });\r\n    }\r\n\r\n    private page = ({ error }: { error: any }) => {\r\n        return <Page header=\"App start error!\">\r\n            <pre>\r\n                {typeof error === 'string' ? error : error.message}\r\n            </pre>\r\n        </Page>;\r\n    }\r\n}","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport {\r\n\tUqMan, Uq as UqCore, Web\r\n} from \"tonwa-core\";\r\n\r\nexport class Uq {\r\n\tprivate web: Web;\r\n\tprivate $_uqMan: UqMan;\r\n\tprivate $_uqSql: UqCore;\r\n\tconstructor(web: Web, uqMan: UqMan) {\r\n\t\tthis.web = web;\r\n\t\tthis.$_uqMan = uqMan;\r\n\t\tthis.$_uqSql = this.$_createUqSqlProxy();\r\n\t}\r\n\r\n\t$_createProxy() {\r\n\t\tlet ret = new Proxy(this.$_uqMan.entities, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tif (key === '$') {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t\tif (key === 'SQL') {\r\n\t\t\t\t\treturn this.$_uqSql;\r\n\t\t\t\t}\r\n\t\t\t\tlet lk = (key as string).toLowerCase();\r\n\t\t\t\tlet ret = target[lk];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tlet func = (this.$_uqMan as any)[key];\r\n\t\t\t\tif (func !== undefined) return func;\r\n\t\t\t\tfunc = (this as any)[key];\r\n\t\t\t\tif (func !== undefined) return func;\r\n\t\t\t\tlet err = `entity ${this.$_uqMan.name}.${String(key)} not defined`;\r\n\t\t\t\tconsole.error('UQ错误：' + err);\r\n\t\t\t\tthis.showReload('服务器正在更新');\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate $_createUqSqlProxy(): UqCore {\r\n\t\tlet ret = new Proxy(this.$_uqMan, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tlet ret = (target as any)['$' + (key as string)];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tlet err = `entity ${this.$_uqMan.name}.${String(key)} not defined`;\r\n\t\t\t\tconsole.error('UQ错误：' + err);\r\n\t\t\t\tthis.$_uqMan.showReload('服务器正在更新');\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret as unknown as UqCore;\r\n\t}\r\n\r\n\tprivate showReload(msg: string) {\r\n\t\t//console.error('uq proxy error name', msg);\r\n\t\tlet cache = this.$_uqMan.localMap.child('$reload-tick');\r\n\t\tlet reloadTick = cache.get();\r\n\t\tif (!reloadTick) reloadTick = 0;\r\n\t\tconsole.error(msg);\r\n\t\tthis.$_uqMan.localMap.removeAll();\r\n\t\tlet tick = Date.now();\r\n\t\tcache.set(tick);\r\n\t\tif (tick - reloadTick < 10 * 1000) {\r\n\t\t\tthis.web.showReloadPage(msg);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.web.reload();\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\tIDTv(ids: number[]): Promise<any[]> {\r\n\t\treturn this.$_uqMan.IDTv(ids);\r\n\t}\r\n\t*/\r\n\r\n\tprotected IDRender = (id: number, render?: (value: any) => JSX.Element): JSX.Element => {\r\n\t\tif (id === undefined || id === null) return null;\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet ret = this.$_uqMan.idCache.getValue(id);\r\n\t\t\tif (ret === undefined) {\r\n\t\t\t\treturn React.createElement('span', { props: { className: 'text-muted' }, children: ['id=' + id] });\r\n\t\t\t}\r\n\t\t\tlet { $type } = ret as any;\r\n\t\t\tif (!$type) return this.renderIDUnknownType(id);\r\n\t\t\tlet IDType = this.$_uqMan.ids[$type];\r\n\t\t\tif (!IDType) return this.renderIDUnknownType(id);\r\n\t\t\treturn (render ?? (IDType as any).render)(ret);\r\n\t\t}));\r\n\t}\r\n\r\n\tprotected IDV = <T extends object>(id: number): T => {\r\n\t\tlet ret = this.$_uqMan.idCache.getValue(id);\r\n\t\treturn ret as T;\r\n\t}\r\n\r\n\tprivate renderIDUnknownType(id: number) {\r\n\t\treturn React.createElement('span', { props: { className: 'text-muted' }, children: [`id=${id} type undefined`] });\r\n\t}\r\n\t/*\r\n\tIDLocalTv(ids: number[]): Promise<any[]> {\r\n\t\treturn this.IDTv(ids.map(v => -v));\r\n\t}\r\n\t*/\r\n\tprotected IDLocalV = <T extends object>(id: number): T => {\r\n\t\treturn this.IDV(-id);\r\n\t}\r\n\r\n\tprotected IDLocalRender = (id: number, render?: (value: any) => JSX.Element): JSX.Element => {\r\n\t\tif (id === undefined || id === null) return null;\r\n\t\treturn this.IDRender(-id, render);\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport { UQsMan, TuidInner, uqStringify, TuidImport, Web } from \"tonwa-core\";\r\nimport { Render } from \"../ui\";\r\nimport { Uq } from \"./Uq\";\r\n\r\nexport function createUQsProxy(web: Web, uqsMan: UQsMan) {\r\n    buildTuidTv();\r\n    const uqReacts: { [key: string]: any } = {};\r\n    function setUq(uqKey: string, proxy: any): void {\r\n        if (!uqKey) return;\r\n        let lower = uqKey.toLowerCase();\r\n        uqReacts[uqKey] = proxy;\r\n        if (lower !== uqKey) uqReacts[lower] = proxy;\r\n    }\r\n    for (let uqMan of uqsMan.uqMans) {\r\n        let uqReact = new Uq(web, uqMan);\r\n        let proxy = uqReact.$_createProxy();\r\n        setUq(uqMan.getUqKey(), proxy);\r\n        setUq(uqMan.getUqKeyWithConfig(), proxy);\r\n    }\r\n    function onUqProxyError(key: string) {\r\n        for (let i in uqReacts) {\r\n            let uqReact = uqReacts[i];\r\n            uqReact.localMap.removeAll();\r\n        }\r\n        //this.web.showReloadPage(msg);\r\n        console.error(`uq proxy ${key} error`);\r\n    }\r\n    return new Proxy(uqReacts, {\r\n        get: (target, key, receiver) => {\r\n            let lk = (key as string).toLowerCase();\r\n            let ret = target[lk];\r\n            if (ret !== undefined) return ret;\r\n            debugger;\r\n            console.error(`controller.uqs.${String(key)} undefined`);\r\n            onUqProxyError(String(key));\r\n            return undefined;\r\n        },\r\n    });\r\n}\r\n\r\nfunction buildTuidTv() {\r\n    (TuidInner.prototype as any).tv = function (this: any, id: number, render?: Render<any>): JSX.Element {\r\n        const TuidView = observer(() => {\r\n            let obj = this.valueFromId(id);\r\n            if (obj === undefined) {\r\n                this.useId(id);\r\n                return <>{this.sName}:{id}</>;\r\n            }\r\n            let r: Render<any>;\r\n            if (render) {\r\n                r = render;\r\n            }\r\n            else if (this.render) {\r\n                r = this.render;\r\n            }\r\n            else {\r\n                console.log('render', render, 'this.render', this.render);\r\n                r = (item: any) => {\r\n                    return <>{this.sName}:{uqStringify(item)}</>;\r\n                };\r\n            }\r\n            return r(obj);\r\n        });\r\n        return <><TuidView /></>;\r\n    };\r\n\r\n    (TuidImport.prototype as any).tv = function (this: any, id: number, render?: Render<any>): JSX.Element {\r\n        return this.tuidLocal?.tv(id, render);\r\n    };\r\n}\r\n","import { /*centerApi, logoutApis, */AppConfig as AppConfigCore, Tonwa, Web } from \"tonwa-core\";\r\nimport { User, UqsConfig as UqsConfigCore } from 'tonwa-core';\r\nimport { RouteFunc, Hooks, Navigo, NamedRoute } from \"tonwa-core\";\r\nimport { UQsLoader, UQsMan } from \"tonwa-core\";\r\nimport { setGlobalRes } from 'tonwa-core';\r\nimport { ControllerWithWeb } from '../vm';\r\nimport { VErrorsPage, VStartError } from \"./vMain\";\r\nimport { createUQsProxy } from \"../uq\";\r\nimport { t } from \"../ui\";\r\n\r\nexport interface IConstructor<T> {\r\n\tnew(...args: any[]): T;\r\n}\r\n/*\r\nexport interface DevConfig {\r\n\tname: string;\r\n\talias?: string;\r\n\tmemo?: string;\r\n}\r\n\r\nexport interface UqConfig {\r\n\tdev: DevConfig;\r\n\tname: string;\r\n\talias?: string;\t\r\n\tversion?: string;\r\n\tmemo?: string;\r\n}\r\n\r\nexport interface UqsConfig {\r\n\tapp?: {\r\n\t\tdev: DevConfig;\r\n\t\tname: string;\r\n\t\tversion?: string;\r\n\t};\r\n\tuqs?: UqConfig[];\r\n}\r\n*/\r\n\r\nexport type UqsConfig = UqsConfigCore;\r\nexport interface AppConfig extends AppConfigCore /*UqsConfig*/ {\r\n\t/*\r\n\tapp?: {\r\n\t\tname: string;\r\n\t\tversion: string;\r\n\t\townerMap?: {[key:string]: string};\r\n\t};\r\n\t*/\r\n\t//appName: string;        // 格式: owner/appName\r\n\tversion: string;        // 版本变化，缓存的uqs才会重载\r\n\t//tvs?: TVs;\r\n\t//uqNameMap?: {[uqName:string]: string};      // uqName='owner/uq' 映射到内存简单名字：uq, 可以注明映射，也可以自动。有可能重\r\n\tloginTop?: JSX.Element;\r\n\toem?: string;               // 用户注册发送验证码的oem厂家，默认同花\r\n\tprivacy?: string;\r\n\tnoUnit?: boolean;\t\t\t// app的运行，不跟unit绑定\r\n\thtmlTitle?: string;\r\n}\r\n\r\nexport interface Elements {\r\n\t[id: string]: (element: HTMLElement) => void,\r\n}\r\n\r\nexport abstract class CAppBase<U> extends ControllerWithWeb {\r\n\tprivate appConfig: AppConfig;\r\n\tprivate uqsMan: UQsMan;\r\n\tprotected _uqs: U;\r\n\treadonly web: Web;\r\n\t//readonly nav: Nav;\r\n\ttimezone: number;\r\n\tunitTimezone: number;\r\n\r\n\tconstructor(tonwa: Tonwa, config?: AppConfig) {\r\n\t\tsuper(tonwa);\r\n\t\tthis.web = tonwa.web;\r\n\t\t//this.nav = new Nav(tonwa); // nav;\r\n\t\tthis.appConfig = config || (tonwa.navSettings as AppConfig);\r\n\t\tif (this.appConfig) {\r\n\t\t\tlet { app, uqs } = this.appConfig;\r\n\t\t\tif (app === undefined && uqs === undefined) {\r\n\t\t\t\tthrow new Error('app or uqs must be defined in AppConfig');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget uqs(): U { return this._uqs; }\r\n\r\n\tinternalT(str: string): any {\r\n\t\treturn t(str);\r\n\t}\r\n\r\n\tsetRes(res: any) {\r\n\t\tsetGlobalRes(res);\r\n\t}\r\n\tprotected afterBuiltUQs(uqs: any) { }\r\n\r\n\tprivate uqsUser: any = '';\r\n\tprotected async initUQs(): Promise<any> {\r\n\t\tif (!this.appConfig) return;\r\n\t\tlet { user } = this.tonwa;\r\n\t\tif (user === this.uqsUser) return;\r\n\t\tthis.uqsUser = user;\r\n\t\tthis.web.logoutApis();\r\n\t\tlet uqsLoader = new UQsLoader(this.tonwa, this.appConfig);\r\n\t\tlet retErrors = await uqsLoader.build();\r\n\t\tthis.uqsMan = uqsLoader.uqsMan;\r\n\t\tthis._uqs = createUQsProxy(this.web, uqsLoader.uqsMan) as any; //  this.uqsMan.proxy;\r\n\t\tthis.afterBuiltUQs(this._uqs);\r\n\t\treturn retErrors;\r\n\t}\r\n\r\n\tprotected async beforeStart(): Promise<boolean> {\r\n\t\ttry {\r\n\t\t\tthis.onNavRoutes();\r\n\t\t\tlet retErrors = await this.initUQs();\r\n\t\t\tif (retErrors !== undefined) {\r\n\t\t\t\tthis.openVPage(VErrorsPage, retErrors);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\tthis.openVPage(VStartError, err);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\tprotected async afterStart(): Promise<void> {\r\n\t\tthis.tonwa.resolveRoute();\r\n\t\tthis.tonwa.onChangeLogin = (user: User) => this.onChangeLogin(user);\r\n\t\tthis.onChangeLogin(this.user);\r\n\t}\r\n\r\n\tasync userFromId(userId: number): Promise<any> {\r\n\t\treturn await this.web.centerApi.userFromId(userId);\r\n\t}\r\n\r\n\tprotected on(routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\tprotected on(url: string, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\tprotected on(regex: RegExp, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\tprotected on(options: { [url: string]: RouteFunc | NamedRoute }): Navigo;\r\n\tprotected on(...args: any[]): Navigo {\r\n\t\treturn this.tonwa.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprotected onNavRoutes() { return; }\r\n\r\n\tasync getUqRoles(uqName: string): Promise<string[]> {\r\n\t\tlet { user } = this.tonwa;\r\n\t\tif (!user) return null;\r\n\t\tlet { roles: userRoles } = user;\r\n\t\tlet uq = uqName.toLowerCase();\r\n\t\tlet roles: string[];\r\n\t\tif (userRoles) {\r\n\t\t\troles = userRoles[uq];\r\n\t\t}\r\n\t\tif (roles) return roles;\r\n\r\n\t\troles = await this.uqsMan.getUqUserRoles(uq);\r\n\t\tif (!roles) roles = null;\r\n\t\tthis.tonwa.setUqRoles(uq, roles);\r\n\t\treturn roles;\r\n\t}\r\n\r\n\tisAdmin(roles: string[]): boolean {\r\n\t\treturn this.isRole(roles, '$');\r\n\t}\r\n\r\n\tisRole(roles: string[], role: string): boolean {\r\n\t\tif (!roles) return false;\r\n\t\trole = role.toLowerCase();\r\n\t\treturn roles.indexOf(role) >= 0;\r\n\t}\r\n\r\n\tprotected onChangeLogin(user: User): Promise<void> {\r\n\t\treturn;\r\n\t}\r\n}\r\n","import { Tonwa } from 'tonwa-core';\r\nimport { AppConfig, CAppBase } from './CAppBase';\r\n\r\nexport async function start(CApp: new (tonwa: Tonwa, config: AppConfig) => CAppBase<any>, tonwa: Tonwa, appConfig: AppConfig, isUserLogin?: boolean) {\r\n\tif (appConfig) {\r\n\t\tlet { htmlTitle } = appConfig;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) {\r\n\t\t\t\t//appConfig.version = version;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tlet cApp = new CApp(tonwa, appConfig);\r\n\tawait cApp.start(isUserLogin);\r\n}\r\n","import { Web } from 'tonwa-core';\r\nimport { ControllerWithWeb, WebNav } from \"../vm\";\r\nimport { CAppBase, IConstructor } from \"./CAppBase\";\r\n\r\nexport abstract class CBase<A extends CAppBase<U>, U> extends ControllerWithWeb {\r\n\tconstructor(cApp: A) {\r\n\t\tsuper(cApp.getTonwa());\r\n\t\tthis.cApp = cApp;\r\n\t\tif (cApp) {\r\n\t\t\tlet { uqs, web } = cApp;\r\n\t\t\tthis.uqs = uqs;\r\n\t\t\tthis.web = web;\r\n\t\t\t//this.nav = nav;\r\n\t\t}\r\n\t}\r\n\r\n\treadonly cApp: A;\r\n\treadonly uqs: U;\r\n\treadonly web: Web;\r\n\t//readonly nav: Nav;\r\n\t//get uqs(): U {return this._uqs}\r\n\t//get cApp(): A {return this._cApp}\r\n\tget timezone(): number { return this.cApp.timezone; }\r\n\tget unitTimezone(): number { return this.cApp.unitTimezone; }\r\n\tasync getUqRoles(uqName: string): Promise<string[]> {\r\n\t\treturn this.cApp?.getUqRoles(uqName);\r\n\t}\r\n\r\n\tprotected async internalStart(param?: any, ...params: any[]): Promise<void> { }\r\n\r\n\tinternalT(str: string): any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r !== undefined) return r;\r\n\t\treturn this.cApp.internalT(str);\r\n\t}\r\n\r\n\tprotected newC<T extends CBase<A, U>>(type: IConstructor<T>, ...param: any[]): T {\r\n\t\tlet c = new type(this.cApp);\r\n\t\tc.internalInit(...param);\r\n\t\treturn c;\r\n\t}\r\n\r\n\tnewSub<O extends CBase<A, U>, T extends CSub<A, U, O>>(type: IConstructor<T>, ...param: any[]): T {\r\n\t\tlet s = new type(this);\r\n\t\ts.internalInit(...param);\r\n\t\treturn s;\r\n\t}\r\n\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this.cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ret = Object.assign({}, wn);\r\n\t\tObject.assign(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nexport abstract class CSub<A extends CAppBase<U>, U, T extends CBase<A, U>> extends CBase<A, U> {\r\n\tprotected _owner: T;\r\n\r\n\tconstructor(owner: T) {\r\n\t\tsuper(owner.cApp);\r\n\t\tthis._owner = owner;\r\n\t}\r\n\r\n\tinternalT(str: string): any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r !== undefined) return r;\r\n\t\treturn this._owner.internalT(str);\r\n\t}\r\n\r\n\tprotected get owner(): T { return this._owner }\r\n\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this.cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ownerWNs: WebNav<any>[] = [];\r\n\t\tfor (let p = this.owner; p !== undefined; p = (p as any)?.owner) {\r\n\t\t\townerWNs.push(p.webNav);\r\n\t\t}\r\n\t\tlet ret = Object.assign({}, wn);\r\n\t\tfor (; ;) {\r\n\t\t\tlet own = ownerWNs.pop();\r\n\t\t\tif (own === undefined) break;\r\n\t\t\tObject.assign(ret, own);\r\n\t\t}\r\n\t\tObject.assign(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { FetchError, Web } from \"tonwa-core\";\r\nimport { TonwaReact } from \"../TonwaReact\";\r\n//import { nav } from '../nav';\r\n\r\nexport class WebReact extends Web {\r\n    private readonly tonwaReact: TonwaReact;\r\n    constructor(tonwaReact: TonwaReact) {\r\n        super();\r\n        this.tonwaReact = tonwaReact;\r\n    }\r\n    /*\r\n    async navInit(): Promise<void> {\r\n        await nav.init();\r\n    }\r\n    */\r\n    async onError(error: FetchError) {\r\n        this.tonwaReact.setFetchError(error);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n//import { nav } from '../nav';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { tonwa, User, Web } from 'tonwa-core';\r\n\r\nexport type UserLoader = (userId: number) => Promise<any>;\r\n\r\nexport class UserCache<T> {\r\n\tprivate readonly web: Web;\r\n\tprivate readonly loader: UserLoader;\r\n\tprivate onLoaded: (user: User) => void;\r\n\tprivate map = observable(new Map<number, T | number>());\r\n\r\n\tconstructor(web: Web, loader: UserLoader) {\r\n\t\tthis.web = web;\r\n\t\tif (loader === undefined) loader = (userId: number) => this.web.userApi.user(userId);\r\n\t\tthis.loader = loader;\r\n\t}\r\n\r\n\tuse(id: number | any, onLoaded?: (user: User) => void) {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tif (!id) return;\r\n\t\tthis.onLoaded = onLoaded;\r\n\t\tid = Number(id);\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (ret === undefined) {\r\n\t\t\tthis.map.set(id, id);\r\n\t\t}\r\n\t}\r\n\r\n\tgetValue(id: number | any): any {\r\n\t\tif (!id) return;\r\n\t\tswitch (typeof (id)) {\r\n\t\t\tcase 'object':\r\n\t\t\t\tid = id.id;\r\n\t\t\t\tif (!id) return;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (!ret) return;\r\n\t\tswitch (typeof (ret)) {\r\n\t\t\tdefault:\r\n\t\t\t\treturn ret;\r\n\t\t\tcase 'number':\r\n\t\t\t\tif (ret < 0) return id;\r\n\t\t\t\tthis.map.set(id, -id);\r\n\t\t\t\tthis.loader(id).then(v => {\r\n\t\t\t\t\tif (!v) v = null;\r\n\t\t\t\t\tthis.map.set(id, v);\r\n\t\t\t\t\tif (this.onLoaded) this.onLoaded(v);\r\n\t\t\t\t}).catch(reason => {\r\n\t\t\t\t\tconsole.error(reason);\r\n\t\t\t\t});\r\n\t\t\t\treturn id;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nlet staticUserCache: UserCache<any>;\r\nfunction getUserCache(web: Web) {\r\n\tif (staticUserCache === undefined) {\r\n\t\tstaticUserCache = new UserCache(web, undefined);\r\n\t}\r\n\treturn staticUserCache;\r\n}\r\n\r\nexport interface UserIconProps {\r\n\tweb: Web;\r\n\tid: number;\r\n\tclassName?: string;\r\n\tstyle?: React.CSSProperties;\r\n\taltImage?: string;\r\n\tnoneImage?: any;\r\n}\r\n\r\nexport const UserIcon = observer((props: UserIconProps): JSX.Element => {\r\n\tlet { className, style, id, altImage, noneImage } = props;\r\n\tlet userCache = getUserCache(props.web);\r\n\tlet user = userCache.getValue(id);\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\tcase 'number':\r\n\t\t\treturn <div className={classNames(className, 'image-none')} style={style}>\r\n\t\t\t\t{noneImage || <i className=\"fa fa-file-o\" />}\r\n\t\t\t</div>;\r\n\t}\r\n\tlet { icon } = user;\r\n\tif (!icon) {\r\n\t\treturn <div className={classNames(className, 'image-none')} style={style}>\r\n\t\t\t<i className=\"fa fa-file-o\" />\r\n\t\t</div>;\r\n\t}\r\n\tif (icon.startsWith(':') === true) {\r\n\t\ticon = tonwa.resUrl + icon.substr(1);\r\n\t}\r\n\treturn <img src={icon} className={className} alt=\"img\"\r\n\t\tstyle={style}\r\n\t\tonError={evt => {\r\n\t\t\tif (altImage) evt.currentTarget.src = altImage;\r\n\t\t\telse evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n\t\t}} />;\r\n});\r\n\r\nexport interface UserViewProps {\r\n\tweb: Web;\r\n\tid?: number;\r\n\tuser?: number | User;\r\n\trender: (user: User) => JSX.Element;\r\n\tonLoaded?: (user: User) => void\r\n}\r\n\r\nexport const UserView = observer((props: UserViewProps): JSX.Element => {\r\n\tlet { web, id: idProp, user, render, onLoaded } = props;\r\n\tif (user === null) return <>null</>;\r\n\tlet userCache = getUserCache(web);\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\t\tuser = userCache.getValue(idProp);\r\n\t\t\tbreak;\r\n\t\tcase 'object':\r\n\t\t\tlet {/*obj, */id } = user as any;\r\n\t\t\t//if (typeof obj !== 'object') {\r\n\t\t\tuseUser(web, id, onLoaded);\r\n\t\t\tuser = userCache.getValue(id);\r\n\t\t\t//}\r\n\t\t\tbreak;\r\n\t\tcase 'number':\r\n\t\t\tuseUser(web, user as number, onLoaded);\r\n\t\t\tuser = userCache.getValue(user as number);\r\n\t\t\tbreak;\r\n\t\tcase 'string':\r\n\t\t\tuseUser(web, Number(user), onLoaded);\r\n\t\t\tuser = userCache.getValue(Number(user));\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tuser = undefined;\r\n\t\t\tbreak;\r\n\t}\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\tcase 'number':\r\n\t\t\treturn <>{user}</>;\r\n\t}\r\n\treturn render(user);\r\n});\r\n\r\nexport function useUser(web: Web, id: number | object, onLoaded?: (user: User) => void) {\r\n\tif (!id) return;\r\n\tif (typeof (id) === 'object') {\r\n\t\tid = (id as any).id;\r\n\t}\r\n\tlet userCache = getUserCache(web);\r\n\tuserCache.use(id, onLoaded);\r\n}\r\n","import { UqBuildContext } from \"tonwa-core\";\r\n\r\nexport class UqBuildContextUI extends UqBuildContext {\r\n\tget uiPlatform(): string { return 'react' };\r\n\tget uiPlatformUpper(): string { return 'REACT' };\r\n\tget uiPlatformCamel(): string { return 'React' }\r\n\tget element(): string { return 'JSX.Element' }\r\n}\r\n","import React from 'react';\r\nimport { FA, Page } from './components';\r\nimport { Controller } from \"./vm/Controller\";\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport interface CStringEditProps {\r\n\tlabel?: string;\r\n\tplaceholder?: string;\r\n\tmaxLength?: number;\r\n\tonValueChange?: (value: string) => Promise<void>;\r\n}\r\n\r\nexport class CStringEdit extends Controller {\r\n\tprivate props: CStringEditProps = {\r\n\t\tlabel: '编辑'\r\n\t}\r\n\tvalue: string = null;\r\n\tnewValue: string = null;\r\n\tisChanged: boolean = null;\r\n\terror: string = null;\r\n\r\n\tconstructor() {\r\n\t\tsuper(tonwa);\r\n\t\tmakeObservable(this, {\r\n\t\t\tvalue: observable,\r\n\t\t\tnewValue: observable,\r\n\t\t\tisChanged: observable,\r\n\t\t\terror: observable,\r\n\t\t});\r\n\t}\r\n\r\n\tprotected async internalStart() { }\r\n\trender(value: string, props?: CStringEditProps) {\r\n\t\tthis.value = value;\r\n\t\tif (props) Object.assign(this.props, props);\r\n\t\treturn React.createElement(observer(() => <>{this.renderValue()}{this.renderPencil()}</>))\r\n\t}\r\n\r\n\tprotected renderValue() { return <>{this.value}</> }\r\n\tprotected renderPencil() {\r\n\t\treturn <span onClick={this.onEdit} className=\"cursor-pointer\">\r\n\t\t\t&nbsp; <FA className=\"text-info\" name=\"pencil-square-o\" /> &nbsp;\r\n\t\t</span>;\r\n\t}\r\n\r\n\tprivate onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.newValue = evt.target.value;\r\n\t\tlet preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\r\n\tprivate onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.verifyValue();\r\n\t}\r\n\r\n\tprotected verifyValue() { }\r\n\r\n\tprivate onFocus = () => {\r\n\t\tthis.error = undefined;\r\n\t}\r\n\r\n\tprivate onEdit = () => {\r\n\t\tlet { label, maxLength, placeholder, onValueChange } = this.props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tthis.value = this.newValue;\r\n\t\t\t\tthis.closePage();\r\n\t\t\t\tif (onValueChange) onValueChange(this.value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet right = React.createElement(observer(() => <button\r\n\t\t\tclassName=\"btn btn-sm btn-success align-self-center me-2\"\r\n\t\t\tdisabled={!this.isChanged}\r\n\t\t\tonClick={onSave}>保存</button>));\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n\t\tthis.openPage(<Page header={label} right={right}>\r\n\t\t\t<div className=\"m-3\">\r\n\t\t\t\t<input type=\"text\"\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n\t\t\t\t\tonBlur={this.onBlur}\r\n\t\t\t\t\tonFocus={this.onFocus}\r\n\t\t\t\t\tclassName=\"form-control\"\r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\tmaxLength={maxLength} />\r\n\t\t\t\t{\r\n\t\t\t\t\tReact.createElement(observer(() => placeholder && <div className=\"small muted m-2\">{placeholder}</div>))\r\n\t\t\t\t}\r\n\t\t\t\t{this.error && <div className=\"text-danger\">{this.error}</div>}\r\n\t\t\t</div>\r\n\t\t</Page>);\r\n\t}\r\n}\r\n","import {makeObservable, observable} from 'mobx';\r\n\r\nexport interface Id {\r\n    id: number;\r\n}\r\n\r\nexport abstract class CacheIds<T extends Id> {\r\n    constructor(maxCount:number = 100) {\r\n\t\tmakeObservable(this, {\r\n\t\t\tdict: observable,\r\n\t\t})\r\n        this.maxCount = maxCount;\r\n    }\r\n    private maxCount:number;\r\n    private arr:T[] = [];\r\n    dict = new Map<number, T>();\r\n\r\n    loadIds(ids:number[]) {\r\n        let arr:number[] = [];\r\n        for (let id of ids) {\r\n            if (id === null) continue;\r\n            let item = this.dict.get(id);\r\n            if (item === undefined) {\r\n                arr.push(id);\r\n                item = {id:id} as T;\r\n                this.dict.set(id, item);\r\n            }\r\n        }                \r\n        this.loadId(arr);\r\n    }\r\n\r\n    get(id:number):T {\r\n        if (id === undefined || id === null) return null;\r\n        let item = this.dict.get(id);\r\n        if (item === undefined) {\r\n            this.dict.set(id, {id:id} as T);\r\n            this.loadId([id]);\r\n            item = this.dict.get(id);\r\n        }\r\n        return item;\r\n    }\r\n    private setItem(id:number, item:T) {\r\n        if (item === undefined) {\r\n            this.dict.set(id, null);\r\n            this.arr.push({id: id} as T);\r\n        }\r\n        else {\r\n            this.dict.set(id, item);\r\n            this.arr.push(item);\r\n        }\r\n        if (this.arr.length > this.maxCount) {\r\n            item = this.arr.shift();\r\n            this.dict.delete(item.id);\r\n        }\r\n    }\r\n    private async loadId(ids:number[]) {\r\n        let items = await this._loadIds(ids);\r\n        if (items === undefined) {\r\n            for (let id of ids) {\r\n                if (id === null) continue;\r\n                let item = await this._loadId(id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n        else {\r\n            for (let id of ids) {\r\n                let item = items.find(v => v.id === id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected abstract _loadIds(ids:number[]):Promise<T[]>;\r\n    protected abstract _loadId(id:number):Promise<T>;\r\n}\r\n","import * as React from 'react';\r\nimport { tonwa } from 'tonwa-core';\r\n// import { nav } from '../nav';\r\nimport { Page } from './page/page';\r\n\r\ninterface Props {\r\n    message: string,\r\n    seconds: number\r\n}\r\n\r\ninterface State {\r\n    seconds: number\r\n}\r\n\r\nexport class ReloadPage extends React.Component<Props, State> {\r\n    private timerHandler: any;\r\n    constructor(props: Props) {\r\n        super(props);\r\n        let { seconds } = props;\r\n        if (seconds === undefined) return;\r\n        this.state = { seconds };\r\n        if (seconds <= 0) return;\r\n        this.timerHandler = setInterval(() => {\r\n            let { seconds } = this.state;\r\n            seconds--;\r\n            if (seconds <= 0) {\r\n                this.reload();\r\n            }\r\n            else {\r\n                this.setState({ seconds: seconds });\r\n            }\r\n        }, 1000);\r\n    }\r\n    private reload = () => {\r\n        clearInterval(this.timerHandler);\r\n        tonwa.reload();\r\n    }\r\n    render() {\r\n        let { seconds } = this.state;\r\n        let title: string, msg: string;\r\n        if (seconds > 0) {\r\n            title = '程序升级中...';\r\n            msg = this.state.seconds + '秒钟之后自动重启动';\r\n        }\r\n        else {\r\n            title = '程序需要升级';\r\n            msg = '请点击下面按钮重启';\r\n        }\r\n        return <Page header={false}>\r\n            <div className=\"text-center p-5\">\r\n                <div className=\"text-info py-5\">\r\n                    <span className=\"text-danger\">{title}</span>\r\n                    <br />\r\n                    {msg}\r\n                    <br />\r\n                    <span className=\"small text-muted\">{this.props.message}</span>\r\n                </div>\r\n                <button className=\"btn btn-danger\" onClick={this.reload}>立刻重启</button>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface ConfirmReloadPageProps {\r\n    confirm: (ok: boolean) => Promise<void>;\r\n}\r\nexport const ConfirmReloadPage = (props: ConfirmReloadPageProps): JSX.Element => {\r\n    return <Page header=\"升级软件\" back=\"close\">\r\n        <div className=\"py-5 px-3 my-5 mx-2 border bg-white rounded\">\r\n            <div className=\"text-center text-info\">\r\n                升级将清除所有本机缓冲区内容，并从服务器重新安装程序！\r\n            </div>\r\n            <div className=\"text-center mt-5\">\r\n                <button className=\"btn btn-danger me-3\" onClick={() => props.confirm(true)}>确认升级</button>\r\n            </div>\r\n        </div>\r\n    </Page>;\r\n    // <button className=\"btn btn-outline-danger\" onClick={()=>props.confirm(false)}>暂不</button>\r\n}\r\n","import { makeObservable, observable } from \"mobx\";\r\nimport { FetchError, Nav, Tonwa, Web } from \"tonwa-core\";\r\nimport { WebReact } from \"./app\";\r\n\r\nimport { Page } from './components';\r\n\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport './css/va-form.css';\r\nimport './css/va.css';\r\nimport './css/animation.css';\r\nimport { ReloadPage, ConfirmReloadPage } from './components/reloadPage';\r\nimport { createLogin, showForget, showRegister } from './components/login';\r\nimport { SystemNotifyPage } from './nav/FetchErrorView';\r\nimport { NavView } from './nav';\r\n\r\nexport class TonwaReact extends Tonwa {\r\n    navView: NavView;\r\n\r\n    constructor() {\r\n        super();\r\n        makeObservable(this, {\r\n            user: observable,\r\n        });\r\n        this.setCreateLogin(createLogin);\r\n    }\r\n\r\n    createWeb(): Web { return new WebReact(this); }\r\n\r\n    createObservableMap<K, V>(): Map<K, V> {\r\n        return observable.map({}, { deep: false });\r\n    }\r\n\r\n    set(navView: NavView) {\r\n        //this.logo = logo;\r\n        this.navView = navView;\r\n    }\r\n\r\n    get nav(): Nav<JSX.Element> { return this.navView };\r\n\r\n    setFetchError(fetchError: FetchError) {\r\n        this.navView.setFetchError(fetchError);\r\n    }\r\n\r\n    renderNavView(onLogined: (isUserLogin?: boolean) => Promise<void>,\r\n        notLogined?: () => Promise<void>,\r\n        userPassword?: () => Promise<{ user: string; password: string }>,\r\n    ) {\r\n        return <NavView ref={nv => this.navView = nv}\r\n            onLogined={onLogined}\r\n            notLogined={notLogined}\r\n            userPassword={userPassword} />;\r\n    }\r\n\r\n    /*\r\n    setIsWebNav() {\r\n        this.isWebNav = true;\r\n        this.navView.backIcon = <i className=\"fa fa-arrow-left\" />;\r\n        this.navView.closeIcon = <i className=\"fa fa-close\" />;\r\n    }\r\n    */\r\n\r\n    // pageWebNav: PageWebNav;\r\n\r\n    async showAppView(isUserLogin?: boolean): Promise<void> {\r\n        let { onLogined } = this.navView.props;\r\n        if (onLogined === undefined) {\r\n            this.navView.push(<div>NavView has no prop onLogined</div>);\r\n            return;\r\n        }\r\n        this.nav.clear();\r\n        await onLogined(isUserLogin);\r\n    }\r\n\r\n\r\n    privacyEntry() {\r\n        if (!this.getPrivacyContent()) return;\r\n        return <div className=\"text-center\">\r\n            <button className=\"btn btn-sm btn-link\"\r\n                onClick={this.showPrivacyPage}>\r\n                <small className=\"text-muted\">隐私政策</small>\r\n            </button>\r\n        </div>;\r\n    }\r\n\r\n    private getPrivacyContent(): string {\r\n        if (!this.navSettings) return;\r\n        let { privacy } = this.navSettings;\r\n        return privacy;\r\n    }\r\n\r\n    showPrivacyPage = () => {\r\n        let privacy = this.getPrivacyContent();\r\n        if (privacy) {\r\n            this.privacyPage(privacy);\r\n        }\r\n        else {\r\n            this.navView.push(<Page header=\"隐私政策\">\r\n                <div className=\"p-3\">AppConfig 中没有定义 privacy。可以定义为字符串，或者url。markdown格式</div>\r\n            </Page>);\r\n        }\r\n    }\r\n\r\n    private privacyPage = async (htmlString: string) => {\r\n        let content = { __html: htmlString };\r\n        this.navView.push(<Page header=\"隐私政策\">\r\n            <div className=\"p-3\" dangerouslySetInnerHTML={content} />\r\n        </Page>);\r\n    }\r\n\r\n    async showRegister() {\r\n        showRegister(this);\r\n    }\r\n\r\n    async showForget() {\r\n        showForget(this);\r\n    }\r\n\r\n    resetAll = () => {\r\n        this.navView.push(<ConfirmReloadPage confirm={(ok: boolean): Promise<void> => {\r\n            if (ok === true) {\r\n                this.showReloadPage('彻底升级');\r\n                localStorage.clear();\r\n            }\r\n            else {\r\n                this.navView.pop();\r\n            }\r\n            return;\r\n        }} />);\r\n    }\r\n\r\n    showReloadPage(msg: string) {\r\n        let seconds = -1;\r\n        this.navView.push(<ReloadPage message={msg} seconds={seconds} />);\r\n    }\r\n\r\n    async onError(fetchError: FetchError) {\r\n        let err = fetchError.error;\r\n        if (err !== undefined) {\r\n            if (err.unauthorized === true) {\r\n                await this.showLogin(undefined);\r\n                //nav.navigateToLogin();\r\n                return;\r\n            }\r\n            switch (err.type) {\r\n                case 'unauthorized':\r\n                    await this.showLogin(undefined);\r\n                    //nav.navigateToLogin();\r\n                    return;\r\n                case 'sheet-processing':\r\n                    this.navView.push(<SystemNotifyPage message=\"单据正在处理中。请重新操作！\" />);\r\n                    return;\r\n            }\r\n        }\r\n        this.navView.setState({\r\n            fetchError,\r\n        });\r\n    }\r\n\r\n    private upgradeUq = () => {\r\n        this.start();\r\n    }\r\n\r\n    async showUpgradeUq(uq: string, version: number): Promise<void> {\r\n        this.navView.show(<Page header={false}>\r\n            <div>\r\n                UQ升级了，请点击按钮升级 <br />\r\n                <small className=\"text-muted\">{uq} ver-{version}</small>\r\n                <button className=\"btn btn-primary\" onClick={this.upgradeUq}>升级</button>\r\n            </div>\r\n        </Page>)\r\n    }\r\n}\r\n","//=== UqApp builder created on Fri Dec 10 2021 14:54:39 GMT-0500 (北美东部标准时间) ===//\nimport { CSub, CBase, CAppBase, IConstructor } from 'tonwa-react';\nimport { UQs } from './uqs';\nimport { CApp } from './CApp';\n\nexport abstract class CUqBase extends CBase<CApp, UQs> {\n    protected async internalStart(param?:any, ...params:any[]):Promise<void> {}\n}\n\nexport abstract class CUqSub<A extends CAppBase<U>, U, T extends CBase<A,U>> extends CSub<A, U, T> {\n}\n\nexport abstract class CUqApp extends CAppBase<UQs> {\n    newC<T extends CUqBase>(type: IConstructor<T>, ...param:any[]): T {\n        let c = new type(this);\n        c.internalInit(...param);\n        return c;\n    }\n}\n","import { VPage } from \"tonwa\";\r\nimport { CUqTest } from \"uqTest\";\r\n\r\nexport class VCustomerEdit extends VPage<CUqTest> {\r\n\r\n    content() {\r\n        //let { JsTicket } = this.controller.uqs;\r\n        //let { Customer } = JsTicket;\r\n        //let {ui} = Customer;\r\n        /*\r\n        return <Form fieldLabelSize={2} formData={param}\r\n        schema={schema} \r\n        uiSchema={uiSchema}\r\n        onButtonClick={this.onSubmit}  />;\r\n        */\r\n        return <div>VCustomerEdit</div>;\r\n    }\r\n}","import { VPage } from \"tonwa\";\r\nimport { Customer } from \"uq-app/uqs/JsTicket\";\r\nimport { CUqTest } from \"uqTest\";\r\n\r\nexport class VUqTest extends VPage<CUqTest> {\r\n    header() {\r\n        return 'UQ数据操作';\r\n    }\r\n    content() {\r\n        let customer: Customer = {\r\n            no: '1013',\r\n            name: '王五',\r\n            vice: '这是一个好客户3',\r\n        };\r\n        return <div className=\"p-3\">\r\n            <div className=\"mb-3\">\r\n                <button className=\"btn btn-primary\"\r\n                    onClick={() => this.controller.newCustomer(customer)}>新建客户</button>\r\n            </div>\r\n            <div className=\"mb-3\">\r\n                <button className=\"btn btn-primary\"\r\n                    onClick={() => this.controller.listCustomer()}>客户列表</button>\r\n            </div>\r\n            <div className=\"mb-3\">\r\n                <button className=\"btn btn-primary\"\r\n                    onClick={() => this.controller.loadTvCustomer()}>客户Tv</button>\r\n            </div>\r\n            <div className=\"mb-3\">\r\n                <button className=\"btn btn-primary\"\r\n                    onClick={() => this.controller.changeCustomer()}>编辑客户</button>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import { CUqBase } from \"uq-app\";\r\nimport { Customer } from \"uq-app/uqs/JsTicket\";\r\nimport { VCustomerEdit } from \"./VCustomerEdit\";\r\nimport { VUqTest } from \"./VUqTest\";\r\n\r\nexport class CUqTest extends CUqBase {\r\n    protected async internalStart() {\r\n        this.openVPage(VUqTest);\r\n    }\r\n\r\n    newCustomer = async (customer: Customer) => {\r\n        customer = {\r\n            no: '333',\r\n            name: 'jk1',\r\n            vice: 'jk1 test'\r\n        }\r\n        // this.openVPage(VCustomerNew);\r\n        let { JsTicket } = this.uqs;\r\n        let ret = await JsTicket.Acts({\r\n            customer: [customer],\r\n        });\r\n        alert('已保存 ' + JSON.stringify(ret));\r\n    }\r\n\r\n    editCustomer = async (customer: Customer) => {\r\n        this.openVPage(VCustomerEdit);\r\n    }\r\n\r\n    listCustomer = async () => {\r\n        let { JsTicket } = this.uqs;\r\n        let ret = await JsTicket.ID({\r\n            IDX: JsTicket.Customer,\r\n            id: [1, 2, 3, 4],\r\n        });\r\n        alert('列表 ' + JSON.stringify(ret));\r\n    }\r\n\r\n    loadTvCustomer = async () => {\r\n        let { JsTicket } = this.uqs;\r\n        let ret = await JsTicket.IDTv([-1, -2, -3]);\r\n        alert('tv列表 ' + JSON.stringify(ret));\r\n    }\r\n\r\n    changeCustomer = async () => {\r\n        await this.uqs.JsTicket.ChangeVice.submit({ id: 4, vice: 'test change vice' });\r\n        alert('完成');\r\n    }\r\n}\r\n","import { FA, VPage } from \"tonwa\";\r\nimport { CCustomer } from \"./CCustomer\";\r\n\r\nexport class VCustomer extends VPage<CCustomer> {\r\n    header() { return '客户管理'; }\r\n    right() {\r\n        return <button className=\"btn btn-sm btn-success me-2\" onClick={this.controller.newCustomer}>\r\n            <FA name=\"plus\" />\r\n        </button>;\r\n    }\r\n    content() {\r\n        return <div className=\"p-3\">\r\n            <button className=\"btn btn-primary\" onClick={this.controller.list}>客户列表</button>\r\n        </div>;\r\n    }\r\n}\r\n","import { VPage } from \"tonwa\";\r\nimport { List, LMR } from \"tonwa\";\r\nimport { Customer } from \"uq-app/uqs/JsTicket\";\r\nimport { CCustomer } from \"./CCustomer\";\r\n\r\nexport class VCustomerList extends VPage<CCustomer> {\r\n    header() { return '客户列表' }\r\n\r\n    content() {\r\n        //let { JsTicket } = this.controller.uqs;\r\n        //let { Customer } = JsTicket;\r\n        return <div>\r\n            <List items={this.controller.customerList}\r\n                item={{ render: this.renderItem, onClick: (item: Customer) => this.controller.showCustomer(item) }} />\r\n        </div>;\r\n    }\r\n\r\n    private renderItem = (item: Customer, index: number) => {\r\n        let { no, name, vice } = item\r\n        return <div className=\"px-3 py-2 d-block\">\r\n            <LMR left={<b>{name}</b>} right={<small className=\"text-muted\">{no}</small>}></LMR>\r\n            <div className=\"small text-muted\">{vice}</div>\r\n        </div>\r\n    };\r\n}","import { UqID } from \"tonwa-core\";\r\nimport { ButtonSchema, FieldItem, IDXEntity, UiItem, UiSchema } from \"tonwa\";\r\n\r\nexport function createFormSchema(ID: UqID<any> & IDXEntity<any>, uiItems: { [name: string]: UiItem }): {\r\n    schema: (ButtonSchema | FieldItem)[];\r\n    uiSchema: UiSchema\r\n} {\r\n    let { ui } = ID;\r\n    let button: ButtonSchema = {\r\n        name: 'submit',\r\n        type: 'submit',\r\n    };\r\n    let schema = [...ui.fieldArr, button];\r\n    let uiSchema: UiSchema;\r\n    if (uiItems) {\r\n        let items: { [name: string]: UiItem } = {}\r\n        for (let i in uiItems) {\r\n            items[i] = {\r\n                ...ui.fields[i],\r\n                ...uiItems[i],\r\n            } as UiItem;\r\n        }\r\n        uiSchema = { items };\r\n    };\r\n    return {\r\n        schema,\r\n        uiSchema,\r\n    }\r\n}\r\n","import { createFormSchema } from \"ids/tool/createFormSchema\";\r\nimport { Context, Form, UiButton, UiTextItem, VPage } from \"tonwa\";\r\nimport { CCustomer } from \"./CCustomer\";\r\n\r\nexport class VCustomerNew extends VPage<CCustomer> {\r\n    header() { return '新建客户' }\r\n    content() {\r\n        let { JsTicket } = this.controller.uqs;\r\n        let { Customer } = JsTicket;\r\n        let { schema, uiSchema } = createFormSchema(Customer, {\r\n            no: {\r\n                widget: 'text',\r\n                label: '编号',\r\n                placeholder: '请输入唯一编号',\r\n                defaultValue: this.controller.newNo\r\n            } as UiTextItem,\r\n            name: {\r\n                widget: 'text',\r\n                label: '名称',\r\n            } as UiTextItem,\r\n            submit: {\r\n                name: 'submit',\r\n                widget: 'button',\r\n                label: '提交',\r\n                className: 'btn btn-success'\r\n            } as UiButton\r\n        });\r\n        return <div className=\"p-3\">\r\n            <Form fieldLabelSize={2} formData={undefined}\r\n                schema={schema}\r\n                uiSchema={uiSchema}\r\n                onButtonClick={(name: string, context: Context) => this.controller.onNewSubmit(context.data)} />\r\n        </div>;\r\n    }\r\n}\r\n","import { VPage } from \"tonwa\";\r\nimport { CCustomer } from \"./CCustomer\";\r\n\r\nexport class VCustomerView extends VPage<CCustomer> {\r\n    header() { return '编辑客户' }\r\n\r\n    content() {\r\n        //let { JsTicket } = this.controller.uqs;\r\n        //let { Customer } = JsTicket;\r\n        //let {ui} = Customer;\r\n        /*\r\n        return <Form fieldLabelSize={2} formData={param}\r\n        schema={schema} \r\n        uiSchema={uiSchema}\r\n        onButtonClick={this.onSubmit}  />;\r\n        */\r\n        return <div>VCustomerEdit</div>;\r\n    }\r\n}","import { CUqBase } from \"uq-app\";\r\nimport { Customer } from \"uq-app/uqs/JsTicket\";\r\nimport { VCustomer } from \"./VCustomer\";\r\nimport { VCustomerList } from \"./VCustomerList\";\r\nimport { VCustomerNew } from \"./VCustomerNew\";\r\nimport { VCustomerView } from \"./VCustomerView\";\r\n\r\nexport class CCustomer extends CUqBase {\r\n    newNo: string;\r\n    customerList: Customer[];\r\n\r\n    protected async internalStart() {\r\n        this.openVPage(VCustomer);\r\n    }\r\n\r\n    newCustomer = async () => {\r\n        let { JsTicket } = this.uqs;\r\n        this.newNo = await JsTicket.IDNO({ ID: JsTicket.Customer });\r\n        this.openVPage(VCustomerNew);\r\n    }\r\n\r\n    onNewSubmit = async (data: Customer) => {\r\n        let { JsTicket } = this.uqs;\r\n        let ret = await JsTicket.Acts(\r\n            {\r\n                customer: [data],\r\n\r\n            }\r\n        );\r\n        alert(JSON.stringify(ret));\r\n    }\r\n\r\n    list = async () => {\r\n        let { JsTicket } = this.uqs;\r\n        this.customerList = await JsTicket.QueryID<Customer>({\r\n            ID: JsTicket.Customer,\r\n            page: {\r\n                start: 0,\r\n                size: 100,\r\n            }\r\n        });\r\n        this.openVPage(VCustomerList);\r\n    }\r\n\r\n    showCustomer = async (item: Customer) => {\r\n        this.openVPage(VCustomerView);\r\n    }\r\n}\r\n","import { CUqBase } from \"uq-app\";\r\n\r\nexport class CProduct extends CUqBase {\r\n}\r\n","import { FA, VPage } from \"tonwa\";\r\nimport { CStaff } from \"./CStaff\";\r\n\r\nexport class VStaff extends VPage<CStaff> {\r\n    header() { return '职员管理'; }\r\n    right() {\r\n        return <button className=\"btn btn-sm btn-success me-2\" onClick={this.controller.newStaff}>\r\n            <FA name=\"plus\" />\r\n        </button>;\r\n    }\r\n    content() {\r\n        return <div className=\"p-3\">\r\n            <button className=\"btn btn-primary\" onClick={this.controller.list}>职员列表</button>\r\n        </div>;\r\n    }\r\n}\r\n","import { VPage } from \"tonwa\";\r\nimport { List, LMR } from \"tonwa\";\r\nimport { Staff } from \"uq-app/uqs/JsTicket\";\r\nimport { CStaff } from \"./CStaff\";\r\n\r\nexport class VStaffList extends VPage<CStaff> {\r\n    header() { return '职员列表' }\r\n\r\n    content() {\r\n        //let { JsTicket } = this.controller.uqs;\r\n        //let { Staff } = JsTicket;\r\n        return <div>\r\n            <List items={this.controller.data.staffList}\r\n                item={{ render: this.renderItem, onClick: (item: Staff) => this.controller.showStaff(item) }} />\r\n        </div>;\r\n    }\r\n\r\n    private renderItem = (item: Staff, index: number) => {\r\n        let { no, name } = item\r\n        return <div className=\"px-3 py-2 d-block\">\r\n            <LMR left={<b>{name}</b>} right={<small className=\"text-muted\">{no}</small>}></LMR>\r\n        </div>\r\n    };\r\n}","import { createFormSchema } from \"ids/tool/createFormSchema\";\r\nimport { Context, Form, UiButton, UiTextItem, VPage } from \"tonwa\";\r\nimport { CStaff } from \"./CStaff\";\r\n\r\nexport class VStaffNew extends VPage<CStaff> {\r\n    header() { return '新建职员' }\r\n    content() {\r\n        let { JsTicket } = this.controller.uqs;\r\n        let { Staff } = JsTicket;\r\n        let { schema, uiSchema } = createFormSchema(Staff, {\r\n            no: {\r\n                widget: 'text',\r\n                label: '编号',\r\n                placeholder: '请输入唯一编号',\r\n                defaultValue: this.controller.data.newNo\r\n            } as UiTextItem,\r\n            name: {\r\n                widget: 'text',\r\n                label: '名称',\r\n            } as UiTextItem,\r\n            submit: {\r\n                name: 'submit',\r\n                widget: 'button',\r\n                label: '提交',\r\n                className: 'btn btn-success'\r\n            } as UiButton\r\n        });\r\n        return <div className=\"p-3\">\r\n            <Form fieldLabelSize={2} formData={undefined}\r\n                schema={schema}\r\n                uiSchema={uiSchema}\r\n                onButtonClick={(name: string, context: Context) => this.controller.onNewSubmit(context.data)} />\r\n        </div>;\r\n    }\r\n}\r\n","import { List, LMR, VPage } from \"tonwa\";\r\nimport { Staff } from \"uq-app/uqs/JsTicket\";\r\nimport { CStaff } from \"./CStaff\";\r\n\r\nexport class VStaffSelect extends VPage<CStaff> {\r\n    header() { return '选择职员' }\r\n    content() {\r\n        return <div>\r\n            <List items={this.controller.data.staffList} item={{ render: this.renderStaff, onSelect: this.onSelect }} />\r\n        </div>\r\n    }\r\n\r\n    onSelect = (staff: Staff, isSelected: boolean) => {\r\n        this.controller.returnCall(staff);\r\n        this.closePage();\r\n    }\r\n\r\n    renderStaff = (staff: Staff, index: number) => {\r\n        let { no, name } = staff;\r\n        let left = <span className=\"w-12c\">{name}</span>;\r\n        let right = <small className=\"text-muted\">{no}</small>;\r\n        return <LMR className=\"ps-3 py-2\" left={left} right={right} />;\r\n    }\r\n}\r\n","import { VPage } from \"tonwa\";\r\nimport { CStaff } from \"./CStaff\";\r\n\r\nexport class VStaffView extends VPage<CStaff> {\r\n    header() { return '编辑职员' }\r\n\r\n    content() {\r\n        //let { JsTicket } = this.controller.uqs;\r\n        //let { Staff } = JsTicket;\r\n        //let {ui} = Staff;\r\n        /*\r\n        return <Form fieldLabelSize={2} formData={param}\r\n        schema={schema} \r\n        uiSchema={uiSchema}\r\n        onButtonClick={this.onSubmit}  />;\r\n        */\r\n        return <div>VStaffEdit</div>;\r\n    }\r\n}","import { CUqBase } from \"uq-app\";\r\nimport { Staff } from \"uq-app/uqs/JsTicket\";\r\nimport { VStaff } from \"./VStaff\";\r\nimport { VStaffList } from \"./VStaffList\";\r\nimport { VStaffNew } from \"./VStaffNew\";\r\nimport { VStaffSelect } from \"./VStaffSelect\";\r\nimport { VStaffView } from \"./VStaffView\";\r\n\r\nexport class CStaff extends CUqBase {\r\n    data: {\r\n        newNo: string;\r\n        staffList: Staff[];\r\n    };\r\n\r\n    init(...param: any[]): void {\r\n        this.data = this.shallow({\r\n            newNo: undefined,\r\n            staffList: undefined,\r\n        });\r\n    }\r\n\r\n    protected async internalStart() {\r\n        this.openVPage(VStaff);\r\n    }\r\n\r\n    newStaff = async () => {\r\n        let { JsTicket } = this.uqs;\r\n        let newNo = await JsTicket.IDNO({ ID: JsTicket.Staff });\r\n        this.runInAction(() => {\r\n            this.data.newNo = newNo;\r\n            this.openVPage(VStaffNew);\r\n        });\r\n    }\r\n\r\n    onNewSubmit = async (data: Staff) => {\r\n        let { JsTicket } = this.uqs;\r\n        let ret = await JsTicket.Acts(\r\n            {\r\n                staff: [data],\r\n            }\r\n        );\r\n        alert(JSON.stringify(ret));\r\n    }\r\n\r\n    private async loadList() {\r\n        let { JsTicket } = this.uqs;\r\n        let staffList = await JsTicket.QueryID<Staff>({\r\n            ID: JsTicket.Staff,\r\n            page: {\r\n                start: 0,\r\n                size: 100,\r\n            }\r\n        });\r\n        this.runInAction(() => {\r\n            this.data.staffList = staffList;\r\n        });\r\n    }\r\n\r\n    list = async () => {\r\n        await this.loadList();\r\n        this.openVPage(VStaffList);\r\n    }\r\n\r\n    showStaff = async (item: Staff) => {\r\n        this.openVPage(VStaffView);\r\n    }\r\n\r\n    async selectStaff() {\r\n        await this.loadList();\r\n        return await this.vCall(VStaffSelect);\r\n    }\r\n}\r\n","import { FA, List, VPage } from \"tonwa\";\r\nimport { TicketType } from \"uq-app/uqs/JsTicket\";\r\nimport { CTicketType } from \"./CTicketType\";\r\n\r\nexport class VTicketTypeList extends VPage<CTicketType> {\r\n    header(): string | boolean | JSX.Element {\r\n        return '工单类型';\r\n    }\r\n\r\n    right() {\r\n        return <button className=\"btn btn-sm btn-success me-2\" onClick={this.controller.saveTicketTypes}>\r\n            <FA name=\"plus\" />\r\n        </button>;\r\n    }\r\n\r\n    content() {\r\n        return <div className=\"py-2\">\r\n            <List items={this.controller.list} item={{ render: this.renderItem }} />\r\n        </div>;\r\n    }\r\n\r\n    renderItem = (item: TicketType, index: number) => {\r\n        return <div className=\"px-3 py-2\">{item.name}</div>;\r\n    }\r\n}","import { CUqBase } from \"uq-app\";\r\nimport { VTicketTypeList } from \"./VTicketTypeList\";\r\n\r\nexport class CTicketType extends CUqBase {\r\n    ticketTypes = [\r\n        {\r\n            name: '客户需求点',\r\n            arr: [\r\n                {\r\n                    name: '经办',\r\n                },\r\n                {\r\n                    name: '验收',\r\n                }\r\n            ]\r\n        }\r\n    ];\r\n\r\n    list: any[];\r\n\r\n    protected async internalStart(param?: any, ...params: any[]): Promise<void> {\r\n        let { JsTicket } = this.uqs;\r\n        this.list = await JsTicket.QueryID({\r\n            ID: JsTicket.TicketType,\r\n            page: {\r\n                start: 0,\r\n                size: 1000,\r\n            }\r\n        })\r\n        this.openVPage(VTicketTypeList);\r\n    }\r\n\r\n    saveTicketTypes = async () => {\r\n        let retIds: number[] = [];\r\n        for (let tt of this.ticketTypes) {\r\n            let ret = await this.uqs.JsTicket.SaveTicketType.submitReturns({\r\n                typeName: tt.name,\r\n                typeVice: undefined,\r\n                states: tt.arr.map(v => ({\r\n                    stateName: v.name,\r\n                    stateVice: undefined,\r\n                })),\r\n            });\r\n            retIds.push(ret.ret[0].id);\r\n        }\r\n        alert(JSON.stringify(retIds));\r\n    }\r\n}\r\n","import { FA, LMR, VPage } from \"tonwa\";\r\nimport { CHome } from \"./CHome\";\r\n//import logo from '../logo.svg';\r\nimport '../App.css';\r\nimport { CCustomer } from \"ids/customer\";\r\nimport { CProduct } from \"ids/product\";\r\nimport { CStaff } from \"ids/staff\";\r\nimport { CTicketType } from \"ids/ticket-type\";\r\n\r\ninterface Row {\r\n\tcaption: string;\r\n\tonClick: () => void;\r\n}\r\nexport class VHome extends VPage<CHome> {\r\n\tprivate rows: Row[] = [\r\n\t\t{\r\n\t\t\tcaption: '客户管理',\r\n\t\t\tonClick: () => this.controller.startController(CCustomer),\r\n\t\t},\r\n\t\t{\r\n\t\t\tcaption: '产品管理',\r\n\t\t\tonClick: () => this.controller.startController(CProduct),\r\n\t\t},\r\n\t\t{\r\n\t\t\tcaption: '职员管理',\r\n\t\t\tonClick: () => this.controller.startController(CStaff),\r\n\t\t},\r\n\t\t{\r\n\t\t\tcaption: '工单类型',\r\n\t\t\tonClick: () => this.controller.startController(CTicketType),\r\n\t\t},\r\n\t\tnull,\r\n\t\t{\r\n\t\t\tcaption: '新建工单',\r\n\t\t\tonClick: this.controller.cApp.cTicket.newTicket,\r\n\t\t}\r\n\t];\r\n\r\n\theader() { return '首页' }\r\n\tcontent() {\r\n\t\treturn <div className=\"App\">\r\n\t\t\t<div className=\"mt-2\">\r\n\t\t\t\t{this.rows.map((v, index) => {\r\n\t\t\t\t\tif (v === null) return <div key={index} className=\"my-3\" />;\r\n\t\t\t\t\tlet { caption, onClick } = v;\r\n\t\t\t\t\treturn <LMR key={index}\r\n\t\t\t\t\t\tclassName=\"cursor-pointer py-2 px-3 bg-white border-bottom justify-content-start\"\r\n\t\t\t\t\t\tleft={<div><FA className=\"me-3 text-primary\" name=\"hand-o-right\" fixWidth={true} />{caption}</div>}\r\n\t\t\t\t\t\tright={<FA name=\"angle-right\" />}\r\n\t\t\t\t\t\tonClick={onClick}>\r\n\t\t\t\t\t</LMR>;\r\n\t\t\t\t})}\r\n\t\t\t\t<div className=\"my-3\">\r\n\t\t\t\t\t{this.controller.cApp.cTicket.renderMyTickets()}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\n/*\r\n\t\t<header className=\"App-header\">\r\n\t\t\t<p>\r\n\t\t\t\t<span className=\"text-success\">tonwa</span> + <span className=\"text-primary\">uq</span> = UI + DB\r\n\t\t\t</p>\r\n\t\t\t<div className=\"mb-3 h6 text-warning\">\r\n\t\t\t\t编程\r\n\t\t\t\t<FA name=\"handshake-o\" size=\"lg\" className=\"text-danger mx-2\" />\r\n\t\t\t\t开心\r\n\t\t\t</div>\r\n\t\t</header>\r\n\t\t<div className=\"border px-3 py-3 bg-white d-flex align-items-start\">\r\n\t\t\t<button className=\"btn btn-primary me-3\"\r\n\t\t\t\tonClick={this.controller.showUqTest}>测试UQ操作</button>\r\n\t\t</div>\r\n\t\t<div className=\"border px-3 py-3 bg-white d-flex align-items-start\">\r\n\t\t\t<button className=\"btn btn-primary me-3\"\r\n\t\t\t\tonClick={this.controller.showTestPage1}>测试页1</button>\r\n\t\t\t<button className=\"btn btn-success me-3\"\r\n\t\t\t\tonClick={this.controller.showTestPage2}>测试页2</button>\r\n\t\t\t<button className=\"btn btn-danger me-3\"\r\n\t\t\t\tonClick={this.controller.showTestPage3}>测试页3</button>\r\n\t\t</div>\r\n\t\t<img src={logo} className=\"App-logo\" alt=\"logo\" />\r\n\t\t<ul className=\"text-left my-3 mr-3\">\r\n\t\t\t{this.items.map((v, index) => <li key={index} className=\"my-2\">{v}</li>)}\r\n\t\t</ul>\r\n*/\r\n","import { CHome } from \"home\";\r\nimport { VPage } from \"tonwa\";\r\n\r\nexport class VTestPage1 extends VPage<CHome> {\r\n    header() {\r\n        return '页面表头1'\r\n    }\r\n    content() {\r\n        return <div className=\"p-3\">\r\n            测试页面1\r\n        </div>;\r\n    }\r\n}","import { CHome } from \"home\";\r\nimport { VPage } from \"tonwa\";\r\n\r\nexport class VTestPage2 extends VPage<CHome> {\r\n    header() {\r\n        return '页面表头2'\r\n    }\r\n    content() {\r\n        let { inc, dec } = this.controller;\r\n        return <div className=\"p-3\">\r\n            测试页面2\r\n            <div>这里显示页面3里面调整了的count计数：{this.controller.data.count}</div>\r\n            <div className=\"d-flex p-2\">\r\n                <button className=\"btn btn-primary cursor-pointer me-3\"\r\n                    onClick={inc/*this.inc*/}>+</button>\r\n                <button className=\"btn btn-success cursor-pointer me-3\"\r\n                    onClick={dec /*() => this.dec()*/}>-</button>\r\n            </div>\r\n            {this.react(() => <div>计数：{this.controller.data.count}</div>)}\r\n            <div>\r\n                <button onClick={this.controller.showTestPage3}>显示页面3</button>\r\n            </div>\r\n        </div>;\r\n    }\r\n}","import { CHome } from \"home\";\r\nimport { FA, VPage } from \"tonwa\";\r\n\r\nexport class VTestPage3 extends VPage<CHome> {\r\n    header() {\r\n        return '页面表头3'\r\n    }\r\n    content() {\r\n        let { inc, dec } = this.controller;\r\n        return <div className=\"p-3\">\r\n            测试页面3\r\n            <div className=\"d-flex p-2\">\r\n                <button className=\"btn btn-primary cursor-pointer me-3\"\r\n                    onClick={inc/*this.inc*/}>\r\n                    <FA name=\"plus\" />\r\n                </button>\r\n                <button className=\"btn btn-success cursor-pointer me-3\"\r\n                    onClick={dec /*() => this.dec()*/}>\r\n                    <FA name=\"minus\" />\r\n                </button>\r\n            </div>\r\n            {this.react(() => <div>计数：{this.controller.data.count}</div>)}\r\n        </div>;\r\n    }\r\n\r\n    inc = () => {\r\n        ++this.controller.data.count;\r\n    }\r\n\r\n    dec() {\r\n        --this.controller.data.count;\r\n    }\r\n}","import { CApp, CUqBase } from \"uq-app\";\r\nimport { CUqTest } from \"uqTest\";\r\nimport { VHome } from \"./VHome\";\r\nimport { VTestPage1 } from \"./VTestPage1\";\r\nimport { VTestPage2 } from \"./VTestPage2\";\r\nimport { VTestPage3 } from \"./VTestPage3\";\r\n\r\ninterface Data {\r\n\tcount: number;\r\n}\r\n\r\nexport class CHome extends CUqBase {\r\n\tdata: Data;\r\n\r\n\tconstructor(cApp: CApp) {\r\n\t\tsuper(cApp);\r\n\t\tthis.data = this.shallow({\r\n\t\t\tcount: 0\r\n\t\t});\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\ttab = () => this.renderView(VHome);\r\n\r\n\tload = async () => {\r\n\t\tawait this.cApp.cTicket.loadMyTicket();\r\n\t}\r\n\r\n\tstartController = (controller: new (cApp: CApp) => CUqBase) => {\r\n\t\tlet c = this.newC(controller);\r\n\t\tc.start();\r\n\t}\r\n\r\n\tshowUqTest = async () => {\r\n\t\tlet cUqTest = this.newC(CUqTest);\r\n\t\tawait cUqTest.start();\r\n\t}\r\n\r\n\tshowTestPage1 = () => {\r\n\t\tthis.openVPage(VTestPage1);\r\n\t}\r\n\r\n\tshowTestPage2 = () => {\r\n\t\tthis.openVPage(VTestPage2);\r\n\t}\r\n\r\n\tshowTestPage3 = () => {\r\n\t\tthis.openVPage(VTestPage3);\r\n\t}\r\n\r\n\tinc = () => {\r\n\t\t++this.data.count;\r\n\t}\r\n\r\n\tdec = () => {\r\n\t\t--this.data.count;\r\n\t}\r\n}\r\n\r\n","//=== UqApp builder created on Tue Jan 12 2021 23:14:51 GMT-0500 (GMT-05:00) ===//\r\nimport { AppConfig } from \"tonwa\";\r\nimport { DevConfig } from 'tonwa-core';\r\n\r\nconst js: DevConfig = {\r\n\tname: 'jksoft',\r\n\talias: 'js',\r\n}\r\n\r\nexport const appConfig: AppConfig = {\r\n\tversion: '0.1.0',\r\n\tapp: undefined,\r\n\tuqs: [\r\n\t\t{\r\n\t\t\tdev: js,\r\n\t\t\tname: 'ticket',\r\n\t\t\talias: 'Ticket',\r\n\t\t\tversion: '0.1.0',\r\n\t\t},\r\n\t],\r\n\tnoUnit: true,\r\n\toem: undefined,\r\n\thtmlTitle: '工单',\r\n};\r\n","import { VPage } from \"tonwa\";\r\nimport { appConfig } from \"../uq-app/appConfig\";\r\nimport { CMe } from \"./CMe\";\r\n\r\nexport class VAbout extends VPage<CMe> {\r\n\theader() { return '关于APP'; }\r\n\tcontent() {\r\n\t\treturn <div className=\"py-5 px-3 my-3 w-max-30c mx-auto bg-white\">\r\n\t\t\t<div className=\"text-center mb-5 position-relative\">\r\n\t\t\t\t<small className=\"text-muted position-absolute\"\r\n\t\t\t\t\tstyle={{ right: '0', top: '-2.8rem' }}>\r\n\t\t\t\t\t版本: {appConfig.version}\r\n\t\t\t\t</small>\r\n\t\t\t\t<b className=\"text-danger h5 mb-0\">About</b>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { observer } from 'mobx-react';\r\nimport { Image, VPage, IconText, PropGrid, LMR, FA, Prop } from \"tonwa\";\r\nimport { CMe } from './CMe';\r\nimport { appConfig } from '../uq-app/appConfig';\r\nimport { VAbout } from './VAbout';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport class VMe extends VPage<CMe> {\r\n    header() { return this.t('me') }\r\n\r\n    content() {\r\n        const { user } = tonwa;\r\n        let aboutRows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <LMR className=\"w-100\" onClick={this.about}\r\n                    right={<FA className=\"align-self-center\" name=\"angle-right\" />}>\r\n                    <IconText iconClass=\"text-info mr-2\"\r\n                        icon=\"smile-o\"\r\n                        text={<>{this.t('aboutTheApp')} <small>版本 {appConfig.version}</small></>} />\r\n                </LMR>,\r\n            },\r\n        ];\r\n\r\n        let rows: Prop[];\r\n        if (user === undefined) {\r\n            rows = aboutRows;\r\n            rows.push(\r\n                {\r\n                    type: 'component',\r\n                    component: <button className=\"btn btn-success w-100 my-2\" onClick={() => tonwa.logout()}>\r\n                        <FA name=\"sign-out\" size=\"lg\" /> {this.t('pleaseLogin')}\r\n                    </button>\r\n                },\r\n            );\r\n        }\r\n        else {\r\n            let logOutRows: Prop[] = [\r\n            ];\r\n\r\n            rows = [\r\n                '',\r\n                {\r\n                    type: 'component',\r\n                    component: <this.meInfo />\r\n                },\r\n            ]\r\n            rows.push(...aboutRows, ...logOutRows);\r\n        }\r\n        return <PropGrid rows={[...rows]} values={{}} />;\r\n    }\r\n\r\n    private meInfo = observer(() => {\r\n        let { user } = tonwa;\r\n        if (user === undefined) return null;\r\n        let { id, name, nick, icon } = user;\r\n        return <LMR className=\"py-2 cursor-pointer w-100\"\r\n            left={<Image className=\"w-3c h-3c mr-3\" src={icon || '.user-o'} />}\r\n            right={<FA className=\"align-self-end\" name=\"angle-right\" />}\r\n            onClick={this.controller.showEditMe}>\r\n            <div>\r\n                <div>{userSpan(name, nick)}</div>\r\n                <div className=\"small\"><span className=\"text-muted\">ID:</span> {id > 10000 ? id : String(id + 10000).substr(1)}</div>\r\n            </div>\r\n        </LMR>;\r\n    });\r\n\r\n    private about = () => {\r\n        this.openVPage(VAbout);\r\n    }\r\n}\r\n\r\nfunction userSpan(name: string, nick: string): JSX.Element {\r\n    return nick ?\r\n        <><b>{nick} &nbsp; <small className=\"muted\">{name}</small></b></>\r\n        : <b>{name}</b>\r\n}\r\n","import { makeObservable, observable } from 'mobx';\r\nimport {\r\n    ItemSchema, StringSchema, ImageSchema, UiTextItem, UiImageItem, Page,\r\n    Edit, UiSchema, VPage, Prop, FA, IconText, PropGrid\r\n} from \"tonwa\";\r\nimport { tonwa } from 'tonwa-core';\r\nimport { CMe } from './CMe';\r\n\r\nexport class VEditMe extends VPage<CMe>{\r\n\r\n    async open(param: any) {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private schema: ItemSchema[] = [\r\n        { name: 'nick', type: 'string' } as StringSchema,\r\n        { name: 'icon', type: 'image' } as ImageSchema,\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            nick: { widget: 'text', label: '别名', placeholder: '好的别名更方便记忆' } as UiTextItem,\r\n            icon: { widget: 'image', label: '头像' } as UiImageItem,\r\n        }\r\n    }\r\n    data: any = undefined;\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            data: observable\r\n        })\r\n        let { nick, icon } = tonwa.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        };\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        let { name } = itemSchema;\r\n        await this.controller.web.userApi.userSetProp(name, newValue);\r\n        this.data[name] = newValue;\r\n        tonwa.user.name = newValue;\r\n        tonwa.saveLocalUser();\r\n    }\r\n\r\n    private onExit = () => {\r\n        tonwa.showLogout();\r\n    }\r\n\r\n    private changePassword = async () => {\r\n        await tonwa.changePassword();\r\n    }\r\n\r\n    private userQuit = async () => {\r\n        await tonwa.userQuit();\r\n    }\r\n\r\n    private page = () => {\r\n        let { schema, uiSchema, data, onItemChanged } = this;\r\n        let gridRows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <IconText iconClass=\"text-info mr-2\" icon=\"key\" text={this.t('changePassword')} />,\r\n                onClick: this.changePassword\r\n            },\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <IconText iconClass=\"text-info mr-2\" icon=\"key\" text={this.t('quitUser')} />,\r\n                onClick: this.userQuit\r\n            },\r\n            '',\r\n            '',\r\n            {\r\n                type: 'component',\r\n                bk: '',\r\n                component: <div className=\"w-100 text-center\">\r\n                    <button className=\"btn btn-danger w-100 w-max-20c\" onClick={this.onExit}>\r\n                        <FA name=\"sign-out\" size=\"lg\" /> {this.t('logout')}\r\n                    </button>\r\n                </div>\r\n            },\r\n        ];\r\n\r\n\r\n        /*\r\n        let vAdmin: any;\r\n    \t\r\n        let { role } = this.controller;\r\n        if ((role & 2) === 2) {\r\n            vAdmin = <div className=\"px-3 py-2 cursor-pointer bg-white border-bottom\" onClick={this.controller.showAdmin}>管理员</div>;\r\n        }\r\n        {vAdmin}\r\n        */\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={schema} uiSchema={uiSchema}\r\n                data={data}\r\n                onItemChanged={onItemChanged} />\r\n            <PropGrid rows={gridRows} values={{}} />\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport const webUserSchema: ItemSchema[] = [\r\n    { name: 'firstName', type: 'string', required: true } as StringSchema,\r\n    { name: 'gender', type: 'string' } as StringSchema,\r\n    { name: 'salutation', type: 'string' } as StringSchema,\r\n    { name: 'organizationName', type: 'string', required: true } as StringSchema,\r\n    { name: 'departmentName', type: 'string' } as StringSchema,\r\n];\r\n\r\n","import { makeObservable, observable } from \"mobx\";\r\nimport { User } from \"tonwa-core\";\r\nimport { QueryPager } from \"tonwa\";\r\nimport { CUqBase } from \"uq-app\";\r\nimport { VMe } from \"./VMe\";\r\nimport { VEditMe } from \"./VEditMe\";\r\n\r\nexport interface RootUnitItem {\r\n\tid: number;\t\t\t\t\t// root unit id\r\n\towner: any;\r\n\tname: string;\t\t\t\t// 唯一\r\n\tcontent: string;\r\n\ttonwaUnit: number;\t\t\t// 跟tonwa机构对应的值\r\n\tx: number;\r\n}\r\n\r\nexport class CMe extends CUqBase {\r\n\trole: number;\r\n\tunitOwner: User;\r\n\trootUnits: QueryPager<any>;\r\n\troles: string[] = null;\r\n\t//uq: Uq;\r\n\r\n\tconstructor(res: any) {\r\n\t\tsuper(res);\r\n\t\tmakeObservable(this, {\r\n\t\t\troles: observable,\r\n\t\t});\r\n\t\t//this.uq = this.uqs.BzTimesChange;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\ttab = () => {\r\n\t\treturn this.renderView(VMe);\r\n\t}\r\n\r\n\tshowEditMe = async () => {\r\n\t\t//let result = await this.uqs.Notes.GetSystemRole.query({});\r\n\t\t//this.role = result.ret[0]?.role;\r\n\t\tthis.openVPage(VEditMe);\r\n\t}\r\n\r\n\tload = async () => {\r\n\t\t//this.roles = await this.getUqRoles(this.uq.name);\r\n\t}\r\n\r\n\tbackend = async () => {\r\n\t\t//let cRoles = new CRoles(this.uq, this.res);\r\n\t\t//await cRoles.start();\r\n\t}\r\n\r\n\tprivate myRolesChanged = (roles: string[]) => {\r\n\t\t//this.roles = roles;\r\n\t\t//this.user.roles[this.uq.name] = roles;\r\n\t\t//nav.saveLocalUser();\r\n\t}\r\n}\r\n","import { zh } from \"./zh\";\r\nimport { en } from \"./en\";\r\n\r\nexport const res = {\r\n\t$zh: zh,\r\n\t$en: en,\r\n}\r\n","export const zh = {\r\n\thome: '首页',\r\n\trelation: '关系',\r\n\tdiscover: '发现',\r\n\tsupervise: '团队',\r\n\ttest: '测试',\r\n\tdebug: 'Debug',\r\n\tme: '我',\r\n\r\n\tchangePassword: '修改密码',\r\n\taboutTheApp: '关于本APP',\r\n\tlogout: '退出登录',\r\n\tpleaseLogin: '登录',\r\n\tuserQuit: '注销用户',\r\n\r\n\tcontent: '内容',\r\n\tbackend: '后台管理',\r\n\r\n\tlist: '列表',\r\n}\r\n","export const en = {\r\n\thome: 'Home',\r\n\trelation: 'Relation',\r\n\tdiscover: 'Discover',\r\n\tsupervise: 'Supervise',\r\n\ttest: 'Test',\r\n\tdebug: 'Debug',\r\n\tme: 'Me',\r\n\r\n\tchangePassword: 'Change password',\r\n\taboutTheApp: 'About the APP',\r\n\tlogout: 'Logout',\r\n\tpleaseLogin: 'Login',\r\n\tuserQuit: 'User quit',\r\n\r\n\tcontent: 'Content',\r\n\tbackend: 'Backend Management',\r\n\r\n\tlist: 'List',\r\n}\r\n","//=== UqApp builder created on Tue Jan 05 2021 18:41:24 GMT-0500 (GMT-05:00) ===//\r\nimport { PageWebNav } from 'tonwa-core';\r\nimport { VPage, TabProp, TabCaptionComponent, TabsProps, t } from \"tonwa\";\r\nimport { CApp } from './CApp';\r\n\r\nconst color = (selected: boolean) => selected === true ? 'text-primary' : 'text-muted';\r\nfunction caption(label: string | JSX.Element, icon: string) {\r\n\treturn (selected: boolean) => TabCaptionComponent(label, icon, color(selected));\r\n}\r\n\r\nexport class VMain extends VPage<CApp> {\r\n\tprotected get tabsProps(): TabsProps {\r\n\t\tlet { cHome, cMe } = this.controller;\r\n\t\tlet tabs: TabProp[] = [\r\n\t\t\t{ name: 'home', caption: caption(t('home'), 'home'), content: cHome.tab },\r\n\t\t]\r\n\t\ttabs.push(\r\n\t\t\t{ name: 'me', caption: caption(t('me'), 'user-o'), content: cMe.tab, load: cMe.load },\r\n\t\t);\r\n\t\treturn { tabs };\r\n\t}\r\n\r\n\tprotected get webNav(): PageWebNav<JSX.Element> {\r\n\t\treturn {\r\n\t\t\tnavHeader: <div>webNav header</div>,\r\n\t\t\tnavFooter: <div>webNav footer</div>,\r\n\t\t};\r\n\t}\r\n}\r\n","//=== UqApp builder created on Fri Dec 10 2021 14:54:39 GMT-0500 (北美东部标准时间) ===//\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { IDXValue, Uq, UqTuid, UqAction, UqQuery, UqID } from \"tonwa-core\";\nimport { Render, IDXEntity } from \"tonwa-react\";\n\n\n//===============================\n//======= UQ jksoft/ticket ========\n//===============================\n\nexport enum SourceType {\n\tcustomer = 1,\n\tticket = 2\n}\n\nexport enum TicketBox {\n\ttodo = 1,\n\ttoAssess = 2\n}\n\nexport interface Tuid$sheet {\n\tid?: number;\n\tno: string;\n\tuser: number;\n\tdate: any;\n\tsheet: number;\n\tversion: number;\n\tflow: number;\n\tapp: number;\n\tstate: number;\n\tdiscription: string;\n\tdata: string;\n\tprocessing: number;\n}\n\nexport interface Tuid$user {\n\tid?: number;\n\tname: string;\n\tnick: string;\n\ticon: string;\n\tassigned: string;\n\tpoke: number;\n\ttimezone: number;\n}\n\nexport interface Param$setMyTimezone {\n\t_timezone: number;\n}\nexport interface Result$setMyTimezone {\n}\n\nexport interface ParamSaveTicket {\n\tto: number;\n\tdiscription: string;\n}\nexport interface ResultSaveTicket {\n}\n\nexport interface ParamSaveTicketType {\n\ttypeName: string;\n\ttypeVice: string;\n\tstates: {\n\t\tstateName: string;\n\t\tstateVice: string;\n\t}[];\n\n}\nexport interface ReturnSaveTicketTypeRet {\n\tid: number;\n}\nexport interface ResultSaveTicketType {\n\tret: ReturnSaveTicketTypeRet[];\n}\n\nexport interface ParamChangeVice {\n\tid: number;\n\tvice: string;\n}\nexport interface ResultChangeVice {\n}\n\nexport interface Param$poked {\n}\nexport interface Return$pokedRet {\n\tpoke: number;\n}\nexport interface Result$poked {\n\tret: Return$pokedRet[];\n}\n\nexport interface Param$getMyTimezone {\n}\nexport interface Return$getMyTimezoneRet {\n\ttimezone: number;\n\tunitTimeZone: number;\n}\nexport interface Result$getMyTimezone {\n\tret: Return$getMyTimezoneRet[];\n}\n\nexport interface ParamMyTickets {\n}\nexport interface ReturnMyTicketsRet {\n\tticket: number;\n\tdiscription: string;\n\tnode: number;\n\tprev: number;\n\tstate: number;\n\toperator: number;\n\tfrom: number;\n}\nexport interface ResultMyTickets {\n\tret: ReturnMyTicketsRet[];\n}\n\nexport interface ParamQueryTest1 {\n\tid: number;\n}\nexport interface ReturnQueryTest1Ret {\n\tid: number;\n\tno: string;\n\tname: string;\n\tvice: string;\n}\nexport interface ResultQueryTest1 {\n\tret: ReturnQueryTest1Ret[];\n}\n\nexport interface ParamQueryTest {\n\tid: number;\n}\nexport interface ReturnQueryTestRet {\n\tid: number;\n\tno: string;\n\tname: string;\n\tvice: string;\n}\nexport interface ResultQueryTest {\n\tret: ReturnQueryTestRet[];\n}\n\nexport interface Customer {\n\tid?: number;\n\tno?: string;\n\tname: string;\n\tvice: string;\n}\n\nexport interface ProductPackage {\n\tid?: number;\n\tname: string;\n\tvice: string;\n}\n\nexport interface Market {\n\tid?: number;\n\tno?: string;\n\tname: string;\n\tvice: string;\n\ticon: string;\n}\n\nexport interface PackageVersion {\n\tid?: number;\n\tpackage: number;\n\tversion: string;\n}\n\nexport interface Project {\n\tid?: number;\n\tno?: string;\n\tname: string;\n\tvice: string;\n}\n\nexport interface Ticket {\n\tid?: number;\n\tdiscription: string;\n\tcreator: number;\n}\n\nexport interface TicketType {\n\tid?: number;\n\tname: string;\n\tvice: string;\n\tfirstState: number;\n}\n\nexport interface Source {\n\tid?: number;\n\tname: string;\n\tvice: string;\n\ttype: any;\n}\n\nexport interface PackageCustomer {\n\tid?: number;\n\tpackageVersion: number;\n\tcustomer: number;\n}\n\nexport interface TicketSheet {\n\tid?: number;\n\tcreator: number;\n}\n\nexport interface SourceCustomer {\n\tid?: number;\n\tmain?: number;\n}\n\nexport interface TicketNode {\n\tid?: number;\n\tticket: number;\n\tprev: number;\n\tstate: number;\n\toperator: number;\n}\n\nexport interface Staff {\n\tid?: number;\n\tno?: string;\n\tname: string;\n}\n\nexport interface SourceCustomerSheet {\n\tid?: number;\n\tno?: string;\n\tcustomer: number;\n}\n\nexport interface TicketState {\n\tid?: number;\n\tmain?: number;\n\tname: string;\n\tvice: string;\n}\n\nexport interface TicketAssess {\n\tid?: number;\n\tname: string;\n\tvice: string;\n\tmin: number;\n\tmax: number;\n}\n\nexport interface ParamActs {\n\tcustomer?: Customer[];\n\tproductPackage?: ProductPackage[];\n\tmarket?: Market[];\n\tpackageVersion?: PackageVersion[];\n\tproject?: Project[];\n\tticket?: Ticket[];\n\tticketType?: TicketType[];\n\tsource?: Source[];\n\tpackageCustomer?: PackageCustomer[];\n\tticketSheet?: TicketSheet[];\n\tsourceCustomer?: SourceCustomer[];\n\tticketNode?: TicketNode[];\n\tstaff?: Staff[];\n\tsourceCustomerSheet?: SourceCustomerSheet[];\n\tticketState?: TicketState[];\n\tticketAssess?: TicketAssess[];\n}\n\n\nexport interface UqExt extends Uq {\n\tActs(param:ParamActs): Promise<any>;\n\tSQL: Uq;\n\tIDRender(id:number):JSX.Element;\n\tIDLocalRender(id:number):JSX.Element;\n\n\t$sheet: UqTuid<Tuid$sheet>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\t$user: UqTuid<Tuid$user>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\t$setMyTimezone: UqAction<Param$setMyTimezone, Result$setMyTimezone>;\n\tSaveTicket: UqAction<ParamSaveTicket, ResultSaveTicket>;\n\tSaveTicketType: UqAction<ParamSaveTicketType, ResultSaveTicketType>;\n\tChangeVice: UqAction<ParamChangeVice, ResultChangeVice>;\n\t$poked: UqQuery<Param$poked, Result$poked>;\n\t$getMyTimezone: UqQuery<Param$getMyTimezone, Result$getMyTimezone>;\n\tMyTickets: UqQuery<ParamMyTickets, ResultMyTickets>;\n\tQueryTest1: UqQuery<ParamQueryTest1, ResultQueryTest1>;\n\tQueryTest: UqQuery<ParamQueryTest, ResultQueryTest>;\n\tCustomer: UqID<any> & IDXEntity<any>;\n\tProductPackage: UqID<any> & IDXEntity<any>;\n\tMarket: UqID<any> & IDXEntity<any>;\n\tPackageVersion: UqID<any> & IDXEntity<any>;\n\tProject: UqID<any> & IDXEntity<any>;\n\tTicket: UqID<any> & IDXEntity<any>;\n\tTicketType: UqID<any> & IDXEntity<any>;\n\tSource: UqID<any> & IDXEntity<any>;\n\tPackageCustomer: UqID<any> & IDXEntity<any>;\n\tTicketSheet: UqID<any> & IDXEntity<any>;\n\tSourceCustomer: UqID<any> & IDXEntity<any>;\n\tTicketNode: UqID<any> & IDXEntity<any>;\n\tStaff: UqID<any> & IDXEntity<any>;\n\tSourceCustomerSheet: UqID<any> & IDXEntity<any>;\n\tTicketState: UqID<any> & IDXEntity<any>;\n\tTicketAssess: UqID<any> & IDXEntity<any>;\n}\n\nexport function assign(uq: any, to:string, from:any): void {\n\tlet hasEntity = uq.hasEntity(to);\n\tif (hasEntity === false) {\n\t\treturn;\n\t}\n\tObject.assign((uq as any)[to], from);\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { Customer } from \"./JsTicket\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tno: {\n\t\t\"name\": \"no\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"No\"\n\t} as FieldItemString,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\tvice: {\n\t\t\"name\": \"vice\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Vice\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.no, fields.name, fields.vice, \n];\n\nexport const ui: UI = {\n\tlabel: \"Customer\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: Customer):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { ProductPackage } from \"./JsTicket\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\tvice: {\n\t\t\"name\": \"vice\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Vice\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.name, fields.vice, \n];\n\nexport const ui: UI = {\n\tlabel: \"ProductPackage\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: ProductPackage):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { Market } from \"./JsTicket\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tno: {\n\t\t\"name\": \"no\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"No\"\n\t} as FieldItemString,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\tvice: {\n\t\t\"name\": \"vice\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Vice\"\n\t} as FieldItemString,\n\ticon: {\n\t\t\"name\": \"icon\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Icon\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.no, fields.name, fields.vice, fields.icon, \n];\n\nexport const ui: UI = {\n\tlabel: \"Market\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: Market):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { PackageVersion } from \"./JsTicket\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tpackage: {\n\t\t\"name\": \"package\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Package\"\n\t} as FieldItemId,\n\tversion: {\n\t\t\"name\": \"version\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Version\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.package, fields.version, \n];\n\nexport const ui: UI = {\n\tlabel: \"PackageVersion\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: PackageVersion):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { Project } from \"./JsTicket\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tno: {\n\t\t\"name\": \"no\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"No\"\n\t} as FieldItemString,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\tvice: {\n\t\t\"name\": \"vice\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Vice\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.no, fields.name, fields.vice, \n];\n\nexport const ui: UI = {\n\tlabel: \"Project\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: Project):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { Ticket } from \"./JsTicket\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tdiscription: {\n\t\t\"name\": \"discription\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Discription\"\n\t} as undefined,\n\tcreator: {\n\t\t\"name\": \"creator\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Creator\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.discription, fields.creator, \n];\n\nexport const ui: UI = {\n\tlabel: \"Ticket\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: Ticket):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { TicketType } from \"./JsTicket\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\tvice: {\n\t\t\"name\": \"vice\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Vice\"\n\t} as FieldItemString,\n\tfirstState: {\n\t\t\"name\": \"firstState\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"FirstState\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.name, fields.vice, fields.firstState, \n];\n\nexport const ui: UI = {\n\tlabel: \"TicketType\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TicketType):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { Source } from \"./JsTicket\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\tvice: {\n\t\t\"name\": \"vice\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Vice\"\n\t} as FieldItemString,\n\ttype: {\n\t\t\"name\": \"type\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Type\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.name, fields.vice, fields.type, \n];\n\nexport const ui: UI = {\n\tlabel: \"Source\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: Source):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { PackageCustomer } from \"./JsTicket\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tpackageVersion: {\n\t\t\"name\": \"packageVersion\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"PackageVersion\"\n\t} as FieldItemId,\n\tcustomer: {\n\t\t\"name\": \"customer\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Customer\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.packageVersion, fields.customer, \n];\n\nexport const ui: UI = {\n\tlabel: \"PackageCustomer\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: PackageCustomer):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { TicketSheet } from \"./JsTicket\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tcreator: {\n\t\t\"name\": \"creator\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Creator\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.creator, \n];\n\nexport const ui: UI = {\n\tlabel: \"TicketSheet\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TicketSheet):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { SourceCustomer } from \"./JsTicket\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tmain: {\n\t\t\"name\": \"main\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Main\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.main, \n];\n\nexport const ui: UI = {\n\tlabel: \"SourceCustomer\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: SourceCustomer):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { TicketNode } from \"./JsTicket\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tticket: {\n\t\t\"name\": \"ticket\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Ticket\"\n\t} as FieldItemId,\n\tprev: {\n\t\t\"name\": \"prev\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Prev\"\n\t} as FieldItemId,\n\tstate: {\n\t\t\"name\": \"state\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"State\"\n\t} as FieldItemId,\n\toperator: {\n\t\t\"name\": \"operator\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Operator\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.ticket, fields.prev, fields.state, fields.operator, \n];\n\nexport const ui: UI = {\n\tlabel: \"TicketNode\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TicketNode):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { Staff } from \"./JsTicket\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tno: {\n\t\t\"name\": \"no\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"No\"\n\t} as FieldItemString,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.no, fields.name, \n];\n\nexport const ui: UI = {\n\tlabel: \"Staff\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: Staff):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { SourceCustomerSheet } from \"./JsTicket\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tno: {\n\t\t\"name\": \"no\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"No\"\n\t} as FieldItemString,\n\tcustomer: {\n\t\t\"name\": \"customer\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Customer\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.no, fields.customer, \n];\n\nexport const ui: UI = {\n\tlabel: \"SourceCustomerSheet\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: SourceCustomerSheet):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { TicketState } from \"./JsTicket\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tmain: {\n\t\t\"name\": \"main\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Main\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\tvice: {\n\t\t\"name\": \"vice\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Vice\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.main, fields.name, fields.vice, \n];\n\nexport const ui: UI = {\n\tlabel: \"TicketState\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TicketState):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { TicketAssess } from \"./JsTicket\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\tvice: {\n\t\t\"name\": \"vice\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Vice\"\n\t} as FieldItemString,\n\tmin: {\n\t\t\"name\": \"min\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Min\"\n\t} as FieldItemInt,\n\tmax: {\n\t\t\"name\": \"max\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Max\"\n\t} as FieldItemInt,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.name, fields.vice, fields.min, fields.max, \n];\n\nexport const ui: UI = {\n\tlabel: \"TicketAssess\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TicketAssess):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","//=== UqApp builder created on Fri Dec 10 2021 14:54:39 GMT-0500 (北美东部标准时间) ===//\nimport * as JsTicket from './JsTicket';\n\nexport interface UQs {\n\tJsTicket: JsTicket.UqExt;\n}\n\nexport * as JsTicket from './JsTicket';\n\nexport function setUI(uqs:UQs) {\n\tJsTicket.setUI(uqs.JsTicket);\n}\n","import { UqExt as Uq, assign } from './JsTicket';\nimport * as Customer from './Customer.ui';\nimport * as ProductPackage from './ProductPackage.ui';\nimport * as Market from './Market.ui';\nimport * as PackageVersion from './PackageVersion.ui';\nimport * as Project from './Project.ui';\nimport * as Ticket from './Ticket.ui';\nimport * as TicketType from './TicketType.ui';\nimport * as Source from './Source.ui';\nimport * as PackageCustomer from './PackageCustomer.ui';\nimport * as TicketSheet from './TicketSheet.ui';\nimport * as SourceCustomer from './SourceCustomer.ui';\nimport * as TicketNode from './TicketNode.ui';\nimport * as Staff from './Staff.ui';\nimport * as SourceCustomerSheet from './SourceCustomerSheet.ui';\nimport * as TicketState from './TicketState.ui';\nimport * as TicketAssess from './TicketAssess.ui';\n\t\nexport function setUI(uq: Uq) {\n\tassign(uq, 'Customer', Customer);\n\tassign(uq, 'ProductPackage', ProductPackage);\n\tassign(uq, 'Market', Market);\n\tassign(uq, 'PackageVersion', PackageVersion);\n\tassign(uq, 'Project', Project);\n\tassign(uq, 'Ticket', Ticket);\n\tassign(uq, 'TicketType', TicketType);\n\tassign(uq, 'Source', Source);\n\tassign(uq, 'PackageCustomer', PackageCustomer);\n\tassign(uq, 'TicketSheet', TicketSheet);\n\tassign(uq, 'SourceCustomer', SourceCustomer);\n\tassign(uq, 'TicketNode', TicketNode);\n\tassign(uq, 'Staff', Staff);\n\tassign(uq, 'SourceCustomerSheet', SourceCustomerSheet);\n\tassign(uq, 'TicketState', TicketState);\n\tassign(uq, 'TicketAssess', TicketAssess);\n}\nexport * from './JsTicket';\n","import { FA, List, LMR, View } from \"tonwa\";\r\nimport { ReturnMyTicketsRet } from \"uq-app/uqs/JsTicket\";\r\nimport { CTicket } from \".\";\r\n\r\nexport class VMyTickets extends View<CTicket> {\r\n    render() {\r\n        return this.react(() => {\r\n            let { data } = this.controller;\r\n            let { myTickets } = data;\r\n            return <List none=\"[无工单]\"\r\n                items={myTickets}\r\n                item={{ render: this.renderMyTicket, onClick: this.onMyTicket, key: item => item.ticket }}\r\n            />;\r\n        })\r\n    }\r\n\r\n    private renderMyTicket = (item: ReturnMyTicketsRet, index: number) => {\r\n        // eslint-disable-next-line\r\n        let { ticket, node, discription, state, from } = item;\r\n        let { JsTicket } = this.controller.uqs;\r\n        let left = <div className=\"d-block\">\r\n            <div className=\"small text-muted\">\r\n                <FA name=\"user-o\" className=\"me-2\" />\r\n                {JsTicket.IDRender(from)}\r\n            </div>\r\n            <div>{discription}</div>\r\n            <div>{JsTicket.IDLocalRender(state)}</div>\r\n        </div>;\r\n        return <LMR className=\"px-3 py-2\" left={left}>\r\n        </LMR>;\r\n    }\r\n\r\n    private onMyTicket = (item: ReturnMyTicketsRet) => {\r\n        alert(JSON.stringify(item));\r\n    }\r\n}\r\n","import { CStaff } from \"ids/staff\";\r\nimport { ChangeEvent } from \"react\";\r\nimport { FA, VPage } from \"tonwa\";\r\nimport { CTicket } from \".\";\r\n\r\nexport class VTicketNew extends VPage<CTicket> {\r\n    data: {\r\n        buttonDisabled: boolean;\r\n    };\r\n    private textarea: HTMLTextAreaElement;\r\n    constructor(cTicket: CTicket) {\r\n        super(cTicket);\r\n        this.data = this.shallow({\r\n            buttonDisabled: true,\r\n        });\r\n    }\r\n    header() { return '新建工单' }\r\n    right() {\r\n        return this.react(() => {\r\n            return <button\r\n                disabled={this.data.buttonDisabled}\r\n                className=\"btn btn-sm btn-success me-2\"\r\n                onClick={this.saveTicket}>\r\n                <FA name=\"paper-plane-o\" className=\"me-1\" /> 提交\r\n            </button>;\r\n        });\r\n    }\r\n\r\n    content() {\r\n        return <div className=\"m-3\">\r\n            <div className=\"mb-3 row\">\r\n                <label htmlFor=\"staticStaff\" className=\"col-sm-2 col-form-label text-right\">经办人</label>\r\n                <div className=\"col-sm-10\">\r\n                    {\r\n                        this.react(() => {\r\n                            let { selectedStaff: staff } = this.controller.data;\r\n                            let placeholder: string;\r\n                            let value: string;\r\n                            if (staff) {\r\n                                value = staff.name;\r\n                            }\r\n                            else {\r\n                                placeholder = ' 点击选择经办人';\r\n                            }\r\n                            return <input type=\"text\" readOnly={true}\r\n                                placeholder={placeholder}\r\n                                onClick={this.onSelectStaff}\r\n                                value={value}\r\n                                className=\"cursor-pointer form-control-plaintext bg-light border px-2\" id=\"staticStaff\" />\r\n                        })\r\n                    }\r\n                </div>\r\n            </div>\r\n            <textarea ref={tt => this.textarea = tt}\r\n                className=\"w-100 rounded form-control\"\r\n                onChange={this.onChange}\r\n                style={{ height: '75vh', }} />\r\n        </div>\r\n    }\r\n\r\n    private saveTicket = async () => {\r\n        await this.controller.saveTicket(this.textarea.value);\r\n        this.closePage();\r\n    }\r\n\r\n    private onChange = (e: ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.runInAction(() => {\r\n            this.data.buttonDisabled = e.currentTarget.value.trim().length === 0;\r\n        });\r\n    }\r\n\r\n    private onSelectStaff = async () => {\r\n        let cStaff = this.controller.cApp.newC(CStaff);\r\n        let staff = await cStaff.selectStaff();\r\n        this.controller.setStaff(staff);\r\n    }\r\n}","import { CUqBase } from \"uq-app\";\r\nimport { ReturnMyTicketsRet, Staff } from \"uq-app/uqs/JsTicket\";\r\nimport { VMyTickets } from \"./VMyTickets\";\r\nimport { VTicketNew } from \"./VTicketNew\";\r\n\r\nclass TicketData {\r\n    myTickets: ReturnMyTicketsRet[];\r\n    selectedStaff: Staff;\r\n}\r\n\r\nexport class CTicket extends CUqBase {\r\n    data: TicketData;\r\n\r\n    init(...param: any[]): void {\r\n        this.data = this.shallow({\r\n            myTickets: undefined,\r\n            selectedStaff: undefined,\r\n        } as TicketData);\r\n    }\r\n\r\n    async loadMyTicket() {\r\n        let ret = await this.uqs.JsTicket.MyTickets.query({});\r\n        this.runInAction(() => {\r\n            this.data.myTickets = ret.ret;\r\n        });\r\n    }\r\n\r\n    newTicket = () => {\r\n        this.data.selectedStaff = undefined;\r\n        this.openVPage(VTicketNew);\r\n    }\r\n\r\n    renderMyTickets() {\r\n        return this.renderView(VMyTickets);\r\n    }\r\n\r\n    setStaff(staff: Staff) {\r\n        this.runInAction(() => {\r\n            this.data.selectedStaff = staff;\r\n        });\r\n    }\r\n\r\n    saveTicket = async (discription: string) => {\r\n        await this.uqs.JsTicket.SaveTicket.submit({ to: this.data.selectedStaff.id, discription });\r\n    }\r\n}\r\n","import { CHome } from \"../home\";\r\nimport { CMe } from \"../me\";\r\nimport { CUqApp } from \"./CBase\";\r\nimport { res } from \"./res\";\r\nimport { VMain } from \"./VMain\";\r\nimport { setUI } from \"./uqs\";\r\nimport { makeObservable, observable, runInAction } from \"mobx\";\r\nimport { start } from \"tonwa\";\r\nimport { appConfig } from \"./appConfig\";\r\nimport { Tonwa } from \"tonwa-core\";\r\nimport { CTicket } from \"ids/ticket\";\r\n\r\nconst gaps = [10, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5, 10, 10, 10, 10, 15, 15, 15, 30, 30, 60];\r\n\r\nexport interface Title {\r\n\ttitle: string;\r\n\tvice?: string;\r\n\tunit?: string;\r\n\tfixed?: number;\r\n}\r\n\r\n\r\nexport class CApp extends CUqApp {\r\n\tconstructor(tonwa: Tonwa) {\r\n\t\tsuper(tonwa, appConfig);\r\n\t}\r\n\r\n\tcHome: CHome;\r\n\tcMe: CMe;\r\n\tcTicket: CTicket;\r\n\r\n\tprotected async internalStart(isUserLogin: boolean) {\r\n\t\tmakeObservable(this, {\r\n\t\t\trefreshTime: observable\r\n\t\t});\r\n\t\tthis.setRes(res);\r\n\t\tsetUI(this.uqs);\r\n\r\n\t\tawait this.loadBaseData();\r\n\r\n\t\tthis.cHome = this.newC(CHome);\r\n\t\tthis.cMe = this.newC(CMe);\r\n\t\tthis.cTicket = this.newC(CTicket);\r\n\t\tthis.cHome.load();\r\n\t\tthis.openVPage(VMain, undefined, this.dispose);\r\n\t\t// 加上下面一句，可以实现主动页面刷新\r\n\t\tthis.timer = setInterval(this.callTick, 1000);\r\n\t\t// uq 里面加入这一句，会让相应的$Poked查询返回poke=1：\r\n\t\t// TUID [$User] ID (member) SET poke=1;\r\n\t}\r\n\r\n\tprivate timer: any;\r\n\tprotected onDispose() {\r\n\t\tclearInterval(this.timer);\r\n\t\tthis.timer = undefined;\r\n\t}\r\n\r\n\tasync initStart() {\r\n\t\tawait this.tonwa.appStart();\r\n\t}\r\n\r\n\trender(loginedOnly: boolean = true): JSX.Element {\r\n\t\tconst onLogined = async (isUserLogin?: boolean) => {\r\n\t\t\tawait start(CApp, this.tonwa, appConfig, isUserLogin);\r\n\t\t}\r\n\t\tlet onNotLogined: () => Promise<void> = undefined;\r\n\t\tif (loginedOnly === false) onNotLogined = onLogined;\r\n\t\treturn this.tonwa.nav.renderNavView(onLogined, onNotLogined);\r\n\t}\r\n\r\n\r\n\tprivate async loadBaseData() {\r\n\t\t/*\r\n\t\tlet { JkMe } = this.uqs;\r\n\t\tlet [retItemTitles, retPostTitles, retAccountTitles, roleOps, myTimezone] = await Promise.all([\r\n\t\t\tJkMe.GetItemTitles.query({}),\r\n\t\t\tJkMe.GetPostTitles.query({}),\r\n\t\t\tJkMe.GetAccountTitles.query({}),\r\n\t\t\tJkMe.GetRoleOps.query({}),\r\n\t\t\tJkMe.$getMyTimezone.query({}),\r\n\t\t]);\r\n\t\tfor (let it of retItemTitles.ret) this.itemTitles[it.id as Item] = it;\r\n\t\tfor (let pt of retPostTitles.ret) this.postTitles[pt.id as Post] = pt;\r\n\t\tfor (let at of retAccountTitles.ret) this.accountTitles[at.id as EnumAccount] = at;\r\n\t\tthis.ops = roleOps.ret;\r\n\t\tlet tz = myTimezone.ret[0];\r\n\t\tthis.timezone = tz.timezone;\r\n\t\tthis.unitTimezone = tz.unitTimeZone;\r\n\t\t*/\r\n\t}\r\n\r\n\t// 数据服务器提醒客户端刷新，下面代码重新调入的数据\r\n\trefresh = async () => {\r\n\t\tlet d = Date.now() / 1000;\r\n\t\tif (d - this.refreshTime < 30) return;\r\n\t\tawait Promise.all([\r\n\t\t\tthis.cHome.load(),\r\n\t\t]);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.refreshTime = d;\r\n\t\t});\r\n\t}\r\n\r\n\trefreshTime: number = Date.now() / 1000;\r\n\r\n\tprivate tick = 0;\r\n\tprivate gapIndex = 0;\r\n\tprivate callTick = async () => {\r\n\t\ttry {\r\n\t\t\tif (!this.user) return;\r\n\t\t\t++this.tick;\r\n\t\t\tif (this.tick < gaps[this.gapIndex]) return;\r\n\t\t\tthis.tick = 0;\r\n\t\t\tif (this.gapIndex < gaps.length - 1) ++this.gapIndex;\r\n\t\t\tlet ret = await this.uqs.JsTicket.$poked.query(undefined, undefined, false);\r\n\t\t\tlet v = ret.ret[0];\r\n\t\t\tif (v === undefined) return;\r\n\t\t\tif (!v.poke) return;\r\n\t\t\tthis.gapIndex = 1;\r\n\t\t\tawait this.refresh();\r\n\t\t}\r\n\t\tcatch {\r\n\t\t}\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { NavView, start, TonwaReact } from \"tonwa\";\r\nimport { CApp } from './CApp';\r\nimport { appConfig } from './appConfig';\r\n// import { App } from './App';\r\n\r\nexport async function startApp() {\r\n    let tonwa = new TonwaReact();\r\n    //initNav(tonwa);\r\n    tonwa.setSettings(appConfig);\r\n    const onLogined = async (isUserLogin?: boolean) => {\r\n        await start(CApp, tonwa, appConfig, isUserLogin);\r\n    }\r\n    const notLogined: () => Promise<void> = undefined;\r\n    const userPassword: () => Promise<{ user: string; password: string }> = undefined;\r\n    tonwa.appStart();\r\n    ReactDOM.render(\r\n        <React.StrictMode>\r\n            <NavView ref={navView => tonwa.set(navView)}\r\n                onLogined={onLogined}\r\n                notLogined={notLogined}\r\n                userPassword={userPassword} />\r\n        </React.StrictMode>,\r\n        document.getElementById('root')\r\n    );\r\n}\r\n","//import React from 'react';\n//import ReactDOM from 'react-dom';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport './index.css';\nimport { startApp } from './uq-app';\n//import App from './App';\n//import reportWebVitals from './reportWebVitals';\n\n(function () {\n  startApp();\n})();\n/*\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n*/"],"sourceRoot":""}